<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>udemy-PythonPROè®­ç»ƒè¥</title>
      <link href="/2023/02/12/udemy-pythonpro-xun-lian-ying/udemy-pythonpro-xun-lian-ying/udemy-pythonpro-xun-lian-ying/"/>
      <url>/2023/02/12/udemy-pythonpro-xun-lian-ying/udemy-pythonpro-xun-lian-ying/udemy-pythonpro-xun-lian-ying/</url>
      
        <content type="html"><![CDATA[<h1 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h1><p><img src="img.png" alt="img.png"></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>udemy-Pythonæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ è®­ç»ƒè¥</title>
      <link href="/2023/02/12/udemy-python-shu-ju-ke-xue-he-ji-qi-xue-xi-xun-lian-ying/udemy-python-shu-ju-ke-xue-he-ji-qi-xue-xi-xun-lian-ying/udemy-python-shu-ju-ke-xue-he-ji-qi-xue-xi-xun-lian-ying/"/>
      <url>/2023/02/12/udemy-python-shu-ju-ke-xue-he-ji-qi-xue-xi-xun-lian-ying/udemy-python-shu-ju-ke-xue-he-ji-qi-xue-xi-xun-lian-ying/udemy-python-shu-ju-ke-xue-he-ji-qi-xue-xi-xun-lian-ying/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®ç§‘å­¦"><a href="#æ•°æ®ç§‘å­¦" class="headerlink" title="æ•°æ®ç§‘å­¦"></a>æ•°æ®ç§‘å­¦</h1><blockquote><p>ä»æ•°æ®æå–ä»·å€¼</p></blockquote><ol><li><strong>data engineer</strong> æ”¶é›†æ•°æ®</li><li><strong>data scientist</strong> åˆ†æ,å¯è§†åŒ–</li><li><strong>machine learning expert</strong> æ™ºèƒ½ç®—æ³•åˆ†ææ–°æ•°æ®, å¾—å‡ºç»“è®º</li></ol><p><img src="5C1676184385567.png" alt="1676184385567"></p><h1 id="ç”¨æ•°æ®ç§‘å­¦è§£å†³é—®é¢˜-çº¿æ€§å›å½’"><a href="#ç”¨æ•°æ®ç§‘å­¦è§£å†³é—®é¢˜-çº¿æ€§å›å½’" class="headerlink" title="ç”¨æ•°æ®ç§‘å­¦è§£å†³é—®é¢˜ + çº¿æ€§å›å½’"></a>ç”¨æ•°æ®ç§‘å­¦è§£å†³é—®é¢˜ + çº¿æ€§å›å½’</h1><blockquote><p>çº¿æ€§å›å½’ -&gt; å»ºæ¨¡, å‘ç°æ½œåœ¨è”ç³»</p></blockquote><p>æ•°æ®åˆ†æç§‘å­¦å®¶ä¼š: </p><ol><li><strong>formulate question</strong> æå‡ºè¦å›ç­”çš„é—®é¢˜</li><li><strong>gather data</strong> æ”¶é›†(æœ‰åŠ©äºå›ç­”é—®é¢˜çš„)æ•°æ®</li><li><strong>clean data</strong> æ¸…ç†æ— ç”¨æ•°æ®(å™ªå£°)</li><li><strong>explore &amp; visualise</strong> æ¢ç©¶ä¸å¯è§†åŒ–</li><li><strong>train algorithm</strong> è®­ç»ƒç®—æ³• (æœ¬èŠ‚çš„ç®—æ³•æ˜¯çº¿æ€§å›å½’)</li><li><strong>evaluate</strong> è¯„ä¼°ç»“æœ</li></ol><p><img src="5C1676185079157.png" alt="æ•°æ®ç§‘å­¦æ­¥éª¤"></p><h2 id="step1-ä¸€ä¸ªå¥½é—®é¢˜"><a href="#step1-ä¸€ä¸ªå¥½é—®é¢˜" class="headerlink" title="step1 ä¸€ä¸ªå¥½é—®é¢˜"></a>step1 ä¸€ä¸ªå¥½é—®é¢˜</h2><ul><li>æˆ‘çš„ç”µå½±èƒ½èµšå¤šå°‘ğŸ’´ =&gt; ä¸æ˜¯å¥½é—®é¢˜, å¤ªæ¨¡ç³Šfakeäº†, é‡‘é’±moneyçš„å®šä¹‰?</li><li>æˆ‘çš„ç”µå½±å¯ä»¥èµšå¤šå°‘æ”¶å…¥(revenue) =&gt; æ¯”é‡‘é’±moneyæ›´å…·ä½“, å¯ä»¥æ›´å¥½åœ°å®šé‡åˆ†æ(æµ‹é‡, è¿½è¸ª)</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç”µå½±é¢„ç®—æ¥é¢„æµ‹ç”µå½±æ”¶å…¥å— =&gt; å¤šäº†ä¸€ä¸ªxè‡ªå˜é‡, ä»–æ˜¯å¯æµ‹è¯•çš„(å¯ä»¥æ£€æŸ¥é¢„ç®—xå’Œæ”¶å…¥yæ˜¯å¦å­˜åœ¨å…³ç³») , è¿™é‡Œçš„<strong>y</strong>å°±æ˜¯<strong>dependent variable <strong>æˆ– æœºå™¨å­¦ä¹ ä¸­çš„</strong>target</strong>, è€Œ<strong>x</strong>åˆ™æ˜¯ <strong>independent variable</strong> æˆ– æœºå™¨å­¦ä¹ ä¸­çš„ <strong>feature</strong></li></ul><p><img src="5C1676185484462.png" alt="1676185484462"></p><h2 id="step2-æ”¶é›†æ•°æ®"><a href="#step2-æ”¶é›†æ•°æ®" class="headerlink" title="step2 æ”¶é›†æ•°æ®"></a>step2 æ”¶é›†æ•°æ®</h2><ol><li><strong>data on feature</strong> è‡ªå˜é‡x ç”µå½±é¢„ç®—</li><li><strong>data on target</strong> å› å˜é‡y ç”µå½±æ”¶å…¥</li></ol><p><img src="5C1676185936970.png" alt="1676185936970"></p><h3 id="å»å“ªè·å–æ•°æ®-the-numbers"><a href="#å»å“ªè·å–æ•°æ®-the-numbers" class="headerlink" title="å»å“ªè·å–æ•°æ®? the numbers"></a>å»å“ªè·å–æ•°æ®? the numbers</h3><p><a href="https://www.the-numbers.com/">the numbers</a></p><p><a href="https://www.the-numbers.com/movie/budgets/all">budgets</a></p><p><img src="5C1676186758255.png" alt="è¯¾ç¨‹èµ„æ–™çš„csvæ–‡ä»¶"></p><p><img src="5C1676186853728.png" alt="å­˜åœ¨ç©ºæ•°æ®,éœ€è¦è¿›è¡Œå¤„ç†"></p><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><blockquote><p>æ•°æ® -&gt; æ’åºå’Œç­›é€‰ -&gt; ä¸éœ€è¦åŒ…å«æ ‡é¢˜ -&gt; æ’åºåˆ— -&gt; æ’åº</p></blockquote><p><img src="5C1676187177869.png" alt="1676187177869"></p><blockquote><p>ä¸º0çš„æ•°æ®å¯èƒ½æ˜¯å› ä¸ºä»æœªä¸Šæ˜ (æ²¡æœ‰æ•°æ®) æˆ– æ•°æ®æœ‰é—®é¢˜/äº‰è®®</p></blockquote><p><img src="5C1676187203915.png" alt="æ’åºç»“æœ"></p><h2 id="step3-æ¸…ç†æ•°æ®"><a href="#step3-æ¸…ç†æ•°æ®" class="headerlink" title="step3 æ¸…ç†æ•°æ®"></a>step3 æ¸…ç†æ•°æ®</h2><ol><li><p>é€‰å–æ‰€æœ‰å«0æ•°æ®çš„é¡¹ -&gt; å³é”®åˆ é™¤</p></li><li><p>åˆ é™¤å‰ä¸‰åˆ—å’Œæœ€åä¸€åˆ—,ç•™ä¸‹Production Budgetå’ŒWorldwide Gross, å› ä¸ºå¯¹è®¡ç®—æ²¡æœ‰ç”¨</p></li><li><p>å°†$x,000,000 æ ¼å¼è½¬ä¸ºçº¯æ•°å­—æ ¼å¼</p></li><li><p>é‡å‘½ååˆ—å(å»æ‰ç‰¹æ®Šç¬¦å·)</p></li></ol><p><img src="5C1676188509895.png" alt="è½¬æ¢æ ¼å¼"></p><p><img src="5C1676188624574.png" alt="1676188624574"><img src="5C1676188639640.png" alt="1676188639640"></p><p><img src="5C1676188831845.png" alt="åˆ—å"></p><p><img src="5C1676188889862.png" alt="æ•°æ®æ¸…æ´—æ­¥éª¤"></p><h2 id="step4-å¯è§†åŒ–æ•°æ®"><a href="#step4-å¯è§†åŒ–æ•°æ®" class="headerlink" title="step4 å¯è§†åŒ–æ•°æ®"></a>step4 å¯è§†åŒ–æ•°æ®</h2>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
          <category> æ•°æ®ç§‘å­¦ </category>
          
          <category> ai </category>
          
          <category> äººå·¥æ™ºèƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> æ•°æ®ç§‘å­¦ </tag>
            
            <tag> ai </tag>
            
            <tag> äººå·¥æ™ºèƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3å®ç°ä½ä»£ç ç¼–è¾‘å™¨</title>
      <link href="/2023/02/07/vue3-shi-xian-di-dai-ma-bian-ji-qi/vue3-shi-xian-di-dai-ma-bian-ji-qi/vue3-shi-xian-di-dai-ma-bian-ji-qi/"/>
      <url>/2023/02/07/vue3-shi-xian-di-dai-ma-bian-ji-qi/vue3-shi-xian-di-dai-ma-bian-ji-qi/vue3-shi-xian-di-dai-ma-bian-ji-qi/</url>
      
        <content type="html"><![CDATA[<p><img src="img.png" alt="ä½ä»£ç çš„ä½œç”¨"></p><h1 id="æ‹–æ‹½ç¼–è¾‘å™¨æ­å»º"><a href="#æ‹–æ‹½ç¼–è¾‘å™¨æ­å»º" class="headerlink" title="æ‹–æ‹½ç¼–è¾‘å™¨æ­å»º"></a>æ‹–æ‹½ç¼–è¾‘å™¨æ­å»º</h1><pre class=" language-shell"><code class="language-shell">vue create low-codeyarn add element-plus</code></pre><p><img src="img_1.png" alt="img_1.png"><br><img src="img_2.png" alt="img_2.png"><br><img src="img_3.png" alt="img_3.png"></p><blockquote><p>æŠŠæ‹–æ›³ç»„ä»¶çš„æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªjsonæ–‡ä»¶é‡Œ</p></blockquote><h1 id="package"><a href="#package" class="headerlink" title="package/"></a>package/</h1><h2 id="editor-block-jsx"><a href="#editor-block-jsx" class="headerlink" title="editor-block.jsx"></a>editor-block.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    block<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Object <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> blockStyles <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>      top<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px`</span></span><span class="token punctuation">,</span>      left<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px`</span></span><span class="token punctuation">,</span>      zIndex<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>zIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// æ ¹æ®keyè·å–ç»„ä»¶</span>      <span class="token keyword">const</span> component <span class="token operator">=</span> config<span class="token punctuation">.</span>componentMap<span class="token punctuation">[</span>props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// è·å–æ¸²æŸ“ç»„ä»¶</span>      <span class="token keyword">const</span> RenderComponent <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-block<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>blockStyles<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>          <span class="token punctuation">{</span>RenderComponent<span class="token punctuation">}</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h2 id="editor-jsx"><a href="#editor-jsx" class="headerlink" title="editor.jsx"></a>editor.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">"./editor.scss"</span><span class="token punctuation">;</span><span class="token keyword">import</span> EditorBlock <span class="token keyword">from</span> <span class="token string">"./editor-block"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ¥æ”¶çˆ¶çº§ä¼ æ¥çš„æ•°æ®</span>    modelValue<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Object <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> props<span class="token punctuation">.</span>modelValue<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(props.data);</span>    <span class="token comment" spellcheck="true">// console.log(props.modelValue);</span>    <span class="token comment" spellcheck="true">// console.log(data.value);</span>    <span class="token keyword">const</span> containerStyles <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>      width<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">,</span>      height<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* æ ¹æ®æ³¨å†Œåˆ—è¡¨,æ¸²æŸ“ç‰©æ–™åŒº */</span><span class="token punctuation">}</span>          <span class="token punctuation">{</span>config<span class="token punctuation">.</span>componentList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-left-item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>component<span class="token punctuation">.</span>label<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>component<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>èœå•æ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å±æ€§æ§åˆ¶æ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* è´Ÿè´£äº§ç”Ÿæ»šåŠ¨æ¡ */</span><span class="token punctuation">}</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-container-canvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* äº§ç”Ÿå†…å®¹åŒºåŸŸ */</span><span class="token punctuation">}</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>              <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-container-canvas__content<span class="token punctuation">"</span></span>              <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>containerStyles<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span>            <span class="token punctuation">></span></span>              <span class="token punctuation">{</span>data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditorBlock</span> <span class="token attr-name">block</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>block<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EditorBlock</span><span class="token punctuation">></span></span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h2 id="editor-scss"><a href="#editor-scss" class="headerlink" title="editor.scss"></a>editor.scss</h2><pre class=" language-scss"><code class="language-scss"><span class="token selector">.editor </span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>    <span class="token selector"><span class="token parent important">&amp;</span>-left,    <span class="token parent important">&amp;</span>-right </span><span class="token punctuation">{</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">270</span>px<span class="token punctuation">;</span>        <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token parent important">&amp;</span>-left </span><span class="token punctuation">{</span>        <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token selector"><span class="token parent important">&amp;</span>-item </span><span class="token punctuation">{</span>            <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">250</span>px<span class="token punctuation">;</span>            <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">20</span>px auto<span class="token punctuation">;</span>            <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>            <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>            <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>            <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>            <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>            <span class="token property">cursor</span><span class="token punctuation">:</span> move<span class="token punctuation">;</span>            <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>            <span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>            <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>            <span class="token selector">> span </span><span class="token punctuation">{</span>                <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>                <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">96</span>, <span class="token number">205</span>, <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>                <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span>px<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token selector"><span class="token parent important">&amp;</span>::after </span><span class="token punctuation">{</span>                <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span>                <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>                <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#ccc</span><span class="token punctuation">;</span>                <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token parent important">&amp;</span>-right </span><span class="token punctuation">{</span>        <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token parent important">&amp;</span>-top </span><span class="token punctuation">{</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">280</span>px<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">280</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">80</span>px<span class="token punctuation">;</span>        <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token parent important">&amp;</span>-container </span><span class="token punctuation">{</span>        <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">80</span>px <span class="token number">270</span>px <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>        <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>        <span class="token selector"><span class="token parent important">&amp;</span>-canvas </span><span class="token punctuation">{</span>            <span class="token property">overflow</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>            <span class="token selector"><span class="token parent important">&amp;</span>__content </span><span class="token punctuation">{</span>                <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">20</span>px auto<span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// width: 550px;</span>                <span class="token comment" spellcheck="true">// height: 550px;</span>                <span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>                <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">.editor-block </span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><h1 id="utils"><a href="#utils" class="headerlink" title="utils/"></a>utils/</h1><h2 id="editor-config-jsx"><a href="#editor-config-jsx" class="headerlink" title="editor-config.jsx"></a>editor-config.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// åˆ—è¡¨åŒº,å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰çš„ç‰©æ–™</span><span class="token comment" spellcheck="true">// keyå¯¹åº”çš„ç»„ä»¶æ˜ å°„å…³ç³»</span><span class="token keyword">import</span> <span class="token punctuation">{</span> ElButton<span class="token punctuation">,</span> ElInput <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"element-plus"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">createEditorConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> componentList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> componentMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    componentList<span class="token punctuation">,</span>    componentMap<span class="token punctuation">,</span>    register<span class="token punctuation">:</span> <span class="token punctuation">(</span>component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// å­˜æ”¾</span>      componentList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>      componentMap<span class="token punctuation">[</span>component<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> component<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">let</span> registerConfig <span class="token operator">=</span> <span class="token function">createEditorConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>registerConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ³¨å†Œç»„ä»¶,æ¸²æŸ“ç‰©æ–™åŒºçš„ç¤ºä¾‹ç»„ä»¶</span>registerConfig<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  label<span class="token punctuation">:</span> <span class="token string">"æ–‡æœ¬"</span><span class="token punctuation">,</span>  preview<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"é¢„è§ˆæ–‡æœ¬"</span><span class="token punctuation">,</span>  render<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"æ¸²æŸ“æ–‡æœ¬"</span><span class="token punctuation">,</span>  key<span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>registerConfig<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  label<span class="token punctuation">:</span> <span class="token string">"æŒ‰é’®"</span><span class="token punctuation">,</span>  preview<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ElButton</span><span class="token punctuation">></span></span>é¢„è§ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ElButton</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>  render<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ElButton</span><span class="token punctuation">></span></span>æ¸²æŸ“æŒ‰é’®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ElButton</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>  key<span class="token punctuation">:</span> <span class="token string">"button"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>registerConfig<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  label<span class="token punctuation">:</span> <span class="token string">"è¾“å…¥æ¡†"</span><span class="token punctuation">,</span>  preview<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ElInput</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>é¢„è§ˆè¾“å…¥æ¡†<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ElInput</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>  render<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ElInput</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>æ¸²æŸ“è¾“å…¥æ¡†<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ElInput</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>  key<span class="token punctuation">:</span> <span class="token string">"input"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h1 id="src"><a href="#src" class="headerlink" title="src/"></a>src/</h1><h2 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a>App.vue</h2><pre class=" language-vue"><code class="language-vue"><template>  <div class="app">    <Editor v-model="state"></Editor>  </div></template><script>import { provide, ref } from "vue";// ç¼–è¾‘å™¨çš„è®¾ç½®å’Œä»£ç å—çš„æ•°æ®import data from "./data.json";import Editor from "./package/editor";import { registerConfig as config } from "./utils/editor-config";export default {    components: {    Editor,  },  setup() {    // console.log(data);    const state = ref(data);    // console.log(state.value);    // æš´éœ²ç»„ä»¶(ç‰©æ–™)çš„é…ç½®    provide("config", config);    return { state };  },};</script><style lang="scss" scoped>.app {  position: fixed;  top: 20px;  left: 20px;  right: 20px;  bottom: 20px;}</style> </code></pre><h2 id="data-json"><a href="#data-json" class="headerlink" title="data.json"></a>data.json</h2><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"container"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">550</span><span class="token punctuation">,</span>        <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">550</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"blocks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token property">"top"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>            <span class="token property">"left"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>            <span class="token property">"zIndex"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"text"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>            <span class="token property">"top"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>            <span class="token property">"left"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>            <span class="token property">"zIndex"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"button"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>            <span class="token property">"top"</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>            <span class="token property">"left"</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>            <span class="token property">"zIndex"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"input"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h2 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span> <span class="token keyword">import</span> ElementPlus <span class="token keyword">from</span> <span class="token string">'element-plus'</span><span class="token keyword">import</span> <span class="token string">'element-plus/dist/index.css'</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementPlus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span> </code></pre><h1 id="æ‹–æ‹½çš„å®ç°"><a href="#æ‹–æ‹½çš„å®ç°" class="headerlink" title="æ‹–æ‹½çš„å®ç°"></a>æ‹–æ‹½çš„å®ç°</h1><blockquote><p>drag,h5æä¾›çš„</p></blockquote><pre class=" language-shell"><code class="language-shell"># ç”¨äºæ·±åº¦æ‹·è´ yarn add deepcopy --registry=https://registry.npmmirror.com</code></pre><p><img src="img_4.png" alt="vue3è¯­æ³•ç³–"></p><h2 id="package-1"><a href="#package-1" class="headerlink" title="package"></a>package</h2><h3 id="editor-block-jsx-1"><a href="#editor-block-jsx-1" class="headerlink" title="editor-block.jsx"></a>editor-block.jsx</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    block<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Object <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> blockStyles <span class="token operator">=</span> <span class="token operator">...</span>    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(config);</span>    <span class="token keyword">const</span> blockRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// new -> æ‹–æ‹½é‡Šæ”¾åå±…ä¸­</span>    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// æ‹–æ‹½æ”¾å…¥æ—¶,è·å–è¯¥å…ƒç´ </span>      <span class="token comment" spellcheck="true">// console.log(blockRef.value);</span>      <span class="token keyword">let</span> <span class="token punctuation">{</span> offsetWidth<span class="token punctuation">,</span> offsetHeight <span class="token punctuation">}</span> <span class="token operator">=</span> blockRef<span class="token punctuation">.</span>value<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// æœ‰è¿™ä¸ªå±æ€§,è¯´æ˜æ˜¯æ‹–æ‹½æ¾æ‰‹æ”¾ç½®çš„,è¦å±…ä¸­(æ¸²æŸ“åé¼ æ ‡åœ¨è¿™ä¸ªç»„ä»¶æ­£ä¸­é—´)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>alignCenter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>left <span class="token operator">=</span> props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>left <span class="token operator">-</span> offsetWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>top <span class="token operator">=</span> props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>top <span class="token operator">-</span> offsetHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span>block<span class="token punctuation">.</span>alignCenter <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// new </span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// ......</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h3 id="editor-jsx-1"><a href="#editor-jsx-1" class="headerlink" title="editor.jsx"></a>editor.jsx</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">"./editor.scss"</span><span class="token punctuation">;</span><span class="token keyword">import</span> EditorBlock <span class="token keyword">from</span> <span class="token string">"./editor-block"</span><span class="token punctuation">;</span><span class="token keyword">import</span> deepcopy <span class="token keyword">from</span> <span class="token string">"deepcopy"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useMenuDrager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useMenuDragger"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useFocus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useFocus"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useBlockDragger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useBlockDragger"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ¥æ”¶çˆ¶çº§ä¼ æ¥çš„æ•°æ®</span>    <span class="token comment" spellcheck="true">// v-modelæ˜¯è¯­æ³•ç³–,å…¶ä¼ è¿›æ¥çš„propsåç§°å°±æ˜¯modelValue</span>    <span class="token comment" spellcheck="true">// &lt;input modelValue="xxx" @change="xxx" /></span>    modelValue<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Object <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  emits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"update:modelValue"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// è¦è§¦å‘çš„äº‹ä»¶</span>  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> props<span class="token punctuation">.</span>modelValue<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// console.log(newValue);</span>        <span class="token comment" spellcheck="true">// è§¦å‘äº‹ä»¶æ›´æ–°æ•°æ®,(v-modelè¯­æ³•ç³–æä¾›çš„)</span>        ctx<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"update:modelValue"</span><span class="token punctuation">,</span> <span class="token function">deepcopy</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(props.data);</span>    <span class="token comment" spellcheck="true">// console.log(props.modelValue);</span>    <span class="token comment" spellcheck="true">// console.log(data.value);</span>    <span class="token keyword">const</span> containerStyles <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>      width<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">,</span>      height<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> containerRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è·å–å†…å®¹åŒºåŸŸå¯¹åº”çš„domå…ƒç´ </span>    <span class="token comment" spellcheck="true">// 1,å®ç°èœå•æ‹–æ‹½åŠŸèƒ½</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> dragstart<span class="token punctuation">,</span> dragend <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMenuDrager</span><span class="token punctuation">(</span>containerRef<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2,å®ç°è·å–ç„¦ç‚¹</span>    <span class="token comment" spellcheck="true">// å®ç°ç»„ä»¶æ‹–æ‹½</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span> blockMousedown<span class="token punctuation">,</span> focusData <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFocus</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// æœ‰å¯èƒ½é€‰ä¸­åç›´æ¥è¿›è¡Œæ‹–æ‹½</span>      <span class="token comment" spellcheck="true">// console.log(focusData.value.focus);</span>      <span class="token function">mousedown</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 3,å®ç°æ‹–æ‹½å¤šä¸ªå…ƒç´ çš„åŠŸèƒ½</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span> mousedown <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useBlockDragger</span><span class="token punctuation">(</span>focusData<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ”¶é›†è·å–å’Œæ²¡æœ‰è·å–ç„¦ç‚¹çš„ç»„ä»¶(block)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* æ ¹æ®æ³¨å†Œåˆ—è¡¨,æ¸²æŸ“ç‰©æ–™åŒº,å¯ä»¥å®ç°h5çš„æ‹–æ‹½ */</span><span class="token punctuation">}</span>          <span class="token punctuation">{</span>config<span class="token punctuation">.</span>componentList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>            <span class="token operator">&lt;</span>div              draggable              <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-left-item"</span>              onDrag<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">dragstart</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> component<span class="token punctuation">)</span><span class="token punctuation">}</span>              <span class="token comment" spellcheck="true">// onDragEnd={dragend} åŸç”Ÿçš„æ— æ³•ç»‘å®š,ä¸çŸ¥é“ä¸ºå•¥</span>            <span class="token operator">></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>component<span class="token punctuation">.</span>label<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>component<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>èœå•æ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å±æ€§æ§åˆ¶æ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* è´Ÿè´£äº§ç”Ÿæ»šåŠ¨æ¡ */</span><span class="token punctuation">}</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editor-container-canvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* äº§ç”Ÿå†…å®¹åŒºåŸŸ */</span><span class="token punctuation">}</span>            <span class="token operator">&lt;</span>div              <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-container-canvas__content"</span>              ref<span class="token operator">=</span><span class="token punctuation">{</span>containerRef<span class="token punctuation">}</span>              style<span class="token operator">=</span><span class="token punctuation">{</span>containerStyles<span class="token punctuation">.</span>value<span class="token punctuation">}</span>              <span class="token comment" spellcheck="true">// ç‚¹å‡»ç»„ä»¶ä»¥å¤–çš„å†…å®¹åŒº,å¯ä»¥æŠŠfocuså–æ¶ˆ</span>              <span class="token comment" spellcheck="true">// onMouseDown={containerMouseDown}</span>            <span class="token operator">></span>              <span class="token punctuation">{</span>data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>                <span class="token operator">&lt;</span>EditorBlock                  <span class="token keyword">class</span><span class="token operator">=</span><span class="token punctuation">{</span>block<span class="token punctuation">.</span>focus <span class="token operator">?</span> <span class="token string">"editor-block-focus"</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// focusçš„è¯éœ€è¦æ·»åŠ æ ·å¼</span>                  block<span class="token operator">=</span><span class="token punctuation">{</span>block<span class="token punctuation">}</span>                  onMousedown<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">blockMousedown</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">}</span>                <span class="token operator">></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EditorBlock</span><span class="token punctuation">></span></span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h3 id="editor-scss-1"><a href="#editor-scss-1" class="headerlink" title="editor.scss"></a>editor.scss</h3><pre class=" language-scss"><code class="language-scss"><span class="token selector">.editor </span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//......</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ·»åŠ ä¸€ä¸ªä¼ªç±»</span><span class="token selector">.editor-block </span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// é˜²æ­¢è¢«é€‰ä¸­</span>    <span class="token selector"><span class="token parent important">&amp;</span>::after </span><span class="token punctuation">{</span>        <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">.editor-block-focus </span><span class="token punctuation">{</span>    <span class="token selector"><span class="token parent important">&amp;</span>::after </span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è™šçº¿</span>        <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">3</span>px dashed red<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="useBlockDragger-js"><a href="#useBlockDragger-js" class="headerlink" title="useBlockDragger.js"></a>useBlockDragger.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useBlockDragger</span><span class="token punctuation">(</span>focusData<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è®°å½•èµ·å§‹ä½ç½®</span>    <span class="token keyword">let</span> dragState <span class="token operator">=</span> <span class="token punctuation">{</span>        startX<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        startY<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> mouseup <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> mousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseup"</span><span class="token punctuation">,</span> mouseup<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> mousemove <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å–ç§»åŠ¨åçš„è·ç¦»</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">:</span> moveX<span class="token punctuation">,</span> clientY<span class="token punctuation">:</span> moveY <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>        <span class="token keyword">let</span> durX <span class="token operator">=</span> moveX <span class="token operator">-</span> dragState<span class="token punctuation">.</span>startX<span class="token punctuation">;</span>        <span class="token keyword">let</span> durY <span class="token operator">=</span> moveY <span class="token operator">-</span> dragState<span class="token punctuation">.</span>startY<span class="token punctuation">;</span>        focusData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>focus<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            block<span class="token punctuation">.</span>top <span class="token operator">=</span> dragState<span class="token punctuation">.</span>startPos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>top <span class="token operator">+</span> durY<span class="token punctuation">;</span>            block<span class="token punctuation">.</span>left <span class="token operator">=</span> dragState<span class="token punctuation">.</span>startPos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>left <span class="token operator">+</span> durX<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> mousedown <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        dragState <span class="token operator">=</span> <span class="token punctuation">{</span>            startX<span class="token punctuation">:</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>            startY<span class="token punctuation">:</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// è®°å½•æ¯ä¸€ä¸ªé€‰ä¸­çš„ä½ç½®</span>            startPos<span class="token punctuation">:</span> focusData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>focus<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token punctuation">,</span> left <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token punctuation">,</span> left <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> mousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseup"</span><span class="token punctuation">,</span> mouseup<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        mousedown    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="useFocus-js"><a href="#useFocus-js" class="headerlink" title="useFocus.js"></a>useFocus.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useFocus</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// è·å–å“ªäº›å…ƒç´ è¢«é€‰ä¸­</span>  <span class="token keyword">const</span> focusData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> focus <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> unfocused <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>      <span class="token punctuation">(</span>block<span class="token punctuation">.</span>focus <span class="token operator">?</span> focus <span class="token punctuation">:</span> unfocused<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      focus<span class="token punctuation">,</span>      unfocused<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> clearBlockFocus <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Mousedownäº‹ä»¶ä»…éœ€è¦æŒ‰é”®è¢«æŒ‰ä¸‹ï¼Œè€Œä¸éœ€è¦æ¾å¼€å³å¯å‘ç”Ÿ</span>  <span class="token keyword">const</span> blockMousedown <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// blockä¸Šæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå±æ€§focus,è·å–ç„¦ç‚¹åå°±å°†focuså˜ä¸ºtrue</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æŒ‰ä½shiftçš„æƒ…å†µ,å°±å¯ä»¥å¤šé€‰</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>      block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token operator">!</span>block<span class="token punctuation">.</span>focus<span class="token punctuation">;</span>      <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>block<span class="token punctuation">.</span>focus<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">clearBlockFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è¦æ¸…ç©ºå…¶ä»–blockçš„focus,å®ç°å•é€‰</span>      <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> containerMouseDown <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">clearBlockFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ç‚¹å‡»å®¹å™¨,è®©é€‰ä¸­çš„blockå¤±å»ç„¦ç‚¹</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// ä¸çŸ¥é“ä¸ºå•¥ç›´æ¥onxxxxç»‘å®šå¤±æ•ˆäº†</span>  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    document      <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".editor-container-canvas__content"</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousedown"</span><span class="token punctuation">,</span> containerMouseDown<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    blockMousedown<span class="token punctuation">,</span>    focusData<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><h3 id="useMenuDragger-js"><a href="#useMenuDragger-js" class="headerlink" title="useMenuDragger.js"></a>useMenuDragger.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMenuDrager</span><span class="token punctuation">(</span>containerRef<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> currentComponent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è®°å½•æ‹–æ‹½çš„ç»„ä»¶,dropæ—¶æ¸²æŸ“</span>  <span class="token keyword">const</span> dragenter <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"enter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¯¥å±æ€§æ§åˆ¶åœ¨æ‹–æ”¾æ“ä½œä¸­ç»™ç”¨æˆ·çš„åé¦ˆï¼ˆé€šå¸¸æ˜¯è§†è§‰ä¸Šçš„ï¼‰ã€‚å®ƒä¼šå½±å“åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­å…‰æ ‡çš„æ‰‹åŠ¿</span>    e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>dropEffect <span class="token operator">=</span> <span class="token string">"move"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> dragover <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// !!!</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> dragleave <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"leave"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>dropEffect <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> drop <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"drop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> blocks <span class="token operator">=</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å†…éƒ¨å·²ç»æ¸²æŸ“çš„ç»„ä»¶</span>    <span class="token comment" spellcheck="true">// console.log(data.value);</span>    <span class="token comment" spellcheck="true">// æ›´æ–°ç»„ä»¶çš„å±æ€§</span>    data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token operator">...</span>data<span class="token punctuation">.</span>value<span class="token punctuation">,</span>      blocks<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token operator">...</span>blocks<span class="token punctuation">,</span>        <span class="token punctuation">{</span>          top<span class="token punctuation">:</span> e<span class="token punctuation">.</span>offsetY<span class="token punctuation">,</span>          left<span class="token punctuation">:</span> e<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span>          zIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          key<span class="token punctuation">:</span> currentComponent<span class="token punctuation">.</span>key<span class="token punctuation">,</span>          alignCenter<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ¾æ‰‹æ—¶å±…ä¸­</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    currentComponent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> dragstart <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// dragenterè¿›å…¥å…ƒç´ ,æ·»åŠ ç§»åŠ¨æ ‡è¯†</span>    <span class="token comment" spellcheck="true">// dragoverç»è¿‡å…ƒç´ ,è¦é˜»æ­¢é»˜è®¤è¡Œä¸º,è´Ÿè´£ä¸èƒ½è§¦å‘drop</span>    <span class="token comment" spellcheck="true">// dragleaveç¦»å¼€å…ƒç´ ,å¢åŠ ç¦ç”¨æ ‡è¯†</span>    <span class="token comment" spellcheck="true">// dropæ¾æ‰‹æ—¶,æ ¹æ®æ‹–æ‹½çš„ç»„ä»¶æ·»åŠ åˆ°å†…å®¹åŒº</span>    <span class="token comment" spellcheck="true">// console.log(containerRef.value);</span>    <span class="token comment" spellcheck="true">// e.dataTransfer.dropEffect = "move";</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"dragover"</span><span class="token punctuation">,</span> dragover<span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"dragenter"</span><span class="token punctuation">,</span> dragenter<span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"dragleave"</span><span class="token punctuation">,</span> dragleave<span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"drop"</span><span class="token punctuation">,</span> drop<span class="token punctuation">)</span><span class="token punctuation">;</span>    currentComponent <span class="token operator">=</span> component<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    document      <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".editor-left-item"</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"dragend"</span><span class="token punctuation">,</span> dragend<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// æ‹–æ‹½ç»“æŸ,æ¸…ç†äº‹ä»¶</span>  <span class="token keyword">const</span> dragend <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"end! remove listener"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"dragover"</span><span class="token punctuation">,</span> dragover<span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"dragenter"</span><span class="token punctuation">,</span> dragenter<span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"dragleave"</span><span class="token punctuation">,</span> dragleave<span class="token punctuation">)</span><span class="token punctuation">;</span>    containerRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"drop"</span><span class="token punctuation">,</span> drop<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    dragstart<span class="token punctuation">,</span>    dragend<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><img src="img_5.png" alt="img_5.png"></p><h1 id="å®ç°æ‹–åŠ¨çš„è¾…åŠ©çº¿æ•ˆæœ"><a href="#å®ç°æ‹–åŠ¨çš„è¾…åŠ©çº¿æ•ˆæœ" class="headerlink" title="å®ç°æ‹–åŠ¨çš„è¾…åŠ©çº¿æ•ˆæœ"></a>å®ç°æ‹–åŠ¨çš„è¾…åŠ©çº¿æ•ˆæœ</h1><p><img src="img_6.png" alt="img_6.png"><img src="img_7.png" alt="img_7.png"></p><h2 id="useBlockDragger-js-1"><a href="#useBlockDragger-js-1" class="headerlink" title="useBlockDragger.js"></a>useBlockDragger.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span> <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useBlockDragger</span><span class="token punctuation">(</span>focusData<span class="token punctuation">,</span> lastSelectBlock<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è®°å½•èµ·å§‹ä½ç½®</span>    <span class="token keyword">let</span> dragState <span class="token operator">=</span> <span class="token punctuation">{</span>        startX<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        startY<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å“åº”å¼,è®©x,yåŒå‘ç»‘å®š</span>    <span class="token keyword">let</span> markline <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        x<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>        y<span class="token punctuation">:</span> <span class="token keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> mouseup <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> mousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseup"</span><span class="token punctuation">,</span> mouseup<span class="token punctuation">)</span><span class="token punctuation">;</span>        markline<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">null</span>        markline<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> mousemove <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å–ç§»åŠ¨åçš„è·ç¦»</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">:</span> moveX<span class="token punctuation">,</span> clientY<span class="token punctuation">:</span> moveY <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¡ç®—æœ€æ–°çš„leftå’Œtop,å»linesé‡Œæ‰¾è¦æ˜¾ç¤ºçš„çº¿</span>        <span class="token comment" spellcheck="true">// é¼ æ ‡ç§»åŠ¨å - é¼ æ ‡ç§»åŠ¨å‰ + left</span>        <span class="token keyword">let</span> left <span class="token operator">=</span> moveX <span class="token operator">-</span> dragState<span class="token punctuation">.</span>startX <span class="token operator">+</span> dragState<span class="token punctuation">.</span>startLeft        <span class="token keyword">let</span> top <span class="token operator">=</span> moveY <span class="token operator">-</span> dragState<span class="token punctuation">.</span>startY <span class="token operator">+</span> dragState<span class="token punctuation">.</span>startTop        <span class="token comment" spellcheck="true">// è®¡ç®—çº¿ è·ç¦»å‚ç…§ç‰©è¿˜æœ‰5pxå°±æ˜¾ç¤º</span>        <span class="token keyword">let</span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dragState<span class="token punctuation">.</span>lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> <span class="token punctuation">{</span> top<span class="token punctuation">:</span> t<span class="token punctuation">,</span> showTop<span class="token punctuation">:</span> s <span class="token punctuation">}</span> <span class="token operator">=</span> dragState<span class="token punctuation">.</span>lines<span class="token punctuation">.</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>t <span class="token operator">-</span> top<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                y <span class="token operator">=</span> s <span class="token comment" spellcheck="true">// çº¿è¦æ˜¾ç¤ºçš„ä½ç½®</span>                <span class="token comment" spellcheck="true">// å®ç°å¿«é€Ÿè´´åˆ</span>                <span class="token comment" spellcheck="true">// å®¹å™¨è·ç¦»é¡¶éƒ¨çš„è·ç¦»+ç›®æ ‡é«˜åº¦</span>                moveY <span class="token operator">=</span> dragState<span class="token punctuation">.</span>startY <span class="token operator">-</span> dragState<span class="token punctuation">.</span>startTop <span class="token operator">+</span> t                <span class="token keyword">break</span> <span class="token comment" spellcheck="true">// æ‰¾åˆ°ä¸€æ ¹çº¿å°±è·³å‡ºå¾ªç¯   </span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dragState<span class="token punctuation">.</span>lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">:</span> l<span class="token punctuation">,</span> showLeft<span class="token punctuation">:</span> s <span class="token punctuation">}</span> <span class="token operator">=</span> dragState<span class="token punctuation">.</span>lines<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>l <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                x <span class="token operator">=</span> s <span class="token comment" spellcheck="true">// çº¿è¦æ˜¾ç¤ºçš„ä½ç½®</span>                <span class="token comment" spellcheck="true">// å®ç°å¿«é€Ÿè´´åˆ</span>                <span class="token comment" spellcheck="true">// å®¹å™¨è·ç¦»é¡¶éƒ¨çš„è·ç¦»+ç›®æ ‡é«˜åº¦</span>                moveX <span class="token operator">=</span> dragState<span class="token punctuation">.</span>startX <span class="token operator">-</span> dragState<span class="token punctuation">.</span>startLeft <span class="token operator">+</span> l                <span class="token keyword">break</span> <span class="token comment" spellcheck="true">// æ‰¾åˆ°ä¸€æ ¹çº¿å°±è·³å‡ºå¾ªç¯   </span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// å®ç°è§†å›¾æ›´æ–°</span>        markline<span class="token punctuation">.</span>x <span class="token operator">=</span> x        markline<span class="token punctuation">.</span>y <span class="token operator">=</span> y        <span class="token comment" spellcheck="true">// .....</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> mousedown <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å–å®½é«˜</span>        <span class="token keyword">const</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> BWidth<span class="token punctuation">,</span> height<span class="token punctuation">:</span> BHeight <span class="token punctuation">}</span> <span class="token operator">=</span> lastSelectBlock<span class="token punctuation">.</span>value <span class="token comment" spellcheck="true">// æ‹–æ‹½çš„æœ€åä¸€ä¸ªå…ƒç´ </span>        dragState <span class="token operator">=</span> <span class="token punctuation">{</span>            startX<span class="token punctuation">:</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>            startY<span class="token punctuation">:</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>            startTop<span class="token punctuation">:</span> lastSelectBlock<span class="token punctuation">.</span>value<span class="token punctuation">.</span>top<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ‹–æ‹½å‰çš„ä½ç½®    </span>            startLeft<span class="token punctuation">:</span> lastSelectBlock<span class="token punctuation">.</span>value<span class="token punctuation">.</span>left<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// è®°å½•æ¯ä¸€ä¸ªé€‰ä¸­çš„ä½ç½®</span>            startPos<span class="token punctuation">:</span> focusData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>focus<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token punctuation">,</span> left <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token punctuation">,</span> left <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            lines<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">const</span> <span class="token punctuation">{</span> unfocused <span class="token punctuation">}</span> <span class="token operator">=</span> focusData<span class="token punctuation">.</span>value <span class="token comment" spellcheck="true">// è·å–å…¶ä»–æ²¡é€‰ä¸­çš„,ä»¥å®ƒä»¬çš„ä½ç½®åšè¾…åŠ©</span>                <span class="token keyword">let</span> lines <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// è®¡ç®—æ¨ªçº¿çš„ä½ç½®ç”¨yå­˜æ”¾ xå­˜çºµå‘</span>                unfocused<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    left<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    width<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>width<span class="token punctuation">,</span>                    height<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>height                <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// console.log(unfocused)</span>                unfocused<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                    <span class="token keyword">const</span> <span class="token punctuation">{</span> top<span class="token punctuation">:</span> ATop<span class="token punctuation">,</span> left<span class="token punctuation">:</span> ALeft<span class="token punctuation">,</span> width<span class="token punctuation">:</span> AWidth<span class="token punctuation">,</span> height<span class="token punctuation">:</span> AHeight <span class="token punctuation">}</span> <span class="token operator">=</span> block                    <span class="token comment" spellcheck="true">// å½“æ­¤å…ƒç´ æ‹–åŠ¨åˆ°Aå…ƒç´ å’Œtopä¸€è‡´æ—¶,è¦æ˜¾ç¤ºè¿™è¾…åŠ©çº¿,è¾…åŠ©çº¿çš„ä½ç½®å°±æ˜¯ATop</span>                    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showTop<span class="token punctuation">:</span> ATop<span class="token punctuation">,</span> top<span class="token punctuation">:</span> ATop <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é¡¶å¯¹é¡¶</span>                    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showTop<span class="token punctuation">:</span> ATop<span class="token punctuation">,</span> top<span class="token punctuation">:</span> ATop <span class="token operator">-</span> BHeight <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é¡¶å¯¹åº•</span>                    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showTop<span class="token punctuation">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> top<span class="token punctuation">:</span> ATop <span class="token operator">-</span> BHeight <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¸­å¯¹ä¸­</span>                    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showTop<span class="token punctuation">:</span> ATop <span class="token operator">+</span> AHeight<span class="token punctuation">,</span> top<span class="token punctuation">:</span> ATop <span class="token operator">+</span> AHeight <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åº•å¯¹é¡¶</span>                    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showTop<span class="token punctuation">:</span> ATop <span class="token operator">+</span> AHeight<span class="token punctuation">,</span> top<span class="token punctuation">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">+</span> BHeight <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åº•å¯¹åº•</span>                    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showLeft<span class="token punctuation">:</span> ALeft<span class="token punctuation">,</span> left<span class="token punctuation">:</span> ALeft <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å·¦å¯¹å·¦</span>                    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showLeft<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth<span class="token punctuation">,</span> left<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å³å¯¹å·¦</span>                    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showLeft<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> left<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> BWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¸­å¯¹ä¸­</span>                    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showLeft<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth<span class="token punctuation">,</span> left<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">-</span> BWidth <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å³å¯¹å³</span>                    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showLeft<span class="token punctuation">:</span> ALeft<span class="token punctuation">,</span> left<span class="token punctuation">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">-</span> BWidth <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å·¦å¯¹å³</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// console.log(lines) </span>                <span class="token keyword">return</span> lines            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> mousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseup"</span><span class="token punctuation">,</span> mouseup<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        mousedown<span class="token punctuation">,</span>        markline    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="useFocus-js-è·å–æœ€åä¸€ä¸ªæ‹–æ‹½å…ƒç´ "><a href="#useFocus-js-è·å–æœ€åä¸€ä¸ªæ‹–æ‹½å…ƒç´ " class="headerlink" title="useFocus.js è·å–æœ€åä¸€ä¸ªæ‹–æ‹½å…ƒç´ "></a>useFocus.js è·å–æœ€åä¸€ä¸ªæ‹–æ‹½å…ƒç´ </h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useFocus</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> selectIndex <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®°å½•æœ€åç‚¹å‡»çš„ç»„ä»¶çš„ç´¢å¼•</span>  <span class="token keyword">const</span> lastSelectBlock <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">[</span>selectIndex<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æœ€åç‚¹å‡»çš„å…ƒç´ </span>  <span class="token comment" spellcheck="true">// è·å–å“ªäº›å…ƒç´ è¢«é€‰ä¸­</span>  <span class="token keyword">const</span> focusData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> focus <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> unfocused <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>      <span class="token punctuation">(</span>block<span class="token punctuation">.</span>focus <span class="token operator">?</span> focus <span class="token punctuation">:</span> unfocused<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      focus<span class="token punctuation">,</span>      unfocused<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> clearBlockFocus <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    selectIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Mousedownäº‹ä»¶ä»…éœ€è¦æŒ‰é”®è¢«æŒ‰ä¸‹ï¼Œè€Œä¸éœ€è¦æ¾å¼€å³å¯å‘ç”Ÿ</span>  <span class="token keyword">const</span> blockMousedown <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> block<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// blockä¸Šæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå±æ€§focus,è·å–ç„¦ç‚¹åå°±å°†focuså˜ä¸ºtrue</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æŒ‰ä½shiftçš„æƒ…å†µ,å°±å¯ä»¥å¤šé€‰</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// å¦‚æœåªæœ‰ä¸€ä¸ªé€‰ä¸­çš„block,æ¯æ¬¡ç‚¹å‡»æ—¶å°±ä¸éœ€è¦åˆ‡æ¢focusçŠ¶æ€</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>focusData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>focus<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token boolean">true</span>        selectIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> index        <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>      <span class="token punctuation">}</span>      block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token operator">!</span>block<span class="token punctuation">.</span>focus<span class="token punctuation">;</span>      selectIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> index      <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>block<span class="token punctuation">.</span>focus<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">clearBlockFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      block<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è¦æ¸…ç©ºå…¶ä»–blockçš„focus,å®ç°å•é€‰</span>      selectIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> index      <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// block.focus = false; // å·²ç»è¢«é€‰ä¸­,åˆ™å†æ¬¡ç‚¹å‡»æ—¶è¿˜æ˜¯é€‰ä¸­çŠ¶æ€</span>    selectIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> index    <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// .....</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    blockMousedown<span class="token punctuation">,</span>    focusData<span class="token punctuation">,</span>    lastSelectBlock  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><h2 id="editor-js"><a href="#editor-js" class="headerlink" title="editor.js"></a>editor.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">"./editor.scss"</span><span class="token punctuation">;</span><span class="token keyword">import</span> EditorBlock <span class="token keyword">from</span> <span class="token string">"./editor-block"</span><span class="token punctuation">;</span><span class="token keyword">import</span> deepcopy <span class="token keyword">from</span> <span class="token string">"deepcopy"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useMenuDrager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useMenuDragger"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useFocus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useFocus"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useBlockDragger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useBlockDragger"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ¥æ”¶çˆ¶çº§ä¼ æ¥çš„æ•°æ®</span>    <span class="token comment" spellcheck="true">// v-modelæ˜¯è¯­æ³•ç³–,å…¶ä¼ è¿›æ¥çš„propsåç§°å°±æ˜¯modelValue</span>    <span class="token comment" spellcheck="true">// &lt;input modelValue="xxx" @change="xxx" /></span>    modelValue<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Object <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  emits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"update:modelValue"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// è¦è§¦å‘çš„äº‹ä»¶</span>  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> props<span class="token punctuation">.</span>modelValue<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// console.log(newValue);</span>        <span class="token comment" spellcheck="true">// è§¦å‘äº‹ä»¶æ›´æ–°æ•°æ®,(v-modelè¯­æ³•ç³–æä¾›çš„)</span>        ctx<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"update:modelValue"</span><span class="token punctuation">,</span> <span class="token function">deepcopy</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(props.data);</span>    <span class="token comment" spellcheck="true">// console.log(props.modelValue);</span>    <span class="token comment" spellcheck="true">// console.log(data.value);</span>    <span class="token keyword">const</span> containerStyles <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>      width<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">,</span>      height<span class="token punctuation">:</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>container<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> containerRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è·å–å†…å®¹åŒºåŸŸå¯¹åº”çš„domå…ƒç´ </span>    <span class="token comment" spellcheck="true">// 1,å®ç°èœå•æ‹–æ‹½åŠŸèƒ½</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> dragstart<span class="token punctuation">,</span> dragend <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMenuDrager</span><span class="token punctuation">(</span>containerRef<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2,å®ç°è·å–ç„¦ç‚¹</span>    <span class="token comment" spellcheck="true">// å®ç°ç»„ä»¶æ‹–æ‹½</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span> blockMousedown<span class="token punctuation">,</span> focusData<span class="token punctuation">,</span> lastSelectBlock <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFocus</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// æœ‰å¯èƒ½é€‰ä¸­åç›´æ¥è¿›è¡Œæ‹–æ‹½</span>      <span class="token comment" spellcheck="true">// console.log(focusData.value.focus);</span>      <span class="token function">mousedown</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 3,å®ç°æ‹–æ‹½å¤šä¸ªå…ƒç´ çš„åŠŸèƒ½</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span> mousedown<span class="token punctuation">,</span> markline <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useBlockDragger</span><span class="token punctuation">(</span>      focusData<span class="token punctuation">,</span>      lastSelectBlock<span class="token punctuation">,</span>      data    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ”¶é›†è·å–å’Œæ²¡æœ‰è·å–ç„¦ç‚¹çš„ç»„ä»¶(block)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-left"</span><span class="token operator">></span>          <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* æ ¹æ®æ³¨å†Œåˆ—è¡¨,æ¸²æŸ“ç‰©æ–™åŒº,å¯ä»¥å®ç°h5çš„æ‹–æ‹½ */</span><span class="token punctuation">}</span>          <span class="token punctuation">{</span>config<span class="token punctuation">.</span>componentList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>            <span class="token operator">&lt;</span>div              draggable              <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-left-item"</span>              onDrag<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">dragstart</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> component<span class="token punctuation">)</span><span class="token punctuation">}</span>              <span class="token comment" spellcheck="true">// onDragEnd={dragend} åŸç”Ÿçš„æ— æ³•ç»‘å®š,ä¸çŸ¥é“ä¸ºå•¥</span>            <span class="token operator">></span>              <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span>component<span class="token punctuation">.</span>label<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>              <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>component<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-top"</span><span class="token operator">></span>èœå•æ <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-right"</span><span class="token operator">></span>å±æ€§æ§åˆ¶æ <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-container"</span><span class="token operator">></span>          <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* è´Ÿè´£äº§ç”Ÿæ»šåŠ¨æ¡ */</span><span class="token punctuation">}</span>          <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-container-canvas"</span><span class="token operator">></span>            <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* äº§ç”Ÿå†…å®¹åŒºåŸŸ */</span><span class="token punctuation">}</span>            <span class="token operator">&lt;</span>div              <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"editor-container-canvas__content"</span>              ref<span class="token operator">=</span><span class="token punctuation">{</span>containerRef<span class="token punctuation">}</span>              style<span class="token operator">=</span><span class="token punctuation">{</span>containerStyles<span class="token punctuation">.</span>value<span class="token punctuation">}</span>              <span class="token comment" spellcheck="true">// ç‚¹å‡»ç»„ä»¶ä»¥å¤–çš„å†…å®¹åŒº,å¯ä»¥æŠŠfocuså–æ¶ˆ</span>              <span class="token comment" spellcheck="true">// onMouseDown={containerMouseDown}</span>            <span class="token operator">></span>              <span class="token punctuation">{</span>data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>                <span class="token operator">&lt;</span>EditorBlock                  <span class="token keyword">class</span><span class="token operator">=</span><span class="token punctuation">{</span>block<span class="token punctuation">.</span>focus <span class="token operator">?</span> <span class="token string">"editor-block-focus"</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// focusçš„è¯éœ€è¦æ·»åŠ æ ·å¼</span>                  block<span class="token operator">=</span><span class="token punctuation">{</span>block<span class="token punctuation">}</span>                  onMousedown<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">blockMousedown</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> block<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">}</span>                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>EditorBlock<span class="token operator">></span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>              <span class="token punctuation">{</span>markline<span class="token punctuation">.</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"line-x"</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> left<span class="token punctuation">:</span> markline<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">"px"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>              <span class="token punctuation">)</span><span class="token punctuation">}</span>              <span class="token punctuation">{</span>markline<span class="token punctuation">.</span>y <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"line-y"</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> top<span class="token punctuation">:</span> markline<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">"px"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>              <span class="token punctuation">)</span><span class="token punctuation">}</span>            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="scss"><a href="#scss" class="headerlink" title="scss"></a>scss</h2><pre class=" language-scss"><code class="language-scss"><span class="token selector">.line-x </span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token property">border-left</span><span class="token punctuation">:</span> <span class="token number">1</span>px dashed red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">.line-y </span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token property">border-top</span><span class="token punctuation">:</span> <span class="token number">1</span>px dashed red<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> é€ è½®å­ </tag>
            
            <tag> js </tag>
            
            <tag> javaScript </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> ä½ä»£ç  </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2023/02/06/shou-xie-pinia/shou-xie-pinia/"/>
      <url>/2023/02/06/shou-xie-pinia/shou-xie-pinia/</url>
      
        <content type="html"><![CDATA[<hr><p>title: æ‰‹å†™pinia(ä¸€ç§æ€è·¯)<br>date: 2023-02-06 18:32:05<br>tags: </p><ul><li>pinia</li><li>çŠ¶æ€ç®¡ç†  </li><li>vue </li><li>js</li><li>javaScript</li><li>é€ è½®å­</li><li>æ¡†æ¶</li><li>å‰ç«¯<br>categories: </li><li>pinia</li><li>çŠ¶æ€ç®¡ç†  </li><li>vue </li><li>js</li><li>javaScript</li><li>é€ è½®å­</li><li>æ¡†æ¶</li><li>å‰ç«¯<br>summary: â€˜æ‰‹å†™å®ç°ç±»ä¼¼piniaçš„åŠŸèƒ½,æ¥ç€Bç«™up<strong>å‰ç«¯å°é‡æ£®æ£®-1</strong>çš„è§†é¢‘â€™<br>description: â€˜æ‰‹å†™å®ç°ç±»ä¼¼piniaçš„åŠŸèƒ½,æ¥ç€Bç«™up<strong>å‰ç«¯å°é‡æ£®æ£®-1</strong>çš„è§†é¢‘â€™</li></ul><hr><h1 id="æœ¬ç¬”è®°å†…å®¹æ¥è‡ªBç«™upå‰ç«¯å°é‡æ£®æ£®-1çš„è§†é¢‘"><a href="#æœ¬ç¬”è®°å†…å®¹æ¥è‡ªBç«™upå‰ç«¯å°é‡æ£®æ£®-1çš„è§†é¢‘" class="headerlink" title="æœ¬ç¬”è®°å†…å®¹æ¥è‡ªBç«™upå‰ç«¯å°é‡æ£®æ£®-1çš„è§†é¢‘"></a>æœ¬ç¬”è®°å†…å®¹æ¥è‡ªBç«™up<strong>å‰ç«¯å°é‡æ£®æ£®-1</strong>çš„è§†é¢‘</h1><h1 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h1><pre class=" language-shell"><code class="language-shell">vue create mypinia# æ·»åŠ piniaä¾èµ–yarn add pinia </code></pre><p><img src="img.png" alt="é¡¹ç›®ç»“æ„"><br><img src="img_1.png" alt="main.js"></p><h2 id="store"><a href="#store" class="headerlink" title="store/"></a>store/</h2><h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> useTodoListStore <span class="token keyword">from</span> <span class="token string">'./todoList'</span><span class="token keyword">export</span> <span class="token punctuation">{</span>    useTodoListStore<span class="token punctuation">}</span></code></pre><h3 id="todoList-js"><a href="#todoList-js" class="headerlink" title="todoList.js"></a>todoList.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'todoList'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    state<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>        todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// id: number text: string isFinished: boolean</span>        filter<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// finished unfinished</span>        nextId<span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ·»åŠ todo</span>        <span class="token function">addTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nextId<span class="token operator">++</span><span class="token punctuation">,</span>                text<span class="token punctuation">,</span>                isFinished<span class="token punctuation">:</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// è½¬æ¢todoçŠ¶æ€</span>        <span class="token function">toggleTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>todo <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// æ‰¾åˆ°è¦ä¿®æ”¹çš„todo</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// è½¬æ¢çŠ¶æ€    </span>                    todo<span class="token punctuation">.</span>isFinished <span class="token operator">=</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>isFinished                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> todo            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">removeTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è¿‡æ»¤idå¯¹åº”çš„å…ƒç´ </span>            <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>todo <span class="token operator">=</span><span class="token operator">></span> todo<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getters<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// state=>è·å–è¿™é‡Œçš„stateè¿”å›çš„æ•°æ®</span>        <span class="token comment" spellcheck="true">// è·å–æ‰€æœ‰å·²å®Œæˆçš„</span>        <span class="token function">finishedTodos</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>todo <span class="token operator">=</span><span class="token operator">></span> todo<span class="token punctuation">.</span>isFinished<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// è·å–æ‰€æœ‰æœªå®Œæˆçš„</span>        <span class="token function">undefinedTodos</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>todo <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>isFinished<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// è·å–ä¸åŒçŠ¶æ€çš„todos</span>        <span class="token function">filterTodos</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token string">'finished'</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>finishedTodos                <span class="token keyword">case</span> <span class="token string">'unfinished'</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>undefinedTodos                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="app-vue"><a href="#app-vue" class="headerlink" title="app.vue"></a>app.vue</h2><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useTodoListStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/store"</span><span class="token punctuation">;</span><span class="token keyword">const</span> todoListStore <span class="token operator">=</span> <span class="token function">useTodoListStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todoListStore<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> </code></pre><h2 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h2><blockquote><p>storeé‡Œçš„ä¸œè¥¿(filter,todosâ€¦)æ˜¯ObjectRefImpl<br>getteré‡Œçš„ä¸œè¥¿(finishedTodosâ€¦)æ˜¯è®¡ç®—å±æ€§(computedRefImpl)</p></blockquote><p><img src="img_2.png" alt="img_2.png"></p><h1 id="å…ˆå®ç°ç®€å•çš„todosç¨‹åº"><a href="#å…ˆå®ç°ç®€å•çš„todosç¨‹åº" class="headerlink" title="å…ˆå®ç°ç®€å•çš„todosç¨‹åº"></a>å…ˆå®ç°ç®€å•çš„todosç¨‹åº</h1><h2 id="components-TodoList"><a href="#components-TodoList" class="headerlink" title="components/TodoList/"></a>components/TodoList/</h2><h3 id="index-vue"><a href="#index-vue" class="headerlink" title="index.vue"></a>index.vue</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>todo-tab</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>todo-tab</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>todo-form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>todo-form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>todos</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>todos</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> TodoTab <span class="token keyword">from</span> <span class="token string">"./TodoTab"</span><span class="token punctuation">;</span><span class="token keyword">import</span> TodoForm <span class="token keyword">from</span> <span class="token string">"./TodoForm"</span><span class="token punctuation">;</span><span class="token keyword">import</span> Todos <span class="token keyword">from</span> <span class="token string">"./Todos"</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="TodoForm-vue"><a href="#TodoForm-vue" class="headerlink" title="TodoForm.vue"></a>TodoForm.vue</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>      <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Please input something...<span class="token punctuation">"</span></span>      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inputRef<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addTodo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Add Todo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> useTodoListStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/store"</span><span class="token punctuation">;</span><span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ç»‘å®šinputæ¡†</span><span class="token keyword">const</span> todoListStore <span class="token operator">=</span> <span class="token function">useTodoListStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>inputRef<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">""</span> <span class="token operator">||</span> inputRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  todoListStore<span class="token punctuation">.</span><span class="token function">addTodo</span><span class="token punctuation">(</span>inputRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ·»åŠ todoåˆ°å…¨å±€çŠ¶æ€</span>  inputRef<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ¸…ç©ºå†…å®¹</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">div </span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="Todos-vue"><a href="#Todos-vue" class="headerlink" title="Todos.vue"></a>Todos.vue</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item of todoListStore.filterTodos<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span>        <span class="token attr-name">:checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.isFinished<span class="token punctuation">"</span></span>        <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todoListStore.toggleTodo(item.id)<span class="token punctuation">"</span></span>      <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ finished: item.isFinished }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todoListStore.removeTodo(item.id)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useTodoListStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/store"</span><span class="token punctuation">;</span><span class="token keyword">const</span> todoListStore <span class="token operator">=</span> <span class="token function">useTodoListStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">div </span><span class="token punctuation">{</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.finished</span> </span><span class="token punctuation">{</span>  <span class="token property">text-decoration</span><span class="token punctuation">:</span> line-through<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="TodoTab-vue"><a href="#TodoTab-vue" class="headerlink" title="TodoTab.vue"></a>TodoTab.vue</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span>      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setFilter(<span class="token punctuation">'</span>all<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span>      <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ active: todoListStore.filter <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>all<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span>      <span class="token punctuation">></span></span>All<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span>      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setFilter(<span class="token punctuation">'</span>finished<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span>      <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ active: todoListStore.filter <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>finished<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span>      <span class="token punctuation">></span></span>Finished<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span>      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setFilter(<span class="token punctuation">'</span>unfinished<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span>      <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ active: todoListStore.filter <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>unfinished<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span>      <span class="token punctuation">></span></span>UnFinished<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>    <span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useTodoListStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/store"</span><span class="token punctuation">;</span><span class="token keyword">const</span> todoListStore <span class="token operator">=</span> <span class="token function">useTodoListStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> setFilter <span class="token operator">=</span> <span class="token punctuation">(</span>filter<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  todoListStore<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> filter <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">div </span><span class="token punctuation">{</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.active</span> </span><span class="token punctuation">{</span>  <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#000</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">a </span><span class="token punctuation">{</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><img src="img_3.png" alt="img_3.png"></p><h1 id="æ‰‹å†™pinia"><a href="#æ‰‹å†™pinia" class="headerlink" title="æ‰‹å†™pinia"></a>æ‰‹å†™pinia</h1><p><img src="img_4.png" alt="main.js"><br><img src="img_6.png" alt="store/todoList.js"></p><blockquote><p>çŒœæµ‹: piniaä¼šåˆ›å»ºä¸€ä¸ªæ ¹store,æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„storeéƒ½ä¼šæŒ‚åˆ°è¯¥çˆ¶storeä¸Š</p></blockquote><p><img src="img_5.png" alt="img_5.png"></p><h2 id="pinia"><a href="#pinia" class="headerlink" title="pinia/"></a>pinia/</h2><h3 id="index-js-1"><a href="#index-js-1" class="headerlink" title="index.js"></a>index.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> createPinia <span class="token keyword">from</span> <span class="token string">'./createPinia'</span><span class="token keyword">import</span> defineStore <span class="token keyword">from</span> <span class="token string">'./defineStore'</span><span class="token keyword">export</span> <span class="token punctuation">{</span>    createPinia<span class="token punctuation">,</span>    defineStore<span class="token punctuation">}</span>   </code></pre><h3 id="createPinia-js"><a href="#createPinia-js" class="headerlink" title="createPinia.js"></a>createPinia.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span> <span class="token comment" spellcheck="true">// æ¥æ”¶ä¸€ä¸ªæ™®é€šå¯¹è±¡ç„¶åè¿”å›è¯¥æ™®é€šå¯¹è±¡çš„å“åº”å¼ä»£ç†(åµŒå¥—çš„éƒ½ä¼šè¢«ä»£ç†)</span><span class="token keyword">import</span> <span class="token punctuation">{</span> patch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./apis'</span> <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> piniaStore <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// æš´éœ²æ“ä½œpiniaStoreçš„æ–¹æ³•</span>    <span class="token keyword">function</span> <span class="token function">setSubStore</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>piniaStore<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            piniaStore<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> store            piniaStore<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>$patch <span class="token operator">=</span> patch <span class="token comment" spellcheck="true">// ç»™å­storeæ·»åŠ patchæ–¹æ³•</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> piniaStore    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// åˆ›å»ºpiniaå®ä¾‹</span>        <span class="token comment" spellcheck="true">// æš´éœ²piniaStore</span>        <span class="token comment" spellcheck="true">// app.provide('piniaStore',piniaStore)        </span>        app<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'setSubStore'</span><span class="token punctuation">,</span> setSubStore<span class="token punctuation">)</span>     <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        install    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * å¯ä»¥è¢«vueå®ä¾‹.useçš„,åŒ…å«è¿™ç§ç»“æ„ *  * { *  install (app) {} * } */</span></code></pre><h3 id="defineStore-js"><a href="#defineStore-js" class="headerlink" title="defineStore.js"></a>defineStore.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> inject<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> toRef<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">import</span> <span class="token punctuation">{</span>    createActions<span class="token punctuation">,</span>    createState<span class="token punctuation">,</span>    createGetters<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./options'</span><span class="token comment" spellcheck="true">// å®šä¹‰store</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>    name<span class="token punctuation">,</span>    <span class="token punctuation">{</span>        state<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// function</span>        getters<span class="token punctuation">,</span>        actions    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºå’ŒæŒ‚è½½state</span>    state <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> state <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">createState</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> state<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºå’ŒæŒ‚è½½actions</span>    actions <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">createActions</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> actions<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºå’ŒæŒ‚è½½getters</span>    getters <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>getters<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">createGetters</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> getters<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å–æš´éœ²çš„setSubStoreæ–¹æ³•</span>        <span class="token keyword">const</span> setSubStore <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'setSubStore'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> piniaStore <span class="token operator">=</span> <span class="token function">setSubStore</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token function">reactive</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> piniaStore<span class="token punctuation">[</span>name<span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="pinia-options"><a href="#pinia-options" class="headerlink" title="pinia/options/"></a>pinia/options/</h2><h3 id="state-js"><a href="#state-js" class="headerlink" title="state.js"></a>state.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> toRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createState</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> _state <span class="token operator">=</span> <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æŒ‡å‘state(ä¸€ä¸ªå‡½æ•°),è·å–å…¶è¿”å›å€¼</span>    store<span class="token punctuation">.</span>$state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>_state<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// stateè½¬å“åº”å¼,æ“ä½œæ—¶å°±æ˜¯æ“ä½œä»– </span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> _state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// key in (todos,filter,nextId)</span>        <span class="token comment" spellcheck="true">// åˆ›å»ºä¸€ä¸ª ref å¯¹è±¡ï¼Œå…¶ value å€¼æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§</span>        <span class="token comment" spellcheck="true">// store.key.value == store.$state.key ($state.todos)</span>        store<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>$state<span class="token punctuation">,</span> key<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="actions-js"><a href="#actions-js" class="headerlink" title="actions.js"></a>actions.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/*    actions: {        // æ·»åŠ todo        addTodo(text) {            this.todos.push({                id: this.nextId++,                text,                isFinished: false            })        },        ...    }*/</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createActions</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span>actions<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> method <span class="token keyword">in</span> actions<span class="token punctuation">)</span> <span class="token punctuation">{</span>        store<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> actions<span class="token punctuation">[</span>method<span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="getters-js"><a href="#getters-js" class="headerlink" title="getters.js"></a>getters.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token comment" spellcheck="true">/*        getters: {            // state=>è·å–è¿™é‡Œçš„state             finishedTodos(state) {                return state.todos.filter(todo => todo.isFinished)            },        }        ...*/</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createGetters</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> getters<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> getter <span class="token keyword">in</span> getters<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// bind,æŠŠgetteræ–¹æ³•çš„thisæŒ‡å‘store.$state,å¹¶ä¼ ä¸€ä¸ªå‚æ•°</span>        store<span class="token punctuation">[</span>getter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span>getters<span class="token punctuation">[</span>getter<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>$state<span class="token punctuation">,</span> store<span class="token punctuation">.</span>$state<span class="token punctuation">)</span><span class="token punctuation">)</span>        store<span class="token punctuation">.</span>$state<span class="token punctuation">[</span>getter<span class="token punctuation">]</span> <span class="token operator">=</span> store<span class="token punctuation">[</span>getter<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// state.xxx</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="index-js-2"><a href="#index-js-2" class="headerlink" title="index.js"></a>index.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actions'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./getters'</span><span class="token keyword">export</span> <span class="token punctuation">{</span>    createState<span class="token punctuation">,</span>    createActions<span class="token punctuation">,</span>    createGetters<span class="token punctuation">}</span></code></pre><h1 id="gitä»“åº“"><a href="#gitä»“åº“" class="headerlink" title="gitä»“åº“"></a>gitä»“åº“</h1><blockquote><p><a href="https://gitee.com/malguy/mypinia">https://gitee.com/malguy/mypinia</a><br><a href="https://github.com/malred/mypinia">https://github.com/malred/mypinia</a></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™redux(ä¸€ç§æ€è·¯)</title>
      <link href="/2023/02/06/shou-xie-redux/shou-xie-redux/"/>
      <url>/2023/02/06/shou-xie-redux/shou-xie-redux/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆå§‹é¡¹ç›®"><a href="#åˆå§‹é¡¹ç›®" class="headerlink" title="åˆå§‹é¡¹ç›®"></a>åˆå§‹é¡¹ç›®</h1><blockquote><p>ä½¿ç”¨åŸç”Ÿçš„providerå’Œcontext</p></blockquote><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºä¸Šä¸‹æ–‡</span><span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>appState<span class="token punctuation">,</span> setAppState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token operator">&lt;</span>appContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">}</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>appContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¤§å„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    å¤§å„¿å­    <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> äºŒå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    äºŒå„¿å­    <span class="token operator">&lt;</span>UserModifier <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>section<span class="token operator">></span>å¹ºå„¿å­<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// console.log(contextValue);</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span> <span class="token operator">=</span> contextValue<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// const {appState, setAppState} = useContext(appContext)</span>  <span class="token comment" spellcheck="true">// console.log(contextValue)</span>  <span class="token comment" spellcheck="true">// console.log(appState)</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸Šä¸‹æ–‡</span>    <span class="token function">setAppState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>contextValue<span class="token punctuation">.</span>appState <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> </code></pre><h1 id="æ‰‹å†™reducer"><a href="#æ‰‹å†™reducer" class="headerlink" title="æ‰‹å†™reducer"></a>æ‰‹å†™reducer</h1><blockquote><p>ä¸Šæ–‡çš„ä»£ç ä¸­, ç›´æ¥ä¿®æ”¹äº†stateçš„åŸå§‹å†…å®¹, ä¸ç¬¦åˆè§„èŒƒ, æ–°å¢reduceræ¥è§„èŒƒstateåˆ›å»ºæµç¨‹ </p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºä¸Šä¸‹æ–‡</span><span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>appState<span class="token punctuation">,</span> setAppState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token operator">&lt;</span>appContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">}</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>appContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¤§å„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    å¤§å„¿å­    <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> äºŒå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    äºŒå„¿å­    <span class="token operator">&lt;</span>UserModifier <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>section<span class="token operator">></span>å¹ºå„¿å­<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// console.log(contextValue);</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"updateUser"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token operator">...</span>state<span class="token punctuation">,</span>      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>        <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¶å®payloadå°±æ˜¯data</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span> <span class="token operator">=</span> contextValue<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// const {appState, setAppState} = useContext(appContext)</span>  <span class="token comment" spellcheck="true">// console.log(contextValue)</span>  <span class="token comment" spellcheck="true">// console.log(appState)</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// appState.user.name = e.target.value;</span>    <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸Šä¸‹æ–‡</span>    <span class="token comment" spellcheck="true">// setAppState({ ...contextValue.appState });</span>    <span class="token comment" spellcheck="true">// ä¸æ˜¯ç›´æ¥ä¿®æ”¹,è€Œæ˜¯åˆ›å»ºæ–°çš„state</span>    <span class="token comment" spellcheck="true">// ä¼ å…¥æ—§çš„state,åˆ›å»ºæ–°çš„</span>    <span class="token function">setAppState</span><span class="token punctuation">(</span>      <span class="token function">reducer</span><span class="token punctuation">(</span>appState<span class="token punctuation">,</span> <span class="token punctuation">{</span>        type<span class="token punctuation">:</span> <span class="token string">"updateUser"</span><span class="token punctuation">,</span>        payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>          name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> </code></pre><h1 id="æ‰‹å†™dispatch"><a href="#æ‰‹å†™dispatch" class="headerlink" title="æ‰‹å†™dispatch"></a>æ‰‹å†™dispatch</h1><blockquote><p>ä¿®æ”¹stateéœ€è¦setxxx, å¦‚æœå¤šæ¬¡, åˆ™ä¼šåœ¨onChangeå‡½æ•°é‡Œæ·»åŠ å¤ªå¤šçš„seté€»è¾‘, æˆ‘ä»¬å°†ä»–æŠ½å–å‡ºæ¥, ä½œä¸ºä¸€ä¸ªfunction, <strong>è§„èŒƒsetStateæµç¨‹</strong> </p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºä¸Šä¸‹æ–‡</span><span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>appState<span class="token punctuation">,</span> setAppState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token operator">&lt;</span>appContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">}</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>appContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¤§å„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    å¤§å„¿å­    <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> äºŒå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    äºŒå„¿å­    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;UserModifier /> */</span><span class="token punctuation">}</span>    <span class="token operator">&lt;</span>Wrapper <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>section<span class="token operator">></span>å¹ºå„¿å­<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// console.log(contextValue);</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"updateUser"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token operator">...</span>state<span class="token punctuation">,</span>      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>        <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¶å®payloadå°±æ˜¯data</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span><span class="token keyword">const</span> Wrapper <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span> <span class="token operator">=</span> contextValue<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">setAppState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>appState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>UserModifier dispatch<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span> state<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>     <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      type<span class="token punctuation">:</span> <span class="token string">"updateUser"</span><span class="token punctuation">,</span>      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>        name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h1 id="connect-é«˜é˜¶ç»„ä»¶"><a href="#connect-é«˜é˜¶ç»„ä»¶" class="headerlink" title="connect é«˜é˜¶ç»„ä»¶"></a>connect é«˜é˜¶ç»„ä»¶</h1><blockquote><p>é«˜é˜¶ç»„ä»¶: ä¸€ä¸ªå‡½æ•°,æ¥æ”¶ä¸€ä¸ªç»„ä»¶,è¿”å›ä¸€ä¸ªæ–°ç»„ä»¶,è¿™ä¸ªç»„ä»¶å°±æ˜¯é«˜é˜¶ç»„ä»¶<br>connect: å°†ç»„ä»¶å’Œå…¨å±€çš„stateè”ç³»èµ·æ¥</p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºä¸Šä¸‹æ–‡</span><span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>appState<span class="token punctuation">,</span> setAppState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token operator">&lt;</span>appContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">}</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>appContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¤§å„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    å¤§å„¿å­    <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> äºŒå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>section<span class="token operator">></span>    äºŒå„¿å­    <span class="token operator">&lt;</span>UserModifier x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"x"</span><span class="token punctuation">}</span><span class="token operator">></span>å†…å®¹<span class="token operator">&lt;</span><span class="token operator">/</span>UserModifier<span class="token operator">></span>    <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;Wrapper /> */</span><span class="token punctuation">}</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>section<span class="token operator">></span>å¹ºå„¿å­<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// console.log(contextValue);</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"updateUser"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token operator">...</span>state<span class="token punctuation">,</span>      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>        <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¶å®payloadå°±æ˜¯data</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token keyword">const</span> connent <span class="token operator">=</span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState<span class="token punctuation">,</span> setAppState <span class="token punctuation">}</span> <span class="token operator">=</span> contextValue<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">setAppState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>appState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> dispatch<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span> state<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¼ å…¥ç»„ä»¶,å°†ç»„ä»¶å’Œå…¨å±€stateè”ç³»èµ·æ¥,å°±æ˜¯connectçš„å«ä¹‰</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      type<span class="token punctuation">:</span> <span class="token string">"updateUser"</span><span class="token punctuation">,</span>      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>        name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1 id="å®ç°ç²¾å‡†render"><a href="#å®ç°ç²¾å‡†render" class="headerlink" title="å®ç°ç²¾å‡†render"></a>å®ç°ç²¾å‡†render</h1><blockquote><p>å½“å‰æ¯æ¬¡éƒ½æ˜¯é‡æ–°æ¸²æŸ“, æŠŠæ²¡æœ‰æ”¹å˜çš„ä¹Ÿæ›´æ–°äº†, æµªè´¹æ€§èƒ½(å½±å“å…¶å®ä¸å¤§, ä½†æ˜¯å¤ªå¤šä¹Ÿä¸å¥½)</p></blockquote><p><img src="5C1675999650847.png" alt="1675999701929"></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> <span class="token punctuation">{</span> update <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lodash"</span><span class="token punctuation">;</span><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useMemo<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºä¸Šä¸‹æ–‡</span><span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>    user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">setState</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(newState); æ²¡æœ‰è°ƒç”¨ç»„ä»¶çš„setState,æ‰€ä»¥ä¸ä¼šåˆ·æ–°</span>    store<span class="token punctuation">.</span>state <span class="token operator">=</span> newState<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// éå†ç›‘å¬è€…åˆ—è¡¨,è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„(æ›´æ–°)æ–¹æ³•</span>    store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// ç›‘å¬è€…</span>  listeners<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// è®©æ‰€æœ‰ä½¿ç”¨storeçš„ç»„ä»¶ç›‘å¬storeçš„å˜åŒ–,å®ç°æ›´æ–°æ¸²æŸ“</span>  <span class="token function">subscribe</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>    store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>      store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// åªè¦æ”¹å˜äº†ç»„ä»¶(app)çš„state,å…¶è¿”å›çš„æ‰€æœ‰ç»„ä»¶éƒ½ä¼šé‡æ–°æ‰§è¡Œ</span>  <span class="token comment" spellcheck="true">// useMemo(() => {</span>  <span class="token comment" spellcheck="true">//   return &lt;å¹ºå„¿å­ />;</span>  <span class="token comment" spellcheck="true">// }, []); // æ–¹æ¡ˆ1: ä½¿ç”¨ç¼“å­˜,ä¼ ç©ºæ•°ç»„è¡¨ç¤ºä»¥åä¸å†æ›´æ–°</span>  <span class="token comment" spellcheck="true">// const [appState, setAppState] = useState({</span>  <span class="token comment" spellcheck="true">//   user: { name: "frank", age: 18 },</span>  <span class="token comment" spellcheck="true">// });</span>  <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span>  <span class="token comment" spellcheck="true">// const contextValue = { appState, setAppState };</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token operator">&lt;</span>appContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>appContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¤§å„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"å¤§å„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>section<span class="token operator">></span>      å¤§å„¿å­      <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> äºŒå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"äºŒå„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>section<span class="token operator">></span>      äºŒå„¿å­      <span class="token operator">&lt;</span>UserModifier x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"x"</span><span class="token punctuation">}</span><span class="token operator">></span>å†…å®¹<span class="token operator">&lt;</span><span class="token operator">/</span>UserModifier<span class="token operator">></span>      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;Wrapper /> */</span><span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ä¸‰å„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>section<span class="token operator">></span>å¹ºå„¿å­<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token keyword">const</span> connent <span class="token operator">=</span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åœ¨wrapperä½¿ç”¨state,è°ƒç”¨æ›´æ–°æ–¹æ³•,å¯ä»¥å®ç°æ›´æ–°</span>    <span class="token comment" spellcheck="true">// è€Œä¸”wrapperåŒ…è£…çš„æ˜¯ç”¨åˆ°stateçš„ç»„ä»¶,æ‰€ä»¥æ›´æ–°æ—¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> update<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const { appState, setAppState } = contextValue;</span>    <span class="token comment" spellcheck="true">// åªè®¢é˜…ä¸€æ¬¡</span>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// setAppState(reducer(appState, action));</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> dispatch<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span> state<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>  <span class="token comment" spellcheck="true">// const { state } = useContext(appContext);</span>  <span class="token comment" spellcheck="true">// console.log(state);</span>  <span class="token comment" spellcheck="true">// console.log(contextValue);</span>  <span class="token comment" spellcheck="true">// return &lt;div>User:{contextValue.appState.user.name}&lt;/div>;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"updateUser"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token operator">...</span>state<span class="token punctuation">,</span>      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>        <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¶å®payloadå°±æ˜¯data</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¼ å…¥ç»„ä»¶,å°†ç»„ä»¶å’Œå…¨å±€stateè”ç³»èµ·æ¥,å°±æ˜¯connectçš„å«ä¹‰</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      type<span class="token punctuation">:</span> <span class="token string">"updateUser"</span><span class="token punctuation">,</span>      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>        name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p><img src="5C1676000932952.png" alt="1676000932952"></p><h1 id="reduxä¹ç°"><a href="#reduxä¹ç°" class="headerlink" title="reduxä¹ç°"></a>reduxä¹ç°</h1><h2 id="App-jsx"><a href="#App-jsx" class="headerlink" title="App.jsx"></a>App.jsx</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token '&lt;'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> appContext<span class="token punctuation">,</span> store<span class="token punctuation">,</span> connent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./redux.jsx"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// åªè¦æ”¹å˜äº†ç»„ä»¶(app)çš„state,å…¶è¿”å›çš„æ‰€æœ‰ç»„ä»¶éƒ½ä¼šé‡æ–°æ‰§è¡Œ</span>  <span class="token comment" spellcheck="true">// useMemo(() => {</span>  <span class="token comment" spellcheck="true">//   return &lt;å¹ºå„¿å­ />;</span>  <span class="token comment" spellcheck="true">// }, []); // æ–¹æ¡ˆ1: ä½¿ç”¨ç¼“å­˜,ä¼ ç©ºæ•°ç»„è¡¨ç¤ºä»¥åä¸å†æ›´æ–°</span>  <span class="token comment" spellcheck="true">// const [appState, setAppState] = useState({</span>  <span class="token comment" spellcheck="true">//   user: { name: "frank", age: 18 },</span>  <span class="token comment" spellcheck="true">// });</span>  <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span>  <span class="token comment" spellcheck="true">// const contextValue = { appState, setAppState };</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token operator">&lt;</span>appContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>appContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¤§å„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"å¤§å„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>section<span class="token operator">></span>      å¤§å„¿å­      <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> äºŒå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"äºŒå„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>section<span class="token operator">></span>      äºŒå„¿å­      <span class="token operator">&lt;</span>UserModifier x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"x"</span><span class="token punctuation">}</span><span class="token operator">></span>å†…å®¹<span class="token operator">&lt;</span><span class="token operator">/</span>UserModifier<span class="token operator">></span>      <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* &lt;Wrapper /> */</span><span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ä¸‰å„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>section<span class="token operator">></span>å¹ºå„¿å­<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>  <span class="token comment" spellcheck="true">// const { state } = useContext(appContext);</span>  <span class="token comment" spellcheck="true">// console.log(state);</span>  <span class="token comment" spellcheck="true">// console.log(contextValue);</span>  <span class="token comment" spellcheck="true">// return &lt;div>User:{contextValue.appState.user.name}&lt;/div>;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¼ å…¥ç»„ä»¶,å°†ç»„ä»¶å’Œå…¨å±€stateè”ç³»èµ·æ¥,å°±æ˜¯connectçš„å«ä¹‰</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      type<span class="token punctuation">:</span> <span class="token string">"updateUser"</span><span class="token punctuation">,</span>      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>        name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="redux-jsx"><a href="#redux-jsx" class="headerlink" title="redux.jsx"></a>redux.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token keyword">export</span> <span class="token keyword">const</span> connent <span class="token operator">=</span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// åœ¨wrapperä½¿ç”¨state,è°ƒç”¨æ›´æ–°æ–¹æ³•,å¯ä»¥å®ç°æ›´æ–°</span>        <span class="token comment" spellcheck="true">// è€Œä¸”wrapperåŒ…è£…çš„æ˜¯ç”¨åˆ°stateçš„ç»„ä»¶,æ‰€ä»¥æ›´æ–°æ—¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶</span>        <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> update<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>        <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// const { appState, setAppState } = contextValue;</span>        <span class="token comment" spellcheck="true">// åªè®¢é˜…ä¸€æ¬¡</span>        <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>        <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// setAppState(reducer(appState, action));</span>            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> dispatch<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span> state<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"updateUser"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>            <span class="token operator">...</span>state<span class="token punctuation">,</span>            user<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>                <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¶å®payloadå°±æ˜¯data</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>    state<span class="token punctuation">:</span> <span class="token punctuation">{</span>        user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">setState</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(newState); æ²¡æœ‰è°ƒç”¨ç»„ä»¶çš„setState,æ‰€ä»¥ä¸ä¼šåˆ·æ–°</span>        store<span class="token punctuation">.</span>state <span class="token operator">=</span> newState<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// éå†ç›‘å¬è€…åˆ—è¡¨,è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„(æ›´æ–°)æ–¹æ³•</span>        store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// ç›‘å¬è€…</span>    listeners<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// è®©æ‰€æœ‰ä½¿ç”¨storeçš„ç»„ä»¶ç›‘å¬storeçš„å˜åŒ–,å®ç°æ›´æ–°æ¸²æŸ“</span>    <span class="token function">subscribe</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>        store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>            store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></code></pre><h1 id="è®©connectæ”¯æŒselector"><a href="#è®©connectæ”¯æŒselector" class="headerlink" title="è®©connectæ”¯æŒselector"></a>è®©connectæ”¯æŒselector</h1><h2 id="App-jsx-1"><a href="#App-jsx-1" class="headerlink" title="App.jsx"></a>App.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token '&lt;'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> appContext<span class="token punctuation">,</span> store<span class="token punctuation">,</span> connent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./redux.jsx"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appContext.Provider</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// const xå„¿å­ ......</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// è·å–å±€éƒ¨state,æ— éœ€å†state.xxx.xxx</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> state<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¼ å…¥ç»„ä»¶,å°†ç»„ä»¶å’Œå…¨å±€stateè”ç³»èµ·æ¥,å°±æ˜¯connectçš„å«ä¹‰</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="redux-jsx-1"><a href="#redux-jsx-1" class="headerlink" title="redux.jsx"></a>redux.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token comment" spellcheck="true">// è¿™ä¸ªå†™æ³•è¡¨ç¤º å…ˆæ¥æ”¶ä¸€ä¸ªå‚æ•°,å†æ¥æ”¶ä¸€ä¸ªå‚æ•°</span><span class="token keyword">export</span> <span class="token keyword">const</span> connent <span class="token operator">=</span> <span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åœ¨wrapperä½¿ç”¨state,è°ƒç”¨æ›´æ–°æ–¹æ³•,å¯ä»¥å®ç°æ›´æ–°</span>    <span class="token comment" spellcheck="true">// è€Œä¸”wrapperåŒ…è£…çš„æ˜¯ç”¨åˆ°stateçš„ç»„ä»¶,æ‰€ä»¥æ›´æ–°æ—¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> update<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const { appState, setAppState } = contextValue;</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> selector <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> state <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åªè®¢é˜…ä¸€æ¬¡</span>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// setAppState(reducer(appState, action));</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>    <span class="token comment" spellcheck="true">// return &lt;Component {...props} dispatch={dispatch} state={state} />;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> dispatch<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1 id="ç²¾å‡†æ¸²æŸ“"><a href="#ç²¾å‡†æ¸²æŸ“" class="headerlink" title="ç²¾å‡†æ¸²æŸ“"></a>ç²¾å‡†æ¸²æŸ“</h1><p><img src="5C1676015232322.png" alt="1676015232322"></p><p><img src="D:\vs-vue\1-blog\hexo-blog\source_posts\æ‰‹å†™redux\æ‰‹å†™redux\5C1676016677462.png" alt="ä¿®æ”¹userå,ä¸‰å„¿å­ä¹Ÿæ”¹å˜äº†"></p><h2 id="redux-jsx-2"><a href="#redux-jsx-2" class="headerlink" title="redux.jsx"></a>redux.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token keyword">const</span> changed <span class="token operator">=</span> <span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> newState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> changed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> oldState<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldState<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> newState<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      changed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> changed<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token comment" spellcheck="true">// è¿™ä¸ªå†™æ³•è¡¨ç¤º å…ˆæ¥æ”¶ä¸€ä¸ªå‚æ•°,å†æ¥æ”¶ä¸€ä¸ªå‚æ•°</span><span class="token keyword">export</span> <span class="token keyword">const</span> connent <span class="token operator">=</span> <span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åœ¨wrapperä½¿ç”¨state,è°ƒç”¨æ›´æ–°æ–¹æ³•,å¯ä»¥å®ç°æ›´æ–°</span>    <span class="token comment" spellcheck="true">// è€Œä¸”wrapperåŒ…è£…çš„æ˜¯ç”¨åˆ°stateçš„ç»„ä»¶,æ‰€ä»¥æ›´æ–°æ—¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> update<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const { appState, setAppState } = contextValue;</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> selector <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> state <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åªè®¢é˜…ä¸€æ¬¡</span>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//   const unsubscribe =</span>      <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> newData <span class="token operator">=</span> selector          <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">)</span>          <span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> store<span class="token punctuation">.</span>state <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ¤æ–­data(store.state.xxx)æ˜¯å¦å‘ç”Ÿå˜åŒ–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">changed</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"update"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//   return unsubscribe; // å–æ¶ˆè®¢é˜…</span>      <span class="token comment" spellcheck="true">// è¿™é‡Œæœ€å¥½å–æ¶ˆè®¢é˜…,å¦åˆ™selectorå˜åŒ–æ—¶å¯èƒ½å‡ºç°é‡å¤è®¢é˜…</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>selector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// setAppState(reducer(appState, action));</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>    <span class="token comment" spellcheck="true">// return &lt;Component {...props} dispatch={dispatch} state={state} />;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> dispatch<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="App-jsx-2"><a href="#App-jsx-2" class="headerlink" title="App.jsx"></a>App.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token '&lt;'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> appContext<span class="token punctuation">,</span> store<span class="token punctuation">,</span> connent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./redux.jsx"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appContext.Provider</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ......</span><span class="token keyword">const</span> å¹ºå„¿å­ <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token punctuation">{</span> group<span class="token punctuation">:</span> state<span class="token punctuation">.</span>group <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> group <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ä¸‰å„¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>      å¹ºå„¿å­<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Group<span class="token punctuation">:</span> <span class="token punctuation">{</span>group<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// è·å–å±€éƒ¨state,æ— éœ€å†state.xxx.xxx</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> state<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>User<span class="token punctuation">:</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¼ å…¥ç»„ä»¶,å°†ç»„ä»¶å’Œå…¨å±€stateè”ç³»èµ·æ¥,å°±æ˜¯connectçš„å«ä¹‰</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p><img src="D:\vs-vue\1-blog\hexo-blog\source_posts\æ‰‹å†™redux\æ‰‹å†™redux\5C1676017417280.png" alt="1676017417280"></p><h1 id="mapDispatcherToProps"><a href="#mapDispatcherToProps" class="headerlink" title="mapDispatcherToProps"></a>mapDispatcherToProps</h1><p><img src="D:\vs-vue\1-blog\hexo-blog\source_posts\æ‰‹å†™redux\æ‰‹å†™redux\5C1676017628946.png" alt="1676017628946"></p><h2 id="App-jsx-3"><a href="#App-jsx-3" class="headerlink" title="App.jsx"></a>App.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token '&lt;'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> appContext<span class="token punctuation">,</span> store<span class="token punctuation">,</span> connent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./redux.jsx"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appContext.Provider</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ......</span><span class="token comment" spellcheck="true">// ä¼ å…¥ç»„ä»¶,å°†ç»„ä»¶å’Œå…¨å±€stateè”ç³»èµ·æ¥,å°±æ˜¯connectçš„å«ä¹‰</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connent</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ¯æ¬¡éƒ½è¦ä¼ update,ç®€åŒ–</span>    updateUser<span class="token punctuation">:</span> <span class="token punctuation">(</span>attr<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">"update"</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> attr <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// })(({ dispatch, state, ...props }) => {</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> updateUser<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// dispatch({</span>    <span class="token comment" spellcheck="true">//   type: "update",</span>    <span class="token comment" spellcheck="true">//   payload: {</span>    <span class="token comment" spellcheck="true">//     name: e.target.value,</span>    <span class="token comment" spellcheck="true">//   },</span>    <span class="token comment" spellcheck="true">// });</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </code></pre><h2 id="redux-jsx-3"><a href="#redux-jsx-3" class="headerlink" title="redux.jsx"></a>redux.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token keyword">const</span> changed <span class="token operator">=</span> <span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> newState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token comment" spellcheck="true">// è¿™ä¸ªå†™æ³•è¡¨ç¤º å…ˆæ¥æ”¶ä¸€ä¸ªå‚æ•°,å†æ¥æ”¶ä¸€ä¸ªå‚æ•°</span><span class="token comment" spellcheck="true">// export const connent = (selector,mapDispatchToProps) => (Component) => {</span><span class="token keyword">export</span> <span class="token keyword">const</span> connent <span class="token operator">=</span> <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> dispatchSelector<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åœ¨wrapperä½¿ç”¨state,è°ƒç”¨æ›´æ–°æ–¹æ³•,å¯ä»¥å®ç°æ›´æ–°</span>    <span class="token comment" spellcheck="true">// è€Œä¸”wrapperåŒ…è£…çš„æ˜¯ç”¨åˆ°stateçš„ç»„ä»¶,æ‰€ä»¥æ›´æ–°æ—¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> update<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const { appState, setAppState } = contextValue;</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> selector <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> state <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// setAppState(reducer(appState, action));</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ¯æ¬¡éƒ½è¦ä¼ update,ç®€åŒ–</span>    <span class="token keyword">const</span> dispatchers <span class="token operator">=</span> dispatchSelector      <span class="token operator">?</span> <span class="token function">dispatchSelector</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span>      <span class="token punctuation">:</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åªè®¢é˜…ä¸€æ¬¡</span>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//   const unsubscribe =</span>      <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> newData <span class="token operator">=</span> selector          <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">)</span>          <span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> store<span class="token punctuation">.</span>state <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ¤æ–­data(store.state.xxx)æ˜¯å¦å‘ç”Ÿå˜åŒ–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">changed</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"update"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// return unsubscribe; // å–æ¶ˆè®¢é˜…</span>      <span class="token comment" spellcheck="true">// è¿™é‡Œæœ€å¥½å–æ¶ˆè®¢é˜…,å¦åˆ™selectorå˜åŒ–æ—¶å¯èƒ½å‡ºç°é‡å¤è®¢é˜…</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>selector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>    <span class="token comment" spellcheck="true">// return &lt;Component {...props} dispatch={dispatch} state={state} />;</span>    <span class="token comment" spellcheck="true">// return &lt;Component {...props} dispatch={dispatch} {...data} />;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>dispatchers<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1 id="connectçš„æ„ä¹‰"><a href="#connectçš„æ„ä¹‰" class="headerlink" title="connectçš„æ„ä¹‰"></a>connectçš„æ„ä¹‰</h1><blockquote><p>å¤šæ¬¡è°ƒç”¨, æ¯æ¬¡è°ƒç”¨äº§ç”ŸåŠæˆå“, å¯ä»¥æ ¹æ®ä¸åŒçš„åŠæˆå“æ¥è¿›è¡Œè¯»/å†™æ“ä½œ</p></blockquote><p><img src="D:\vs-vue\1-blog\hexo-blog\source_posts\æ‰‹å†™redux\æ‰‹å†™redux\5C1676026550867.png" alt="1676026550867"></p><h2 id="connects-connectToUser-js"><a href="#connects-connectToUser-js" class="headerlink" title="connects/connectToUser.js"></a>connects/connectToUser.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../redux'</span><span class="token comment" spellcheck="true">// æŠ½å–å…¬å…±selectorå’Œdispatcher</span><span class="token comment" spellcheck="true">// å°è£…è¯»é€»è¾‘</span><span class="token keyword">const</span> userSelector <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> state<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å°è£…å†™é€»è¾‘</span><span class="token keyword">const</span> userDispatcher <span class="token operator">=</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        updateUser<span class="token punctuation">:</span> <span class="token punctuation">(</span>attrs<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">"update"</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> attrs <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> connentToUser <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>userSelector<span class="token punctuation">,</span> userDispatcher<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="App-jsx-4"><a href="#App-jsx-4" class="headerlink" title="App.jsx"></a>App.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token '&lt;'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> appContext<span class="token punctuation">,</span> store<span class="token punctuation">,</span>connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./redux.jsx"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> connentToUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./connects/connectToUser.js"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appContext.Provider</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ......</span><span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connentToUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> updateUser<span class="token punctuation">,</span> user<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// dispatch({</span>    <span class="token comment" spellcheck="true">//   type: "update",</span>    <span class="token comment" spellcheck="true">//   payload: {</span>    <span class="token comment" spellcheck="true">//     name: e.target.value,</span>    <span class="token comment" spellcheck="true">//   },</span>    <span class="token comment" spellcheck="true">// });</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h1 id="å°è£…providerå’ŒcreateStore"><a href="#å°è£…providerå’ŒcreateStore" class="headerlink" title="å°è£…providerå’ŒcreateStore"></a>å°è£…providerå’ŒcreateStore</h1><p><img src="D:\vs-vue\1-blog\hexo-blog\source_posts\æ‰‹å†™redux\æ‰‹å†™redux\5C1676029099571.png" alt="1676029099571"></p><h2 id="redux-jsx-4"><a href="#redux-jsx-4" class="headerlink" title="redux.jsx"></a>redux.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ......</span><span class="token comment" spellcheck="true">// reduceå’Œstoreéƒ½æ˜¯å†™æ­»çš„,ä¸ç¬¦åˆè§„èŒƒ</span><span class="token comment" spellcheck="true">// è§„èŒƒstateåˆ›å»ºæµç¨‹</span><span class="token comment" spellcheck="true">// const reducer = (state, { type, payload }) => {</span><span class="token comment" spellcheck="true">//   if (type === "update") {</span><span class="token comment" spellcheck="true">//     return {</span><span class="token comment" spellcheck="true">//       ...state,</span><span class="token comment" spellcheck="true">//       user: {</span><span class="token comment" spellcheck="true">//         ...state.user,</span><span class="token comment" spellcheck="true">//         ...payload, // å…¶å®payloadå°±æ˜¯data</span><span class="token comment" spellcheck="true">//       },</span><span class="token comment" spellcheck="true">//     };</span><span class="token comment" spellcheck="true">//   } else {</span><span class="token comment" spellcheck="true">//     return state;</span><span class="token comment" spellcheck="true">//   }</span><span class="token comment" spellcheck="true">// };</span><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// state: {</span>  <span class="token comment" spellcheck="true">// user: { name: "frank", age: 18 },</span>  <span class="token comment" spellcheck="true">// group: { name: "å‰ç«¯ç»„" },</span>  <span class="token comment" spellcheck="true">// },</span>  state<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>  <span class="token function">setState</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(newState); æ²¡æœ‰è°ƒç”¨ç»„ä»¶çš„setState,æ‰€ä»¥ä¸ä¼šåˆ·æ–°</span>    store<span class="token punctuation">.</span>state <span class="token operator">=</span> newState<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// éå†ç›‘å¬è€…åˆ—è¡¨,è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„(æ›´æ–°)æ–¹æ³•</span>    store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  reducer<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// ç›‘å¬è€…</span>  listeners<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// è®©æ‰€æœ‰ä½¿ç”¨storeçš„ç»„ä»¶ç›‘å¬storeçš„å˜åŒ–,å®ç°æ›´æ–°æ¸²æŸ“</span>  <span class="token function">subscribe</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>    store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>      store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºstoreå’Œreducer</span><span class="token keyword">export</span> <span class="token keyword">const</span> createStore <span class="token operator">=</span> <span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  store<span class="token punctuation">.</span>state <span class="token operator">=</span> initState<span class="token punctuation">;</span>  store<span class="token punctuation">.</span>reducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span>  <span class="token keyword">return</span> store<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> Provider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appContext.Provider</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="App-jsx-5"><a href="#App-jsx-5" class="headerlink" title="App.jsx"></a>App.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// è¯·ä»è¯¾ç¨‹ç®€ä»‹é‡Œä¸‹è½½æœ¬ä»£ç </span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Uncaught SyntaxError: Unexpected token '&lt;'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> appContext<span class="token punctuation">,</span> createStore<span class="token punctuation">,</span> connect<span class="token punctuation">,</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./redux.jsx"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> connentToUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./connects/connectToUser.js"</span><span class="token punctuation">;</span><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"update"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token operator">...</span>state<span class="token punctuation">,</span>      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>        <span class="token operator">...</span>payload<span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> initState <span class="token operator">=</span> <span class="token punctuation">{</span>  user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"frank"</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  group<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"å‰ç«¯ç»„"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initState<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ–¹æ¡ˆ2: å°†ç»„ä»¶çš„stateæå–åˆ°å¤–éƒ¨çš„store</span><span class="token keyword">export</span> <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">// ä¼ é€’ä¸Šä¸‹æ–‡</span>    <span class="token comment" spellcheck="true">// &lt;appContext.Provider value={store}></span>    <span class="token comment" spellcheck="true">//   &lt;å¤§å„¿å­ /></span>    <span class="token comment" spellcheck="true">//   &lt;äºŒå„¿å­ /></span>    <span class="token comment" spellcheck="true">//   &lt;å¹ºå„¿å­ /></span>    <span class="token comment" spellcheck="true">// &lt;/appContext.Provider></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Provider</span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>      <span class="token operator">&lt;</span>å¤§å„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>äºŒå„¿å­ <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span>å¹ºå„¿å­ <span class="token operator">/</span><span class="token operator">></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Provider</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ......</span><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">connentToUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">const</span> UserModifier <span class="token operator">=</span> <span class="token function">connentToUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> updateUser<span class="token punctuation">,</span> user<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1 id="reduxæ¦‚å¿µæ€»ç»“"><a href="#reduxæ¦‚å¿µæ€»ç»“" class="headerlink" title="reduxæ¦‚å¿µæ€»ç»“"></a>reduxæ¦‚å¿µæ€»ç»“</h1><p><img src="D:\vs-vue\1-blog\hexo-blog\source_posts\æ‰‹å†™redux\æ‰‹å†™redux%5CUsers%5C13695%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1676032605733.png" alt="1676032605733"></p><p><img src="C:\Users\13695\AppData\Roaming\Typora\typora-user-images\1676032698339.png" alt="1676032698339"></p><h1 id="ä»£ç é‡æ„"><a href="#ä»£ç é‡æ„" class="headerlink" title="ä»£ç é‡æ„"></a>ä»£ç é‡æ„</h1><h2 id="redux-jsx-5"><a href="#redux-jsx-5" class="headerlink" title="redux.jsx"></a>redux.jsx</h2><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><span class="token keyword">const</span> changed <span class="token operator">=</span> <span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> newState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> changed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> oldState<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldState<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> newState<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      changed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> changed<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¯æ¬¡è‡ªå·±å†™warpperåŒ…è£…dispatchå¤ªéº»çƒ¦,å°è£…ä¸€ä¸ªreturn wrapperçš„å‡½æ•°</span><span class="token comment" spellcheck="true">// è¿™ä¸ªå†™æ³•è¡¨ç¤º å…ˆæ¥æ”¶ä¸€ä¸ªå‚æ•°,å†æ¥æ”¶ä¸€ä¸ªå‚æ•°</span><span class="token comment" spellcheck="true">// export const connent = (selector,mapDispatchToProps) => (Component) => {</span><span class="token keyword">export</span> <span class="token keyword">const</span> connect <span class="token operator">=</span> <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> dispatchSelector<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// contextåªèƒ½åœ¨ç»„ä»¶å†…éƒ¨è®¿é—®,åˆ™è¿™é‡Œåˆ›å»ºä¸€ä¸ªç»„ä»¶æ¥å°è£…dispatchçš„é€»è¾‘,ç„¶åé€šè¿‡è¿™ä¸ªç»„ä»¶è·å–context(æƒå®œä¹‹è®¡)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åœ¨wrapperä½¿ç”¨state,è°ƒç”¨æ›´æ–°æ–¹æ³•,å¯ä»¥å®ç°æ›´æ–°</span>    <span class="token comment" spellcheck="true">// è€Œä¸”wrapperåŒ…è£…çš„æ˜¯ç”¨åˆ°stateçš„ç»„ä»¶,æ‰€ä»¥æ›´æ–°æ—¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> update<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const contextValue = useContext(appContext);</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// const { appState, setAppState } = contextValue;</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> selector <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> state <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// // è§„èŒƒsetStateæµç¨‹</span>    <span class="token comment" spellcheck="true">// const dispatch = (action) => {</span>    <span class="token comment" spellcheck="true">//   // setAppState(reducer(appState, action));</span>    <span class="token comment" spellcheck="true">//   setState(reducer(state, action));</span>    <span class="token comment" spellcheck="true">//   // update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>    <span class="token comment" spellcheck="true">// };</span>    <span class="token comment" spellcheck="true">// æ¯æ¬¡éƒ½è¦ä¼ update,ç®€åŒ–</span>    <span class="token keyword">const</span> dispatchers <span class="token operator">=</span> dispatchSelector      <span class="token operator">?</span> <span class="token function">dispatchSelector</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span>      <span class="token punctuation">:</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åªè®¢é˜…ä¸€æ¬¡</span>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//   const unsubscribe =</span>      <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> newData <span class="token operator">=</span> selector <span class="token operator">?</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ¤æ–­data(store.state.xxx)æ˜¯å¦å‘ç”Ÿå˜åŒ–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">changed</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"update"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//   return unsubscribe; // å–æ¶ˆè®¢é˜…</span>      <span class="token comment" spellcheck="true">// è¿™é‡Œæœ€å¥½å–æ¶ˆè®¢é˜…,å¦åˆ™selectorå˜åŒ–æ—¶å¯èƒ½å‡ºç°é‡å¤è®¢é˜…</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>selector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœç»„ä»¶æœ‰ä¼ å€¼,åº”è¯¥ä¼ é€’(props)</span>    <span class="token comment" spellcheck="true">// return &lt;Component {...props} dispatch={dispatch} state={state} />;</span>    <span class="token comment" spellcheck="true">// return &lt;Component {...props} dispatch={dispatch} {...data} />;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>dispatchers<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">let</span> state <span class="token operator">=</span> undefined<span class="token punctuation">;</span><span class="token keyword">let</span> reducer <span class="token operator">=</span> undefined<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ç›‘å¬è€…</span><span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> setState <span class="token operator">=</span> <span class="token punctuation">(</span>newState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// console.log(newState); æ²¡æœ‰è°ƒç”¨ç»„ä»¶çš„setState,æ‰€ä»¥ä¸ä¼šåˆ·æ–°</span>  state <span class="token operator">=</span> newState<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// éå†ç›‘å¬è€…åˆ—è¡¨,è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„(æ›´æ–°)æ–¹æ³•</span>  listeners<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// è§„èŒƒsetStateæµç¨‹</span>  dispatch<span class="token punctuation">:</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// setAppState(reducer(appState, action));</span>    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// update({}); // ä½†æ˜¯,å…¶ä»–ä½¿ç”¨storeçš„æ— æ³•æ ¹æ®storeå†…çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// è®©æ‰€æœ‰ä½¿ç”¨storeçš„ç»„ä»¶ç›‘å¬storeçš„å˜åŒ–,å®ç°æ›´æ–°æ¸²æŸ“</span>  <span class="token function">subscribe</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> index <span class="token operator">=</span> listeners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>      listeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> dispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºstoreå’Œreducer</span><span class="token keyword">export</span> <span class="token keyword">const</span> createStore <span class="token operator">=</span> <span class="token punctuation">(</span>_reducer<span class="token punctuation">,</span> initState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  state <span class="token operator">=</span> initState<span class="token punctuation">;</span>  reducer <span class="token operator">=</span> _reducer<span class="token punctuation">;</span>  <span class="token keyword">return</span> store<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> appContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> Provider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appContext.Provider</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h1 id="reduxå¦‚ä½•æ”¯æŒå¼‚æ­¥"><a href="#reduxå¦‚ä½•æ”¯æŒå¼‚æ­¥" class="headerlink" title="reduxå¦‚ä½•æ”¯æŒå¼‚æ­¥"></a>reduxå¦‚ä½•æ”¯æŒå¼‚æ­¥</h1>]]></content>
      
      
      <categories>
          
          <category> redux </category>
          
          <category> çŠ¶æ€ç®¡ç† </category>
          
          <category> react </category>
          
          <category> è„šæ‰‹æ¶ </category>
          
          <category> js </category>
          
          <category> javaScript </category>
          
          <category> é€ è½®å­ </category>
          
          <category> æ¡†æ¶ </category>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> é€ è½®å­ </tag>
            
            <tag> redux </tag>
            
            <tag> çŠ¶æ€ç®¡ç† </tag>
            
            <tag> react </tag>
            
            <tag> è„šæ‰‹æ¶ </tag>
            
            <tag> js </tag>
            
            <tag> javaScript </tag>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™vue2</title>
      <link href="/2023/02/05/shou-xie-vue2-vuerouter-vuex/shou-xie-vue2-vuerouter-vuex/"/>
      <url>/2023/02/05/shou-xie-vue2-vuerouter-vuex/shou-xie-vue2-vuerouter-vuex/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h1><h2 id="rollupå¼€å‘ç¯å¢ƒæ­å»º"><a href="#rollupå¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="rollupå¼€å‘ç¯å¢ƒæ­å»º"></a>rollupå¼€å‘ç¯å¢ƒæ­å»º</h2><pre class=" language-shell"><code class="language-shell">npm init -y# å·¥å…·åº“ä¸€èˆ¬ç”¨rollupæ‰“åŒ…,babelåˆ™æ˜¯ç¼–è¯‘é«˜çº§è¯­æ³•(->ä½çº§è¯­æ³•),æ¥é€‚é…ä¸åŒæµè§ˆå™¨npm i rollup rollup-plugin-babel @babel/core @babel/preset-env --save-dev# ä½¿ç”¨æ·˜å®æ–°é•œåƒä¸‹è½½npm i rollup rollup-plugin-babel @babel/core @babel/preset-env --registry=https://registry.npmmirror.com</code></pre><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p><img src="img_5.png" alt="img_5.png"></p><h3 id="è¦æ‰“åŒ…çš„src-index-js"><a href="#è¦æ‰“åŒ…çš„src-index-js" class="headerlink" title="è¦æ‰“åŒ…çš„src/index.js"></a>è¦æ‰“åŒ…çš„src/index.js</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token number">100</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="é…ç½®æ–‡ä»¶-babelrc"><a href="#é…ç½®æ–‡ä»¶-babelrc" class="headerlink" title="é…ç½®æ–‡ä»¶ .babelrc"></a>é…ç½®æ–‡ä»¶ .babelrc</h3><pre class=" language-shell"><code class="language-shell">{    "presets": [        // presetæ˜¯å¾ˆå¤šæ’ä»¶çš„é›†åˆ        "@babel/preset-env"    ]}</code></pre><h3 id="é…ç½®æ–‡ä»¶-rollup-config-js"><a href="#é…ç½®æ–‡ä»¶-rollup-config-js" class="headerlink" title="é…ç½®æ–‡ä»¶ rollup.config.js"></a>é…ç½®æ–‡ä»¶ rollup.config.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// rollupé»˜è®¤å¯ä»¥å¯¼å‡ºä¸€ä¸ªå¯¹è±¡,ä½œä¸ºæ‰“åŒ…çš„é…ç½®æ–‡ä»¶</span><span class="token comment" spellcheck="true">// import babel from 'rollup-plugin-babel' // es6å¯¼å…¥è¯­æ³•</span><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-babel'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// export default {</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    input<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¥å£</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        file<span class="token punctuation">:</span> <span class="token string">'./dist/vue.js'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å‡ºå£</span>        name<span class="token punctuation">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ‰“åŒ…åå…¨å±€æ·»åŠ Vueå¯¹è±¡ global Vue</span>        format<span class="token punctuation">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// esm es6æ¨¡å— commonjsæ¨¡å— iifeè‡ªæ‰§è¡Œå‡½æ•° umdé€šç”¨æ¨¡å—è§„èŒƒ(å…¼å®¹AMDå’Œcommonjs,iife,ä¸å…¼å®¹es6)</span>        sourcemap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å¯ä»¥è°ƒè¯•æºä»£ç </span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// å¯ä»¥ä½¿ç”¨çš„æ’ä»¶</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            exclude<span class="token punctuation">:</span> <span class="token string">'node_modules/**'</span> <span class="token comment" spellcheck="true">// æ’é™¤nodemoduleä¸‹æ‰€æœ‰æ–‡ä»¶</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="æµ‹è¯•ç”¨html"><a href="#æµ‹è¯•ç”¨html" class="headerlink" title="æµ‹è¯•ç”¨html"></a>æµ‹è¯•ç”¨html</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_1.png" alt="img_1.png"><img src="img_2.png" alt="img_2.png"><img src="img_3.png" alt="img_3.png"><img src="img_4.png" alt="img_4.png"></p><h1 id="åˆå§‹åŒ–æ•°æ®"><a href="#åˆå§‹åŒ–æ•°æ®" class="headerlink" title="åˆå§‹åŒ–æ•°æ®"></a>åˆå§‹åŒ–æ•°æ®</h1><h2 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>initMixin<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./init"</span><span class="token comment" spellcheck="true">// classä¼šæŠŠæ‰€æœ‰æ–¹æ³•è€¦åˆåœ¨ä¸€èµ·</span><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// optionså°±æ˜¯ç”¨æˆ·æä¾›çš„é€‰é¡¹ </span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆå§‹åŒ–</span><span class="token punctuation">}</span><span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ‹“å±•äº†vue,æ·»åŠ initæ–¹æ³•</span><span class="token keyword">export</span> <span class="token keyword">default</span> Vue</code></pre><h2 id="init-js"><a href="#init-js" class="headerlink" title="init.js"></a>init.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>initState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token comment" spellcheck="true">// æä¾›ç»™vueæ¥ä½¿ç”¨(æ­¤æ—¶å…¨å±€è¿˜æ²¡æœ‰vueå¯¹è±¡,æ‰€ä»¥æ²¡åŠæ³•ç›´æ¥æŒ‚è½½)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_init <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å°†ç”¨æˆ·ä¼ å…¥çš„optionsæŒ‚è½½åˆ°vueå¯¹è±¡ä¸Š</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment" spellcheck="true">// åŸå‹ä¸­çš„thisè¡¨ç¤ºå®ä¾‹</span>        vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> options <span class="token comment" spellcheck="true">// $xxx è¡¨ç¤ºæ˜¯vueçš„å±æ€§(åœ¨(vueé‡Œ,å¦‚æœdataé‡Œçš„å˜é‡åæ˜¯$å¼€å¤´,vueæ˜¯æ‹¿ä¸åˆ°çš„)</span>        <span class="token comment" spellcheck="true">// åˆå§‹åŒ–çŠ¶æ€</span>        <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="state-js"><a href="#state-js" class="headerlink" title="state.js"></a>state.js</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// å¯¹optionså†…å±æ€§å’Œæ–¹æ³•è¿›è¡Œæ“ä½œ </span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// dataæ•°æ®çš„åˆå§‹åŒ–</span>        <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ•°æ®åˆå§‹åŒ–(è½¬ä¸ºå“åº”å¼)</span><span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data    <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯å‡½æ•°,å°±è°ƒç”¨å¹¶è·å–å…¶è¿”å›å€¼</span>    data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> data<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> data    <span class="token comment" spellcheck="true">// dataæŒ‚è½½åˆ°vmä¸Š</span>    vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> data    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token comment" spellcheck="true">// æ•°æ®åŠ«æŒ </span>    <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç›‘å¬æ•°æ®å˜åŒ–</span><span class="token punctuation">}</span></code></pre><h1 id="å®ç°å¯¹è±¡å“åº”å¼"><a href="#å®ç°å¯¹è±¡å“åº”å¼" class="headerlink" title="å®ç°å¯¹è±¡å“åº”å¼"></a>å®ç°å¯¹è±¡å“åº”å¼</h1><h2 id="src-observe-index-js"><a href="#src-observe-index-js" class="headerlink" title="src\observe\index.js"></a>src\observe\index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">debugger</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬ä¸€æ­¥æµ‹è¯•-èƒ½å¦æ‹¿åˆ°dataæ•°æ®"><a href="#ç¬¬ä¸€æ­¥æµ‹è¯•-èƒ½å¦æ‹¿åˆ°dataæ•°æ®" class="headerlink" title="ç¬¬ä¸€æ­¥æµ‹è¯•,èƒ½å¦æ‹¿åˆ°dataæ•°æ®"></a>ç¬¬ä¸€æ­¥æµ‹è¯•,èƒ½å¦æ‹¿åˆ°dataæ•°æ®</h3><p><img src="img_6.png" alt="img_6.png"></p><h3 id="ç»§ç»­å¼€å‘"><a href="#ç»§ç»­å¼€å‘" class="headerlink" title="ç»§ç»­å¼€å‘"></a>ç»§ç»­å¼€å‘</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è§‚å¯Ÿdataå¯¹è±¡çš„ç±»</span><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// Object.definePropertyåªèƒ½åŠ«æŒå·²ç»å­˜åœ¨çš„å±æ€§ (vueé‡Œæä¾›äº†ä¸“é—¨çš„api($set $delete ...)æ¥è§£å†³)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¾ªç¯å¯¹è±¡,å¯¹å±æ€§ä¾æ¬¡åŠ«æŒ</span>        <span class="token comment" spellcheck="true">// é‡æ–°å®šä¹‰å±æ€§(vue2çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨),æ¯ä¸ªå˜é‡éƒ½æ·»åŠ get/setç›‘å¬</span>        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å¯¹è±¡è½¬å“åº”å¼çš„æ–¹æ³•(é‡æ–°å®šä¹‰)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// é—­åŒ… å±æ€§åŠ«æŒ</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å†…éƒ¨ä½¿ç”¨äº†å¤–éƒ¨çš„å˜é‡(value),æ‰€ä»¥valueè¢«ä¿å­˜åˆ°é—­åŒ…</span>        <span class="token comment" spellcheck="true">// å–å€¼æ—¶æ‰§è¡Œ</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> value        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// ä¿®æ”¹æ—¶æ‰§è¡Œ</span>        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span>            <span class="token function">observe</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®¾ç½®å€¼æ—¶,å¦‚æœæ˜¯å¯¹è±¡,ä¹Ÿéœ€è¦è½¬å“åº”å¼! </span>            value <span class="token operator">=</span> newValue        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token comment" spellcheck="true">// console.log(data)</span>    <span class="token comment" spellcheck="true">// å¦‚æœdataä¸æ˜¯å¯¹è±¡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span> <span class="token operator">||</span> data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token comment" spellcheck="true">// åªå¯¹å¯¹è±¡è¿›è¡ŒåŠ«æŒ</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å¯¹dataå¯¹è±¡è¿›è¡ŒåŠ«æŒ</span>    <span class="token comment" spellcheck="true">// åˆ¤æ–­æ˜¯å¦è¢«åŠ«æŒ => é€šè¿‡ä¸€ä¸ªä¸“é—¨çš„å®ä¾‹æ¥è§‚æµ‹åˆ¤æ–­</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="ä¿®æ”¹init-js-ä»£ç†å–æ“ä½œå€¼-vm-data-xxx-gt-vm-xxx"><a href="#ä¿®æ”¹init-js-ä»£ç†å–æ“ä½œå€¼-vm-data-xxx-gt-vm-xxx" class="headerlink" title="ä¿®æ”¹init.js,ä»£ç†å–æ“ä½œå€¼ vm._data.xxx -> vm.xxx"></a>ä¿®æ”¹init.js,ä»£ç†å–æ“ä½œå€¼ vm._data.xxx -&gt; vm.xxx</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// ......</span><span class="token comment" spellcheck="true">// ä»£ç†å–å€¼å’Œè®¾ç½®å€¼,é€šè¿‡å“åº”å¼çš„æ–¹æ³•æ¥æ”¹å˜å®é™…æ“ä½œçš„å€¼</span><span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è¿”å›vm[_data][key] (vm._data.key)</span>            <span class="token keyword">return</span> vm<span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> vm<span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span>            <span class="token punctuation">}</span>            vm<span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ•°æ®åˆå§‹åŒ–(è½¬ä¸ºå“åº”å¼)</span><span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data    <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯å‡½æ•°,å°±è°ƒç”¨å¹¶è·å–å…¶è¿”å›å€¼</span>    data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> data<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> data    <span class="token comment" spellcheck="true">// dataæŒ‚è½½åˆ°vmä¸Š</span>    vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> data    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token comment" spellcheck="true">// æ•°æ®åŠ«æŒ </span>    <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç›‘å¬æ•°æ®å˜åŒ–</span>    <span class="token comment" spellcheck="true">// å°†vm._dataä»£ç†,åˆ™ç”¨æˆ·æ“ä½œå€¼åªéœ€è¦vm.xxx(è€Œä¸æ˜¯vm._data.xxx)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'_data'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// data: {</span>        <span class="token comment" spellcheck="true">//     name: 'zs',</span>        <span class="token comment" spellcheck="true">//     age: 12</span>        <span class="token comment" spellcheck="true">// }</span>        <span class="token comment" spellcheck="true">// vue3é‡Œdataåªèƒ½æ˜¯å‡½æ•°,vue2åˆ™å¯ä»¥æ˜¯å‡½æ•°å’Œå¯¹è±¡</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span>                age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>                obj<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    sex<span class="token punctuation">:</span> <span class="token string">'boy'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ls'</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_7.png" alt="img_7.png"><img src="img_8.png" alt="img_8.png"></p><h3 id="é—®é¢˜-åªå¯¹ç¬¬ä¸€å±‚dataè¿›è¡Œå“åº”å¼å¤„ç†-è€Œdata-objå†…çš„å±æ€§åˆ™æ²¡æœ‰è½¬ä¸ºå“åº”å¼"><a href="#é—®é¢˜-åªå¯¹ç¬¬ä¸€å±‚dataè¿›è¡Œå“åº”å¼å¤„ç†-è€Œdata-objå†…çš„å±æ€§åˆ™æ²¡æœ‰è½¬ä¸ºå“åº”å¼" class="headerlink" title="é—®é¢˜: åªå¯¹ç¬¬ä¸€å±‚dataè¿›è¡Œå“åº”å¼å¤„ç†,è€Œdata.objå†…çš„å±æ€§åˆ™æ²¡æœ‰è½¬ä¸ºå“åº”å¼"></a>é—®é¢˜: åªå¯¹ç¬¬ä¸€å±‚dataè¿›è¡Œå“åº”å¼å¤„ç†,è€Œdata.objå†…çš„å±æ€§åˆ™æ²¡æœ‰è½¬ä¸ºå“åº”å¼</h3><h2 id="ä¿®æ”¹src-observe-index-js"><a href="#ä¿®æ”¹src-observe-index-js" class="headerlink" title="ä¿®æ”¹src\observe\index.js"></a>ä¿®æ”¹src\observe\index.js</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// ..... </span><span class="token comment" spellcheck="true">// å¯¹è±¡è½¬å“åº”å¼çš„æ–¹æ³•(é‡æ–°å®šä¹‰)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// é—­åŒ… å±æ€§åŠ«æŒ</span>    <span class="token comment" spellcheck="true">// valueå¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡,éœ€è¦å¯¹å…¶è¿›è¡Œå“åº”å¼å¤„ç†</span>    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é€’å½’äº†,æ€§èƒ½ä¹Ÿä¼šé™ä½ &lt;&lt;-</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å†…éƒ¨ä½¿ç”¨äº†å¤–éƒ¨çš„å˜é‡(value),æ‰€ä»¥valueè¢«ä¿å­˜åˆ°é—­åŒ…</span>        <span class="token comment" spellcheck="true">// å–å€¼æ—¶æ‰§è¡Œ</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> value        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// ä¿®æ”¹æ—¶æ‰§è¡Œ</span>        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span>            value <span class="token operator">=</span> newValue        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// .....</span></code></pre><p><img src="img_9.png" alt="ä¿®æ”¹å,objç¡®å®å¤šäº†getå’Œsetæ–¹æ³•"></p><h2 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// data: {</span>        <span class="token comment" spellcheck="true">//     name: 'zs',</span>        <span class="token comment" spellcheck="true">//     age: 12</span>        <span class="token comment" spellcheck="true">// }</span>        <span class="token comment" spellcheck="true">// vue3é‡Œdataåªèƒ½æ˜¯å‡½æ•°,vue2åˆ™å¯ä»¥æ˜¯å‡½æ•°å’Œå¯¹è±¡</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span>                age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>                obj<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    sex<span class="token punctuation">:</span> <span class="token string">'boy'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ls'</span>    <span class="token comment" spellcheck="true">// æ–°å¢å€¼æ—¶ä¸ä¼šè½¬å“åº”å¼</span>    vm<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>addr <span class="token operator">=</span> <span class="token punctuation">{</span>        code<span class="token punctuation">:</span> <span class="token number">201</span><span class="token punctuation">,</span>        desc<span class="token punctuation">:</span> <span class="token string">'åå°”è¡—'</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ”¹å˜å·²æœ‰å€¼æ—¶ä¼šè½¬å“åº”å¼</span>    vm<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token punctuation">{</span>        sex<span class="token punctuation">:</span> <span class="token string">'boy'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span> <span class="token number">112</span>    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h1 id="å®ç°æ•°ç»„çš„å“åº”å¼"><a href="#å®ç°æ•°ç»„çš„å“åº”å¼" class="headerlink" title="å®ç°æ•°ç»„çš„å“åº”å¼"></a>å®ç°æ•°ç»„çš„å“åº”å¼</h1><blockquote><p>1,åŸæœ¬çš„æ–¹å¼å¯ä»¥è®©æ•°ç»„è½¬å“åº”å¼,ä½†æ˜¯éœ€è¦éå†,å¦‚æœæ•°ç»„å¾ˆå¤§,åˆ™éå¸¸è€—æ—¶!<br>2,å¦‚æœæ•°ç»„å†…éƒ¨æœ‰å¯¹è±¡,ä¹Ÿéœ€è¦å“åº”å¼å¤„ç†</p></blockquote><h2 id="ä¿®æ”¹-src-observe-index-js"><a href="#ä¿®æ”¹-src-observe-index-js" class="headerlink" title="ä¿®æ”¹ src/observe/index.js"></a>ä¿®æ”¹ src/observe/index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>newArrayProto<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./array"</span><span class="token comment" spellcheck="true">// è§‚å¯Ÿdataå¯¹è±¡çš„ç±»</span><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯æ•°ç»„</span>            <span class="token comment" spellcheck="true">// å¯ä»¥ä¿ç•™æ•°ç»„çš„ç‰¹æ€§,é‡å†™æ•°ç»„çš„éƒ¨åˆ†æ–¹æ³• 7ä¸ªå˜å¼‚æ–¹æ³• å¯ä»¥ä¿®æ”¹æ•°ç»„æœ¬èº«</span>            <span class="token comment" spellcheck="true">// data.__proto__ = { // è¿™æ ·é‡æ–°æŒ‡å®šåŸå‹é“¾,ä¼šå¯¼è‡´æ•°ç»„åŸæœ‰å±æ€§å’Œæ–¹æ³•çš„ç¼ºå¤±</span>            <span class="token comment" spellcheck="true">//     push() {</span>            <span class="token comment" spellcheck="true">//         // é‡å†™push</span>            <span class="token comment" spellcheck="true">//         console.log('push')</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// }</span>            data<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> newArrayProto            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Object.definePropertyåªèƒ½åŠ«æŒå·²ç»å­˜åœ¨çš„å±æ€§ (vueé‡Œæä¾›äº†ä¸“é—¨çš„api($set $delete ...)æ¥è§£å†³)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ...... </span>    <span class="token comment" spellcheck="true">// è§‚æµ‹,å¯¹æ•°ç»„å’Œæ•°ç»„é‡Œçš„å¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†</span>    <span class="token function">observeArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ......</span></code></pre><h2 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'ant'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// ä¸€èˆ¬æ“ä½œæ•°ç»„å¾ˆå°‘ç”¨ä¸‹æ ‡,ä¸€èˆ¬æ˜¯ç”¨æ•°ç»„æä¾›çš„æ–¹æ³•</span>    vm<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'bear'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// æ•°ç»„é‡Œçš„å¯¹è±¡ä¹Ÿéœ€è¦è¢«åŠ«æŒ</span>    vm<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">100</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="é—®é¢˜-ä½¿ç”¨å˜å¼‚æ–¹æ³•æ·»åŠ çš„æ•°ç»„å…ƒç´ æ²¡æœ‰è½¬å“åº”å¼"><a href="#é—®é¢˜-ä½¿ç”¨å˜å¼‚æ–¹æ³•æ·»åŠ çš„æ•°ç»„å…ƒç´ æ²¡æœ‰è½¬å“åº”å¼" class="headerlink" title="é—®é¢˜: ä½¿ç”¨å˜å¼‚æ–¹æ³•æ·»åŠ çš„æ•°ç»„å…ƒç´ æ²¡æœ‰è½¬å“åº”å¼"></a>é—®é¢˜: ä½¿ç”¨å˜å¼‚æ–¹æ³•æ·»åŠ çš„æ•°ç»„å…ƒç´ æ²¡æœ‰è½¬å“åº”å¼</h3><p><img src="img_10.png" alt="ä½¿ç”¨å˜å¼‚æ–¹æ³•æ·»åŠ çš„æ•°ç»„å…ƒç´ æ²¡æœ‰è½¬å“åº”å¼"></p><h2 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h2><h3 id="src-observe-index-js-1"><a href="#src-observe-index-js-1" class="headerlink" title="src/observe/index.js"></a>src/observe/index.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>newArrayProto<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./array"</span><span class="token comment" spellcheck="true">// è§‚å¯Ÿdataå¯¹è±¡çš„ç±»</span><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>            value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯å¯¹è±¡,åˆ™åŠ ä¸Š__ob__å,ä¼šä¸€ç›´è¿›è¡Œå“åº”å¼å¤„ç†walk(åœ¨æ„é€ å‡½æ•°è°ƒç”¨äº†),ç„¶åæ ˆæº¢å‡º</span>            enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// ä¸å¯æšä¸¾,(å¾ªç¯æ—¶æ— æ³•è·å–)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// æŠŠobserverå®ä¾‹æŒ‚è½½åˆ°data,åˆ™array.jsä¹Ÿå¯ä»¥ä½¿ç”¨observerçš„è§‚æµ‹æ•°ç»„æ–¹æ³•</span>        <span class="token comment" spellcheck="true">// å¦‚æœdataä¸Šæœ‰ä¸€ä¸ª__ob__å±æ€§,åˆ™è¯´æ˜è¢«è§‚æµ‹è¿‡</span>        <span class="token comment" spellcheck="true">// data.__ob__ = this</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯æ•°ç»„</span>            <span class="token comment" spellcheck="true">// å¯ä»¥ä¿ç•™æ•°ç»„çš„ç‰¹æ€§,é‡å†™æ•°ç»„çš„éƒ¨åˆ†æ–¹æ³• 7ä¸ªå˜å¼‚æ–¹æ³• å¯ä»¥ä¿®æ”¹æ•°ç»„æœ¬èº«</span>            <span class="token comment" spellcheck="true">// data.__proto__ = { // è¿™æ ·é‡æ–°æŒ‡å®šåŸå‹é“¾,ä¼šå¯¼è‡´æ•°ç»„åŸæœ‰å±æ€§å’Œæ–¹æ³•çš„ç¼ºå¤±</span>            <span class="token comment" spellcheck="true">//     push() {</span>            <span class="token comment" spellcheck="true">//         // é‡å†™push</span>            <span class="token comment" spellcheck="true">//         console.log('push')</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// }</span>            data<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> newArrayProto            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Object.definePropertyåªèƒ½åŠ«æŒå·²ç»å­˜åœ¨çš„å±æ€§ (vueé‡Œæä¾›äº†ä¸“é—¨çš„api($set $delete ...)æ¥è§£å†³)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¾ªç¯å¯¹è±¡,å¯¹å±æ€§ä¾æ¬¡åŠ«æŒ</span>        <span class="token comment" spellcheck="true">// é‡æ–°å®šä¹‰å±æ€§(vue2çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨),æ¯ä¸ªå˜é‡éƒ½æ·»åŠ get/setç›‘å¬</span>        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// è§‚æµ‹,å¯¹æ•°ç»„å’Œæ•°ç»„é‡Œçš„å¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†</span>    <span class="token function">observeArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ......</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token comment" spellcheck="true">// console.log(data)</span>    <span class="token comment" spellcheck="true">// å¦‚æœdataä¸æ˜¯å¯¹è±¡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span> <span class="token operator">||</span> data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token comment" spellcheck="true">// åªå¯¹å¯¹è±¡è¿›è¡ŒåŠ«æŒ</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>__ob__ <span class="token keyword">instanceof</span> <span class="token class-name">Observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¯´æ˜è¢«ä»£ç†è¿‡</span>        <span class="token keyword">return</span> data<span class="token punctuation">.</span>__ob__    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å¯¹dataå¯¹è±¡è¿›è¡ŒåŠ«æŒ</span>    <span class="token comment" spellcheck="true">// åˆ¤æ–­æ˜¯å¦è¢«åŠ«æŒ => é€šè¿‡ä¸€ä¸ªä¸“é—¨çš„å®ä¾‹æ¥è§‚æµ‹åˆ¤æ–­</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="src-observe-array-js"><a href="#src-observe-array-js" class="headerlink" title="src/observe/array.js"></a>src/observe/array.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// é‡å†™æ•°ç»„éƒ¨åˆ†æ–¹æ³•</span><span class="token keyword">let</span> oldArrayProto <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype <span class="token comment" spellcheck="true">// è·å–æ•°ç»„çš„åŸå‹</span><span class="token comment" spellcheck="true">// newArrayProto = oldArrayProto æ‹¿åˆ°äº†æ—§åŸå‹</span><span class="token keyword">export</span> <span class="token keyword">let</span> newArrayProto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>oldArrayProto<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// é‡å†™</span><span class="token keyword">let</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment" spellcheck="true">// æ‰¾åˆ°æ‰€æœ‰çš„å˜å¼‚æ–¹æ³•(å¯ä»¥ä¿®æ”¹æ•°ç»„çš„æ–¹æ³•)</span>    <span class="token comment" spellcheck="true">// push å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦</span>    <span class="token comment" spellcheck="true">// pop åˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´  </span>    <span class="token comment" spellcheck="true">// shift ç§»é™¤æ•°ç»„çš„ç¬¬ä¸€é¡¹ </span>    <span class="token comment" spellcheck="true">// unshift å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„å¼€å¤´ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦</span>    <span class="token comment" spellcheck="true">// reverse åè½¬æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåº </span>    <span class="token comment" spellcheck="true">// sort æ’åº</span>    <span class="token comment" spellcheck="true">// splice ä»æ•°ç»„ä¸­æ·»åŠ /åˆ é™¤å…ƒç´ </span>    <span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span>    <span class="token string">'shift'</span><span class="token punctuation">,</span> <span class="token string">'unshift'</span><span class="token punctuation">,</span>    <span class="token string">'reverse'</span><span class="token punctuation">,</span>    <span class="token string">'sort'</span><span class="token punctuation">,</span>    <span class="token string">'splice'</span><span class="token punctuation">]</span>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>method <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// arr.push(1,2,3)</span>    <span class="token comment" spellcheck="true">// é‡å†™æ–¹æ³•</span>    newArrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è°ƒç”¨</span>        <span class="token comment" spellcheck="true">// å†…éƒ¨è°ƒç”¨åŸæ–¹æ³•,å‡½æ•°çš„åŠ«æŒ,åˆ‡ç‰‡ç¼–ç¨‹</span>        <span class="token keyword">const</span> result <span class="token operator">=</span> oldArrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿ç•™æ—§æ–¹æ³•çš„é€»è¾‘ </span>        <span class="token comment" spellcheck="true">// å¯¹æ–°å¢çš„æ•°æ®å†æ¬¡è¿›è¡ŒåŠ«æŒ</span>        <span class="token keyword">let</span> inserted <span class="token comment" spellcheck="true">// æ˜¯ä¸€ä¸ªæ•°ç»„</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token punctuation">:</span>            <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token punctuation">:</span>                inserted <span class="token operator">=</span> args                <span class="token keyword">break</span>            <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// splice(å¼€å§‹ä½ç½®,ç»“æŸä½ç½®,{æ–°å¢æ•°æ®},{æ–°å¢æ•°æ®})</span>                <span class="token comment" spellcheck="true">// è·å–æ–°å¢çš„æ•°æ®</span>                inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å»æ‰å‰ä¸¤ä¸ª,æ‹¿åˆ°å‰©ä¸‹çš„</span>                <span class="token keyword">break</span>            <span class="token keyword">default</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(inserted)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// æ•°ç»„è½¬å“åº”å¼</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><img src="img_11.png" alt="img_11.png"></p><h1 id="è§£ææ¨¡æ¿å‚æ•°"><a href="#è§£ææ¨¡æ¿å‚æ•°" class="headerlink" title="è§£ææ¨¡æ¿å‚æ•° "></a>è§£ææ¨¡æ¿å‚æ•° </h1><blockquote><p>å®ç°è§£æè¡¨è¾¾å¼çš„æ–¹æ¡ˆ:</p></blockquote><ul><li>1,æ¨¡æ¿å¼•æ“ -&gt; æ€§èƒ½å·®,éœ€è¦æ­£åˆ™åŒ¹é…æ›¿æ¢ vue1.0 -&gt; æ²¡æœ‰å¼•å…¥è™šæ‹Ÿdom</li><li>2,é‡‡ç”¨<strong>è™šæ‹Ÿdom</strong> -&gt; æ•°æ®å˜åŒ–å,æ¯”è¾ƒè™šæ‹Ÿdomçš„å·®å¼‚,æœ€åæ›´æ–°éœ€è¦æ›´æ–°çš„åœ°æ–¹,æ ¸å¿ƒå°±æ˜¯å°†æ¨¡æ¿å˜æˆjsè¯­æ³•,é€šè¿‡jsè¯­æ³•ç”Ÿæˆè™šæ‹Ÿdom</li></ul><blockquote><p>æ¶‰åŠè¯­æ³•è½¬æ¢,å¦‚ es6-&gt;es5 csså‹ç¼©<br>éœ€è¦å…ˆå˜æˆè¯­æ³•æ ‘å†é‡æ–°ç»„è£…ä»£ç ,å°†templateè¯­æ³•è½¬æ¢æˆrenderå‡½æ•°</p></blockquote><h2 id="é…ç½®ä¸€ä¸‹æ’ä»¶-ä¼˜åŒ–importçš„ç¼–ç ä½“éªŒ"><a href="#é…ç½®ä¸€ä¸‹æ’ä»¶-ä¼˜åŒ–importçš„ç¼–ç ä½“éªŒ" class="headerlink" title="é…ç½®ä¸€ä¸‹æ’ä»¶,ä¼˜åŒ–importçš„ç¼–ç ä½“éªŒ"></a>é…ç½®ä¸€ä¸‹æ’ä»¶,ä¼˜åŒ–importçš„ç¼–ç ä½“éªŒ</h2><pre class=" language-shell"><code class="language-shell"># nodeæ’ä»¶,å¯ä»¥ç®€åŒ–å¯¼å…¥npm i @rollup/plugin-node-resolvenpm i @rollup/plugin-node-resolve --registry=https://registry.npmmirror.com</code></pre><h3 id="rollup-config-js"><a href="#rollup-config-js" class="headerlink" title="rollup.config.js"></a>rollup.config.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// rollupé»˜è®¤å¯ä»¥å¯¼å‡ºä¸€ä¸ªå¯¹è±¡,ä½œä¸ºæ‰“åŒ…çš„é…ç½®æ–‡ä»¶</span><span class="token comment" spellcheck="true">// import babel from 'rollup-plugin-babel' // es6å¯¼å…¥è¯­æ³•</span><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-babel'</span><span class="token punctuation">)</span><span class="token keyword">const</span> resolve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@rollup/plugin-node-resolve'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// export default {</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    input<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å…¥å£</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        file<span class="token punctuation">:</span> <span class="token string">'./dist/vue.js'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å‡ºå£</span>        name<span class="token punctuation">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ‰“åŒ…åå…¨å±€æ·»åŠ Vueå¯¹è±¡ global Vue</span>        format<span class="token punctuation">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// esm es6æ¨¡å— commonjsæ¨¡å— iifeè‡ªæ‰§è¡Œå‡½æ•° umdé€šç”¨æ¨¡å—è§„èŒƒ(å…¼å®¹AMDå’Œcommonjs,iife,ä¸å…¼å®¹es6)</span>        sourcemap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å¯ä»¥è°ƒè¯•æºä»£ç </span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// å¯ä»¥ä½¿ç”¨çš„æ’ä»¶</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            exclude<span class="token punctuation">:</span> <span class="token string">'node_modules/**'</span> <span class="token comment" spellcheck="true">// æ’é™¤nodemoduleä¸‹æ‰€æœ‰æ–‡ä»¶</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// import xx from 'xxx/index' -> 'xxx'</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><h3 id="init-js-1"><a href="#init-js-1" class="headerlink" title="init.js"></a>init.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>initState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token keyword">import</span> <span class="token punctuation">{</span>compileToFunction<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./compile"</span><span class="token comment" spellcheck="true">// æä¾›ç»™vueæ¥ä½¿ç”¨(æ­¤æ—¶å…¨å±€è¿˜æ²¡æœ‰vueå¯¹è±¡,æ‰€ä»¥æ²¡åŠæ³•ç›´æ¥æŒ‚è½½)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ“ä½œ</span>    <span class="token comment" spellcheck="true">// ......</span>    <span class="token comment" spellcheck="true">// æ¸²æŸ“æ¨¡æ¿çš„æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token comment" spellcheck="true">// è·å–elå¯¹åº”çš„dom</span>        el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>        <span class="token keyword">let</span> ops <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å…ˆçœ‹æœ‰æ²¡æœ‰renderå‡½æ•°</span>            <span class="token keyword">let</span> template <span class="token comment" spellcheck="true">// æ²¡æœ‰renderå°±çœ‹çœ‹æœ‰æ²¡æœ‰template</span>            <span class="token comment" spellcheck="true">// å¦‚æœç”¨æˆ·æ²¡æœ‰ä½¿ç”¨äº†renderå‡½æ•°</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>template <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ²¡æœ‰å†™æ¨¡æ¿,ä½†æ˜¯å†™äº†el</span>                <span class="token comment" spellcheck="true">/*                    1ï¼‰innerHTML:                    ä»å¯¹è±¡çš„èµ·å§‹ä½ç½®åˆ°ç»ˆæ­¢ä½ç½®çš„å…¨éƒ¨å†…å®¹,ä¸åŒ…æ‹¬Htmlæ ‡ç­¾ã€‚                    2ï¼‰outerHTML:                    é™¤äº†åŒ…å«innerHTMLçš„å…¨éƒ¨å†…å®¹å¤–, è¿˜åŒ…å«å¯¹è±¡æ ‡ç­¾æœ¬èº«ã€‚                */</span>                template <span class="token operator">=</span> el<span class="token punctuation">.</span>outerHTML  <span class="token comment" spellcheck="true">// outerHTMLåœ¨ç«ç‹ä¸‹å¯èƒ½ä¸å…¼å®¹</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// å†™äº†template,å°±ç”¨ç”¨æˆ·çš„template</span>                    template <span class="token operator">=</span> ops<span class="token punctuation">.</span>template                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(template)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘</span>                <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>                ops<span class="token punctuation">.</span>render <span class="token operator">=</span> render            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        ops<span class="token punctuation">.</span>render <span class="token comment" spellcheck="true">// æœ€ç»ˆè·å–renderæ–¹æ³•</span>        <span class="token comment" spellcheck="true">// scriptæ ‡ç­¾å¼•ç”¨çš„vue.global.js,è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨æµè§ˆå™¨è¿è¡Œçš„</span>        <span class="token comment" spellcheck="true">// runtimeæ˜¯ä¸åŒ…å«æ¨¡æ¿ç¼–è¯‘çš„,æ•´ä¸ªç¼–è¯‘æ˜¯æ‰“åŒ…æ—¶é€šè¿‡loaderæ¥è½¬ä¹‰vueæ–‡ä»¶çš„,ç”¨runtimeæ—¶ä¸èƒ½ä½¿ç”¨template</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>  </code></pre><h3 id="compile-index-js"><a href="#compile-index-js" class="headerlink" title="compile/index.js"></a>compile/index.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 1,å°†templateè½¬åŒ–ä¸ºastè¯­æ³•æ ‘</span>    <span class="token comment" spellcheck="true">// 2,ç”Ÿæˆrenderæ–¹æ³•,renderæ–¹æ³•æ‰§è¡Œè¿”å›çš„ç»“æœå°±æ˜¯è™šæ‹Ÿdom</span><span class="token punctuation">}</span></code></pre><h2 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="index-html-1"><a href="#index-html-1" class="headerlink" title="index.html"></a>index.html</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span> skyblue</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span> skyblue</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        {{name}}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>            {{age}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// console.log(Vue);</span>    <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// name: 'zs',</span>                <span class="token comment" spellcheck="true">// age: 12,</span>                <span class="token comment" spellcheck="true">// obj: {</span>                <span class="token comment" spellcheck="true">//     sex: 'boy'</span>                <span class="token comment" spellcheck="true">// },</span>                arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'ant'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        template<span class="token punctuation">:</span> <span class="token string">'&lt;div>hello&lt;/div>'</span>        <span class="token comment" spellcheck="true">// el: '#app', // å°†æ•°æ®è§£æåˆ°elä¸Š</span>        <span class="token comment" spellcheck="true">// render(){</span>        <span class="token comment" spellcheck="true">// return createElement('div',{})</span>        <span class="token comment" spellcheck="true">// }</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// å®ç°è§£æè¡¨è¾¾å¼çš„æ–¹æ¡ˆ</span>    <span class="token comment" spellcheck="true">// 1,æ¨¡æ¿å¼•æ“ -> æ€§èƒ½å·®,éœ€è¦æ­£åˆ™åŒ¹é…æ›¿æ¢ vue1.0 -> æ²¡æœ‰å¼•å…¥è™šæ‹Ÿdom</span>    <span class="token comment" spellcheck="true">// 2,é‡‡ç”¨è™šæ‹Ÿdom -> æ•°æ®å˜åŒ–å,æ¯”è¾ƒè™šæ‹Ÿdomçš„å·®å¼‚,æœ€åæ›´æ–°éœ€è¦æ›´æ–°çš„åœ°æ–¹</span>    <span class="token comment" spellcheck="true">// 3,æ ¸å¿ƒå°±æ˜¯å°†æ¨¡æ¿å˜æˆjsè¯­æ³•,é€šè¿‡jsè¯­æ³•ç”Ÿæˆè™šæ‹Ÿdom</span>    <span class="token comment" spellcheck="true">// æ¶‰åŠè¯­æ³•è½¬æ¢,å¦‚ es6->es5 csså‹ç¼©</span>    <span class="token comment" spellcheck="true">// éœ€è¦å…ˆå˜æˆè¯­æ³•æ ‘å†é‡æ–°ç»„è£…ä»£ç ,å°†templateè¯­æ³•è½¬æ¢æˆrenderå‡½æ•°</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_12.png" alt="img_12.png"></p><h1 id="å®ç°æ¨¡æ¿è½¬åŒ–ä¸ºastè¯­æ³•æ ‘"><a href="#å®ç°æ¨¡æ¿è½¬åŒ–ä¸ºastè¯­æ³•æ ‘" class="headerlink" title="å®ç°æ¨¡æ¿è½¬åŒ–ä¸ºastè¯­æ³•æ ‘"></a>å®ç°æ¨¡æ¿è½¬åŒ–ä¸ºastè¯­æ³•æ ‘</h1><p><img src="img_13.png" alt="æ­£åˆ™è¡¨è¾¾å¼å¯è§†åŒ–ç½‘ç«™"></p><h2 id="init-js-2"><a href="#init-js-2" class="headerlink" title="init.js"></a>init.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>initState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token keyword">import</span> <span class="token punctuation">{</span>compileToFunction<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./compile"</span><span class="token comment" spellcheck="true">// æä¾›ç»™vueæ¥ä½¿ç”¨(æ­¤æ—¶å…¨å±€è¿˜æ²¡æœ‰vueå¯¹è±¡,æ‰€ä»¥æ²¡åŠæ³•ç›´æ¥æŒ‚è½½)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ“ä½œ</span>    <span class="token comment" spellcheck="true">// ......</span>    <span class="token comment" spellcheck="true">// æ¸²æŸ“æ¨¡æ¿çš„æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token comment" spellcheck="true">// è·å–elå¯¹åº”çš„dom</span>        el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>        <span class="token keyword">let</span> ops <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å…ˆçœ‹æœ‰æ²¡æœ‰renderå‡½æ•°</span>            <span class="token keyword">let</span> template <span class="token comment" spellcheck="true">// æ²¡æœ‰renderå°±çœ‹çœ‹æœ‰æ²¡æœ‰template</span>            <span class="token comment" spellcheck="true">// å¦‚æœç”¨æˆ·æ²¡æœ‰ä½¿ç”¨äº†renderå‡½æ•°</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>template <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ²¡æœ‰å†™æ¨¡æ¿,ä½†æ˜¯å†™äº†el</span>                <span class="token comment" spellcheck="true">/*                    1ï¼‰innerHTML:                    ä»å¯¹è±¡çš„èµ·å§‹ä½ç½®åˆ°ç»ˆæ­¢ä½ç½®çš„å…¨éƒ¨å†…å®¹,ä¸åŒ…æ‹¬Htmlæ ‡ç­¾ã€‚                    2ï¼‰outerHTML:                    é™¤äº†åŒ…å«innerHTMLçš„å…¨éƒ¨å†…å®¹å¤–, è¿˜åŒ…å«å¯¹è±¡æ ‡ç­¾æœ¬èº«ã€‚                */</span>                template <span class="token operator">=</span> el<span class="token punctuation">.</span>outerHTML  <span class="token comment" spellcheck="true">// outerHTMLåœ¨ç«ç‹ä¸‹å¯èƒ½ä¸å…¼å®¹</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// å†™äº†template,å°±ç”¨ç”¨æˆ·çš„template</span>                    template <span class="token operator">=</span> ops<span class="token punctuation">.</span>template                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(template)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘</span>                <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>                ops<span class="token punctuation">.</span>render <span class="token operator">=</span> render            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        ops<span class="token punctuation">.</span>render <span class="token comment" spellcheck="true">// æœ€ç»ˆè·å–renderæ–¹æ³•</span>        <span class="token comment" spellcheck="true">// scriptæ ‡ç­¾å¼•ç”¨çš„vue.global.js,è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨æµè§ˆå™¨è¿è¡Œçš„</span>        <span class="token comment" spellcheck="true">// runtimeæ˜¯ä¸åŒ…å«æ¨¡æ¿ç¼–è¯‘çš„,æ•´ä¸ªç¼–è¯‘æ˜¯æ‰“åŒ…æ—¶é€šè¿‡loaderæ¥è½¬ä¹‰vueæ–‡ä»¶çš„,ç”¨runtimeæ—¶ä¸èƒ½ä½¿ç”¨template</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> </code></pre><h2 id="compile-index-js-1"><a href="#compile-index-js-1" class="headerlink" title="compile/index.js"></a>compile/index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>parseHTML<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./parse"</span><span class="token comment" spellcheck="true">// ç¼–è¯‘æ¨¡æ¿</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(template)</span>    <span class="token comment" spellcheck="true">// 1,å°†templateè½¬åŒ–ä¸ºastè¯­æ³•æ ‘</span>    <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 2,ç”Ÿæˆrenderæ–¹æ³•,renderæ–¹æ³•æ‰§è¡Œè¿”å›çš„ç»“æœå°±æ˜¯è™šæ‹Ÿdom </span><span class="token punctuation">}</span></code></pre><h2 id="compile-parse-js"><a href="#compile-parse-js" class="headerlink" title="compile/parse.js"></a>compile/parse.js</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// æ­£åˆ™è¡¨è¾¾å¼</span><span class="token comment" spellcheck="true">// vue3é‡‡ç”¨çš„ä¸æ˜¯æ­£åˆ™</span><span class="token keyword">const</span> ncname <span class="token operator">=</span> <span class="token template-string"><span class="token string">`[a-zA-Z_][\\-\\.0-9_a-zA-Z]*`</span></span> <span class="token comment" spellcheck="true">// æ ‡ç­¾å</span><span class="token keyword">const</span> qnameCapture <span class="token operator">=</span> <span class="token template-string"><span class="token string">`((?:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\:)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span> <span class="token comment" spellcheck="true">// è§£æ &lt;div:xxx> å½¢å¼(å¸¦å‘½åç©ºé—´)çš„æ ‡ç­¾</span><span class="token keyword">const</span> startTagOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`^&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åŒ¹é…åˆ°çš„åˆ†ç»„æ˜¯ä¸€ä¸ªå¼€å§‹æ ‡ç­¾å</span><span class="token keyword">const</span> endTag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`^&lt;\\/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[^>]*>`</span></span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åŒ¹é…çš„æ˜¯&lt;/xxx> æœ€ç»ˆåŒ¹é…åˆ°çš„åˆ†ç»„æ˜¯ç»“æŸæ ‡ç­¾çš„åå­—</span><span class="token keyword">const</span> attribute <span class="token operator">=</span> <span class="token operator">/</span><span class="token operator">^</span>\s<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">^</span>\s<span class="token string">"'&lt;>\/=]+)(?:\s*(=)\s*(?:"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token string">"]*)"</span><span class="token operator">+</span><span class="token operator">|</span><span class="token string">'([^'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">'+|([^\s"'</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token operator">></span>`<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">/</span> <span class="token comment" spellcheck="true">// åŒ¹é…å±æ€§</span><span class="token keyword">const</span> startTagClose <span class="token operator">=</span> <span class="token operator">/</span><span class="token operator">^</span>\s<span class="token operator">*</span><span class="token punctuation">(</span>\<span class="token operator">/</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">/</span> <span class="token comment" spellcheck="true">// åŒ¹é… &lt;br/> è¿™ç§å•æ ‡ç­¾</span><span class="token keyword">const</span> defaultTagRE <span class="token operator">=</span> <span class="token operator">/</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token operator">|</span>\r<span class="token operator">?</span>\n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">?</span><span class="token punctuation">)</span>\<span class="token punctuation">}</span>\<span class="token punctuation">}</span><span class="token operator">/</span>g <span class="token comment" spellcheck="true">// åŒ¹é… æ’å€¼è¡¨è¾¾å¼ </span><span class="token comment" spellcheck="true">// htmlparser2åº“ä¹Ÿå¯ä»¥è§£æhtml</span><span class="token comment" spellcheck="true">/*{    tag: 'div',    type: 1,    attrs: [{name,age,address}],    parent: null,    children:[        {                tag: 'span',                type: 1,                attrs: [{...}],                parent: div,                children:[]        }    ]}*/</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// htmlå¿…å®šæ˜¯&lt;å¼€å¤´(vue2çš„templateä¸èƒ½æ˜¯å­—ç¬¦ä¸²,ä½†æ˜¯vue3å¯ä»¥)</span>    <span class="token comment" spellcheck="true">// å®šä¹‰è™šæ‹Ÿdomçš„èŠ‚ç‚¹ç±»å‹</span>    <span class="token keyword">const</span> ELEMENT_TYPE <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">const</span> TEXT_TYPE <span class="token operator">=</span> <span class="token number">3</span>    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// ç”¨äºå­˜æ”¾å…ƒç´ </span>    <span class="token keyword">let</span> currentParent <span class="token comment" spellcheck="true">// æŒ‡å‘æ ˆä¸­æœ€åä¸€ä¸ªå…ƒç´ </span>    <span class="token keyword">let</span> root <span class="token comment" spellcheck="true">// æ ‡è®°æ ¹èŠ‚ç‚¹</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºè™šæ‹Ÿdomçš„èŠ‚ç‚¹</span>    <span class="token keyword">function</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>            tag<span class="token punctuation">,</span>            type<span class="token punctuation">:</span> ELEMENT_TYPE<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            attrs<span class="token punctuation">,</span>            parent<span class="token punctuation">:</span> <span class="token keyword">null</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æœ€ç»ˆéœ€è¦è½¬åŒ–ä¸ºä¸€é¢—æŠ½è±¡è¯­æ³•æ ‘</span>    <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(tag, attrs, 'å¼€å§‹');</span>        <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœè¿˜æ²¡æœ‰æ ¹èŠ‚ç‚¹,åˆ™è¯¥å…ƒç´ å°±æ˜¯æ ¹èŠ‚ç‚¹</span>            root <span class="token operator">=</span> node        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentParent<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæœ‰å½“å‰èŠ‚ç‚¹,åˆ™å½“å‰èŠ‚ç‚¹æ˜¯æ–°èŠ‚ç‚¹çš„parent</span>            node<span class="token punctuation">.</span>parent <span class="token operator">=</span> currentParent            <span class="token comment" spellcheck="true">// å­èŠ‚ç‚¹çš„parentè¦å˜ä¸ºcurrentParent</span>            currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ”¾å…¥æ ˆ</span>        currentParent <span class="token operator">=</span> node <span class="token comment" spellcheck="true">// æŒ‡é’ˆæŒ‡å‘æ ˆä¸­æœ€åä¸€ä¸ª</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">chars</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// vue2æºç æ˜¯ä¿ç•™æœ€å¤šä¸¤ä¸ªç©ºæ ¼</span>        text <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å»æ‰ç©ºæ ¼</span>        <span class="token comment" spellcheck="true">// console.log(text, 'æ–‡æœ¬');</span>        <span class="token comment" spellcheck="true">// æ–‡æœ¬ç›´æ¥æ”¾å…¥å½“å‰æŒ‡å‘çš„èŠ‚ç‚¹çš„children</span>        text <span class="token operator">&amp;&amp;</span> currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            type<span class="token punctuation">:</span> TEXT_TYPE<span class="token punctuation">,</span>            text<span class="token punctuation">,</span>            parent<span class="token punctuation">:</span> currentParent        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(tag, 'ç»“æŸ');</span>        <span class="token comment" spellcheck="true">// å¼¹å‡ºæ—¶,å…¶å¼€å§‹æ ‡ç­¾å’Œæ–‡æœ¬å†…å®¹éƒ½è¢«åŠ åˆ°æ ¹ç»“ç‚¹çš„childrenäº†</span>        <span class="token keyword">let</span> node <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å¼¹å‡ºæœ€åä¸€ä¸ª // å¯ä»¥æ ¡éªŒæ ‡ç­¾æ˜¯å¦åˆæ³•</span>        currentParent <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æˆªå–htmlå­—ç¬¦ä¸²</span>    <span class="token keyword">function</span> <span class="token function">advance</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// console.log(html)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// åŒ¹é…æ˜¯å¦æ˜¯å¼€å§‹æ ‡ç­¾</span>    <span class="token keyword">function</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> start <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagOpen<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// console.log(start); // {0: '&lt;div', 1: 'div' ,...}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// åˆ†ç»„å°±æ˜¯æ ‡ç­¾å</span>                tagName<span class="token punctuation">:</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                attrs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// start[0].lengthæ˜¯åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²,('&lt;div')</span>            <span class="token function">advance</span><span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä»htmlåˆ é™¤åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²</span>            <span class="token comment" spellcheck="true">// console.log(match) </span>            <span class="token comment" spellcheck="true">// åªè¦ä¸æ˜¯å¼€å§‹æ ‡ç­¾çš„ç»“æŸ,å°±ä¸€ç›´å¾ªç¯åŒ¹é…</span>            <span class="token keyword">let</span> attr<span class="token punctuation">,</span> end            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>end <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagClose<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// å°†åŒ¹é…åˆ°çš„å†…å®¹å­˜å…¥attr</span>            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>attr <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// å› ä¸ºå·²ç»å°†åŒ¹é…çš„å†…å®¹å­˜æ”¾,æ‰€ä»¥å¯ä»¥åˆ é™¤åŒ¹é…çš„å­—ç¬¦ä¸²</span>                <span class="token function">advance</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// console.log(attr);</span>                match<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    name<span class="token punctuation">:</span> attr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token comment" spellcheck="true">// å› ä¸ºç­‰å·ä¸¤è¾¹å¯èƒ½æœ‰ç©ºæ ¼,æ‰€ä»¥valueå¯èƒ½æ˜¯attr[3]æˆ–[4]æˆ–[5]</span>                    value<span class="token punctuation">:</span> attr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">||</span> attr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">||</span> attr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯disableè¿™ç§æ²¡æœ‰ = çš„,åˆ™å€¼æ˜¯true</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// å¦‚æœæœ‰ > è¿™ç§ç»“æŸæ ‡ç­¾,ä¹Ÿè¦åˆ é™¤</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">advance</span><span class="token punctuation">(</span>end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(match);</span>            <span class="token keyword">return</span> match        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(html);</span>        <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// ä¸æ˜¯å¼€å§‹æ ‡ç­¾</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ¯è§£æä¸€ä¸ª,å°±æŠŠè§£æçš„å†…å®¹ä»htmlå­—ç¬¦ä¸²é‡Œåˆ é™¤,htmlåˆ å®Œå°±æ˜¯è§£æå®Œæˆ</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// debugger</span>        <span class="token comment" spellcheck="true">// å¼€å¤´æ˜¯ &lt;çš„ è€Œä¸‹ä¸€ä¸ªå¼€å¤´åˆ™æ˜¯&lt;/çš„&lt; æ‰€ä»¥ä¸¤ä¸ª &lt; ä¹‹é—´å°±æ˜¯æ ‡ç­¾çš„å†…å®¹</span>        <span class="token comment" spellcheck="true">// å¦‚æœindexofçš„ç´¢å¼•æ˜¯0,åˆ™è¯´æ˜æ˜¯ä¸ªå¼€å§‹æˆ–ç»“æŸæ ‡ç­¾</span>        <span class="token comment" spellcheck="true">// å¦‚æœindexofçš„ç´¢å¼•å¤§äº0,åˆ™è¯´æ˜æ˜¯æ–‡æœ¬ç»“æŸä½ç½®</span>        <span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> startTagMatch <span class="token operator">=</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// è§£æåˆ°å¼€å§‹æ ‡ç­¾</span>                <span class="token comment" spellcheck="true">// console.log(html);</span>                <span class="token function">start</span><span class="token punctuation">(</span>startTagMatch<span class="token punctuation">.</span>tagName<span class="token punctuation">,</span> startTagMatch<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// å¦‚æœæœ‰ç»“æŸæ ‡ç­¾</span>            <span class="token keyword">let</span> endTagMatch <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>endTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">end</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token function">advance</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// æ–‡æœ¬å†…å®¹</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> text <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ–‡æœ¬å†…å®¹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// è§£æåˆ°æ–‡æœ¬ </span>                <span class="token function">chars</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>                <span class="token function">advance</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>length<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// console.log(html)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(root)</span>    <span class="token comment" spellcheck="true">// console.log(html)</span>    <span class="token keyword">return</span> root<span class="token punctuation">}</span>   </code></pre><h2 id="æµ‹è¯•-4"><a href="#æµ‹è¯•-4" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><img src="img_14.png" alt="æ¸²æŸ“å‡ºæ¥çš„ast"></p><h1 id="ä»£ç ç”Ÿæˆå®ç°åŸç†"><a href="#ä»£ç ç”Ÿæˆå®ç°åŸç†" class="headerlink" title="ä»£ç ç”Ÿæˆå®ç°åŸç†"></a>ä»£ç ç”Ÿæˆå®ç°åŸç†</h1><h2 id="compile-index-js-2"><a href="#compile-index-js-2" class="headerlink" title="compile/index.js"></a>compile/index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>parseHTML<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./parse"</span><span class="token keyword">const</span> defaultTagRE <span class="token operator">=</span> <span class="token operator">/</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token operator">|</span>\r<span class="token operator">?</span>\n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">?</span><span class="token punctuation">)</span>\<span class="token punctuation">}</span>\<span class="token punctuation">}</span><span class="token operator">/</span>g <span class="token comment" spellcheck="true">// åŒ¹é… æ’å€¼è¡¨è¾¾å¼</span><span class="token keyword">function</span> <span class="token function">gen</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// èŠ‚ç‚¹ç›´æ¥ç”Ÿæˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">codegen</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ–‡æœ¬</span>        <span class="token keyword">let</span> text <span class="token operator">=</span> node<span class="token punctuation">.</span>text        <span class="token comment" spellcheck="true">// æœ‰å¯èƒ½æ˜¯æ’å€¼è¡¨è¾¾å¼æˆ–çº¯æ–‡æœ¬</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>defaultTagRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// çº¯æ–‡æœ¬</span>            <span class="token comment" spellcheck="true">// stringifyæ˜¯ä¸ºäº†åŠ ä¸Š'',è®©ä¼ å…¥çš„å€¼å˜æˆå­—ç¬¦ä¸²</span>            <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`_v(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¸¦æ’å€¼è¡¨è¾¾å¼</span>            <span class="token comment" spellcheck="true">// {{name}}hello => _v(_s(name)+'hello')</span>            <span class="token comment" spellcheck="true">// console.log(text)</span>            <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">// æ•è·æ–‡æœ¬</span>            <span class="token keyword">let</span> match            <span class="token comment" spellcheck="true">// å¦‚æœæ­£åˆ™é‡Œæœ‰g,åˆ™å†æ¬¡execä¼šä»ä¸Šæ¬¡åŒ¹é…åˆ°çš„ä½ç½®å¼€å§‹å¾€åæ‰¾</span>            <span class="token comment" spellcheck="true">// é‡ç½®æ­£åˆ™åŒ¹é…çš„èµ·å§‹ä½ç½®</span>            defaultTagRE<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// è®°å½•ä¸Šä¸€æ¬¡åŒ¹é…çš„æœ€åä¸€ä½</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>match <span class="token operator">=</span> defaultTagRE<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// console.log(match)</span>                <span class="token keyword">let</span> index <span class="token operator">=</span> match<span class="token punctuation">.</span>index <span class="token comment" spellcheck="true">// æ‹¿åˆ°åŒ¹é…åˆ°å­—ç¬¦({{)çš„å¼€å§‹ç´¢å¼•</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">></span> lastIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// {{name}} hello {{age}} => hello</span>                    tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span>                tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`_s(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ’å€¼è¡¨è¾¾å¼é‡Œçš„å˜é‡å</span>                <span class="token comment" spellcheck="true">// {{name}} xxx {{age}} -> 0 + name}}.length => 8</span>                <span class="token comment" spellcheck="true">// ä¸‹ä¸€æ¬¡åŒ¹é…åˆ°,å°±å¯ä»¥æŸ¥çœ‹ä¸¤æ¬¡åŒ¹é…ä¸­é—´æœ‰æ²¡æœ‰å€¼ ({{name}} hello {{age}} => hello)</span>                lastIndex <span class="token operator">=</span> index <span class="token operator">+</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastIndex <span class="token operator">&lt;</span> text<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// {{name}} hello {{age}} world => world</span>                tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(tokens, `_v(${tokens.join("+")})`)</span>            <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`_v(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tokens<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token function">gen</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç”Ÿæˆå±æ€§strçš„æ–¹æ³•</span><span class="token keyword">function</span> <span class="token function">genProps</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment" spellcheck="true">// {name,value}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> attrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> attr <span class="token operator">=</span> attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'style'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// color:red => {color:'red'}</span>            <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// color: xxx;font-weight:xxx å¤šä¸ªç”¨;åˆ†å¼€</span>            attr<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// color: xxx å•ä¸ªç”¨:åˆ†å¼€</span>                <span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>                obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value <span class="token comment" spellcheck="true">// ç»™objèµ‹å€¼</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            attr<span class="token punctuation">.</span>value <span class="token operator">=</span> obj        <span class="token punctuation">}</span>        str <span class="token operator">+</span><span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>attr<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,`</span></span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// slice(å¼€å§‹,ç»“å°¾),å¦‚æœæ˜¯è´Ÿæ•°åˆ™ä»æœ«å°¾å¼€å§‹</span>    <span class="token comment" spellcheck="true">// è¿™é‡Œä»0å–åˆ°-1çš„å­—ç¬¦,å»æ‰äº†æœ€åä¸€ä¸ª ,</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}`</span></span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">codegen</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è§£æchildren</span>    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>children<span class="token punctuation">)</span>    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token string">`_c('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ast<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ast<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">genProps</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">'null'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ${ast.children.length ? `</span></span><span class="token punctuation">,</span>$<span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token template-string"><span class="token string">` : ''})`</span></span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// console.log(code)</span>    <span class="token keyword">return</span> code<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç¼–è¯‘æ¨¡æ¿</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(template)</span>    <span class="token comment" spellcheck="true">// 1,å°†templateè½¬åŒ–ä¸ºastè¯­æ³•æ ‘</span>    <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 2,ç”Ÿæˆrenderæ–¹æ³•,renderæ–¹æ³•æ‰§è¡Œè¿”å›çš„ç»“æœå°±æ˜¯è™šæ‹Ÿdom</span>    <span class="token comment" spellcheck="true">// render(){ æŠŠæ ‘ç»„è£…æˆè¿™æ ·</span>    <span class="token comment" spellcheck="true">//     return _c('div', { id: 'app' },_c('div', { color: 'blue' }, _v(_s(name) + 'hello')</span>    <span class="token comment" spellcheck="true">//         , _c('span', null, _v(_s(age) + 'hello'))))</span>    <span class="token comment" spellcheck="true">// }</span>    <span class="token comment" spellcheck="true">// console.log(ast)</span>    <span class="token comment" spellcheck="true">// ç”Ÿæˆä»£ç  (æ¨¡æ¿å¼•æ“çš„å®ç°åŸç†å°±æ˜¯ with + new Function)</span>    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token function">codegen</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// console.log(this)</span>    <span class="token comment" spellcheck="true">// withä¼šä»ä¼ è¿›æ¥çš„å‚æ•°é‡Œå–å€¼,è¿™é‡Œçš„thisæ˜¯è°ƒç”¨è€…</span>    code <span class="token operator">=</span> <span class="token template-string"><span class="token string">`with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}`</span></span>    <span class="token comment" spellcheck="true">// æ ¹æ®ä»£ç è‡ªåŠ¨ç”Ÿæˆå‡½æ•°</span>    <span class="token keyword">let</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// console.log(render.toString())</span>    <span class="token comment" spellcheck="true">// function render(</span>    <span class="token comment" spellcheck="true">// ) {</span>    <span class="token comment" spellcheck="true">//     // å…³é—­ä¸¥æ ¼æ¨¡å¼æ‰èƒ½ç”¨with</span>    <span class="token comment" spellcheck="true">//     with (this) { return _c('div', { id: "app", style: { "color": "skyblue", "background": " yellow" }, show: true }, _c('div', null, _v(_s(age) + "hello" + _s(name) + "world")), _c('br', null, _v("world"), _c('br', null, _c('span', null, _v(_s(age)))))) }</span>    <span class="token comment" spellcheck="true">// }</span>    <span class="token comment" spellcheck="true">// console.log(render.call(vm))</span>    <span class="token keyword">return</span> render<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// with (vm) {</span><span class="token comment" spellcheck="true">// ä¼ this,åˆ™vmçš„å±æ€§ä¼šç»™this</span><span class="token comment" spellcheck="true">// name => this.name => vm.name => vm.data.name</span><span class="token comment" spellcheck="true">//     // æ­¤æ—¶,nameå°±æ˜¯vm.name</span><span class="token comment" spellcheck="true">// log name</span><span class="token comment" spellcheck="true">// }</span></code></pre><h2 id="init-js-3"><a href="#init-js-3" class="headerlink" title="init.js"></a>init.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>initState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token keyword">import</span> <span class="token punctuation">{</span>compileToFunction<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./compile"</span><span class="token keyword">import</span> <span class="token punctuation">{</span>mountComponent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lifecycle"</span><span class="token comment" spellcheck="true">// æä¾›ç»™vueæ¥ä½¿ç”¨(æ­¤æ—¶å…¨å±€è¿˜æ²¡æœ‰vueå¯¹è±¡,æ‰€ä»¥æ²¡åŠæ³•ç›´æ¥æŒ‚è½½)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ“ä½œ</span>    <span class="token comment" spellcheck="true">// ......</span>    <span class="token comment" spellcheck="true">// æ¸²æŸ“æ¨¡æ¿çš„æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token comment" spellcheck="true">// è·å–elå¯¹åº”çš„dom</span>        el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>        <span class="token keyword">let</span> ops <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å…ˆçœ‹æœ‰æ²¡æœ‰renderå‡½æ•°</span>            <span class="token keyword">let</span> template <span class="token comment" spellcheck="true">// æ²¡æœ‰renderå°±çœ‹çœ‹æœ‰æ²¡æœ‰template</span>            <span class="token comment" spellcheck="true">// å¦‚æœç”¨æˆ·æ²¡æœ‰ä½¿ç”¨äº†renderå‡½æ•°</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>template <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ²¡æœ‰å†™æ¨¡æ¿,ä½†æ˜¯å†™äº†el</span>                <span class="token comment" spellcheck="true">/*                    1ï¼‰innerHTML:                    ä»å¯¹è±¡çš„èµ·å§‹ä½ç½®åˆ°ç»ˆæ­¢ä½ç½®çš„å…¨éƒ¨å†…å®¹,ä¸åŒ…æ‹¬Htmlæ ‡ç­¾ã€‚                    2ï¼‰outerHTML:                    é™¤äº†åŒ…å«innerHTMLçš„å…¨éƒ¨å†…å®¹å¤–, è¿˜åŒ…å«å¯¹è±¡æ ‡ç­¾æœ¬èº«ã€‚                */</span>                template <span class="token operator">=</span> el<span class="token punctuation">.</span>outerHTML  <span class="token comment" spellcheck="true">// outerHTMLåœ¨ç«ç‹ä¸‹å¯èƒ½ä¸å…¼å®¹</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// å†™äº†template,å°±ç”¨ç”¨æˆ·çš„template</span>                    template <span class="token operator">=</span> ops<span class="token punctuation">.</span>template                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(template)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘</span>                <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>                ops<span class="token punctuation">.</span>render <span class="token operator">=</span> render            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(ops.render)// æœ€ç»ˆè·å–renderæ–¹æ³•</span>        <span class="token comment" spellcheck="true">// ç»„ä»¶æŒ‚è½½</span>        <span class="token function">mountComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// scriptæ ‡ç­¾å¼•ç”¨çš„vue.global.js,è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨æµè§ˆå™¨è¿è¡Œçš„</span>        <span class="token comment" spellcheck="true">// runtimeæ˜¯ä¸åŒ…å«æ¨¡æ¿ç¼–è¯‘çš„,æ•´ä¸ªç¼–è¯‘æ˜¯æ‰“åŒ…æ—¶é€šè¿‡loaderæ¥è½¬ä¹‰vueæ–‡ä»¶çš„,ç”¨runtimeæ—¶ä¸èƒ½ä½¿ç”¨template</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> </code></pre><h2 id="lifecycle-js"><a href="#lifecycle-js" class="headerlink" title="lifecycle.js"></a>lifecycle.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è™šæ‹Ÿdomè½¬çœŸå®dom</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_update <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ¸²æŸ“è™šæ‹Ÿdom</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_render <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç»„ä»¶æŒ‚è½½</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 1,è°ƒç”¨renderæ–¹æ³•äº§ç”Ÿè™šæ‹ŸèŠ‚ç‚¹,è™šæ‹Ÿdom</span>    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// vm.$options.render è¿”å›è™šæ‹ŸèŠ‚ç‚¹</span>    <span class="token comment" spellcheck="true">// 2,æ ¹æ®è™šæ‹Ÿdomç”ŸæˆçœŸå®dom</span>    <span class="token comment" spellcheck="true">// 3,æ’å…¥elå…ƒç´ </span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// vueæ ¸å¿ƒæµç¨‹: 1,åˆ›å»ºå“åº”å¼æ•°æ® 2,æ¨¡æ¿è½¬åŒ–ä¸ºastè¯­æ³•æ ‘</span><span class="token comment" spellcheck="true">// 3,å°†astè½¬æ¢ä¸ºrenderå‡½æ•° 4,åç»­æ¯æ¬¡æ›´æ–°å¯ä»¥åªæ‰§è¡Œrenderå‡½æ•°(æ— éœ€å†æ¬¡æ‰§è¡Œastè½¬æ¢)</span><span class="token comment" spellcheck="true">// renderå‡½æ•°ä¼šäº§ç”Ÿè™šæ‹ŸèŠ‚ç‚¹(ä½¿ç”¨å“åº”å¼æ•°æ®)</span><span class="token comment" spellcheck="true">// æ ¹æ®ç”Ÿæˆçš„è™šæ‹Ÿdomåˆ›é€ çœŸå®dom</span></code></pre><h2 id="index-js-1"><a href="#index-js-1" class="headerlink" title="index.js"></a>index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>initMixin<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./init"</span><span class="token keyword">import</span> <span class="token punctuation">{</span>initLifeCycle<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lifecycle"</span><span class="token comment" spellcheck="true">// classä¼šæŠŠæ‰€æœ‰æ–¹æ³•è€¦åˆåœ¨ä¸€èµ·</span><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// optionså°±æ˜¯ç”¨æˆ·æä¾›çš„é€‰é¡¹ </span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆå§‹åŒ–</span><span class="token punctuation">}</span><span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ‹“å±•äº†vue,æ·»åŠ initæ–¹æ³•</span><span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç»„ä»¶æ¸²æŸ“,ç”Ÿå‘½å‘¨æœŸ</span><span class="token keyword">export</span> <span class="token keyword">default</span> Vue</code></pre><h1 id="å®ç°è™šæ‹Ÿdomè½¬çœŸå®dom"><a href="#å®ç°è™šæ‹Ÿdomè½¬çœŸå®dom" class="headerlink" title="å®ç°è™šæ‹Ÿdomè½¬çœŸå®dom"></a>å®ç°è™šæ‹Ÿdomè½¬çœŸå®dom</h1><p><img src="img_15.png" alt="åœ¨çº¿astè½¬æ¢å·¥å…·"></p><h2 id="vdom-index-js"><a href="#vdom-index-js" class="headerlink" title="vdom/index.js"></a>vdom/index.js</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è™šæ‹Ÿdomæ“ä½œ</span><span class="token comment" spellcheck="true">// _h() _c()</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElementVnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token operator">...</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(data)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">let</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span>key    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">delete</span> data<span class="token punctuation">.</span>key    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// _v()</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createTextVnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// astæ˜¯è¯­æ³•è½¬æ¢,æè¿°è¯­æ³•(html js css), &lt;div xxx> -> div,xxx=true</span><span class="token comment" spellcheck="true">// è™šæ‹Ÿdomæ˜¯æè¿°domå…ƒç´ ,å¯ä»¥å¢åŠ è‡ªå®šä¹‰å±æ€§ div.xxx</span><span class="token keyword">function</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        vm<span class="token punctuation">,</span>        tag<span class="token punctuation">,</span>        key<span class="token punctuation">,</span>        data<span class="token punctuation">,</span>        children<span class="token punctuation">,</span>        text        <span class="token comment" spellcheck="true">// ......</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="lifecycle-js-1"><a href="#lifecycle-js-1" class="headerlink" title="lifecycle.js"></a>lifecycle.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>createElementVnode<span class="token punctuation">,</span> createTextVnode<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./vdom"</span><span class="token keyword">function</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token operator">=</span> vnode    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ ‡ç­¾</span>        <span class="token comment" spellcheck="true">// åˆ›å»ºçœŸå®èŠ‚ç‚¹</span>        <span class="token comment" spellcheck="true">// å°†çœŸå®èŠ‚ç‚¹æŒ‚è½½åˆ°è™šæ‹ŸèŠ‚ç‚¹,åç»­ä¿®æ”¹å°±å¯ä»¥é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹ç›´æ¥æ‰¾åˆ°çœŸå®èŠ‚ç‚¹</span>        vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>        <span class="token function">patchProps</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ›´æ–°å±æ€§ xxx=xxx</span>        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            vnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(vnode) æ–‡æœ¬è™šæ‹ŸèŠ‚ç‚¹çš„tagæ˜¯undefined</span>        vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">patchProps</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'style'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯styleæ ·å¼å±æ€§</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> sytleName <span class="token keyword">in</span> props<span class="token punctuation">.</span>style<span class="token punctuation">)</span> <span class="token punctuation">{</span>                el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>sytleName<span class="token punctuation">]</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>style<span class="token punctuation">[</span>sytleName<span class="token punctuation">]</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ—¶æ˜¯ä¼ ä¸€ä¸ªçœŸå®dom,ä¸€ä¸ªè™šæ‹Ÿdom</span>    <span class="token keyword">const</span> isRealElement <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>nodeType    <span class="token comment" spellcheck="true">// åˆæ¬¡æ¸²æŸ“</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> elm <span class="token operator">=</span> oldVNode <span class="token comment" spellcheck="true">// æ‹¿åˆ°çœŸå®å…ƒç´ </span>        <span class="token keyword">const</span> parentElm <span class="token operator">=</span> elm<span class="token punctuation">.</span>parentNode <span class="token comment" spellcheck="true">// æ‹¿åˆ°çˆ¶å…ƒç´ </span>        <span class="token keyword">let</span> newElm <span class="token operator">=</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newElm<span class="token punctuation">)</span>        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newElm<span class="token punctuation">,</span> elm<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å…ˆæ’å…¥åˆ°å½“å‰èŠ‚ç‚¹çš„åé¢(æˆä¸ºå…„å¼ŸèŠ‚ç‚¹)</span>        parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆ é™¤è€èŠ‚ç‚¹ </span>        <span class="token keyword">return</span> newElm    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ›´æ–°æ—¶æ˜¯ä¼ ä¸¤ä¸ªè™šæ‹Ÿdom</span>        <span class="token comment" spellcheck="true">// diffç®—æ³•</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è™šæ‹Ÿdomè½¬çœŸå®dom</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_update <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el        <span class="token comment" spellcheck="true">// console.log('update', vnode)</span>        <span class="token comment" spellcheck="true">// æ—¢èƒ½åˆå§‹åŒ–,åˆèƒ½æ›´æ–°</span>        vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// _c{'div',{},...children}</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_c <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// this -> vm</span>        <span class="token keyword">return</span> <span class="token function">createElementVnode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// _v(text)</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_v <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// console.log(...arguments)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">createTextVnode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token function">createTextVnode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_s <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// æ’å€¼è¡¨è¾¾å¼é‡Œçš„å€¼(zs)å¦‚æœä¸æ˜¯å¯¹è±¡,å°±ç›´æ¥è¿”å› </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value        <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯å¯¹è±¡,å°±è½¬å­—ç¬¦ä¸²    </span>        <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ¸²æŸ“è™šæ‹Ÿdom</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_render <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log('render')</span>        <span class="token comment" spellcheck="true">// const vm = this </span>        <span class="token comment" spellcheck="true">// è®©withé‡Œçš„thisæŒ‡å‘vm</span>        <span class="token comment" spellcheck="true">// æ­¤æ—¶å¯ä»¥è§†å›¾å’Œå±æ€§è¿›è¡Œç»‘å®š</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// astè¯­æ³•è½¬ä¹‰åç”Ÿæˆçš„render</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç»„ä»¶æŒ‚è½½</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æŠŠè¦è¢«æŒ‚è½½çš„çœŸå®dom,æ”¾åˆ°vmå®ä¾‹ä¸Š</span>    vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> el <span class="token comment" spellcheck="true">// è¿™ä¸ªelæ˜¯querySelectorè·å–äº†çš„</span>    <span class="token comment" spellcheck="true">// 1,è°ƒç”¨renderæ–¹æ³•äº§ç”Ÿè™šæ‹ŸèŠ‚ç‚¹,è™šæ‹Ÿdom</span>    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// vm.$options.render è¿”å›è™šæ‹ŸèŠ‚ç‚¹</span>    <span class="token comment" spellcheck="true">// 2,æ ¹æ®è™šæ‹Ÿdomç”ŸæˆçœŸå®dom</span>    <span class="token comment" spellcheck="true">// 3,æ’å…¥elå…ƒç´ </span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// vueæ ¸å¿ƒæµç¨‹: 1,åˆ›å»ºå“åº”å¼æ•°æ® 2,æ¨¡æ¿è½¬åŒ–ä¸ºastè¯­æ³•æ ‘</span><span class="token comment" spellcheck="true">// 3,å°†astè½¬æ¢ä¸ºrenderå‡½æ•° 4,åç»­æ¯æ¬¡æ›´æ–°å¯ä»¥åªæ‰§è¡Œrenderå‡½æ•°(æ— éœ€å†æ¬¡æ‰§è¡Œastè½¬æ¢)</span><span class="token comment" spellcheck="true">// renderå‡½æ•°ä¼šäº§ç”Ÿè™šæ‹ŸèŠ‚ç‚¹(ä½¿ç”¨å“åº”å¼æ•°æ®)</span><span class="token comment" spellcheck="true">// æ ¹æ®ç”Ÿæˆçš„è™šæ‹Ÿdomåˆ›é€ çœŸå®dom</span></code></pre><h2 id="æµ‹è¯•-5"><a href="#æµ‹è¯•-5" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>skyblue<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">show</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        {{age}} hello {{name}} world    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    world    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>            {{age}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span>                name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span>                age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// template: '&lt;div>hello&lt;/div>'</span>        <span class="token comment" spellcheck="true">// el: '#app', // å°†æ•°æ®è§£æåˆ°elä¸Š</span>        <span class="token comment" spellcheck="true">// render(){</span>        <span class="token comment" spellcheck="true">// return createElement('div',{})</span>        <span class="token comment" spellcheck="true">// }</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ls'</span>        vm<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">23</span>        <span class="token comment" spellcheck="true">// æ‰‹åŠ¨é‡æ–°æ¸²æŸ“</span>        vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_17.png" alt="img_17.png"><br><img src="img_16.png" alt="1ç§’å"><br><img src="img_18.png" alt="å°ç»“"></p><h1 id="å®ç°vueä¸­çš„ä¾èµ–æ”¶é›†-åŒå‘ç»‘å®šä¸­çš„æ•°æ®å˜åŒ–å½±å“è§†å›¾"><a href="#å®ç°vueä¸­çš„ä¾èµ–æ”¶é›†-åŒå‘ç»‘å®šä¸­çš„æ•°æ®å˜åŒ–å½±å“è§†å›¾" class="headerlink" title="å®ç°vueä¸­çš„ä¾èµ–æ”¶é›†(åŒå‘ç»‘å®šä¸­çš„æ•°æ®å˜åŒ–å½±å“è§†å›¾)"></a>å®ç°vueä¸­çš„ä¾èµ–æ”¶é›†(åŒå‘ç»‘å®šä¸­çš„æ•°æ®å˜åŒ–å½±å“è§†å›¾)</h1><blockquote><p>åŒå‘ç»‘å®šå®ç°åŸç†æ˜¯è§‚å¯Ÿè€…æ¨¡å¼</p></blockquote><p><img src="img_19.png" alt="ç»„ä»¶åŒ–çš„å¥½å¤„"></p><h2 id="ä¿®æ”¹lifecycle-jsçš„mountComponentæ–¹æ³•"><a href="#ä¿®æ”¹lifecycle-jsçš„mountComponentæ–¹æ³•" class="headerlink" title="ä¿®æ”¹lifecycle.jsçš„mountComponentæ–¹æ³•"></a>ä¿®æ”¹lifecycle.jsçš„mountComponentæ–¹æ³•</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// ç»„ä»¶æŒ‚è½½</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æŠŠè¦è¢«æŒ‚è½½çš„çœŸå®dom,æ”¾åˆ°vmå®ä¾‹ä¸Š</span>    vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> el <span class="token comment" spellcheck="true">// è¿™ä¸ªelæ˜¯querySelectorè·å–äº†çš„</span>    <span class="token comment" spellcheck="true">// 1,è°ƒç”¨renderæ–¹æ³•äº§ç”Ÿè™šæ‹ŸèŠ‚ç‚¹,è™šæ‹Ÿdom</span>    <span class="token comment" spellcheck="true">// 2,æ ¹æ®è™šæ‹Ÿdomç”ŸæˆçœŸå®dom </span>    <span class="token comment" spellcheck="true">// 3,æ’å…¥elå…ƒç´ </span>    <span class="token comment" spellcheck="true">// åˆ›å»ºwatcher</span>    <span class="token keyword">const</span> updateComponent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> updateComponent<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// trueç”¨äºæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªæ¸²æŸ“watcher</span>    <span class="token comment" spellcheck="true">// æ”¹ä¸ºåœ¨Watcheråˆ›å»ºæ—¶è°ƒç”¨,è¿›è¡Œåˆæ¬¡æ¸²æŸ“</span>    <span class="token comment" spellcheck="true">// vm._update(vm._render()) // vm.$options.render è¿”å›è™šæ‹ŸèŠ‚ç‚¹</span><span class="token punctuation">}</span></code></pre><h2 id="ä¿®æ”¹observe-index-jsçš„defineReactiveæ–¹æ³•"><a href="#ä¿®æ”¹observe-index-jsçš„defineReactiveæ–¹æ³•" class="headerlink" title="ä¿®æ”¹observe/index.jsçš„defineReactiveæ–¹æ³•"></a>ä¿®æ”¹observe/index.jsçš„defineReactiveæ–¹æ³•</h2><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// å¯¹è±¡è½¬å“åº”å¼çš„æ–¹æ³•(é‡æ–°å®šä¹‰)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// é—­åŒ… å±æ€§åŠ«æŒ</span>    <span class="token comment" spellcheck="true">// valueå¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡,éœ€è¦å¯¹å…¶è¿›è¡Œå“åº”å¼å¤„ç†</span>    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é€’å½’äº†,æ€§èƒ½ä¹Ÿä¼šé™ä½</span>    <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ­¤æ—¶æ¯ä¸ªå±æ€§éƒ½æœ‰dep </span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å†…éƒ¨ä½¿ç”¨äº†å¤–éƒ¨çš„å˜é‡(value),æ‰€ä»¥valueè¢«ä¿å­˜åˆ°é—­åŒ…</span>        <span class="token comment" spellcheck="true">// å–å€¼æ—¶æ‰§è¡Œ</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// åœ¨æ¨¡æ¿é‡Œå–å€¼æ—¶(mount)æ‰ä¼šä¾èµ–æ”¶é›†(æ­¤æ—¶æœ‰watcher,watcheræŠŠdep.targetèµ‹å€¼ä¸ºè‡ªå·±)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// æ¯ä¸ªå±æ€§çš„depæ˜¯ä¸åŒçš„</span>                dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å±æ€§çš„æ”¶é›†å™¨è®°ä½å½“å‰watcher</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> value        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// ä¿®æ”¹æ—¶æ‰§è¡Œ</span>        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span>            <span class="token function">observe</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®¾ç½®å€¼æ—¶,å¦‚æœæ˜¯å¯¹è±¡,ä¹Ÿéœ€è¦è½¬å“åº”å¼!  </span>            value <span class="token operator">=</span> newValue            dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// é€šçŸ¥æ›´æ–°</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="observe-dep-js"><a href="#observe-dep-js" class="headerlink" title="observe/dep.js"></a>observe/dep.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// ç”¨äºå”¯ä¸€æ ‡è¯†dep </span><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token operator">++</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// å­˜æ”¾å½“å‰å±æ€§å¯¹åº”çš„watcheræœ‰å“ªäº›</span>    <span class="token punctuation">}</span>    <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ä¸å¸Œæœ›åŠ é‡å¤çš„watcher</span>        <span class="token comment" spellcheck="true">// this.subs.push(Dep.target)</span>        <span class="token comment" spellcheck="true">// debugger</span>        Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®©watcherè®°ä½dep</span>    <span class="token punctuation">}</span>    <span class="token function">addSub</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// åœ¨watcheré‡Œæœ‰å»é‡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ›´æ–°æ–¹æ³•!</span>    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è®©æ‰€æœ‰watcheræ›´æ–°æ•°æ®</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>watcher <span class="token operator">=</span><span class="token operator">></span> watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span>Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> Dep </code></pre><h2 id="observe-watcher-js"><a href="#observe-watcher-js" class="headerlink" title="observe/watcher.js"></a>observe/watcher.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Dep <span class="token keyword">from</span> <span class="token string">"./dep"</span><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// å”¯ä¸€æ ‡è¯†watcher</span><span class="token comment" spellcheck="true">// 1,æ¸²æŸ“watcheræ—¶,æŠŠå½“å‰æ¸²æŸ“çš„watcheræ”¾åˆ°dep.target</span><span class="token comment" spellcheck="true">// 2,è°ƒç”¨_render() ä¼šå–å€¼,èµ°åˆ°å±æ€§çš„getä¸Š</span><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸åŒç»„ä»¶æœ‰ä¸åŒçš„watcher</span>    <span class="token comment" spellcheck="true">// ä¼ å…¥vmå’Œæ›´æ–°æ–¹æ³•</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token operator">++</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>renderWatcher <span class="token operator">=</span> options <span class="token comment" spellcheck="true">// æ˜¯ä¸€ä¸ªæ¸²æŸ“watcher</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> fn <span class="token comment" spellcheck="true">// getteræ„å‘³ç€è°ƒç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥å‘ç”Ÿå–å€¼æ“ä½œ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// åç»­å®ç°è®¡ç®—å±æ€§å’Œæ¸…ç†å·¥ä½œç”¨å¾—åˆ°</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿å­˜depçš„id(å¤šä¸ª),seté›†åˆå¯ä»¥å»é‡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// init get</span>    <span class="token punctuation">}</span>    <span class="token function">addDep</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªå±æ€§,é‡å¤çš„ä¸ç”¨è®°å½•</span>        <span class="token keyword">let</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// watcherè®°å½•dep</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// æ­¤æ—¶è®©depè®°å½•watcher</span>            dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ›´æ–°</span>    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment" spellcheck="true">// å½“å‰çš„watcherç»™dep</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¼šä»vmä¸Šå–å€¼</span>        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment" spellcheck="true">// æ¸²æŸ“å®Œæ¸…ç©º</span>    <span class="token punctuation">}</span>    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// éœ€è¦ç»™æ¯ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ªdep,ç›®çš„æ˜¯æ”¶é›†watcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶ä¸­,æœ‰å¤šä¸ªå±æ€§(nä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªè§†å›¾) nä¸ªdepå¯¹åº”ä¸€ä¸ªwatcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªå±æ€§,å¯¹åº”å¤šä¸ªç»„ä»¶,ä¸€ä¸ªdepå¯¹åº”å¤šä¸ªwatcher</span><span class="token comment" spellcheck="true">// å¤šå¯¹å¤š</span><span class="token keyword">export</span> <span class="token keyword">default</span> Watcher</code></pre><h2 id="æµ‹è¯•-6"><a href="#æµ‹è¯•-6" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å¯ä»¥ç»™æ¨¡æ¿ä¸­çš„å±æ€§æ·»åŠ ä¸€ä¸ªæ”¶é›†å™¨ dep --></span>    <span class="token comment" spellcheck="true">&lt;!-- é¡µé¢æ¸²æŸ“æ—¶ å°†æ¸²æŸ“é€»è¾‘å°è£…åˆ°watcherä¸­, vm._update(vm.render()) --></span>    <span class="token comment" spellcheck="true">&lt;!-- è®©depè®°ä½è¿™ä¸ªwatcher,æ•°æ®å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„watcherè¿›è¡Œæ›´æ–° --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¤šä¸ª{{name}},ä¼šæœ‰é‡å¤watcher,è¦é¿å… --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæ¸²æŸ“çš„elé‡Œæœ‰æ³¨é‡Š,ä¼šå¡æ­»!!!! --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>skyblue<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">show</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            {{age}} hello {{name}} world {{name}} {{name}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        world        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>            {{age}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token comment" spellcheck="true">// console.log(Vue);</span>        <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>        <span class="token comment" spellcheck="true">// debugger</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">{</span>                    name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span>                    age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>                    <span class="token comment" spellcheck="true">// obj: {</span>                    <span class="token comment" spellcheck="true">//     sex: 'boy'</span>                    <span class="token comment" spellcheck="true">// },</span>                    arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'ant'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>         <span class="token punctuation">}</span><span class="token punctuation">)</span>        vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>         <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ls'</span>            vm<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">23</span>            <span class="token comment" spellcheck="true">// æ‰‹åŠ¨é‡æ–°æ¸²æŸ“</span>            <span class="token comment" spellcheck="true">// vm._update(vm._render())</span>            vm<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// é¡µé¢æ²¡ç”¨åˆ°çš„æ›´æ–°äº†ä¹Ÿä¸ä¼šè§¦å‘è§‚å¯Ÿè€…</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_20.png" alt="img_20.png"></p><h1 id="å®ç°å¼‚æ­¥æ›´æ–°åŸç†"><a href="#å®ç°å¼‚æ­¥æ›´æ–°åŸç†" class="headerlink" title="å®ç°å¼‚æ­¥æ›´æ–°åŸç†"></a>å®ç°å¼‚æ­¥æ›´æ–°åŸç†</h1><blockquote><p>å¤šä¸ªæ›´æ–°ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—</p></blockquote><h2 id="watcher-js"><a href="#watcher-js" class="headerlink" title="watcher.js"></a>watcher.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Dep <span class="token keyword">from</span> <span class="token string">"./dep"</span><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// å”¯ä¸€æ ‡è¯†watcher</span><span class="token comment" spellcheck="true">// 1,æ¸²æŸ“watcheræ—¶,æŠŠå½“å‰æ¸²æŸ“çš„watcheræ”¾åˆ°dep.target</span><span class="token comment" spellcheck="true">// 2,è°ƒç”¨_render() ä¼šå–å€¼,èµ°åˆ°å±æ€§çš„getä¸Š</span><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸åŒç»„ä»¶æœ‰ä¸åŒçš„watcher</span>    <span class="token comment" spellcheck="true">// ä¼ å…¥vmå’Œæ›´æ–°æ–¹æ³•</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token operator">++</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>renderWatcher <span class="token operator">=</span> options <span class="token comment" spellcheck="true">// æ˜¯ä¸€ä¸ªæ¸²æŸ“watcher</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> fn <span class="token comment" spellcheck="true">// getteræ„å‘³ç€è°ƒç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥å‘ç”Ÿå–å€¼æ“ä½œ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// åç»­å®ç°è®¡ç®—å±æ€§å’Œæ¸…ç†å·¥ä½œç”¨å¾—åˆ°</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿å­˜depçš„id(å¤šä¸ª),seté›†åˆå¯ä»¥å»é‡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// init get</span>    <span class="token punctuation">}</span>    <span class="token function">addDep</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªå±æ€§,é‡å¤çš„ä¸ç”¨è®°å½•</span>        <span class="token keyword">let</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// watcherè®°å½•dep</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// æ­¤æ—¶è®©depè®°å½•watcher</span>            dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ›´æ–°</span>    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment" spellcheck="true">// å½“å‰çš„watcherç»™dep</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¼šä»vmä¸Šå–å€¼</span>        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment" spellcheck="true">// æ¸²æŸ“å®Œæ¸…ç©º</span>    <span class="token punctuation">}</span>    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªæ•°æ®,åˆ™åº”è¯¥ç”¨é˜Ÿåˆ—è®°å½•,åªæ›´æ–°æœ€åä¸€æ¬¡</span>        <span class="token function">queryWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æš‚å­˜watcher</span>        <span class="token comment" spellcheck="true">// this.get() // é‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span>    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ­¤æ—¶æœ€ç»ˆçš„vm.nameå·²ç»èµ‹å€¼å®Œæ¯•(ls5),æ›´æ–°æ—¶å–å€¼,å°±æ˜¯æœ€åçš„è¿™ä¸ªå€¼</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// éœ€è¦ç»™æ¯ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ªdep,ç›®çš„æ˜¯æ”¶é›†watcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶ä¸­,æœ‰å¤šä¸ªå±æ€§(nä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªè§†å›¾) nä¸ªdepå¯¹åº”ä¸€ä¸ªwatcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªå±æ€§,å¯¹åº”å¤šä¸ªç»„ä»¶,ä¸€ä¸ªdepå¯¹åº”å¤šä¸ªwatcher</span><span class="token comment" spellcheck="true">// å¤šå¯¹å¤š</span><span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// æºç æ˜¯ç”¨setæ¥å»é‡</span><span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨å¯¹è±¡æ¥å»é‡</span><span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// é˜²æŠ–</span><span class="token comment" spellcheck="true">// ç­‰å¾…ä¸€æ®µæ—¶é—´åè¿›å…¥è¯¥æ–¹æ³•,ä¸€æ¬¡æ€§æ›´æ–°</span><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> flushQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// åˆ·æ–°è¿‡ç¨‹ä¸­,å¯èƒ½ä¹Ÿæœ‰æ–°çš„watcher,å¯ä»¥é‡æ–°æ”¾åˆ°queue</span>    queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    pending <span class="token operator">=</span> <span class="token boolean">false</span>    flushQueue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>q <span class="token operator">=</span><span class="token operator">></span> q<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">queryWatcher</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ²¡æœ‰é‡å¤,ç›´æ¥æ”¾å…¥é˜Ÿåˆ—</span>        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>        has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token comment" spellcheck="true">// console.log(queue)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ä¸ç®¡updateå¤šå°‘æ¬¡,æœ€ç»ˆåªæ‰§è¡Œä¸€è½®åˆ·æ–°æ“ä½œ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pending <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç”¨æˆ·æ›´æ–°é˜Ÿåˆ—</span><span class="token keyword">let</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">// å¼‚æ­¥æ‰¹å¤„ç†</span><span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> cbs <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    waiting <span class="token operator">=</span> <span class="token boolean">false</span>    callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    cbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>cb <span class="token operator">=</span><span class="token operator">></span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> timerFunc<span class="token comment" spellcheck="true">// æœ‰bug,promiseæ‹¿åˆ°çš„è¿˜æ˜¯è€çš„</span><span class="token comment" spellcheck="true">// if (Promise) { // åˆ¤æ–­æœ‰æ²¡æœ‰promise(å¯ä»¥è½¬å­—ç¬¦ä¸²çœ‹æ˜¯ä¸æ˜¯åŸç”Ÿpromise)</span><span class="token comment" spellcheck="true">//     // console.log('Promise')</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         Promise.resolve().then(flushCallbacks)</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// } else if (MutationObserver) {</span><span class="token comment" spellcheck="true">//     // è¿™é‡Œä¼ å…¥çš„å›è°ƒæ˜¯å¼‚æ­¥çš„</span><span class="token comment" spellcheck="true">//     let observe = new MutationObserver(flushCallbacks)</span><span class="token comment" spellcheck="true">//     // ç›‘æ§æ–‡æœ¬å˜åŒ–</span><span class="token comment" spellcheck="true">//     let textNode = document.createTextNode(1)</span><span class="token comment" spellcheck="true">//     observe.observe(textNode, {</span><span class="token comment" spellcheck="true">//         characterData: true,</span><span class="token comment" spellcheck="true">//     })</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         textNode.textContent = 2</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// } else if (setImmediate) {</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         setImmediate(flushCallbacks)</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// } else {</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         setTimeout(flushCallbacks)</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// }</span><span class="token comment" spellcheck="true">// æš´éœ²ç»™å¤–éƒ¨çš„æ›´æ–°æ–¹æ³•</span><span class="token comment" spellcheck="true">// vueé‡Œçš„nextTickä¸æ˜¯ç”¨api(å®šæ—¶å™¨...),è€Œæ˜¯é‡‡ç”¨ä¼˜é›…é™çº§çš„æ–¹å¼</span><span class="token comment" spellcheck="true">// é™çº§: promise(ieä¸å…¼å®¹) => MutationObserver(h5çš„api) => setImmediate(ieä¸“ç”¨) => setTimeout</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å…ˆç”¨æˆ·è¿˜æ˜¯å…ˆå†…éƒ¨æ›´æ–° ? => çœ‹ç”¨æˆ·æ›´æ–°æ–¹æ³•åœ¨å‰,è¿˜æ˜¯æ•°æ®å˜åŒ–åœ¨å‰</span>    <span class="token comment" spellcheck="true">// å®šæ—¶å™¨è€—æ€§èƒ½,promiseæ‰§è¡Œæ¯”å®šæ—¶å™¨å¿«</span>    callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// timerFunc(flushCallbacks) </span>        <span class="token comment" spellcheck="true">// timerFunc() // æ‰§è¡Œçš„å°±æ˜¯flushCallbacks</span>        waiting <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Watcher</code></pre><h2 id="index-js-2"><a href="#index-js-2" class="headerlink" title="index.js"></a>index.js</h2><p><img src="img_21.png" alt="img_21.png"></p><h2 id="æµ‹è¯•-7"><a href="#æµ‹è¯•-7" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å¯ä»¥ç»™æ¨¡æ¿ä¸­çš„å±æ€§æ·»åŠ ä¸€ä¸ªæ”¶é›†å™¨ dep --></span>    <span class="token comment" spellcheck="true">&lt;!-- é¡µé¢æ¸²æŸ“æ—¶ å°†æ¸²æŸ“é€»è¾‘å°è£…åˆ°watcherä¸­, vm._update(vm.render()) --></span>    <span class="token comment" spellcheck="true">&lt;!-- è®©depè®°ä½è¿™ä¸ªwatcher,æ•°æ®å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„watcherè¿›è¡Œæ›´æ–° --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¤šä¸ª{{name}},ä¼šæœ‰é‡å¤watcher,è¦é¿å… --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæ¸²æŸ“çš„elé‡Œæœ‰æ³¨é‡Š,ä¼šå¡æ­»!!!! --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>skyblue<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">show</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            {{age}} hello {{name}} world {{name}} {{name}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        world        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>            {{age}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token comment" spellcheck="true">// console.log(Vue);</span>        <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>        <span class="token comment" spellcheck="true">// debugger</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">{</span>                    name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span>                    age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>                    <span class="token comment" spellcheck="true">// obj: {</span>                    <span class="token comment" spellcheck="true">//     sex: 'boy'</span>                    <span class="token comment" spellcheck="true">// },</span>                    arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'ant'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// template: '&lt;div>hello&lt;/div>'</span>            <span class="token comment" spellcheck="true">// el: '#app', // å°†æ•°æ®è§£æåˆ°elä¸Š</span>            <span class="token comment" spellcheck="true">// render(){</span>            <span class="token comment" spellcheck="true">// return createElement('div',{})</span>            <span class="token comment" spellcheck="true">// }</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// å®ç°è§£æè¡¨è¾¾å¼çš„æ–¹æ¡ˆ</span>        <span class="token comment" spellcheck="true">// 1,æ¨¡æ¿å¼•æ“ -> æ€§èƒ½å·®,éœ€è¦æ­£åˆ™åŒ¹é…æ›¿æ¢ vue1.0 -> æ²¡æœ‰å¼•å…¥è™šæ‹Ÿdom</span>        <span class="token comment" spellcheck="true">// 2,é‡‡ç”¨è™šæ‹Ÿdom -> æ•°æ®å˜åŒ–å,æ¯”è¾ƒè™šæ‹Ÿdomçš„å·®å¼‚,æœ€åæ›´æ–°éœ€è¦æ›´æ–°çš„åœ°æ–¹</span>        <span class="token comment" spellcheck="true">// 3,æ ¸å¿ƒå°±æ˜¯å°†æ¨¡æ¿å˜æˆjsè¯­æ³•,é€šè¿‡jsè¯­æ³•ç”Ÿæˆè™šæ‹Ÿdom</span>        <span class="token comment" spellcheck="true">// æ¶‰åŠè¯­æ³•è½¬æ¢,å¦‚ es6->es5 csså‹ç¼©</span>        <span class="token comment" spellcheck="true">// éœ€è¦å…ˆå˜æˆè¯­æ³•æ ‘å†é‡æ–°ç»„è£…ä»£ç ,å°†templateè¯­æ³•è½¬æ¢æˆrenderå‡½æ•°</span>        <span class="token comment" spellcheck="true">// setTimeout(() => {</span>        <span class="token comment" spellcheck="true">//     // å¤šæ¬¡æ›´æ–°</span>        <span class="token comment" spellcheck="true">//     vm.name = 'ls1'</span>        <span class="token comment" spellcheck="true">//     vm.name = 'ls2'</span>        <span class="token comment" spellcheck="true">//     vm.name = 'ls3'</span>        <span class="token comment" spellcheck="true">//     vm.name = 'ls4'</span>        <span class="token comment" spellcheck="true">//     vm.name = 'ls5'</span>        <span class="token comment" spellcheck="true">//     // vm.age = 23</span>        <span class="token comment" spellcheck="true">//     // æ‰‹åŠ¨é‡æ–°æ¸²æŸ“</span>        <span class="token comment" spellcheck="true">//     // vm._update(vm._render())</span>        <span class="token comment" spellcheck="true">//     // vm.arr[0] = 0 // é¡µé¢æ²¡ç”¨åˆ°çš„æ›´æ–°äº†ä¹Ÿä¸ä¼šè§¦å‘è§‚å¯Ÿè€…</span>        <span class="token comment" spellcheck="true">// }, 1000);</span>        vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'jw'</span> <span class="token comment" spellcheck="true">// ä¸ä¼šç«‹å³é‡æ–°æ¸²æŸ“é¡µé¢</span>        <span class="token comment" spellcheck="true">// åŒæ­¥è·å–,æ‹¿ä¸åˆ°æœ€æ–°çš„</span>        <span class="token comment" spellcheck="true">// console.log(app.innerHTML);</span>        <span class="token comment" spellcheck="true">// setTimeout(() => {</span>        <span class="token comment" spellcheck="true">//     // å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„</span>        <span class="token comment" spellcheck="true">//     console.log(app.innerHTML);</span>        <span class="token comment" spellcheck="true">// }, 1000);</span>        <span class="token comment" spellcheck="true">// // promiseä¼˜å…ˆçº§å¤§äºå®šæ—¶å™¨,æ‹¿åˆ°çš„è¿˜æ˜¯è€çš„</span>        <span class="token comment" spellcheck="true">// Promise.resolve().then(() => {</span>        <span class="token comment" spellcheck="true">//     console.log(app.innerHTML);</span>        <span class="token comment" spellcheck="true">// })</span>        <span class="token comment" spellcheck="true">// è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨ç»Ÿä¸€æš´éœ²ç»™å¤–éƒ¨çš„æ›´æ–°æ–¹æ³•</span>        <span class="token comment" spellcheck="true">// nextTickä¸æ˜¯åˆ›å»ºå¼‚æ­¥ä»»åŠ¡,è€Œæ˜¯å°†ä»»åŠ¡ç»´æŠ¤åˆ°é˜Ÿåˆ—</span>        vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// vm.name = 'jw2' // æ”¾åœ¨åé¢æ›´æ–°,å‰é¢æ‹¿åˆ°çš„åº”è¯¥è¿˜æ˜¯è€æ•°æ®</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_22.png" alt="img_22.png"></p><h1 id="å®ç°æ•°ç»„çš„æ›´æ–°"><a href="#å®ç°æ•°ç»„çš„æ›´æ–°" class="headerlink" title="å®ç°æ•°ç»„çš„æ›´æ–°"></a>å®ç°æ•°ç»„çš„æ›´æ–°</h1><h2 id="observe"><a href="#observe" class="headerlink" title="observe/"></a>observe/</h2><h3 id="index-js-3"><a href="#index-js-3" class="headerlink" title="index.js"></a>index.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> newArrayProto <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./array"</span><span class="token keyword">import</span> Dep <span class="token keyword">from</span> <span class="token string">'./dep'</span><span class="token comment" spellcheck="true">// è§‚å¯Ÿdataå¯¹è±¡çš„ç±»</span><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// dataå¯èƒ½æ˜¯å¯¹è±¡æˆ–æ•°ç»„</span>        <span class="token comment" spellcheck="true">// å¦‚æœå¯¹è±¡æˆ–æ•°ç»„æ–°å¢æ•°æ®,å¸Œæœ›ä¹Ÿèƒ½è¿›è¡Œæ›´æ–°,æ‰€ä»¥ç»™æ•°ç»„æˆ–å¯¹è±¡æœ¬èº«æ·»åŠ dep</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>            value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯å¯¹è±¡,åˆ™åŠ ä¸Š__ob__å,ä¼šä¸€ç›´è¿›è¡Œå“åº”å¼å¤„ç†walk(åœ¨æ„é€ å‡½æ•°è°ƒç”¨äº†),ç„¶åæ ˆæº¢å‡º</span>            enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// ä¸å¯æšä¸¾,(å¾ªç¯æ—¶æ— æ³•è·å–)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// æŠŠobserverå®ä¾‹æŒ‚è½½åˆ°data,åˆ™array.jsä¹Ÿå¯ä»¥ä½¿ç”¨observerçš„è§‚æµ‹æ•°ç»„æ–¹æ³•</span>        <span class="token comment" spellcheck="true">// å¦‚æœdataä¸Šæœ‰ä¸€ä¸ª__ob__å±æ€§,åˆ™è¯´æ˜è¢«è§‚æµ‹è¿‡</span>        <span class="token comment" spellcheck="true">// data.__ob__ = this</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœdataæ˜¯æ•°ç»„</span>            <span class="token comment" spellcheck="true">// å¯ä»¥ä¿ç•™æ•°ç»„çš„ç‰¹æ€§,é‡å†™æ•°ç»„çš„éƒ¨åˆ†æ–¹æ³• 7ä¸ªå˜å¼‚æ–¹æ³• å¯ä»¥ä¿®æ”¹æ•°ç»„æœ¬èº«</span>            <span class="token comment" spellcheck="true">// data.__proto__ = { // è¿™æ ·é‡æ–°æŒ‡å®šåŸå‹é“¾,ä¼šå¯¼è‡´æ•°ç»„åŸæœ‰å±æ€§å’Œæ–¹æ³•çš„ç¼ºå¤±</span>            <span class="token comment" spellcheck="true">//     push() {</span>            <span class="token comment" spellcheck="true">//         // é‡å†™push</span>            <span class="token comment" spellcheck="true">//         console.log('push')</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// }</span>            data<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> newArrayProto            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Object.definePropertyåªèƒ½åŠ«æŒå·²ç»å­˜åœ¨çš„å±æ€§ (vueé‡Œæä¾›äº†ä¸“é—¨çš„api($set $delete ...)æ¥è§£å†³)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¾ªç¯å¯¹è±¡,å¯¹å±æ€§ä¾æ¬¡åŠ«æŒ</span>        <span class="token comment" spellcheck="true">// é‡æ–°å®šä¹‰å±æ€§(vue2çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨),æ¯ä¸ªå˜é‡éƒ½æ·»åŠ get/setç›‘å¬</span>        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// è§‚æµ‹,å¯¹æ•°ç»„å’Œæ•°ç»„é‡Œçš„å¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†</span>    <span class="token function">observeArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> current <span class="token operator">=</span> value<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        current<span class="token punctuation">.</span>__ob__ <span class="token operator">&amp;&amp;</span> current<span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// å¦‚æœæ•°ç»„é‡Œæœ‰æ•°ç»„,è€Œä¸”è¿˜æœ‰æ•°ç»„,å°±ç»§ç»­ä¾èµ–æ”¶é›†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">dependArray</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å¯¹è±¡è½¬å“åº”å¼çš„æ–¹æ³•(é‡æ–°å®šä¹‰)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// é—­åŒ… å±æ€§åŠ«æŒ</span>    <span class="token comment" spellcheck="true">// valueå¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡,éœ€è¦å¯¹å…¶è¿›è¡Œå“åº”å¼å¤„ç†</span>    <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é€’å½’äº†,æ€§èƒ½ä¹Ÿä¼šé™ä½</span>    <span class="token comment" spellcheck="true">// childOb.depæ˜¯ç”¨æ¥æ”¶é›†ä¾èµ–çš„,childObæ˜¯observeæ–¹æ³•è¿”å›çš„Observeå®ä¾‹å¯¹è±¡</span>    <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ­¤æ—¶æ¯ä¸ªå±æ€§éƒ½æœ‰dep </span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å†…éƒ¨ä½¿ç”¨äº†å¤–éƒ¨çš„å˜é‡(value),æ‰€ä»¥valueè¢«ä¿å­˜åˆ°é—­åŒ…</span>        <span class="token comment" spellcheck="true">// å–å€¼æ—¶æ‰§è¡Œ</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// åœ¨æ¨¡æ¿é‡Œå–å€¼æ—¶(mount)æ‰ä¼šä¾èµ–æ”¶é›†(æ­¤æ—¶æœ‰watcher,watcheræŠŠdep.targetèµ‹å€¼ä¸ºè‡ªå·±)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// æ¯ä¸ªå±æ€§çš„depæ˜¯ä¸åŒçš„</span>                dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å±æ€§çš„æ”¶é›†å™¨è®°ä½å½“å‰watcher</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¦‚æœæœ‰childOb(éå¯¹è±¡å’Œè¢«ä»£ç†è¿‡çš„ä¸ä¼šäº§ç”ŸObserverå®ä¾‹)</span>                    childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// (æ•°ç»„æˆ–å¯¹è±¡)è¿›è¡Œä¾èµ–æ”¶é›†</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// è§£å†³æ•°ç»„åµŒå¥—æ•°ç»„æ— æ³•ä¾èµ–æ”¶é›†çš„é—®é¢˜</span>                        <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ•°ç»„</span>                        <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> value        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// ä¿®æ”¹æ—¶æ‰§è¡Œ</span>        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span>            <span class="token function">observe</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®¾ç½®å€¼æ—¶,å¦‚æœæ˜¯å¯¹è±¡,ä¹Ÿéœ€è¦è½¬å“åº”å¼!  </span>            value <span class="token operator">=</span> newValue            dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// é€šçŸ¥æ›´æ–°</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span></code></pre><h3 id="array-js"><a href="#array-js" class="headerlink" title="array.js"></a>array.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// é‡å†™æ•°ç»„éƒ¨åˆ†æ–¹æ³•</span><span class="token keyword">let</span> oldArrayProto <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype <span class="token comment" spellcheck="true">// è·å–æ•°ç»„çš„åŸå‹</span><span class="token comment" spellcheck="true">// newArrayProto = oldArrayProto æ‹¿åˆ°äº†æ—§åŸå‹</span><span class="token keyword">export</span> <span class="token keyword">let</span> newArrayProto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>oldArrayProto<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// é‡å†™</span><span class="token keyword">let</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment" spellcheck="true">// æ‰¾åˆ°æ‰€æœ‰çš„å˜å¼‚æ–¹æ³•(å¯ä»¥ä¿®æ”¹æ•°ç»„çš„æ–¹æ³•)</span>    <span class="token comment" spellcheck="true">// push å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦</span>    <span class="token comment" spellcheck="true">// pop åˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´  </span>    <span class="token comment" spellcheck="true">// shift ç§»é™¤æ•°ç»„çš„ç¬¬ä¸€é¡¹ </span>    <span class="token comment" spellcheck="true">// unshift å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„å¼€å¤´ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦</span>    <span class="token comment" spellcheck="true">// reverse åè½¬æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåº </span>    <span class="token comment" spellcheck="true">// sort æ’åº</span>    <span class="token comment" spellcheck="true">// splice ä»æ•°ç»„ä¸­æ·»åŠ /åˆ é™¤å…ƒç´ </span>    <span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span>    <span class="token string">'shift'</span><span class="token punctuation">,</span> <span class="token string">'unshift'</span><span class="token punctuation">,</span>    <span class="token string">'reverse'</span><span class="token punctuation">,</span>    <span class="token string">'sort'</span><span class="token punctuation">,</span>    <span class="token string">'splice'</span><span class="token punctuation">]</span>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>method <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// arr.push(1,2,3)</span>    <span class="token comment" spellcheck="true">// é‡å†™æ–¹æ³•</span>    newArrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è°ƒç”¨</span>        <span class="token comment" spellcheck="true">// å†…éƒ¨è°ƒç”¨åŸæ–¹æ³•,å‡½æ•°çš„åŠ«æŒ,åˆ‡ç‰‡ç¼–ç¨‹</span>        <span class="token keyword">const</span> result <span class="token operator">=</span> oldArrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿ç•™æ—§æ–¹æ³•çš„é€»è¾‘ </span>        <span class="token comment" spellcheck="true">// å¯¹æ–°å¢çš„æ•°æ®å†æ¬¡è¿›è¡ŒåŠ«æŒ</span>        <span class="token keyword">let</span> inserted <span class="token comment" spellcheck="true">// æ˜¯ä¸€ä¸ªæ•°ç»„</span>        <span class="token keyword">let</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__ <span class="token comment" spellcheck="true">// æŒ‚è½½åœ¨dataçš„observerå®ä¾‹,å¯ä»¥ä½¿ç”¨å…¶æ›´æ–°æ–¹æ³•</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token punctuation">:</span>            <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token punctuation">:</span>                inserted <span class="token operator">=</span> args                <span class="token keyword">break</span>            <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// splice(å¼€å§‹ä½ç½®,ç»“æŸä½ç½®,{æ–°å¢æ•°æ®},{æ–°å¢æ•°æ®})</span>                <span class="token comment" spellcheck="true">// è·å–æ–°å¢çš„æ•°æ®</span>                inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å»æ‰å‰ä¸¤ä¸ª,æ‹¿åˆ°å‰©ä¸‹çš„</span>                <span class="token keyword">break</span>            <span class="token keyword">default</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(inserted)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// console.log(this)</span>            <span class="token comment" spellcheck="true">// æ•°ç»„è½¬å“åº”å¼</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// æ•°ç»„å˜åŒ–,æ›´æ–°ä¾èµ–æ”¶é›†</span>        ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> result    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="æµ‹è¯•-8"><a href="#æµ‹è¯•-8" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="index-html-2"><a href="#index-html-2" class="headerlink" title="index.html"></a>index.html</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å¯ä»¥ç»™æ¨¡æ¿ä¸­çš„å±æ€§æ·»åŠ ä¸€ä¸ªæ”¶é›†å™¨ dep --></span>    <span class="token comment" spellcheck="true">&lt;!-- é¡µé¢æ¸²æŸ“æ—¶ å°†æ¸²æŸ“é€»è¾‘å°è£…åˆ°watcherä¸­, vm._update(vm.render()) --></span>    <span class="token comment" spellcheck="true">&lt;!-- è®©depè®°ä½è¿™ä¸ªwatcher,æ•°æ®å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„watcherè¿›è¡Œæ›´æ–° --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¤šä¸ª{{name}},ä¼šæœ‰é‡å¤watcher,è¦é¿å… --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæ¸²æŸ“çš„elé‡Œæœ‰æ³¨é‡Š,ä¼šå¡æ­»!!!! --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>skyblue<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">show</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            {{ a }}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span>            {{arr}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token comment" spellcheck="true">// console.log(Vue);</span>        <span class="token comment" spellcheck="true">// å“åº”å¼çš„æ•°æ®å˜åŒ– (æ•°æ®å˜åŒ–å¯ä»¥è¢«ç›‘æ§) </span>        <span class="token comment" spellcheck="true">// debugger</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">{</span>                    arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    a<span class="token punctuation">:</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// vm.$mount('#app')</span>        <span class="token comment" spellcheck="true">// vm.arr[0] = 100 // åªé‡å†™æ•°ç»„æ–¹æ³•,æ²¡æœ‰ç›‘è§†æ•°ç»„æ”¹å˜</span>        <span class="token comment" spellcheck="true">// vm.arr.length = 100 // æ²¡æœ‰ç›‘æ§æ•°ç»„é•¿åº¦å˜åŒ–</span>        <span class="token comment" spellcheck="true">// æ”¹å˜çš„ä¸æ˜¯arré‡Œçš„å€¼,è€Œæ˜¯æ”¹å˜arrå¯¹è±¡æœ¬èº«,æ‰€æœ‰ä¼šæ›´æ–°</span>        <span class="token comment" spellcheck="true">// vm.arr = [123, 456]</span>        <span class="token comment" spellcheck="true">// vm.arr[3].a = 2 // aå¯¹è±¡å–å€¼æ—¶ä¼šè°ƒç”¨jsonstringfyè¿›è¡Œå–å€¼,æ‰€ä»¥ä¼šæ›´æ–°</span>        <span class="token comment" spellcheck="true">// vm.a.a = 199</span>        vm<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">222</span> <span class="token comment" spellcheck="true">// æ— æ³•ç›´æ¥å¯¹ä¸å­˜åœ¨çš„å€¼æ›´æ–°(è¦ç”¨$set)</span>        vm<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// $setåŸç†</span>        vm<span class="token punctuation">.</span>a<span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        vm<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>        vm<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'d'</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_23.png" alt="vue3ä½¿ç”¨proxy"><br><img src="img_24.png" alt="img_24.png"></p><h1 id="å®ç°è®¡ç®—å±æ€§"><a href="#å®ç°è®¡ç®—å±æ€§" class="headerlink" title="å®ç°è®¡ç®—å±æ€§"></a>å®ç°è®¡ç®—å±æ€§</h1><blockquote><p>è®¡ç®—å±æ€§å°±æ˜¯æ ¹æ®å¤šä¸ªå“åº”å¼æ•°æ®å¾—å‡ºçš„å€¼</p></blockquote><h2 id="ä½¿ç”¨åŸç”Ÿvue2çš„è®¡ç®—å±æ€§-è¿›è¡Œåˆ†æ"><a href="#ä½¿ç”¨åŸç”Ÿvue2çš„è®¡ç®—å±æ€§-è¿›è¡Œåˆ†æ" class="headerlink" title="ä½¿ç”¨åŸç”Ÿvue2çš„è®¡ç®—å±æ€§,è¿›è¡Œåˆ†æ"></a>ä½¿ç”¨åŸç”Ÿvue2çš„è®¡ç®—å±æ€§,è¿›è¡Œåˆ†æ</h2><blockquote><ol><li>å¤šæ¬¡getåªä¼šæ‰§è¡Œä¸€æ¬¡(é™¤éå€¼å‘ç”Ÿäº†å˜åŒ–) -&gt; éœ€è¦ç»´æŠ¤ä¸€ä¸ªdirty(è„å€¼æ£€æµ‹)</li><li>è®¡ç®—å±æ€§ä¸ä¼šç«‹åˆ»æ‰§è¡Œ</li><li>æœ‰getå’Œset -&gt; æ˜¯ä¸€ä¸ªdefineProperty</li><li>å¯ä»¥ç›‘å¬è®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å€¼çš„æ”¹å˜,ä»è€Œæ›´æ–°è§†å›¾ -&gt; è®¡ç®—å±æ€§ æ˜¯/æœ‰ watcher</li></ol></blockquote><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å¯ä»¥ç»™æ¨¡æ¿ä¸­çš„å±æ€§æ·»åŠ ä¸€ä¸ªæ”¶é›†å™¨ dep --></span>    <span class="token comment" spellcheck="true">&lt;!-- é¡µé¢æ¸²æŸ“æ—¶ å°†æ¸²æŸ“é€»è¾‘å°è£…åˆ°watcherä¸­, vm._update(vm.render()) --></span>    <span class="token comment" spellcheck="true">&lt;!-- è®©depè®°ä½è¿™ä¸ªwatcher,æ•°æ®å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„watcherè¿›è¡Œæ›´æ–° --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¤šä¸ª{{name}},ä¼šæœ‰é‡å¤watcher,è¦é¿å… --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæ¸²æŸ“çš„elé‡Œæœ‰æ³¨é‡Š,ä¼šå¡æ­»!!!! --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         {{fullname}} {{fullname}} {{fullname}}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- &lt;script src="./vue.js">&lt;/script> --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                firstname<span class="token punctuation">:</span> <span class="token string">'ä¿Š'</span><span class="token punctuation">,</span>                lastname<span class="token punctuation">:</span> <span class="token string">'æ°'</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// ç®€å†™</span>                <span class="token comment" spellcheck="true">// fullname() { // definePropertyä¸­çš„getæ–¹æ³•</span>                <span class="token comment" spellcheck="true">// return this.firstname + this.lastname</span>                <span class="token comment" spellcheck="true">// }</span>                fullname<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// å¯è§,è®¡ç®—å±æ€§éœ€è¦ç»´æŠ¤ä¸€ä¸ªdirtyå±æ€§</span>                    <span class="token comment" spellcheck="true">// é»˜è®¤è®¡ç®—å±æ€§ä¸ä¼šç«‹åˆ»æ‰§è¡Œ</span>                    <span class="token comment" spellcheck="true">// å°±æ˜¯ä¸€ä¸ªdefineProperty</span>                    <span class="token comment" spellcheck="true">// å¦‚æœç»„æˆè®¡ç®—å±æ€§çš„å€¼æ”¹å˜(è®¡ç®—å±æ€§ä¾èµ–çš„å€¼å‘ç”Ÿæ”¹å˜),åˆ™ä¼šè§¦å‘æ›´æ–° -> è®¡ç®—å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªwatcher</span>                    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// (å¦‚æœå€¼æ²¡å‘ç”Ÿæ”¹å˜)å¤šæ¬¡è°ƒç”¨åªæ‰§è¡Œä¸€æ¬¡ (è„å€¼æ£€æµ‹)</span>                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstname <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token keyword">set</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// vm.fullname = '123'</span>            vm<span class="token punctuation">.</span>firstname <span class="token operator">=</span> <span class="token string">'123'</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_25.png"></p><blockquote><p>è®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å±æ€§çš„depç›‘å¬åˆ°å˜åŒ–,ä¼šå»æ‰¾watcher,æ­¤æ—¶stacké‡Œåªå‰©ä¸‹è®¡ç®—å±æ€§çš„watcher,ä½†æ˜¯å½“å‰çš„updateæ–¹æ³•æ‰§è¡Œgetæ–¹æ³•ä¸ä¼šè§¦å‘æ›´æ–°(ä¼ å…¥watchcerçš„fn(æ˜¯getter)ä¸èƒ½æ›´æ–°è§†å›¾)</p></blockquote><p><img src="img_27.png" alt="ä¿®æ”¹äº†depå¯¹åº”çš„å±æ€§çš„å€¼,æ­¤æ—¶æ¸²æŸ“watcheræ‰§è¡Œç»“æŸå·²ç»è¢«pop,éœ€è¦è®©depè®°å½•ä¸‹æ¸²æŸ“watcher,æ›´æ–°æ—¶è°ƒç”¨æ¸²æŸ“watcheræ¥æ›´æ–°è§†å›¾"></p><h2 id="ä¿®æ”¹state-js"><a href="#ä¿®æ”¹state-js" class="headerlink" title="ä¿®æ”¹state.js"></a>ä¿®æ”¹state.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Dep <span class="token keyword">from</span> <span class="token string">"./observe/dep"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> observe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observe/index"</span><span class="token keyword">import</span> Watcher <span class="token keyword">from</span> <span class="token string">"./observe/watcher"</span><span class="token comment" spellcheck="true">// å¯¹optionså†…å±æ€§å’Œæ–¹æ³•è¿›è¡Œæ“ä½œ </span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// dataæ•°æ®çš„åˆå§‹åŒ–</span>        <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(vm.$options)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§åˆå§‹åŒ–</span>        <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ä»£ç†å–å€¼å’Œè®¾ç½®å€¼,é€šè¿‡å“åº”å¼çš„æ–¹æ³•æ¥æ”¹å˜å®é™…æ“ä½œçš„å€¼</span><span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ•°æ®åˆå§‹åŒ–(è½¬ä¸ºå“åº”å¼)</span><span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§åˆå§‹åŒ–</span><span class="token keyword">function</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ‹¿åˆ°ç”¨æˆ·å®šä¹‰çš„è®¡ç®—å±æ€§(æœ‰ä¸¤ç§å†™æ³•)</span>    <span class="token keyword">const</span> computed <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>computed    <span class="token comment" spellcheck="true">// console.log(computed)</span>    <span class="token comment" spellcheck="true">// æŒ‚è½½åˆ°vm</span>    <span class="token keyword">let</span> watchers <span class="token operator">=</span> vm<span class="token punctuation">.</span>_computedWatchers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// ä¿å­˜ä¸åŒè®¡ç®—å±æ€§çš„watcher</span>    <span class="token comment" spellcheck="true">// æ‹¿åˆ°computedé‡Œå®šä¹‰çš„è®¡ç®—å±æ€§</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> userDef <span class="token operator">=</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">// ç¼“å­˜</span>        <span class="token comment" spellcheck="true">// éœ€è¦ç›‘æ§è®¡ç®—å±æ€§ä¸­get(ä¾èµ–çš„å±æ€§)çš„å˜åŒ–</span>        <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">typeof</span> userDef <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> userDef <span class="token punctuation">:</span> userDef<span class="token punctuation">.</span><span class="token keyword">get</span>        <span class="token comment" spellcheck="true">// ç›´æ¥new,ä¼šèµ°fn,æ‰€ä»¥ç”¨lazyæ¥æ ‡è¯†ä¸éœ€è¦ç«‹åˆ»æ‰§è¡Œfn</span>        watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å°†è®¡ç®—å±æ€§å’Œwatcherå¯¹åº”èµ·æ¥</span>        <span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å®šä¹‰è®¡ç®—å±æ€§</span><span class="token keyword">function</span> <span class="token function">defineComputed</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆ¤æ–­è®¡ç®—å±æ€§æ˜¯å‡½æ•°è¿˜æ˜¯å¯¹è±¡</span>    <span class="token comment" spellcheck="true">// const getter = typeof userDef === 'function' ? userDef : userDef.get</span>    <span class="token keyword">const</span> setter <span class="token operator">=</span> userDef<span class="token punctuation">.</span><span class="token keyword">set</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// console.log(getter, setter)</span>    <span class="token comment" spellcheck="true">// å¯ä»¥é€šè¿‡å®ä¾‹(target[vm])è·å–å¯¹åº”å±æ€§ </span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// thisæŒ‡å‘vm </span>        <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">set</span><span class="token punctuation">:</span> setter    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ³¨æ„: è®¡ç®—å±æ€§ä¸ä¼šæ”¶é›†ä¾èµ–,åªä¼šè®©è‡ªå·±çš„ä¾èµ–å±æ€§å»æ”¶é›†ä¾èµ–</span><span class="token comment" spellcheck="true">// åŒ…è£…ä¸€ä¸‹getter,åˆ¤æ–­æ˜¯ä¸æ˜¯é‡å¤getäº†</span><span class="token keyword">function</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ£€æµ‹æ˜¯å¦è¦æ‰§è¡Œgetter</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// thisæŒ‡å‘vm</span>        <span class="token comment" spellcheck="true">// æ‹¿åˆ°å¯¹åº”å±æ€§çš„watcher (è®¡ç®—å±æ€§watcher)</span>        <span class="token comment" spellcheck="true">// console.log(this, key) </span>        <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯dirty,å°±æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„å‡½æ•°</span>            watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è°ƒç”¨å®Œä¼šè®¾ç½®dirtyä¸ºfalse</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§å‡ºæ ˆå,è¿˜è¦æ¸²æŸ“,éœ€è¦è®°å½•æ¸²æŸ“watcheræ¥æ›´æ–°è§†å›¾</span>            watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(this.value)</span>        <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value <span class="token comment" spellcheck="true">// è¿”å›watcherä¸Šçš„å€¼</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> </code></pre><h2 id="ä¿®æ”¹dep-js"><a href="#ä¿®æ”¹dep-js" class="headerlink" title="ä¿®æ”¹dep.js"></a>ä¿®æ”¹dep.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// ç”¨äºå”¯ä¸€æ ‡è¯†dep </span><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token operator">++</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// å­˜æ”¾å½“å‰å±æ€§å¯¹åº”çš„watcheræœ‰å“ªäº›</span>    <span class="token punctuation">}</span>    <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ä¸å¸Œæœ›åŠ é‡å¤çš„watcher</span>        <span class="token comment" spellcheck="true">// this.subs.push(Dep.target)</span>        <span class="token comment" spellcheck="true">// debugger</span>        Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®©watcherè®°ä½dep</span>    <span class="token punctuation">}</span>    <span class="token function">addSub</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// åœ¨watcheré‡Œæœ‰å»é‡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ›´æ–°æ–¹æ³•!</span>    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è®©æ‰€æœ‰watcheræ›´æ–°æ•°æ®</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>watcher <span class="token operator">=</span><span class="token operator">></span> watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment" spellcheck="true">// è¿™ä¸ªstackæ˜¯å…±ç”¨çš„</span><span class="token comment" spellcheck="true">// åªæœ‰ä¸€ä¸ªwatcheræ—¶,å…¶å®å’Œä¹‹å‰æ²¡æœ‰å·®åˆ«</span><span class="token comment" spellcheck="true">// æ”¹ä¸ºå°†watcheræ”¾å…¥æ ˆ,targetæŒ‡å‘æœ€åæ”¾å…¥çš„watcher</span><span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">// æ¸²æŸ“å‰å…¥æ ˆ</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushTarget</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> watcher    <span class="token comment" spellcheck="true">// console.log(stack)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ¸²æŸ“åå‡ºæ ˆ</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Dep </code></pre><h2 id="ä¿®æ”¹watcher-js"><a href="#ä¿®æ”¹watcher-js" class="headerlink" title="ä¿®æ”¹watcher.js"></a>ä¿®æ”¹watcher.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Dep<span class="token punctuation">,</span> <span class="token punctuation">{</span> popTarget<span class="token punctuation">,</span> pushTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./dep"</span><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// å”¯ä¸€æ ‡è¯†watcher</span><span class="token comment" spellcheck="true">// 1,æ¸²æŸ“watcheræ—¶,æŠŠå½“å‰æ¸²æŸ“çš„watcheræ”¾åˆ°dep.target</span><span class="token comment" spellcheck="true">// 2,è°ƒç”¨_render() ä¼šå–å€¼,èµ°åˆ°å±æ€§çš„getä¸Š</span><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸åŒç»„ä»¶æœ‰ä¸åŒçš„watcher</span>    <span class="token comment" spellcheck="true">// ä¼ å…¥vmå’Œæ›´æ–°æ–¹æ³•</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(fn)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token operator">++</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>renderWatcher <span class="token operator">=</span> options <span class="token comment" spellcheck="true">// æ˜¯ä¸€ä¸ªæ¸²æŸ“watcher</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> fn <span class="token comment" spellcheck="true">// getteræ„å‘³ç€è°ƒç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥å‘ç”Ÿå–å€¼æ“ä½œ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// åç»­å®ç°è®¡ç®—å±æ€§å’Œæ¸…ç†å·¥ä½œç”¨å¾—åˆ°</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿å­˜depçš„id(å¤šä¸ª),seté›†åˆå¯ä»¥å»é‡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> options<span class="token punctuation">.</span>lazy <span class="token comment" spellcheck="true">// æ˜¯å¦ç«‹åˆ»æ‰§è¡Œfn</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token comment" spellcheck="true">// æ ‡è®°è„,æ˜¯å¦ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm        <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">?</span> undefined <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// init get</span>    <span class="token punctuation">}</span>    <span class="token function">addDep</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªå±æ€§,é‡å¤çš„ä¸ç”¨è®°å½•</span>        <span class="token keyword">let</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// watcherè®°å½•dep</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// æ­¤æ—¶è®©depè®°å½•watcher</span>            dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç”¨æˆ·ä¼ å…¥çš„getæ–¹æ³• </span>        <span class="token comment" spellcheck="true">// console.log(this)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç”¨æˆ·getå‡½æ•°çš„è¿”å›å€¼ </span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// å¦‚æœå†æ¬¡å–å€¼,åˆ™state.jsé‡Œçš„åˆ¤æ–­ä¼šfalse,ä¸ä¼šå†æ¬¡è§¦å‘this.get</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ›´æ–°</span>    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// Dep.target = this // å½“å‰çš„watcherç»™dep</span>        <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¼šä»vmä¸Šå–å€¼</span>        <span class="token comment" spellcheck="true">// console.log(value)</span>        <span class="token comment" spellcheck="true">// console.log(this.getter)</span>        <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// Dep.target = null // æ¸²æŸ“å®Œæ¸…ç©º</span>        <span class="token keyword">return</span> value <span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§æ‰§è¡Œçš„æ˜¯ç”¨æˆ·ä¼ å…¥çš„getter,è¿”å›å€¼å°±æ˜¯è®¡ç®—å±æ€§çš„å€¼</span>    <span class="token punctuation">}</span>    <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length        <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// dep.depend()</span>            <span class="token comment" spellcheck="true">// depä¾èµ–æ¸²æŸ“watcherå’Œè®¡ç®—å±æ€§watcher,éƒ½éœ€è¦æ”¶é›†</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®©è®¡ç®—å±æ€§watcherä¹Ÿæ”¶é›†æ¸²æŸ“watcher</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯è®¡ç®—å±æ€§,ä¾èµ–çš„å€¼å˜åŒ–äº†,ä¼šè§¦å‘è®¡ç®—å±æ€§watcherçš„updateæ–¹æ³•</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">// æ ‡è®°ä¸ºtrue,å¯ä»¥æ›´æ–°(state.js)</span>            <span class="token comment" spellcheck="true">// console.log(1) </span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªæ•°æ®,åˆ™åº”è¯¥ç”¨é˜Ÿåˆ—è®°å½•,åªæ›´æ–°æœ€åä¸€æ¬¡</span>        <span class="token function">queryWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æš‚å­˜watcher</span>        <span class="token comment" spellcheck="true">// this.get() // é‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span>    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ­¤æ—¶æœ€ç»ˆçš„vm.nameå·²ç»èµ‹å€¼å®Œæ¯•(ls5),æ›´æ–°æ—¶å–å€¼,å°±æ˜¯æœ€åçš„è¿™ä¸ªå€¼</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// éœ€è¦ç»™æ¯ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ªdep,ç›®çš„æ˜¯æ”¶é›†watcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶ä¸­,æœ‰å¤šä¸ªå±æ€§(nä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªè§†å›¾) nä¸ªdepå¯¹åº”ä¸€ä¸ªwatcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªå±æ€§,å¯¹åº”å¤šä¸ªç»„ä»¶,ä¸€ä¸ªdepå¯¹åº”å¤šä¸ªwatcher</span><span class="token comment" spellcheck="true">// å¤šå¯¹å¤š</span><span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// æºç æ˜¯ç”¨setæ¥å»é‡</span><span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨å¯¹è±¡æ¥å»é‡</span><span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// é˜²æŠ–</span><span class="token comment" spellcheck="true">// ç­‰å¾…ä¸€æ®µæ—¶é—´åè¿›å…¥è¯¥æ–¹æ³•,ä¸€æ¬¡æ€§æ›´æ–°</span><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> flushQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// åˆ·æ–°è¿‡ç¨‹ä¸­,å¯èƒ½ä¹Ÿæœ‰æ–°çš„watcher,å¯ä»¥é‡æ–°æ”¾åˆ°queue</span>    queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    pending <span class="token operator">=</span> <span class="token boolean">false</span>    flushQueue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>q <span class="token operator">=</span><span class="token operator">></span> q<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">queryWatcher</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ²¡æœ‰é‡å¤,ç›´æ¥æ”¾å…¥é˜Ÿåˆ—</span>        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>        has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token comment" spellcheck="true">// console.log(queue)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ä¸ç®¡updateå¤šå°‘æ¬¡,æœ€ç»ˆåªæ‰§è¡Œä¸€è½®åˆ·æ–°æ“ä½œ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pending <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç”¨æˆ·æ›´æ–°é˜Ÿåˆ—</span><span class="token keyword">let</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">// å¼‚æ­¥æ‰¹å¤„ç†</span><span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> cbs <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    waiting <span class="token operator">=</span> <span class="token boolean">false</span>    callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    cbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>cb <span class="token operator">=</span><span class="token operator">></span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// æš´éœ²ç»™å¤–éƒ¨çš„æ›´æ–°æ–¹æ³•</span><span class="token comment" spellcheck="true">// vueé‡Œçš„nextTickä¸æ˜¯ç”¨api(å®šæ—¶å™¨...),è€Œæ˜¯é‡‡ç”¨ä¼˜é›…é™çº§çš„æ–¹å¼</span><span class="token comment" spellcheck="true">// é™çº§: promise(ieä¸å…¼å®¹) => MutationObserver(h5çš„api) => setImmediate(ieä¸“ç”¨) => setTimeout</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å…ˆç”¨æˆ·è¿˜æ˜¯å…ˆå†…éƒ¨æ›´æ–° ? => çœ‹ç”¨æˆ·æ›´æ–°æ–¹æ³•åœ¨å‰,è¿˜æ˜¯æ•°æ®å˜åŒ–åœ¨å‰</span>    <span class="token comment" spellcheck="true">// å®šæ—¶å™¨è€—æ€§èƒ½,promiseæ‰§è¡Œæ¯”å®šæ—¶å™¨å¿«</span>    callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// timerFunc(flushCallbacks) </span>        <span class="token comment" spellcheck="true">// timerFunc() // æ‰§è¡Œçš„å°±æ˜¯flushCallbacks</span>        waiting <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Watcher</code></pre><h2 id="æµ‹è¯•-9"><a href="#æµ‹è¯•-9" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å¯ä»¥ç»™æ¨¡æ¿ä¸­çš„å±æ€§æ·»åŠ ä¸€ä¸ªæ”¶é›†å™¨ dep --></span>    <span class="token comment" spellcheck="true">&lt;!-- é¡µé¢æ¸²æŸ“æ—¶ å°†æ¸²æŸ“é€»è¾‘å°è£…åˆ°watcherä¸­, vm._update(vm.render()) --></span>    <span class="token comment" spellcheck="true">&lt;!-- è®©depè®°ä½è¿™ä¸ªwatcher,æ•°æ®å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„watcherè¿›è¡Œæ›´æ–° --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¤šä¸ª{{name}},ä¼šæœ‰é‡å¤watcher,è¦é¿å… --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæ¸²æŸ“çš„elé‡Œæœ‰æ³¨é‡Š,ä¼šå¡æ­»!!!! --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        {{fullname}}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- &lt;script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.js">&lt;/script> --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                firstname<span class="token punctuation">:</span> <span class="token string">'ä¿Š'</span><span class="token punctuation">,</span>                lastname<span class="token punctuation">:</span> <span class="token string">'æ°'</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// ç®€å†™</span>                <span class="token function">fullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// definePropertyä¸­çš„getæ–¹æ³•</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// console.log(this); </span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstname <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">// fullname: {</span>                <span class="token comment" spellcheck="true">//     // å¯è§,è®¡ç®—å±æ€§éœ€è¦ç»´æŠ¤ä¸€ä¸ªdirtyå±æ€§</span>                <span class="token comment" spellcheck="true">//     // é»˜è®¤è®¡ç®—å±æ€§ä¸ä¼šç«‹åˆ»æ‰§è¡Œ</span>                <span class="token comment" spellcheck="true">//     // å°±æ˜¯ä¸€ä¸ªdefineProperty</span>                <span class="token comment" spellcheck="true">//     // å¦‚æœç»„æˆè®¡ç®—å±æ€§çš„å€¼æ”¹å˜(è®¡ç®—å±æ€§ä¾èµ–çš„å€¼å‘ç”Ÿæ”¹å˜),åˆ™ä¼šè§¦å‘æ›´æ–° -> è®¡ç®—å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªwatcher</span>                <span class="token comment" spellcheck="true">//     get() {</span>                <span class="token comment" spellcheck="true">//         console.log('run'); // (å¦‚æœå€¼æ²¡å‘ç”Ÿæ”¹å˜)å¤šæ¬¡è°ƒç”¨åªæ‰§è¡Œä¸€æ¬¡ (è„å€¼æ£€æµ‹)</span>                <span class="token comment" spellcheck="true">//         return this.firstname + this.lastname</span>                <span class="token comment" spellcheck="true">//     },</span>                <span class="token comment" spellcheck="true">//     set(newVal) {</span>                <span class="token comment" spellcheck="true">//         console.log(newVal);</span>                <span class="token comment" spellcheck="true">//     }</span>                <span class="token comment" spellcheck="true">// }</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>             vm<span class="token punctuation">.</span>firstname <span class="token operator">=</span> <span class="token string">'123'</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_28.png" alt="img_28.png"><img src="img_29.png" alt="img_29.png"></p><h1 id="å®ç°watch"><a href="#å®ç°watch" class="headerlink" title="å®ç°watch"></a>å®ç°watch</h1><blockquote><p>watchçš„åŠŸèƒ½å°±æ˜¯ç›‘æ§ç‰¹å®šå˜é‡çš„å˜åŒ–<br>è®¡ç®—å±æ€§å’Œwatchåº•å±‚éƒ½æ˜¯åŸºäºè®¡ç®—å±æ€§</p></blockquote><h2 id="index-js-4"><a href="#index-js-4" class="headerlink" title="index.js"></a>index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./init"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initLifeCycle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lifecycle"</span><span class="token keyword">import</span> Watcher<span class="token punctuation">,</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observe/watcher"</span><span class="token comment" spellcheck="true">// classä¼šæŠŠæ‰€æœ‰æ–¹æ³•è€¦åˆåœ¨ä¸€èµ·</span><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// optionså°±æ˜¯ç”¨æˆ·æä¾›çš„é€‰é¡¹ </span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆå§‹åŒ– </span>    <span class="token comment" spellcheck="true">// if (options.el) this.$mount(options.el) // æŒ‚è½½</span><span class="token punctuation">}</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$nextTick <span class="token operator">=</span> nextTick <span class="token comment" spellcheck="true">// ç»Ÿä¸€æš´éœ²ç»™å¤–éƒ¨çš„æ›´æ–°æ–¹æ³•</span><span class="token comment" spellcheck="true">// debugger</span><span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ‹“å±•äº†vue,æ·»åŠ initæ–¹æ³•</span><span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç»„ä»¶æ¸²æŸ“</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$watch <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>exprOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(exprOrFn, cb, options)</span>    <span class="token comment" spellcheck="true">// exprOrFnå¯èƒ½æ˜¯å‡½æ•°(è¿”å›ä¸€ä¸ªå‡½æ•°),ä¹Ÿæœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸²</span>    <span class="token comment" spellcheck="true">// cbæ˜¯watchç›‘æµ‹çš„å€¼å˜åŒ–æ—¶è§¦å‘çš„å‡½æ•°</span>    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> exprOrFn<span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Vue</code></pre><h2 id="state-js-1"><a href="#state-js-1" class="headerlink" title="state.js"></a>state.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Dep <span class="token keyword">from</span> <span class="token string">"./observe/dep"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> observe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observe/index"</span><span class="token keyword">import</span> Watcher <span class="token keyword">from</span> <span class="token string">"./observe/watcher"</span><span class="token comment" spellcheck="true">// å¯¹optionså†…å±æ€§å’Œæ–¹æ³•è¿›è¡Œæ“ä½œ </span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// dataæ•°æ®çš„åˆå§‹åŒ–</span>        <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(vm.$options)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§åˆå§‹åŒ–</span>        <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// watchçš„åˆå§‹åŒ–</span>        <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ä»£ç†å–å€¼å’Œè®¾ç½®å€¼,é€šè¿‡å“åº”å¼çš„æ–¹æ³•æ¥æ”¹å˜å®é™…æ“ä½œçš„å€¼</span><span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ......</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ•°æ®åˆå§‹åŒ–(è½¬ä¸ºå“åº”å¼)</span><span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§åˆå§‹åŒ–</span><span class="token keyword">function</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å®šä¹‰è®¡ç®—å±æ€§</span><span class="token keyword">function</span> <span class="token function">defineComputed</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// .....</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æ³¨æ„: è®¡ç®—å±æ€§ä¸ä¼šæ”¶é›†ä¾èµ–,åªä¼šè®©è‡ªå·±çš„ä¾èµ–å±æ€§å»æ”¶é›†ä¾èµ–</span><span class="token comment" spellcheck="true">// åŒ…è£…ä¸€ä¸‹getter,åˆ¤æ–­æ˜¯ä¸æ˜¯é‡å¤getäº†</span><span class="token keyword">function</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ£€æµ‹æ˜¯å¦è¦æ‰§è¡Œgetter</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// thisæŒ‡å‘vm</span>        <span class="token comment" spellcheck="true">// æ‹¿åˆ°å¯¹åº”å±æ€§çš„watcher (è®¡ç®—å±æ€§watcher)</span>        <span class="token comment" spellcheck="true">// console.log(this, key) </span>        <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯dirty,å°±æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„å‡½æ•°</span>            watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è°ƒç”¨å®Œä¼šè®¾ç½®dirtyä¸ºfalse</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§å‡ºæ ˆå,è¿˜è¦æ¸²æŸ“,éœ€è¦è®°å½•æ¸²æŸ“watcheræ¥æ›´æ–°è§†å›¾</span>            watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(this.value)</span>        <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value <span class="token comment" spellcheck="true">// è¿”å›watcherä¸Šçš„å€¼</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> watch <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>watch    <span class="token comment" spellcheck="true">// console.log(watch)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ä¸‰ç§æƒ…å†µ: å­—ç¬¦ä¸²,æ•°ç»„,å‡½æ•° (å…¶å®ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡,ä½†æ˜¯è¿™é‡Œä¸è€ƒè™‘)</span>        <span class="token keyword">const</span> handler <span class="token operator">=</span> watch<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ•°ç»„</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> handler<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">createWatcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> handler<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœä¸æ˜¯æ•°ç»„</span>            <span class="token function">createWatcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// åˆ›å»ºwatch</span><span class="token keyword">function</span> <span class="token function">createWatcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å­—ç¬¦ä¸²,æ•°ç»„,å‡½æ•°</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> handler <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        handler <span class="token operator">=</span> vm<span class="token punctuation">[</span>handler<span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="watcher-js-1"><a href="#watcher-js-1" class="headerlink" title="watcher.js"></a>watcher.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Dep<span class="token punctuation">,</span> <span class="token punctuation">{</span> popTarget<span class="token punctuation">,</span> pushTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./dep"</span><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// å”¯ä¸€æ ‡è¯†watcher</span><span class="token comment" spellcheck="true">// 1,æ¸²æŸ“watcheræ—¶,æŠŠå½“å‰æ¸²æŸ“çš„watcheræ”¾åˆ°dep.target</span><span class="token comment" spellcheck="true">// 2,è°ƒç”¨_render() ä¼šå–å€¼,èµ°åˆ°å±æ€§çš„getä¸Š</span><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸åŒç»„ä»¶æœ‰ä¸åŒçš„watcher</span>    <span class="token comment" spellcheck="true">// ä¼ å…¥vmå’Œæ›´æ–°æ–¹æ³•</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> exprOrFn<span class="token punctuation">,</span> options<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(fn)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token operator">++</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>renderWatcher <span class="token operator">=</span> options <span class="token comment" spellcheck="true">// æ˜¯ä¸€ä¸ªæ¸²æŸ“watcher</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb <span class="token comment" spellcheck="true">// è·å–ç”¨æˆ·å®šä¹‰çš„watchå›è°ƒ|å¤„ç†é€»è¾‘</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exprOrFn <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å­—ç¬¦ä¸²</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> vm<span class="token punctuation">[</span>exprOrFn<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// vm.xxx</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> exprOrFn <span class="token comment" spellcheck="true">// getteræ„å‘³ç€è°ƒç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥å‘ç”Ÿå–å€¼æ“ä½œ</span>        <span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// åç»­å®ç°è®¡ç®—å±æ€§å’Œæ¸…ç†å·¥ä½œç”¨å¾—åˆ°</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿å­˜depçš„id(å¤šä¸ª),seté›†åˆå¯ä»¥å»é‡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> options<span class="token punctuation">.</span>lazy <span class="token comment" spellcheck="true">// æ˜¯å¦ç«‹åˆ»æ‰§è¡Œfn</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token comment" spellcheck="true">// æ ‡è®°è„,æ˜¯å¦ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm        <span class="token comment" spellcheck="true">// æ‹¿åˆ°åˆå§‹å€¼</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">?</span> undefined <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// init get</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> options<span class="token punctuation">.</span>user<span class="token comment" spellcheck="true">// æ ‡è¯†æ˜¯ä¸æ˜¯ç”¨æˆ·è‡ªå·±çš„watch</span>    <span class="token punctuation">}</span>    <span class="token function">addDep</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªå±æ€§,é‡å¤çš„ä¸ç”¨è®°å½•</span>        <span class="token keyword">let</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// watcherè®°å½•dep</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// æ­¤æ—¶è®©depè®°å½•watcher</span>            dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç”¨æˆ·ä¼ å…¥çš„getæ–¹æ³• </span>        <span class="token comment" spellcheck="true">// console.log(this)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç”¨æˆ·getå‡½æ•°çš„è¿”å›å€¼ </span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// å¦‚æœå†æ¬¡å–å€¼,åˆ™state.jsé‡Œçš„åˆ¤æ–­ä¼šfalse,ä¸ä¼šå†æ¬¡è§¦å‘this.get</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ›´æ–°</span>    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// Dep.target = this // å½“å‰çš„watcherç»™dep</span>        <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¼šä»vmä¸Šå–å€¼</span>        <span class="token comment" spellcheck="true">// console.log(value)</span>        <span class="token comment" spellcheck="true">// console.log(this.getter)</span>        <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// Dep.target = null // æ¸²æŸ“å®Œæ¸…ç©º</span>        <span class="token keyword">return</span> value <span class="token comment" spellcheck="true">// è®¡ç®—å±æ€§æ‰§è¡Œçš„æ˜¯ç”¨æˆ·ä¼ å…¥çš„getter,è¿”å›å€¼å°±æ˜¯è®¡ç®—å±æ€§çš„å€¼</span>    <span class="token punctuation">}</span>    <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length        <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// dep.depend()</span>            <span class="token comment" spellcheck="true">// depä¾èµ–æ¸²æŸ“watcherå’Œè®¡ç®—å±æ€§watcher,éƒ½éœ€è¦æ”¶é›†</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®©è®¡ç®—å±æ€§watcherä¹Ÿæ”¶é›†æ¸²æŸ“watcher</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯è®¡ç®—å±æ€§,ä¾èµ–çš„å€¼å˜åŒ–äº†,ä¼šè§¦å‘è®¡ç®—å±æ€§watcherçš„updateæ–¹æ³•</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">// æ ‡è®°ä¸ºtrue,å¯ä»¥æ›´æ–°(state.js)</span>            <span class="token comment" spellcheck="true">// console.log(1) </span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªæ•°æ®,åˆ™åº”è¯¥ç”¨é˜Ÿåˆ—è®°å½•,åªæ›´æ–°æœ€åä¸€æ¬¡</span>        <span class="token function">queryWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æš‚å­˜watcher</span>        <span class="token comment" spellcheck="true">// this.get() // é‡æ–°æ¸²æŸ“</span>    <span class="token punctuation">}</span>    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value        <span class="token comment" spellcheck="true">// æ­¤æ—¶æœ€ç»ˆçš„vm.nameå·²ç»èµ‹å€¼å®Œæ¯•(ls5),æ›´æ–°æ—¶å–å€¼,å°±æ˜¯æœ€åçš„è¿™ä¸ªå€¼</span>        <span class="token keyword">let</span> newVal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// watchè°ƒç”¨ç”¨æˆ·å®šä¹‰çš„å¤„ç†é€»è¾‘</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> newVal<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// éœ€è¦ç»™æ¯ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ªdep,ç›®çš„æ˜¯æ”¶é›†watcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªç»„ä»¶ä¸­,æœ‰å¤šä¸ªå±æ€§(nä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªè§†å›¾) nä¸ªdepå¯¹åº”ä¸€ä¸ªwatcher</span><span class="token comment" spellcheck="true">// ä¸€ä¸ªå±æ€§,å¯¹åº”å¤šä¸ªç»„ä»¶,ä¸€ä¸ªdepå¯¹åº”å¤šä¸ªwatcher</span><span class="token comment" spellcheck="true">// å¤šå¯¹å¤š</span><span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// æºç æ˜¯ç”¨setæ¥å»é‡</span><span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨å¯¹è±¡æ¥å»é‡</span><span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// é˜²æŠ–</span><span class="token comment" spellcheck="true">// ç­‰å¾…ä¸€æ®µæ—¶é—´åè¿›å…¥è¯¥æ–¹æ³•,ä¸€æ¬¡æ€§æ›´æ–°</span><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> flushQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// åˆ·æ–°è¿‡ç¨‹ä¸­,å¯èƒ½ä¹Ÿæœ‰æ–°çš„watcher,å¯ä»¥é‡æ–°æ”¾åˆ°queue</span>    queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    pending <span class="token operator">=</span> <span class="token boolean">false</span>    flushQueue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>q <span class="token operator">=</span><span class="token operator">></span> q<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">queryWatcher</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ²¡æœ‰é‡å¤,ç›´æ¥æ”¾å…¥é˜Ÿåˆ—</span>        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>        has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token comment" spellcheck="true">// console.log(queue)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ä¸ç®¡updateå¤šå°‘æ¬¡,æœ€ç»ˆåªæ‰§è¡Œä¸€è½®åˆ·æ–°æ“ä½œ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pending <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç”¨æˆ·æ›´æ–°é˜Ÿåˆ—</span><span class="token keyword">let</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">// å¼‚æ­¥æ‰¹å¤„ç†</span><span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> cbs <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    waiting <span class="token operator">=</span> <span class="token boolean">false</span>    callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    cbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>cb <span class="token operator">=</span><span class="token operator">></span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> timerFunc<span class="token comment" spellcheck="true">// æœ‰bug,promiseæ‹¿åˆ°çš„è¿˜æ˜¯è€çš„</span><span class="token comment" spellcheck="true">// if (Promise) { // åˆ¤æ–­æœ‰æ²¡æœ‰promise(å¯ä»¥è½¬å­—ç¬¦ä¸²çœ‹æ˜¯ä¸æ˜¯åŸç”Ÿpromise)</span><span class="token comment" spellcheck="true">//     // console.log('Promise')</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         Promise.resolve().then(flushCallbacks)</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// } else if (MutationObserver) {</span><span class="token comment" spellcheck="true">//     // è¿™é‡Œä¼ å…¥çš„å›è°ƒæ˜¯å¼‚æ­¥çš„</span><span class="token comment" spellcheck="true">//     let observe = new MutationObserver(flushCallbacks)</span><span class="token comment" spellcheck="true">//     // ç›‘æ§æ–‡æœ¬å˜åŒ–</span><span class="token comment" spellcheck="true">//     let textNode = document.createTextNode(1)</span><span class="token comment" spellcheck="true">//     observe.observe(textNode, {</span><span class="token comment" spellcheck="true">//         characterData: true,</span><span class="token comment" spellcheck="true">//     })</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         textNode.textContent = 2</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// } else if (setImmediate) {</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         setImmediate(flushCallbacks)</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// } else {</span><span class="token comment" spellcheck="true">//     timerFunc = () => {</span><span class="token comment" spellcheck="true">//         setTimeout(flushCallbacks)</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">// }</span><span class="token comment" spellcheck="true">// æš´éœ²ç»™å¤–éƒ¨çš„æ›´æ–°æ–¹æ³•</span><span class="token comment" spellcheck="true">// vueé‡Œçš„nextTickä¸æ˜¯ç”¨api(å®šæ—¶å™¨...),è€Œæ˜¯é‡‡ç”¨ä¼˜é›…é™çº§çš„æ–¹å¼</span><span class="token comment" spellcheck="true">// é™çº§: promise(ieä¸å…¼å®¹) => MutationObserver(h5çš„api) => setImmediate(ieä¸“ç”¨) => setTimeout</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å…ˆç”¨æˆ·è¿˜æ˜¯å…ˆå†…éƒ¨æ›´æ–° ? => çœ‹ç”¨æˆ·æ›´æ–°æ–¹æ³•åœ¨å‰,è¿˜æ˜¯æ•°æ®å˜åŒ–åœ¨å‰</span>    <span class="token comment" spellcheck="true">// å®šæ—¶å™¨è€—æ€§èƒ½,promiseæ‰§è¡Œæ¯”å®šæ—¶å™¨å¿«</span>    callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// timerFunc(flushCallbacks) </span>        <span class="token comment" spellcheck="true">// timerFunc() // æ‰§è¡Œçš„å°±æ˜¯flushCallbacks</span>        waiting <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Watcher</code></pre><h2 id="æµ‹è¯•-10"><a href="#æµ‹è¯•-10" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å¯ä»¥ç»™æ¨¡æ¿ä¸­çš„å±æ€§æ·»åŠ ä¸€ä¸ªæ”¶é›†å™¨ dep --></span>    <span class="token comment" spellcheck="true">&lt;!-- é¡µé¢æ¸²æŸ“æ—¶ å°†æ¸²æŸ“é€»è¾‘å°è£…åˆ°watcherä¸­, vm._update(vm.render()) --></span>    <span class="token comment" spellcheck="true">&lt;!-- è®©depè®°ä½è¿™ä¸ªwatcher,æ•°æ®å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„watcherè¿›è¡Œæ›´æ–° --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¤šä¸ª{{name}},ä¼šæœ‰é‡å¤watcher,è¦é¿å… --></span>    <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæ¸²æŸ“çš„elé‡Œæœ‰æ³¨é‡Š,ä¼šå¡æ­»!!!! --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        {{fullname}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>            {{firstname}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- &lt;script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.js">&lt;/script> --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                firstname<span class="token punctuation">:</span> <span class="token string">'ä¿Š'</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token function">fullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstname <span class="token operator">+</span> <span class="token string">'lastname'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// å†™æ³•3 </span>            <span class="token comment" spellcheck="true">// methods: {</span>            <span class="token comment" spellcheck="true">//     fn(newVal, oldVal) {</span>            <span class="token comment" spellcheck="true">//         console.log(newVal, oldVal);</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// },</span>            <span class="token comment" spellcheck="true">// å†™æ³•1,ç›´æ¥å†™å‡½æ•°</span>            watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// firstname(newVal, oldVal) {</span>                <span class="token comment" spellcheck="true">//     console.log(newVal, oldVal);</span>                <span class="token comment" spellcheck="true">// }</span>                <span class="token comment" spellcheck="true">// å†™æ³•2: æ•°ç»„å†…å‡½æ•°ä¾æ¬¡æ‰§è¡Œ</span>                <span class="token comment" spellcheck="true">// firstname: [</span>                <span class="token comment" spellcheck="true">//     // 'fn', // å†™æ³•3,è°ƒç”¨methodé‡Œå®šä¹‰çš„æ–¹æ³•</span>                <span class="token comment" spellcheck="true">//     (newVal, oldVal) => {</span>                <span class="token comment" spellcheck="true">//     },</span>                <span class="token comment" spellcheck="true">//     (newVal, oldVal) => {</span>                <span class="token comment" spellcheck="true">//     }</span>                <span class="token comment" spellcheck="true">// ]</span>                <span class="token comment" spellcheck="true">// firstname: 'fn', // å†™æ³•3,è°ƒç”¨methodé‡Œå®šä¹‰çš„æ–¹æ³• </span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å†™æ³•ä¸åŒ,ä½†æ˜¯åº•å±‚éƒ½æ˜¯$watch</span>        <span class="token comment" spellcheck="true">// å†™æ³•4</span>        <span class="token comment" spellcheck="true">// vm.$watch(() => vm.firstname, (newVal, oldVal) => {</span>        <span class="token comment" spellcheck="true">//     // vm.$watch("firstname", (newVal, oldVal) => {</span>        <span class="token comment" spellcheck="true">//     console.log(newVal, oldVal);</span>        <span class="token comment" spellcheck="true">// })</span>        vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> vm<span class="token punctuation">.</span>fullname<span class="token punctuation">,</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            vm<span class="token punctuation">.</span>firstname <span class="token operator">=</span> <span class="token string">'123'</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_30.png" alt="img_30.png"></p><h1 id="å®ç°åŸºæœ¬diffç®—æ³•"><a href="#å®ç°åŸºæœ¬diffç®—æ³•" class="headerlink" title="å®ç°åŸºæœ¬diffç®—æ³•"></a>å®ç°åŸºæœ¬diffç®—æ³•</h1><p><img src="img_31.png" alt="è€èŠ‚ç‚¹æ²¡æœ‰,æ–°èŠ‚ç‚¹æœ‰"><br><img src="5C1676119360637.png" alt="è€èŠ‚ç‚¹æœ‰,æ–°èŠ‚ç‚¹æ²¡æœ‰"><br><img src="img_32.png" alt="äº¤å‰æ¯”è¾ƒ"><br><img src="img_33.png" alt="äº¤å‰æ¯”è¾ƒ"><br><img src="img_34.png" alt="äº¤å‰æ¯”è¾ƒè§£å†³çš„ç‰¹æ®Šæƒ…å†µ"></p><h2 id="vueçš„indexé—®é¢˜"><a href="#vueçš„indexé—®é¢˜" class="headerlink" title="vueçš„indexé—®é¢˜"></a>vueçš„indexé—®é¢˜</h2><p><img src="img_37.png" alt="img_37.png"><br><img src="img_36.png" alt="img_36.png"><br><img src="img_35.png" alt="img_35.png"><br><img src="img_38.png" alt="img_38.png"><br><img src="img_39.png" alt="img_39.png"><br><img src="img_40.png" alt="keyåªèƒ½æ˜¯numberæˆ–string"><br><img src="img_41.png" alt="img_41.png"><br><img src="img_42.png" alt="ä¹±åºæ¯”è¾ƒ-æ˜ å°„è¡¨"><br><img src="img_43.png" alt="img_43.png"></p><h2 id="src-index-js"><a href="#src-index-js" class="headerlink" title="src/index.js"></a>src/index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> compileToFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./compile"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./init"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initLifeCycle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lifecycle"</span><span class="token keyword">import</span> Watcher<span class="token punctuation">,</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observe/watcher"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initStateMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createElm<span class="token punctuation">,</span> patch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./vdom/patch"</span><span class="token comment" spellcheck="true">// classä¼šæŠŠæ‰€æœ‰æ–¹æ³•è€¦åˆåœ¨ä¸€èµ·</span><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// optionså°±æ˜¯ç”¨æˆ·æä¾›çš„é€‰é¡¹ </span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆå§‹åŒ– </span>    <span class="token comment" spellcheck="true">// if (options.el) this.$mount(options.el) // æŒ‚è½½</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// debugger</span><span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç»„ä»¶æ¸²æŸ“</span><span class="token function">initStateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// test</span><span class="token comment" spellcheck="true">// let render1 = compileToFunction(`&lt;li key="b" b='1' style="color: red">{{name}}&lt;/li>`)</span><span class="token comment" spellcheck="true">// let render1 = compileToFunction(`&lt;li key="b" b='1' style="color: red">&lt;/li>`)</span><span class="token comment" spellcheck="true">// let render1 = compileToFunction(`&lt;ul style="color: red"></span><span class="token comment" spellcheck="true">//     &lt;li key="a">a&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="b">b&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="c">c&lt;/li></span><span class="token comment" spellcheck="true">// &lt;/ul>`)</span><span class="token comment" spellcheck="true">// let render1 = compileToFunction(`&lt;ul style="color: red"></span><span class="token comment" spellcheck="true">//     &lt;li key="a">a&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="b">b&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="c">c&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="d">d&lt;/li></span><span class="token comment" spellcheck="true">// &lt;/ul>`)</span><span class="token keyword">let</span> render1 <span class="token operator">=</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;ul style="color: red">    &lt;li key="a">a&lt;/li>    &lt;li key="b">b&lt;/li>    &lt;li key="c">c&lt;/li>      &lt;li key="d">d&lt;/li>&lt;/ul>`</span></span><span class="token punctuation">)</span><span class="token keyword">let</span> vm1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"zf"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">let</span> prevVnode <span class="token operator">=</span> render1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm1<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// console.log(prevVnode);</span><span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">createElm</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">)</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;span key="a" style="color: red;background: blue">{{name}}&lt;/span>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;li key="a" style="color: red;background: blue">{{name}}&lt;/li>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;li key="b" a='1' style="color: red;background: blue">{{name}}&lt;/li>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;li key="b" a='1' style="color: red;background: blue">&lt;/li>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;li key="b" a='1' style="color: red;background: blue">&lt;div>1&lt;span>2&lt;/span>&lt;/div>{{name}}&lt;/li>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;ul style="color: red;background: blue"></span><span class="token comment" spellcheck="true">//     &lt;li key="a">a&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="b">b&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="c">c&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="d">d&lt;/li></span><span class="token comment" spellcheck="true">// &lt;/ul>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;ul style="color: red;background: blue"></span><span class="token comment" spellcheck="true">//     &lt;li key="a">a&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="b">b&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="c">c&lt;/li> </span><span class="token comment" spellcheck="true">// &lt;/ul>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;ul style="color: red;background: blue"></span><span class="token comment" spellcheck="true">//     &lt;li key="d">d&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="a">a&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="b">b&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="c">c&lt;/li> </span><span class="token comment" spellcheck="true">// &lt;/ul>`)</span><span class="token comment" spellcheck="true">// let render2 = compileToFunction(`&lt;ul style="color: red;background: blue"></span><span class="token comment" spellcheck="true">//     &lt;li key="d">d&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="c">c&lt;/li> </span><span class="token comment" spellcheck="true">//     &lt;li key="b">b&lt;/li></span><span class="token comment" spellcheck="true">//     &lt;li key="a">a&lt;/li></span><span class="token comment" spellcheck="true">// &lt;/ul>`)</span><span class="token keyword">let</span> render2 <span class="token operator">=</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;ul style="color: red;background: blue">      &lt;li key="b">b&lt;/li>    &lt;li key="m">m&lt;/li>    &lt;li key="a">a&lt;/li>    &lt;li key="p">p&lt;/li>       &lt;li key="c">c&lt;/li>      &lt;li key="q">q&lt;/li>&lt;/ul>`</span></span><span class="token punctuation">)</span><span class="token keyword">let</span> vm2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"zf"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">let</span> nextVnode <span class="token operator">=</span> render2<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm2<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// console.log(nextVnode);</span><span class="token keyword">let</span> newEl <span class="token operator">=</span> <span class="token function">createElm</span><span class="token punctuation">(</span>nextVnode<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// æš´åŠ›æ›¿æ¢, å¦‚æœç”¨æˆ·ä¸€ç›´åˆ›å»ºå¹¶æ“ä½œdom, ä¼šå¾ˆè€—æ€§èƒ½</span><span class="token comment" spellcheck="true">// diffç®—æ³•å¹³çº§è¿›è¡Œæ¯”è¾ƒ,å¦‚æœç›¸åŒå°±ä¸ä¿®æ”¹</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// el.parentNode.replaceChild(newEl, el)</span>    <span class="token function">patch</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">,</span> nextVnode<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Vue</code></pre><h2 id="vdom-patch-js"><a href="#vdom-patch-js" class="headerlink" title="vdom/patch.js"></a>vdom/patch.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> isSameVnode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"."</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> vnode    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ ‡ç­¾</span>        <span class="token comment" spellcheck="true">// åˆ›å»ºçœŸå®èŠ‚ç‚¹</span>        <span class="token comment" spellcheck="true">// å°†çœŸå®èŠ‚ç‚¹æŒ‚è½½åˆ°è™šæ‹ŸèŠ‚ç‚¹,åç»­ä¿®æ”¹å°±å¯ä»¥é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹ç›´æ¥æ‰¾åˆ°çœŸå®èŠ‚ç‚¹</span>        vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>        <span class="token function">patchProps</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ›´æ–°å±æ€§ xxx=xxx</span>        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// debugger</span>            <span class="token comment" spellcheck="true">// console.log(child)</span>            vnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(vnode) æ–‡æœ¬è™šæ‹ŸèŠ‚ç‚¹çš„tagæ˜¯undefined</span>        vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token comment" spellcheck="true">// console.log(vnode.el)</span>    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patchProps</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è€çš„å±æ€§ä¸­æœ‰,æ–°çš„æ²¡æœ‰,è¦åˆ é™¤è€çš„</span>    <span class="token comment" spellcheck="true">// style</span>    <span class="token keyword">let</span> oldStyles <span class="token operator">=</span> oldProps<span class="token punctuation">.</span>style <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">let</span> newStyles <span class="token operator">=</span> props<span class="token punctuation">.</span>style <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> oldStyles<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newStyles<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// attributes</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> oldProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            el<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ–°çš„è¦†ç›–è€çš„</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'style'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯styleæ ·å¼å±æ€§</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> sytleName <span class="token keyword">in</span> props<span class="token punctuation">.</span>style<span class="token punctuation">)</span> <span class="token punctuation">{</span>                el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>sytleName<span class="token punctuation">]</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>style<span class="token punctuation">[</span>sytleName<span class="token punctuation">]</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ—¶æ˜¯ä¼ ä¸€ä¸ªçœŸå®dom,ä¸€ä¸ªè™šæ‹Ÿdom</span>    <span class="token keyword">const</span> isRealElement <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>nodeType    <span class="token comment" spellcheck="true">// åˆæ¬¡æ¸²æŸ“</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> elm <span class="token operator">=</span> oldVNode <span class="token comment" spellcheck="true">// æ‹¿åˆ°çœŸå®å…ƒç´ </span>        <span class="token keyword">const</span> parentElm <span class="token operator">=</span> elm<span class="token punctuation">.</span>parentNode <span class="token comment" spellcheck="true">// æ‹¿åˆ°çˆ¶å…ƒç´ </span>        <span class="token keyword">let</span> newElm <span class="token operator">=</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// console.log(newElm)</span>        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newElm<span class="token punctuation">,</span> elm<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// å…ˆæ’å…¥åˆ°å½“å‰èŠ‚ç‚¹çš„åé¢(æˆä¸ºå…„å¼ŸèŠ‚ç‚¹)</span>        parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆ é™¤è€èŠ‚ç‚¹ </span>        <span class="token keyword">return</span> newElm    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ›´æ–°æ—¶æ˜¯ä¼ ä¸¤ä¸ªè™šæ‹Ÿdom</span>        <span class="token comment" spellcheck="true">// diffç®—æ³•</span>        <span class="token comment" spellcheck="true">// console.log(oldVNode, vnode);</span>        <span class="token comment" spellcheck="true">// 1,ä¸¤ä¸ªèŠ‚ç‚¹ä¸æ˜¯åŒä¸€ä¸ª(keyæˆ–æ ‡ç­¾tagä¸åŒ),åˆ™ç›´æ¥æ›´æ–°</span>        <span class="token comment" spellcheck="true">// 2,å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹æ˜¯åŒä¸€ä¸ª,åˆ™æ¯”è¾ƒå…¶å±æ€§æ˜¯å¦æœ‰å·®å¼‚(å¤ç”¨è€çš„,æ›´æ–°å±æ€§)</span>        <span class="token comment" spellcheck="true">// 3,èŠ‚ç‚¹æ¯”è¾ƒå®Œæ¯•,å°±æ¯”è¾ƒå„¿å­</span>        <span class="token comment" spellcheck="true">// console.log(isSameVnode(oldVNode, vnode));</span>        <span class="token comment" spellcheck="true">// æ¯”è¾ƒçš„æ–¹æ³•</span>        <span class="token keyword">return</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(!isSameVnode(oldVNode, vnode));</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isSameVnode</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç”¨è€èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹è¿›è¡Œæ›¿æ¢</span>        <span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>        oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>        <span class="token keyword">return</span> el    <span class="token punctuation">}</span>    <span class="token keyword">let</span> el <span class="token operator">=</span> vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>el <span class="token comment" spellcheck="true">// å¤ç”¨è€èŠ‚ç‚¹çš„å…ƒç´     </span>    <span class="token comment" spellcheck="true">// æ–‡æœ¬çš„æƒ…å†µ,åˆ™æ¯”è¾ƒæ–‡æœ¬å†…å®¹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldVNode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>            el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vnode<span class="token punctuation">.</span>text <span class="token comment" spellcheck="true">// æ–°çš„æ–‡æœ¬,è¦†ç›–è€æ–‡æœ¬</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// æ–‡æœ¬çš„tagæ˜¯undefined</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ ‡ç­¾,éœ€è¦å¯¹æ¯”æ ‡ç­¾çš„å±æ€§</span>    <span class="token comment" spellcheck="true">// console.log(1);</span>    <span class="token function">patchProps</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldVNode<span class="token punctuation">.</span>data<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// æ¯”è¾ƒå„¿å­èŠ‚ç‚¹ (1,åŒæ–¹éƒ½æœ‰children;2,åªæœ‰ä¸€æ–¹æœ‰children)</span>    <span class="token keyword">let</span> oldChildren <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">let</span> newChildren <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(oldChildren, newChildren);</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(el);</span>        <span class="token comment" spellcheck="true">// å®Œæ•´diff,éœ€è¦æ¯”è¾ƒä¸¤ä¸ªäººçš„children</span>        <span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldChildren<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ›´æ–°ä¸¤ä¸ªäººçš„children</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ²¡æœ‰è€çš„,æœ‰æ–°çš„</span>        <span class="token comment" spellcheck="true">// ç›´æ¥æ’å…¥</span>        <span class="token function">mountChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ²¡æœ‰æ–°çš„,è€çš„æœ‰,è¦åˆ é™¤</span>        <span class="token comment" spellcheck="true">// unmountChildren(el, oldChildren)</span>        el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment" spellcheck="true">// å¯ä»¥å¾ªç¯åˆ é™¤,è¿™é‡Œåªæ˜¯å›¾çœäº‹</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> el<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">mountChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> child <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldChildren<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(el, newChildren, oldChildren);</span>    <span class="token comment" spellcheck="true">// æ¯”è¾ƒæ—¶,ä¸ºäº†æé«˜æ€§èƒ½,éœ€è¦ä¼˜åŒ–(push,shift,pop,unshift,reserve,sort)</span>    <span class="token comment" spellcheck="true">// vue2ä½¿ç”¨åŒæŒ‡é’ˆçš„æ–¹å¼æ¯”è¾ƒä¸¤ä¸ªèŠ‚ç‚¹,(ä¼˜åŒ–ç‰¹æ®Šæƒ…å†µ: )åªè¦å¤´æŒ‡é’ˆè¶…è¿‡å°¾æŒ‡é’ˆæˆ–è€…é‡åˆ,å°±æ‰§è¡Œæ›´æ–°</span>    <span class="token keyword">let</span> oldStartIndex <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">let</span> newStartIndex <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">let</span> oldEndIndex <span class="token operator">=</span> oldChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>    <span class="token keyword">let</span> newEndIndex <span class="token operator">=</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>    <span class="token comment" spellcheck="true">// console.log(oldEndIndex, newEndIndex);</span>    <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEndIndex<span class="token punctuation">]</span>    <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEndIndex<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">// ä¸ºäº†é˜²æ­¢ç©ºæ ¼å¹²æ‰°,å°±åœ¨parseé‡Œå»æ‰ç©ºæ ¼</span>    <span class="token comment" spellcheck="true">// console.log(oldStartVnode, newStartVnode, oldEndVnode, newEndVnode);</span>    <span class="token comment" spellcheck="true">// ç‰¹æ®Šæƒ…å†µ: åªè¦æœ€å/æˆ–æœ€å‰çš„å‡ ä¸ªèŠ‚ç‚¹ä¸åŒ</span>    <span class="token keyword">let</span> lastEqIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">// è§£å†³bug(insertBefore)</span>    <span class="token keyword">let</span> lastEqVnode <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token comment" spellcheck="true">// æ ¹æ®è€çš„åˆ—è¡¨åšæ˜ å°„å…³ç³»,ç”¨æ–°çš„å»æ‰¾,æ‰¾åˆ°å°±ç§»åŠ¨,æ‰¾ä¸åˆ°å°±æ·»åŠ ,æœ€åå¤šä½™çš„åˆ é™¤</span>    <span class="token keyword">function</span> <span class="token function">makeIndexByKey</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span>        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            map<span class="token punctuation">[</span>child<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> index        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> map    <span class="token punctuation">}</span>    <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token function">makeIndexByKey</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex <span class="token operator">&lt;=</span> newEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ’é™¤ä¸ºundefinedçš„æƒ…å†µ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldStartVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>            oldStartVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldEndVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>            oldEndVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// æœ‰ä¸€æ–¹ å¤´æŒ‡é’ˆ > å°¾éƒ¨æŒ‡é’ˆ,åˆ™åœæ­¢å¾ªç¯</span>        <span class="token comment" spellcheck="true">// ä»å¤´å‘åæ¯”è¾ƒ</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// é€’å½’æ¯”è¾ƒ</span>            <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>            oldStartVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// å‘åç§»åŠ¨</span>            newStartVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">// æ¯”è¾ƒå¼€å¤´èŠ‚ç‚¹</span>            <span class="token comment" spellcheck="true">// console.log(oldStartIndex, oldEndIndex, newStartIndex, newEndIndex);</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// ä»å°¾å‘å‰æ¯”è¾ƒ</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// æœ€åä¸€æ¬¡ç›¸åŒå--,åˆ™å­˜å…¥çš„æ˜¯ä¸ç›¸åŒçš„å…ƒç´ </span>            lastEqVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>lastEqIndex<span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">// console.log(lastEqIndex, lastEqVnode);</span>            oldEndVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// å‘å‰ç§»åŠ¨</span>            newEndVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span>            lastEqIndex <span class="token operator">=</span> oldEndIndex        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// äº¤å‰æ¯”è¾ƒ</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è€çš„å°¾ ç§»åˆ° è€çš„å¤´ (insertBeforeæœ‰ç§»åŠ¨æ€§,ä¼šæŠŠæ—§çš„ç§»åŠ¨èµ°)</span>            el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// è€çš„è¢«å¤ç”¨,æ‰€ä»¥è¦æ›¿æ¢è€çš„</span>            <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>            oldEndVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span>            newStartVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è€çš„å¤´ ç§»åˆ° è€çš„æ–°å°¾ (insertBeforeæœ‰ç§»åŠ¨æ€§,ä¼šæŠŠæ—§çš„ç§»åŠ¨èµ°)</span>            el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// è€çš„è¢«å¤ç”¨,æ‰€ä»¥è¦æ›¿æ¢è€çš„</span>            <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span>            oldStartVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span>            newEndVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ä¹±åºæ¯”å¯¹</span>            <span class="token comment" spellcheck="true">// å¦‚æœæ²¡æœ‰keyå°±ç›´æ¥æ›¿æ¢(æ²¡åŠæ³•æ¯”è¾ƒ)</span>            <span class="token keyword">let</span> moveIndex <span class="token operator">=</span> map<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// å¦‚æœæ‹¿åˆ°,åˆ™è¯´æ˜æ˜¯è¦ç§»åŠ¨çš„ç´¢å¼•</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>moveIndex <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> moveVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>moveIndex<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// æ‰¾çš„å¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹,å¤ç”¨</span>                el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>moveVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>                oldChildren<span class="token punctuation">[</span>moveIndex<span class="token punctuation">]</span> <span class="token operator">=</span> undefined <span class="token comment" spellcheck="true">// è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹å·²ç»ç§»åŠ¨èµ°äº†(å¦‚æœæ˜¯åˆ é™¤ä¼šæŠ¥é”™)</span>                <span class="token function">patchVnode</span><span class="token punctuation">(</span>moveVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ¯”è¾ƒå±æ€§å’Œå­èŠ‚ç‚¹</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// æ‰¾ä¸åˆ°å°±åˆ›å»ºæ–°çš„,ç›´æ¥æ’å…¥åˆ°oldStartVnodeå‰ </span>                el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>            <span class="token punctuation">}</span>            newStartVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(newStartIndex, newEndIndex);</span>    <span class="token comment" spellcheck="true">// ç»è¿‡ä¸Šé¢çš„æ¯”è¾ƒå,æŒ‡é’ˆéƒ½ç§»åˆ°äº†åŒæ–¹æœ€åä¸€ä¸ªç›¸åŒçš„èŠ‚ç‚¹çš„ä½ç½®,å‰©ä¸‹çš„å°±æ˜¯oldæˆ–newç‹¬æœ‰çš„</span>    <span class="token comment" spellcheck="true">// æ–°çš„å¤šä½™çš„æ’å…¥</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIndex <span class="token operator">&lt;=</span> newEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> newStartIndex<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> newEndIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> childEl <span class="token operator">=</span> <span class="token function">createElm</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// å¯èƒ½æ˜¯å‘å‰æˆ–å‘åè¿½åŠ </span>            <span class="token comment" spellcheck="true">// æ ¹æ®åä¸€ä½æœ‰æ— èŠ‚ç‚¹æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å‘åè¿½åŠ </span>            <span class="token comment" spellcheck="true">// Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.</span>            <span class="token comment" spellcheck="true">// let anchor = newChildren[newEndIndex + 1] ? newChildren[newEndIndex + 1].el : null // è·å–ä¸‹ä¸€ä¸ªå…ƒç´ </span>            <span class="token keyword">let</span> anchor <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEndIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> lastEqVnode<span class="token punctuation">.</span>el <span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token comment" spellcheck="true">// è·å–ä¸‹ä¸€ä¸ªå…ƒç´ </span>            <span class="token comment" spellcheck="true">// el.appendChild(childEl) // æ·»åŠ èŠ‚ç‚¹</span>            <span class="token comment" spellcheck="true">// console.log(childEl, anchor);</span>            el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>childEl<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// anchorä¸ºnull,åˆ™è®¤ä¸ºæ˜¯appendChild</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ—§çš„å¤šä½™çš„åˆ é™¤</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIndex<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// æ’é™¤æ˜¯undefinedçš„æƒ…å†µ,æœ‰å€¼æ‰åˆ é™¤</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> childEl <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>el                el<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>childEl<span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æµ‹è¯•-11"><a href="#æµ‹è¯•-11" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><img src="img_44.png" alt="img_44.png"><br><img src="img_45.png" alt="img_45.png"></p><h1 id="å®ç°ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹"><a href="#å®ç°ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="å®ç°ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹"></a>å®ç°ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹</h1><p><img src="img_46.png" alt="img_46.png"><br><img src="img_48.png" alt="img_48.png"></p><h2 id="ä¿®æ”¹lifeCycle-js"><a href="#ä¿®æ”¹lifeCycle-js" class="headerlink" title="ä¿®æ”¹lifeCycle.js"></a>ä¿®æ”¹lifeCycle.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è™šæ‹Ÿdomè½¬çœŸå®dom</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_update <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el        <span class="token comment" spellcheck="true">// console.log('update', vnode)</span>        <span class="token comment" spellcheck="true">// åˆ¤æ–­æ˜¯å¦æ˜¯æ›´æ–°æ“ä½œ</span>        <span class="token keyword">const</span> prevVnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode        <span class="token comment" spellcheck="true">// æŠŠç»„ä»¶ç¬¬ä¸€æ¬¡äº§ç”Ÿçš„è™šæ‹ŸèŠ‚ç‚¹ä¿å­˜åˆ°vnodeä¸Š</span>        vm<span class="token punctuation">.</span>_vnode <span class="token operator">=</span> vnode        <span class="token keyword">if</span> <span class="token punctuation">(</span>prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ä¹‹å‰æ¸²æŸ“è¿‡äº†</span>            <span class="token comment" spellcheck="true">// diffæ›´æ–°</span>            <span class="token function">patch</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// åˆå§‹åŒ– </span>            vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span></code></pre><h2 id="ä¿®æ”¹init-js"><a href="#ä¿®æ”¹init-js" class="headerlink" title="ä¿®æ”¹init.js"></a>ä¿®æ”¹init.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_init <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// debugger</span>        <span class="token comment" spellcheck="true">// å°†ç”¨æˆ·ä¼ å…¥çš„optionsæŒ‚è½½åˆ°vueå¯¹è±¡ä¸Š</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment" spellcheck="true">// åŸå‹ä¸­çš„thisè¡¨ç¤ºå®ä¾‹</span>        <span class="token comment" spellcheck="true">// vm.$options = options // $xxx è¡¨ç¤ºæ˜¯vueçš„å±æ€§(åœ¨(vueé‡Œ,å¦‚æœdataé‡Œçš„å˜é‡åæ˜¯$å¼€å¤´,vueæ˜¯æ‹¿ä¸åˆ°çš„)</span>        vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>options<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// $xxx è¡¨ç¤ºæ˜¯vueçš„å±æ€§(åœ¨(vueé‡Œ,å¦‚æœdataé‡Œçš„å˜é‡åæ˜¯$å¼€å¤´,vueæ˜¯æ‹¿ä¸åˆ°çš„)</span>        <span class="token comment" spellcheck="true">// åˆå§‹åŒ–çŠ¶æ€</span>        <span class="token comment" spellcheck="true">// console.log(vm.$options)</span>        <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// callHook(vm, 'created')     </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>            vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span></code></pre><h2 id="ä¿®æ”¹src-index-js"><a href="#ä¿®æ”¹src-index-js" class="headerlink" title="ä¿®æ”¹src/index.js"></a>ä¿®æ”¹src/index.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> compileToFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./compile"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initGlobalAPI <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./globalApi"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./init"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initLifeCycle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lifecycle"</span><span class="token keyword">import</span> Watcher<span class="token punctuation">,</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observe/watcher"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initStateMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createElm<span class="token punctuation">,</span> patch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./vdom/patch"</span><span class="token comment" spellcheck="true">// classä¼šæŠŠæ‰€æœ‰æ–¹æ³•è€¦åˆåœ¨ä¸€èµ·</span><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// optionså°±æ˜¯ç”¨æˆ·æä¾›çš„é€‰é¡¹ </span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆå§‹åŒ– </span>    <span class="token comment" spellcheck="true">// if (options.el) this.$mount(options.el) // æŒ‚è½½</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// debugger</span><span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token function">initLifeCycle</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç»„ä»¶æ¸²æŸ“</span><span class="token function">initGlobalAPI</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token function">initStateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> Vue</code></pre><h2 id="utils-js"><a href="#utils-js" class="headerlink" title="utils.js"></a>utils.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> strats <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">const</span> LIFECYCLE <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'beforeCreate'</span><span class="token punctuation">,</span>    <span class="token string">'create'</span><span class="token punctuation">]</span>LIFECYCLE<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>hook <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    strats<span class="token punctuation">[</span>hook<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœå„¿å­æœ‰,çˆ¶äº²æœ‰,å°±æ‹¼åœ¨ä¸€èµ·</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// å„¿å­æœ‰,çˆ¶äº²æ²¡æœ‰,åˆ™å°†å„¿å­åŒ…è£…ä¸ºæ•°ç»„</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> p <span class="token comment" spellcheck="true">// å¦‚æœå„¿å­æ²¡æœ‰,åˆ™ç”¨çˆ¶äº²å³å¯</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// è§£å†³å…¨å±€å’Œå±€éƒ¨å£°æ˜åŒä¸€ç»„ä»¶çš„æƒ…å†µ </span>strats<span class="token punctuation">.</span>components <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>parentValue<span class="token punctuation">,</span> childValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parentValue<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>childValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> childValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è¿”å›çš„æ˜¯æ„é€ çš„å¯¹è±¡,å¯ä»¥æ‹¿åˆ°çˆ¶äº²èº«ä¸Šçš„å±æ€§,å¹¶ä¸”å°†å„¿å­çš„éƒ½æ‹·è´åˆ°è‡ªå·±èº«ä¸Š</span>            res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> childValue<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> res<span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å–è€çš„</span>        <span class="token function">margeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">margeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">margeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç”¨ç­–ç•¥æ¨¡å¼å‡å°‘if/else</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>strats<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> strats<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ä¸åœ¨ç­–ç•¥ä¸­,åˆ™ä»¥å„¿å­ä¸ºä¸»</span>            options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> p<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> options<span class="token punctuation">}</span></code></pre><h2 id="ä¿®æ”¹init-js-1"><a href="#ä¿®æ”¹init-js-1" class="headerlink" title="ä¿®æ”¹init.js"></a>ä¿®æ”¹init.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> initState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./state"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> compileToFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./compile"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mountComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lifecycle"</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./utils"</span><span class="token comment" spellcheck="true">// æä¾›ç»™vueæ¥ä½¿ç”¨(æ­¤æ—¶å…¨å±€è¿˜æ²¡æœ‰vueå¯¹è±¡,æ‰€ä»¥æ²¡åŠæ³•ç›´æ¥æŒ‚è½½)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_init <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ......</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// æ¸²æŸ“æ¨¡æ¿çš„æ“ä½œ</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(el)</span>        <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token comment" spellcheck="true">// è·å–elå¯¹åº”çš„dom</span>        el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// console.log(el);</span>        <span class="token keyword">let</span> ops <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å…ˆçœ‹æœ‰æ²¡æœ‰renderå‡½æ•°</span>            <span class="token keyword">let</span> template <span class="token comment" spellcheck="true">// æ²¡æœ‰renderå°±çœ‹çœ‹æœ‰æ²¡æœ‰template</span>            <span class="token comment" spellcheck="true">// å¦‚æœç”¨æˆ·æ²¡æœ‰ä½¿ç”¨äº†renderå‡½æ•°</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ops<span class="token punctuation">.</span>template <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ²¡æœ‰å†™æ¨¡æ¿,ä½†æ˜¯å†™äº†el</span>                <span class="token comment" spellcheck="true">/*                    1ï¼‰innerHTML:                    ä»å¯¹è±¡çš„èµ·å§‹ä½ç½®åˆ°ç»ˆæ­¢ä½ç½®çš„å…¨éƒ¨å†…å®¹,ä¸åŒ…æ‹¬Htmlæ ‡ç­¾ã€‚                    2ï¼‰outerHTML:                    é™¤äº†åŒ…å«innerHTMLçš„å…¨éƒ¨å†…å®¹å¤–, è¿˜åŒ…å«å¯¹è±¡æ ‡ç­¾æœ¬èº«ã€‚                */</span>                template <span class="token operator">=</span> el<span class="token punctuation">.</span>outerHTML  <span class="token comment" spellcheck="true">// outerHTMLåœ¨ç«ç‹ä¸‹å¯èƒ½ä¸å…¼å®¹</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// if (el) {</span>                    <span class="token comment" spellcheck="true">// console.log(el) </span>                    <span class="token comment" spellcheck="true">// å†™äº†template,å°±ç”¨ç”¨æˆ·çš„template</span>                    template <span class="token operator">=</span> ops<span class="token punctuation">.</span>template                <span class="token comment" spellcheck="true">// }</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(template)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘</span>                <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>                ops<span class="token punctuation">.</span>render <span class="token operator">=</span> render            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(ops.render)// æœ€ç»ˆè·å–renderæ–¹æ³•</span>        <span class="token comment" spellcheck="true">// ç»„ä»¶æŒ‚è½½</span>        <span class="token function">mountComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// scriptæ ‡ç­¾å¼•ç”¨çš„vue.global.js,è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨æµè§ˆå™¨è¿è¡Œçš„</span>        <span class="token comment" spellcheck="true">// runtimeæ˜¯ä¸åŒ…å«æ¨¡æ¿ç¼–è¯‘çš„,æ•´ä¸ªç¼–è¯‘æ˜¯æ‰“åŒ…æ—¶é€šè¿‡loaderæ¥è½¬ä¹‰vueæ–‡ä»¶çš„,ç”¨runtimeæ—¶ä¸èƒ½ä½¿ç”¨template</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="globalApi-js"><a href="#globalApi-js" class="headerlink" title="globalApi.js"></a>globalApi.js</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./utils"</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initGlobalAPI</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// Vueæ„é€ å‡½æ•°æŒ‚åˆ°å…¨å±€</span>        _base<span class="token punctuation">:</span> Vue    <span class="token punctuation">}</span>    Vue<span class="token punctuation">.</span>mixin <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>mixin<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> mixin<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token keyword">this</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(Vue.options);</span>    Vue<span class="token punctuation">.</span>extend <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(options);</span>        <span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æœ€ç»ˆä½¿ç”¨ä¸€ä¸ªç»„ä»¶,å°±æ˜¯newä¸€ä¸ªå®ä¾‹</span>            <span class="token comment" spellcheck="true">// console.log(options,Sub.options);</span>            <span class="token comment" spellcheck="true">// options = mergeOptions(Sub.options,options)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é»˜è®¤å¯¹å­ç±»è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span>            <span class="token comment" spellcheck="true">// console.log(this._init,this.$mount);</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// å­ç±»å¯ä»¥æ‰¾åˆ°çˆ¶ç±»åŸå‹ Sub.prototype.__proto__ = Vue.prototype</span>        Sub<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// object.create ä½†æ˜¯æ­¤æ—¶Subçš„æ„é€ å™¨ç”¨çš„æ˜¯çˆ¶ç±»çš„</span>        <span class="token comment" spellcheck="true">// console.log(Vue.prototype, Sub.prototype,Object.create(Vue.prototype));</span>        Sub<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Sub        <span class="token comment" spellcheck="true">// console.log(Sub.prototype.__proto__);</span>        <span class="token comment" spellcheck="true">// Sub.prototype.__proto__ = Vue.prototype</span>        Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¿å­˜ç”¨æˆ·ä¼ çš„é€‰é¡¹</span>        <span class="token keyword">return</span> Sub    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å£°æ˜å…¨å±€ç»„ä»¶</span>    Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    Vue<span class="token punctuation">.</span>component <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å¦‚æœdefinitionæ˜¯å‡½æ•°,è¯´æ˜ç”¨æˆ·è°ƒç”¨äº†extend()</span>        definition <span class="token operator">=</span>            <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> definition <span class="token punctuation">:</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>        Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition        <span class="token comment" spellcheck="true">// console.log(Vue.options.components);</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="vdom"><a href="#vdom" class="headerlink" title="vdom/"></a>vdom/</h2><h3 id="ä¿®æ”¹patch-js"><a href="#ä¿®æ”¹patch-js" class="headerlink" title="ä¿®æ”¹patch.js"></a>ä¿®æ”¹patch.js</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> isSameVnode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"."</span><span class="token keyword">function</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data    <span class="token comment" spellcheck="true">// dataå˜ä¸ºinitæ–¹æ³•</span>    data <span class="token operator">=</span> data<span class="token punctuation">.</span>hook    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> data <span class="token operator">=</span> data<span class="token punctuation">.</span>init    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">data</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ç»„ä»¶</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(vnode);</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>    <span class="token keyword">let</span> <span class="token punctuation">{</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> vnode    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// æ ‡ç­¾</span>        <span class="token comment" spellcheck="true">// åŒºåˆ†æ˜¯ç»„ä»¶è¿˜æ˜¯å…ƒç´ </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">createComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ç»„ä»¶</span>            <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span>$el        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// åˆ›å»ºçœŸå®èŠ‚ç‚¹</span>        <span class="token comment" spellcheck="true">// å°†çœŸå®èŠ‚ç‚¹æŒ‚è½½åˆ°è™šæ‹ŸèŠ‚ç‚¹,åç»­ä¿®æ”¹å°±å¯ä»¥é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹ç›´æ¥æ‰¾åˆ°çœŸå®èŠ‚ç‚¹</span>        vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>        <span class="token function">patchProps</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ›´æ–°å±æ€§ xxx=xxx</span>        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// debugger</span>            <span class="token comment" spellcheck="true">// console.log(child)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">)</span> <span class="token keyword">return</span>            vnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä¼šæŠŠç»„ä»¶åˆ›å»ºçš„èŠ‚ç‚¹æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(vnode) æ–‡æœ¬è™šæ‹ŸèŠ‚ç‚¹çš„tagæ˜¯undefined</span>        vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// debugger</span>    <span class="token comment" spellcheck="true">// console.log(vnode.el)</span>    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patchProps</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç»„ä»¶æŒ‚è½½,æ²¡æœ‰ä¼ el</span>        <span class="token keyword">return</span> <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// vm.$el ç»„ä»¶æ¸²æŸ“çš„ç»“æœ</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">mountChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldChildren<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ......</span><span class="token punctuation">}</span></code></pre><h3 id="ä¿®æ”¹index-js"><a href="#ä¿®æ”¹index-js" class="headerlink" title="ä¿®æ”¹index.js"></a>ä¿®æ”¹index.js</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// è™šæ‹Ÿdomæ“ä½œ</span><span class="token comment" spellcheck="true">// _h() _c()</span><span class="token keyword">const</span> isReservedTag <span class="token operator">=</span> <span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// åˆ¤æ–­æ˜¯ä¸æ˜¯htmlä¸­å·²æœ‰çš„åŸå§‹æ ‡ç­¾</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'span'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElementVnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token operator">...</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(data)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">let</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span>key    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">delete</span> data<span class="token punctuation">.</span>key    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯åŸå§‹æ ‡ç­¾</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(tag);</span>        <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// åˆ›é€ è™šæ‹ŸèŠ‚ç‚¹</span>        <span class="token keyword">let</span> Ctor <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>tag<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// æ‹¿åˆ°ç»„ä»¶çš„æ„é€ å‡½æ•°</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">createComponentVnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> Ctor<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// åˆ›å»ºç»„ä»¶è™šæ‹ŸèŠ‚ç‚¹</span><span class="token keyword">function</span> <span class="token function">createComponentVnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> Ctor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Ctor <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯å¯¹è±¡</span>        <span class="token comment" spellcheck="true">/*         let Sub = Vue.extend({            template: '&lt;button>click&lt;my-button>&lt;/my-button>&lt;/button>',            components: {                'my-button': {                    template: '&lt;button>click-my-sub&lt;/button>'                }            }            // Vueè§£æç»„ä»¶çš„templateæ¥æ¸²æŸ“        })        */</span>        <span class="token comment" spellcheck="true">// æ‹¿åˆ°æ„é€ å‡½æ•°</span>        Ctor <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    data<span class="token punctuation">.</span>hook <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token function">init</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ç»„ä»¶åˆ›å»ºçœŸå®èŠ‚ç‚¹æ—¶è°ƒç”¨</span>            <span class="token comment" spellcheck="true">// ä¿å­˜ç»„ä»¶çš„å®ä¾‹åˆ°è™šæ‹ŸèŠ‚ç‚¹ä¸Š</span>            <span class="token keyword">let</span> instance <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vnode<span class="token punctuation">.</span>componentsOptions<span class="token punctuation">.</span>Ctor</span>            instance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// instance.$el</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// console.log(Ctor);</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºvnode</span>    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> Ctor <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// _v()</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createTextVnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(text)</span>    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// astæ˜¯è¯­æ³•è½¬æ¢,æè¿°è¯­æ³•(html js css), &lt;div xxx> -> div,xxx=true</span><span class="token comment" spellcheck="true">// è™šæ‹Ÿdomæ˜¯æè¿°domå…ƒç´ ,å¯ä»¥å¢åŠ è‡ªå®šä¹‰å±æ€§ div.xxx</span><span class="token keyword">function</span> <span class="token function">vnode</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> componentsOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        vm<span class="token punctuation">,</span>        tag<span class="token punctuation">,</span>        key<span class="token punctuation">,</span>        data<span class="token punctuation">,</span>        children<span class="token punctuation">,</span>        text<span class="token punctuation">,</span>        componentsOptions <span class="token comment" spellcheck="true">// ç»„ä»¶çš„æ„é€ å‡½æ•°</span>        <span class="token comment" spellcheck="true">// ......</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// åˆ¤æ–­æ˜¯ä¸æ˜¯åŒä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isSameVnode</span><span class="token punctuation">(</span>vnode1<span class="token punctuation">,</span> vnode2<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> vnode1<span class="token punctuation">.</span>tag <span class="token operator">===</span> vnode2<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span> vnode1<span class="token punctuation">.</span>key <span class="token operator">===</span> vnode2<span class="token punctuation">.</span>key<span class="token punctuation">}</span></code></pre><h2 id="æµ‹è¯•-12"><a href="#æµ‹è¯•-12" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- &lt;script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.js">&lt;/script> --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token comment" spellcheck="true">// æ ¹å®ä¾‹</span>        <span class="token comment" spellcheck="true">// ç»„ä»¶ä¸‰å¤§ç‰¹æ€§: è‡ªå®šä¹‰æ ‡ç­¾ ç»„ä»¶æœ‰è‡ªå·±çš„äº‹ä»¶å’Œå±æ€§ ç»„ä»¶æ’æ§½</span>        <span class="token comment" spellcheck="true">// å£°æ˜ç»„ä»¶: å…¨å±€ (ä¸ç®¡å…¨å±€è¿˜æ˜¯å±€éƒ¨,å†…éƒ¨éƒ½æ˜¯è°ƒç”¨Vue.extend)</span>        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-button'</span><span class="token punctuation">,</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// Vueè§£æç»„ä»¶çš„templateæ¥æ¸²æŸ“</span>            template<span class="token punctuation">:</span> <span class="token string">'&lt;button>click-my&lt;/button>'</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> Sub <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            template<span class="token punctuation">:</span> <span class="token string">'&lt;button>click&lt;my-button>&lt;/my-button>&lt;/button>'</span><span class="token punctuation">,</span>            components<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token string">'my-button'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                    template<span class="token punctuation">:</span> <span class="token string">'&lt;button>click-my-sub&lt;/button>'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// Vueè§£æç»„ä»¶çš„templateæ¥æ¸²æŸ“</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// console.log(new Sub());</span>        <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// const vm = new Vue({</span>        <span class="token comment" spellcheck="true">//     el: '#app',</span>        <span class="token comment" spellcheck="true">//     data() {</span>        <span class="token comment" spellcheck="true">//         return { name: 'zf' }</span>        <span class="token comment" spellcheck="true">//     },</span>        <span class="token comment" spellcheck="true">//     component: { // ç±»ä¼¼jsåŸå‹é“¾,å±€éƒ¨æ²¡æœ‰æ‰æ‰¾å…¨å±€</span>        <span class="token comment" spellcheck="true">//         'my-button': {</span>        <span class="token comment" spellcheck="true">//             template: '&lt;button>click2&lt;/button>'</span>        <span class="token comment" spellcheck="true">//         }</span>        <span class="token comment" spellcheck="true">//     }</span>        <span class="token comment" spellcheck="true">// }) </span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="img_49.png" alt="img_49.png"></p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
          <category> js </category>
          
          <category> javaScript </category>
          
          <category> é€ è½®å­ </category>
          
          <category> æ¡†æ¶ </category>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> é€ è½®å­ </tag>
            
            <tag> js </tag>
            
            <tag> javaScript </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºjavaåå°„æ‰‹å†™isetæ³¨è§£,å®ç°è‡ªåŠ¨new</title>
      <link href="/2023/01/30/ji-yu-java-fan-she-shou-xie-iset-zhu-jie-shi-xian-zi-dong-new/ji-yu-java-fan-she-shou-xie-iset-zhu-jie-shi-xian-zi-dong-new/"/>
      <url>/2023/01/30/ji-yu-java-fan-she-shou-xie-iset-zhu-jie-shi-xian-zi-dong-new/ji-yu-java-fan-she-shou-xie-iset-zhu-jie-shi-xian-zi-dong-new/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote><p>è¿™ä¸ªæ³¨è§£æ˜¯æˆ‘ä¹‹å‰å­¦åå°„æ—¶å†™çš„,ä»£ç è§„èŒƒä¸æ˜¯å¾ˆå¥½,æœ‰å¾ˆå¤šéœ€è¦æ”¹è¿›çš„åœ°æ–¹,ä¸è¿‡ä½œä¸ºå­¦ä¹ å·²ç»æ˜¯å¤Ÿç”¨äº†,ä¹Ÿå¯ä»¥ç”¨æ¥ç†è§£springçš„ä¾èµ–æ³¨å…¥</p></blockquote><h1 id="1-æ–°å»ºmavenå·¥ç¨‹"><a href="#1-æ–°å»ºmavenå·¥ç¨‹" class="headerlink" title="1,æ–°å»ºmavenå·¥ç¨‹"></a>1,æ–°å»ºmavenå·¥ç¨‹</h1><h2 id="1-1-æ·»åŠ lombokä¾èµ–-ç®€åŒ–å¼€å‘"><a href="#1-1-æ·»åŠ lombokä¾èµ–-ç®€åŒ–å¼€å‘" class="headerlink" title="1.1,æ·»åŠ lombokä¾èµ–,ç®€åŒ–å¼€å‘"></a>1.1,æ·»åŠ lombokä¾èµ–,ç®€åŒ–å¼€å‘</h2><pre class=" language-xml"><code class="language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.18.24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h1 id="2-æ³¨è§£"><a href="#2-æ³¨è§£" class="headerlink" title="2,æ³¨è§£"></a>2,æ³¨è§£</h1><p>å†™ä¸€ä¸ªæ³¨è§£ç±»,ä»£ç å¦‚ä¸‹</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ä½œç”¨åœ¨å­—æ®µä¸Š</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è¿è¡Œæ—¶ä½¿ç”¨</span><span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">iset</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ³¨å…¥å•ä¸ªå±æ€§</span>    String <span class="token function">setName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¦è®¾ç½®çš„å±æ€§å</span>    String <span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¦è®¾ç½®çš„å±æ€§å€¼</span>    <span class="token comment" spellcheck="true">// æ³¨å…¥å¤šä¸ªå±æ€§</span>    <span class="token comment" spellcheck="true">// ä¸¤ä¸ªæ•°ç»„ä¸€ä¸€å¯¹åº”,åˆ°æ—¶å€™é€ä¸ªèµ‹å€¼</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">setNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">setDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><p>è¯´æ˜ä¸€ä¸‹:  </p><blockquote><p>@Retention - æ ‡è¯†è¿™ä¸ªæ³¨è§£æ€ä¹ˆä¿å­˜ï¼Œæ˜¯åªåœ¨ä»£ç ä¸­ï¼Œè¿˜æ˜¯ç¼–å…¥classæ–‡ä»¶ä¸­ï¼Œæˆ–è€…æ˜¯åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è®¿é—®ã€‚<br>@Target - æ ‡è®°ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„åº”è¯¥æ˜¯å“ªç§ Java æˆå‘˜ã€‚</p></blockquote><p>è€Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å£°æ˜å­—æ®µ(ä¸€ä¸ªç±»çš„å®ä¾‹),ç„¶åé€šè¿‡isetæ¥ä¸ºè¿™ä¸ªå­—æ®µåˆ›å»ºå®ä¾‹å’Œæ³¨å…¥å±æ€§</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ³¨å…¥å•ä¸ªå­—æ®µ </span><span class="token annotation punctuation">@iset</span><span class="token punctuation">(</span>setName <span class="token operator">=</span> <span class="token string">"age"</span> <span class="token punctuation">,</span> setData <span class="token operator">=</span> <span class="token string">"8"</span> <span class="token punctuation">)</span>tStu stu2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ³¨å…¥å¤šä¸ªå­—æ®µ</span><span class="token annotation punctuation">@iset</span><span class="token punctuation">(</span>setNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span><span class="token string">"email"</span><span class="token punctuation">,</span><span class="token string">"id"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> setDatas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">,</span><span class="token string">"lisi@qq.com"</span><span class="token punctuation">,</span><span class="token string">"200"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>User user<span class="token punctuation">;</span></code></pre><h1 id="3-æ ¸å¿ƒä»£ç é€»è¾‘"><a href="#3-æ ¸å¿ƒä»£ç é€»è¾‘" class="headerlink" title="3,æ ¸å¿ƒä»£ç é€»è¾‘"></a>3,æ ¸å¿ƒä»£ç é€»è¾‘</h1><p>æˆ‘ä»¬è¿™é‡Œå¸Œæœ›æ€ä¹ˆåšå‘¢, å°±æ˜¯å®šä¹‰ä¸€ä¸ªç±»,æä¾›æ–¹æ³•,å°†å½“å‰æ‰€æœ‰æ ‡è®°äº†@isetæ³¨è§£çš„å­—æ®µåˆ›å»º, å¹¶å°†å…¶å±æ€§èµ‹å€¼, ç„¶åæ”¾å…¥ä¸€ä¸ªå…¬å…±map&lt;ç±»å®ä¾‹å­—æ®µçš„å­—æ®µå,ç±»å®ä¾‹&gt;, æƒ³è¦ç±»å®ä¾‹åªéœ€è¦ä»å…¬å…±mapé‡Œå–å°±è¡Œäº†</p><h2 id="3-1-iConstruct"><a href="#3-1-iConstruct" class="headerlink" title="3.1,iConstruct"></a>3.1,iConstruct</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>utils<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Field<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @author malguy-wang sir * @create --- */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">iConstruct</span> <span class="token punctuation">{</span>    <span class="token keyword">final</span> <span class="token keyword">static</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>iConstruct<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * a map to save all class (ä¿å­˜æ‰€æœ‰åˆ›å»ºçš„ç±»)     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> dogs<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è·å–æ‰€æœ‰åˆ›å»ºå¥½çš„ç±»     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">getDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> dogs<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ä¼ å…¥å½“å‰ç±»çš„è·¯å¾„,åˆ›å»ºæ–°çš„å®ä¾‹     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">generateDogs</span><span class="token punctuation">(</span>String targetClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"\t\t==========>>> isetè¿è¡Œå¼€å§‹ &lt;&lt;&lt;=========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è·¯å¾„æ”¹ä¸ºå…¨ç±»å</span>        targetClass <span class="token operator">=</span> iUtils<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¯»æ‰¾å¹¶åŠ è½½è¦åˆ›å»ºçš„ç±»</span>        Class <span class="token class-name">clazz</span> <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å‡†å¤‡è¿”å›çš„ç±»</span>        Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> u <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è·å–å½“å‰ç±»æ‰€æœ‰çš„å…¨ç±»å</span>        String<span class="token punctuation">[</span><span class="token punctuation">]</span> classes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ä¼šå¸¦æœ‰å½“å‰ç±»å’Œå…¨ç±»å+ç©ºæ ¼+ä½œä¸ºå±æ€§çš„ç±»çš„å…¨ç±»å</span>            <span class="token comment" spellcheck="true">// private org.malred.iset.entitys.User org.malred.iset.itest.t.user</span>            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è·å–å½“å‰ç±»æ‰€æœ‰çš„å…¨ç±»å => "</span> <span class="token operator">+</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// è·å–ç±»å®ä¾‹çš„å­—æ®µåç§° ( org.malred.iset.itest.t.user => user )</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> classes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è§£æç±»å®ä¾‹å­—æ®µå => "</span> <span class="token operator">+</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>                    classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>                    classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è§£æç»“æœ => "</span> <span class="token operator">+</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// æ ¹æ®è§£æå®Œæˆçš„ç±»å®ä¾‹å­—æ®µå,è·å–ç±»å®ä¾‹éœ€è¦çš„å­—æ®µ,ç„¶åèµ‹å€¼</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> classes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"ä¸º => { "</span><span class="token operator">+</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">" } ç±»å®ä¾‹å­—æ®µ,æ³¨å…¥å±æ€§å€¼å¼€å§‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Field obj <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è·å–æ‰€æœ‰å­—æ®µ</span>            <span class="token comment" spellcheck="true">// isAnnotationPresent(iset.class));//åˆ¤æ–­æœ‰æ²¡æœ‰åŠ æ³¨è§£</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span>iset<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                iset is <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span>iset<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è·å–æ³¨è§£</span>                Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> type <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–ç±»</span>                Object iu <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åˆ›å»ºå®ä¾‹</span>                Field<span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> iu<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–å±æ€§å</span>                String<span class="token punctuation">[</span><span class="token punctuation">]</span> iargs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>fields<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å±æ€§åæ•°ç»„</span>                <span class="token comment" spellcheck="true">// è§£æå±æ€§å(å…¨ç±»å -> å­—æ®µå)</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> fields<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    iargs<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> fields<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>                            <span class="token comment" spellcheck="true">// å±æ€§ä¼šå¸¦å…¨ç±»å,æ¯”å¦‚org.malred.iset.itest.t.user</span>                            fields<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>                            fields<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è·å–ç±»å±æ€§åç§° => "</span> <span class="token operator">+</span> iargs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">// æ³¨å…¥å•ä¸ªå±æ€§æ—¶</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> fields<span class="token punctuation">.</span>length<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>iargs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è®¾ç½®å‚æ•° { "</span> <span class="token operator">+</span> iargs<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" } ä¸º { "</span> <span class="token operator">+</span> is<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" } ä¸­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        Field declaredField <span class="token operator">=</span> iu<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>iargs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// è®¾ç½®å¯è®¿é—®(ç§æœ‰å­—æ®µä¹Ÿèƒ½è¢«è®¿é—®)</span>                        declaredField<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// ä¼ å…¥å­—æ®µå’Œå±æ€§,èµ‹å€¼</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>iUtils<span class="token punctuation">.</span><span class="token function">isNumber</span><span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ•°å€¼ç±»å‹éœ€è¦è½¬int</span>                            declaredField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>iu<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                            declaredField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>iu<span class="token punctuation">,</span> is<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è®¾ç½®å‚æ•° => "</span> <span class="token operator">+</span> iargs<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" å®Œæ¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">// æ³¨å…¥å±æ€§</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> fields<span class="token punctuation">.</span>length<span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> is<span class="token punctuation">.</span><span class="token function">setNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">setNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>iargs<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è®¾ç½®å‚æ•° { "</span> <span class="token operator">+</span> iargs<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" } ä¸º { "</span>                                    <span class="token operator">+</span> is<span class="token punctuation">.</span><span class="token function">setDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" } ä¸­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment" spellcheck="true">// iuæ˜¯åˆ›å»ºäº†çš„å®ä¾‹</span>                            Field declaredField <span class="token operator">=</span> iu<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>iargs<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            declaredField<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ•°å€¼ç±»å‹éœ€è¦è½¬int</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>iUtils<span class="token punctuation">.</span><span class="token function">isNumber</span><span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">setDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                declaredField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>iu<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">setDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                                declaredField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>iu<span class="token punctuation">,</span> is<span class="token punctuation">.</span><span class="token function">setDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è®¾ç½®å‚æ•° => "</span> <span class="token operator">+</span> iargs<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" å®Œæ¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"ä¸º => { "</span><span class="token operator">+</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">" } ç±»å®ä¾‹å­—æ®µ,æ³¨å…¥å±æ€§å€¼å®Œæ¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"å°† { "</span> <span class="token operator">+</span> classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" } æ”¾å…¥mapä¸­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// æ”¾å…¥dogsé›†åˆ</span>                u<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> iu<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"\t\t==========>>> isetè¿è¡Œç»“æŸ &lt;&lt;&lt;=========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> u<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ç”Ÿæˆç±»,å¹¶è·å–æ‰€æœ‰åˆ›å»ºå¥½çš„ç±»(map)     *     * @param nowClass å½“å‰ç±»çš„è·¯å¾„æˆ–å…¨ç±»å     * @return     * @throws Exception     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">getDogs</span><span class="token punctuation">(</span>String nowClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        dogs <span class="token operator">=</span> <span class="token function">generateDogs</span><span class="token punctuation">(</span>nowClass<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dogs<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * é€šè¿‡id(å­—æ®µå)è·å–ç±»å®ä¾‹     *     * @param className     * @return     * @throws Exception     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getDogByName</span><span class="token punctuation">(</span>String className<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token keyword">return</span> dogs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//just new class , than U can get a map named dogs which have all class you need</span>    <span class="token keyword">public</span> <span class="token function">iConstruct</span><span class="token punctuation">(</span>String nowClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token function">getDogs</span><span class="token punctuation">(</span>nowClass<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span> </code></pre><h2 id="3-2-iUtils-å·¥å…·ç±»"><a href="#3-2-iUtils-å·¥å…·ç±»" class="headerlink" title="3.2,iUtils å·¥å…·ç±»"></a>3.2,iUtils å·¥å…·ç±»</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>utils<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/** * å·¥å…·ç±» * * @author malguy-wang sir * @create --- */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">iUtils</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯æ•°å­—</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isNumber</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Character<span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ä¼ å…¥æ¥è‡ªæºæ ¹çš„è·¯å¾„,è¿”å›å…¨ç±»å</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getClassName</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token punctuation">{</span>        path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">".java"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> path<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> </code></pre><h1 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4,æµ‹è¯•"></a>4,æµ‹è¯•</h1><h2 id="4-1-å®ä½“ç±»"><a href="#4-1-å®ä½“ç±»" class="headerlink" title="4.1,å®ä½“ç±»"></a>4.1,å®ä½“ç±»</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">;</span> <span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span> <span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>  <span class="token keyword">private</span> String name<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">long</span> age<span class="token punctuation">;</span>  <span class="token keyword">private</span> String email<span class="token punctuation">;</span><span class="token punctuation">}</span>  </code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">;</span> <span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span> <span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">tStu</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><h2 id="4-2-æµ‹è¯•"><a href="#4-2-æµ‹è¯•" class="headerlink" title="4.2,æµ‹è¯•"></a>4.2,æµ‹è¯•</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">t</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@iset</span><span class="token punctuation">(</span>setNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> setDatas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">,</span> <span class="token string">"lisi@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"200"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> User user<span class="token punctuation">;</span>    <span class="token annotation punctuation">@iset</span><span class="token punctuation">(</span>setNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> setDatas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> <span class="token string">"56"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    tStu stu<span class="token punctuation">;</span>    <span class="token annotation punctuation">@iset</span><span class="token punctuation">(</span>setNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> setDatas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">,</span> <span class="token string">"8"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    tStu stu1<span class="token punctuation">;</span>    <span class="token annotation punctuation">@iset</span><span class="token punctuation">(</span>setName <span class="token operator">=</span> <span class="token string">"age"</span> <span class="token punctuation">,</span> setData <span class="token operator">=</span> <span class="token string">"8"</span> <span class="token punctuation">)</span>    tStu stu2<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        Map iuser <span class="token operator">=</span> iConstruct<span class="token punctuation">.</span>                <span class="token function">generateDogs</span><span class="token punctuation">(</span><span class="token string">"org/malred/iset/itest/t.java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iuser<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">iConstruct</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Map map <span class="token operator">=</span> iConstruct<span class="token punctuation">.</span><span class="token function">getDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"stu"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"stu1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"stu2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="4-3-ç»“æœ"><a href="#4-3-ç»“æœ" class="headerlink" title="4.3,ç»“æœ"></a>4.3,ç»“æœ</h2><pre class=" language-java"><code class="language-java"><span class="token string">"C:\Program Files\Java\jdk1.8.0_241\bin\java.exe"</span> <span class="token operator">-</span>Dvisualvm<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token number">218153308319900</span> <span class="token string">"-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2021.1.1\lib\idea_rt.jar=50078:C:\Program Files\JetBrains\IntelliJ IDEA 2021.1.1\bin"</span> <span class="token operator">-</span>Dfile<span class="token punctuation">.</span>encoding<span class="token operator">=</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span>classpath <span class="token string">"C:\Program Files\Java\jdk1.8.0_241\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_241\jre\lib\rt.jar;C:\Users\13695\Desktop\é€ è½®å­\ä»£ç \æ‰‹å†™é€ è½®å­\iset(åå°„å°ç»ƒä¹ )\myConstruct\target\classes;D:\java_maven\maven_repository\org\projectlombok\lombok\1.18.24\lombok-1.18.24.jar"</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>tä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span>         <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>>></span> isetè¿è¡Œå¼€å§‹ <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–å½“å‰ç±»æ‰€æœ‰çš„å…¨ç±»å <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">private</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>User org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>userä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–å½“å‰ç±»æ‰€æœ‰çš„å…¨ç±»å <span class="token operator">=</span><span class="token operator">></span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>tStu org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>stuä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–å½“å‰ç±»æ‰€æœ‰çš„å…¨ç±»å <span class="token operator">=</span><span class="token operator">></span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>tStu org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>stu1ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–å½“å‰ç±»æ‰€æœ‰çš„å…¨ç±»å <span class="token operator">=</span><span class="token operator">></span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>tStu org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>stu2ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç±»å®ä¾‹å­—æ®µå <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">private</span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>User org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>userä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç»“æœ <span class="token operator">=</span><span class="token operator">></span> userä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç±»å®ä¾‹å­—æ®µå <span class="token operator">=</span><span class="token operator">></span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>tStu org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>stuä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç»“æœ <span class="token operator">=</span><span class="token operator">></span> stuä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç±»å®ä¾‹å­—æ®µå <span class="token operator">=</span><span class="token operator">></span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>tStu org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>stu1ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç»“æœ <span class="token operator">=</span><span class="token operator">></span> stu1ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç±»å®ä¾‹å­—æ®µå <span class="token operator">=</span><span class="token operator">></span> org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>entitys<span class="token punctuation">.</span>tStu org<span class="token punctuation">.</span>malred<span class="token punctuation">.</span>iset<span class="token punctuation">.</span>itest<span class="token punctuation">.</span>t<span class="token punctuation">.</span>stu2ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è§£æç»“æœ <span class="token operator">=</span><span class="token operator">></span> stu2ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å¼€å§‹ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> idä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> nameä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> ageä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> emailä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> id <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> <span class="token number">200</span> <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> id å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> name <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> æå›› <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> name å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> age <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> <span class="token number">18</span> <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> age å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> email <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> lisi<span class="token annotation punctuation">@qq</span><span class="token punctuation">.</span>com <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> email å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> å°† <span class="token punctuation">{</span> user <span class="token punctuation">}</span> æ”¾å…¥mapä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> stu <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å¼€å§‹ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> nameä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> ageä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> name <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> å¼ ä¸‰ <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> name å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> age <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> <span class="token number">56</span> <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> age å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> stu <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> å°† <span class="token punctuation">{</span> stu <span class="token punctuation">}</span> æ”¾å…¥mapä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> stu1 <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å¼€å§‹ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> nameä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> ageä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> name <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> ç‹äº” <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> name å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> age <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> <span class="token number">8</span> <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> age å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> stu1 <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> å°† <span class="token punctuation">{</span> stu1 <span class="token punctuation">}</span> æ”¾å…¥mapä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> stu2 <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å¼€å§‹ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> nameä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è·å–ç±»å±æ€§åç§° <span class="token operator">=</span><span class="token operator">></span> ageä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token punctuation">{</span> age <span class="token punctuation">}</span> ä¸º <span class="token punctuation">{</span> <span class="token number">8</span> <span class="token punctuation">}</span> ä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> è®¾ç½®å‚æ•° <span class="token operator">=</span><span class="token operator">></span> age å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> ä¸º <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> stu2 <span class="token punctuation">}</span> ç±»å®ä¾‹å­—æ®µ<span class="token punctuation">,</span>æ³¨å…¥å±æ€§å€¼å®Œæ¯•ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span> å°† <span class="token punctuation">{</span> stu2 <span class="token punctuation">}</span> æ”¾å…¥mapä¸­ä¸€æœˆ <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2023</span> <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">23</span> ä¸‹åˆ com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logger warnè­¦å‘Š<span class="token operator">:</span>         <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>>></span> isetè¿è¡Œç»“æŸ <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token function">User</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> name<span class="token operator">=</span>æå››<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> email<span class="token operator">=</span>lisi<span class="token annotation punctuation">@qq</span><span class="token punctuation">.</span>com<span class="token punctuation">)</span><span class="token function">tStu</span><span class="token punctuation">(</span>name<span class="token operator">=</span>å¼ ä¸‰<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token function">tStu</span><span class="token punctuation">(</span>name<span class="token operator">=</span>ç‹äº”<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token function">tStu</span><span class="token punctuation">(</span>name<span class="token operator">=</span>null<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º <span class="token number">0</span> </code></pre><h1 id="é—®é¢˜å’Œæ‹“å±•"><a href="#é—®é¢˜å’Œæ‹“å±•" class="headerlink" title="*.é—®é¢˜å’Œæ‹“å±•"></a>*.é—®é¢˜å’Œæ‹“å±•</h1><p>gitä»“åº“</p><blockquote><p><a href="https://github.com/malred/myConstruct.git">https://github.com/malred/myConstruct.git</a><br><a href="https://gitee.com/malguy/myConstruct.git">https://gitee.com/malguy/myConstruct.git</a></p></blockquote><h2 id="1-å¯¹è±¡"><a href="#1-å¯¹è±¡" class="headerlink" title="*.1,å¯¹è±¡"></a>*.1,å¯¹è±¡</h2><p>æˆ‘è¿™é‡Œæ²¡æœ‰è€ƒè™‘ç±»é‡Œé¢æœ‰å¯¹è±¡ç±»å‹çš„å±æ€§çš„æƒ…å†µ,å¦‚æœè¦åˆ›å»ºçš„ç±»éœ€è¦ä¸€ä¸ªå¯¹è±¡å±æ€§,å¦‚ä½•å®ç°?</p><h2 id="2-å¾ªç¯ä¾èµ–"><a href="#2-å¾ªç¯ä¾èµ–" class="headerlink" title="*.2,å¾ªç¯ä¾èµ–"></a>*.2,å¾ªç¯ä¾èµ–</h2><p>å¦‚æœæœ‰userå’Œstuç±»,userç±»æœ‰ä¸€ä¸ªå±æ€§æ˜¯stuç±»,è€Œstuç±»ä¹Ÿæœ‰ä¸€ä¸ªuserå±æ€§,é‚£ä¹ˆ,å°±ä¼šäº’ç›¸ä¾èµ–,æ— æ³•åˆ›å»º,å¦‚ä½•è§£å†³?</p><h2 id="3-æ‰«æ"><a href="#3-æ‰«æ" class="headerlink" title="*.3,æ‰«æ"></a>*.3,æ‰«æ</h2><p>å½“å‰éœ€è¦æ‰‹åŠ¨ä¼ å…¥å½“å‰ç±»è·¯å¾„,èƒ½ä¸èƒ½å®ç°åƒspringçš„scanä¸€æ ·çš„æ‰«æ,å°†æŸä¸ªå®ç°@Scanæ³¨è§£çš„ç±»çš„å­ç›®å½•å…¨éƒ¨æ‰«æ,å¹¶æ ¹æ®æœ‰æ— @compnent+@isetæ³¨è§£æ¥æ³¨å…¥å‘¢</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> java </tag>
            
            <tag> é€ è½®å­ </tag>
            
            <tag> åå°„ </tag>
            
            <tag> æ³¨è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jdk11ç¼ºå¤±ä¾èµ–æŠ¥é”™</title>
      <link href="/2022/10/16/jdk11-que-shi-yi-lai-bao-cuo/jdk11-que-shi-yi-lai-bao-cuo/"/>
      <url>/2022/10/16/jdk11-que-shi-yi-lai-bao-cuo/jdk11-que-shi-yi-lai-bao-cuo/</url>
      
        <content type="html"><![CDATA[<p>å½“jdk8å‡çº§åˆ°jdk11,Java EEç›¸å…³æ¨¡å—é»˜è®¤ä¸åœ¨JavaåŒ…é‡Œé¢äº†ï¼Œç›¸å…³çš„ç±»éœ€è¦å¢åŠ é¢å¤–ä¾èµ–æˆ–è€…æ›¿æ¢æˆå…¶ä»–çš„ç±»,å¦‚æœä½ ç›´æ¥è¿è¡Œ,å¯èƒ½ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜: </p><p>error: package javax.xml.bind does not exist<br>import javax.xml.bind.JAXBException;  </p><p>Exception in thread â€œmainâ€ java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException<br>    at monitor.Main.main(Main.java:27)<br>Caused by: java.lang.ClassNotFoundException: javax.xml.bind.JAXBException<br>    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:582)<br>    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:185)<br>    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:496)<br>    â€¦ 1 more<br> æˆ‘çš„å»ºè®®æ˜¯ç›´æ¥åŠ ä¸Šç¼ºå¤±çš„ä¾èµ–: </p><pre class=" language-xml"><code class="language-xml">       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.sun.xml.bind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxb-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.xml.bind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxb-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.sun.xml.bind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxb-impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.glassfish.jaxb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxb-runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.10-b140310.1920<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.activation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>activation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>       <span class="token comment" spellcheck="true">&lt;!--å¼•â¼ŠJaxbï¼Œç»“æŸ--></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> bugè®°å½• </tag>
            
            <tag> java </tag>
            
            <tag> å¼€å‘ç¯å¢ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaå¯åŠ¨æŠ¥é”™</title>
      <link href="/2022/10/16/idea-qi-dong-bao-cuo/idea-qi-dong-bao-cuo/"/>
      <url>/2022/10/16/idea-qi-dong-bao-cuo/idea-qi-dong-bao-cuo/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©å¯åŠ¨ideaçªç„¶æŠ¥é”™:   </p><p>Internal error. Please refer to <a href="https://jb.gg/ide/critical-startup-errors">https://jb.gg/ide/critical-startup-errors</a> </p><p>java.util.concurrent.CompletionException: java.net.BindException: Address already in use: bind</p><p>â€¦.</p><p>è™½ç„¶ä¸çŸ¥é“ä»€ä¹ˆåŸå› ,ä½†æ˜¯æ‹¿æŠ¥é”™æœäº†ä¸€ä¸‹,æ‰¾åˆ°è§£å†³æ–¹æ³•</p><p>win+x â€“&gt; ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œpowershell â€“&gt; æ‰§è¡Œå‘½ä»¤net stop winnatå’Œ net start winnat å°±å¯ä»¥äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> bugè®°å½• </tag>
            
            <tag> java </tag>
            
            <tag> ide </tag>
            
            <tag> å¼€å‘ç¯å¢ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°šç¡…è°·spring securityç¬”è®°ä¸€</title>
      <link href="/2022/10/15/spring-security-bi-ji-yi/spring-security-bi-ji-yi/"/>
      <url>/2022/10/15/spring-security-bi-ji-yi/spring-security-bi-ji-yi/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼•å­"><a href="#å¼•å­" class="headerlink" title="å¼•å­"></a>å¼•å­</h1><p><img src="img.png" alt="img.png"><img src="img_1.png" alt="img_1.png"><img src="img_2.png" alt="img_2.png"><img src="img_3.png" alt="img_3.png"><img src="img_4.png" alt="img_4.png"><br><img src="img_5.png" alt="img_5.png"><img src="img_6.png" alt="img_6.png"><img src="img_7.png" alt="img_7.png"><br><img src="img_8.png" alt="img_8.png"><img src="img_9.png" alt="img_9.png"><br><img src="img_10.png" alt="img_10.png"><br><img src="img_11.png" alt="img_11.png"><br><img src="img_12.png" alt="img_12.png"><br><img src="img_13.png" alt="img_13.png"><br><img src="img_14.png" alt="img_14.png"><br><img src="img_15.png" alt="img_15.png"><img src="img_16.png" alt="img_16.png"></p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p><img src="ig_1.png" alt="ig.png"><img src="ig_2.png" alt="ig_1.png"><img src="ig_3.png" alt="ig_2.png"><img src="ig_4.png" alt="ig_3.png"><img src="ig_5.png" alt="ig_4.png"><br><img src="ig_6.png" alt="ig_5.png"><img src="ig_7.png" alt="ig_6.png"></p>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
          <category> æƒé™ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> spring </tag>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> security </tag>
            
            <tag> æƒé™ </tag>
            
            <tag> bugè®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººspringè¸©å‘åˆé›†</title>
      <link href="/2022/10/15/ge-ren-spring-cai-keng-he-ji/ge-ren-spring-cai-keng-he-ji/"/>
      <url>/2022/10/15/ge-ren-spring-cai-keng-he-ji/ge-ren-spring-cai-keng-he-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="æ³¨å†Œçš„æ—¶å€™èµ‹å€¼äº†ä¸å­˜åœ¨çš„å‚æ•°ï¼š"><a href="#æ³¨å†Œçš„æ—¶å€™èµ‹å€¼äº†ä¸å­˜åœ¨çš„å‚æ•°ï¼š" class="headerlink" title="æ³¨å†Œçš„æ—¶å€™èµ‹å€¼äº†ä¸å­˜åœ¨çš„å‚æ•°ï¼š"></a>æ³¨å†Œçš„æ—¶å€™èµ‹å€¼äº†ä¸å­˜åœ¨çš„å‚æ•°ï¼š</h1><p><img src="img.png" alt="img.png"></p><h1 id="å†…éƒ¨beanè®¾ç½®é”™è¯¯æŠ¥é”™"><a href="#å†…éƒ¨beanè®¾ç½®é”™è¯¯æŠ¥é”™" class="headerlink" title="å†…éƒ¨beanè®¾ç½®é”™è¯¯æŠ¥é”™"></a>å†…éƒ¨beanè®¾ç½®é”™è¯¯æŠ¥é”™</h1><p><img src="img_1.png" alt="img_1.png"><br><img src="img_2.png" alt="img_2.png"><br><img src="img_3.png" alt="img_3.png"><br><img src="img_4.png" alt="img_4.png"></p><h2 id="ä¸èƒ½åœ¨å†…éƒ¨ç±»é…ç½®æ¥å£å¤šæ€"><a href="#ä¸èƒ½åœ¨å†…éƒ¨ç±»é…ç½®æ¥å£å¤šæ€" class="headerlink" title="ä¸èƒ½åœ¨å†…éƒ¨ç±»é…ç½®æ¥å£å¤šæ€"></a>ä¸èƒ½åœ¨å†…éƒ¨ç±»é…ç½®æ¥å£å¤šæ€</h2><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p><img src="img_5.png" alt="img_5.png"></p><h3 id="é¦–å…ˆä¼ å…¥nameå­—ç¬¦ä¸²ï¼ˆåº”è¯¥æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–åˆ«çš„æ–¹å¼ï¼‰ï¼Œç„¶åæŠŠ-æ¢æˆ-ï¼Œåœ¨æ¥ä¸Šclassï¼ˆå…¶å®å°±æ˜¯è·å–nameå¯¹åº”çš„ç±»çš„è·¯å¾„ï¼‰ï¼Œç„¶åé€šè¿‡ucpçš„getresourceæ–¹æ³•å¯»æ‰¾ç±»ï¼Œå¦‚æœä¸ä¸ºç©ºå°±è¿”å›ä¸€ä¸ªç±»ï¼Œå¦åˆ™è¿”å›null"><a href="#é¦–å…ˆä¼ å…¥nameå­—ç¬¦ä¸²ï¼ˆåº”è¯¥æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–åˆ«çš„æ–¹å¼ï¼‰ï¼Œç„¶åæŠŠ-æ¢æˆ-ï¼Œåœ¨æ¥ä¸Šclassï¼ˆå…¶å®å°±æ˜¯è·å–nameå¯¹åº”çš„ç±»çš„è·¯å¾„ï¼‰ï¼Œç„¶åé€šè¿‡ucpçš„getresourceæ–¹æ³•å¯»æ‰¾ç±»ï¼Œå¦‚æœä¸ä¸ºç©ºå°±è¿”å›ä¸€ä¸ªç±»ï¼Œå¦åˆ™è¿”å›null" class="headerlink" title="é¦–å…ˆä¼ å…¥nameå­—ç¬¦ä¸²ï¼ˆåº”è¯¥æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–åˆ«çš„æ–¹å¼ï¼‰ï¼Œç„¶åæŠŠ . æ¢æˆ / ï¼Œåœ¨æ¥ä¸Šclassï¼ˆå…¶å®å°±æ˜¯è·å–nameå¯¹åº”çš„ç±»çš„è·¯å¾„ï¼‰ï¼Œç„¶åé€šè¿‡ucpçš„getresourceæ–¹æ³•å¯»æ‰¾ç±»ï¼Œå¦‚æœä¸ä¸ºç©ºå°±è¿”å›ä¸€ä¸ªç±»ï¼Œå¦åˆ™è¿”å›null"></a>é¦–å…ˆä¼ å…¥nameå­—ç¬¦ä¸²ï¼ˆåº”è¯¥æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–åˆ«çš„æ–¹å¼ï¼‰ï¼Œç„¶åæŠŠ . æ¢æˆ / ï¼Œåœ¨æ¥ä¸Šclassï¼ˆå…¶å®å°±æ˜¯è·å–nameå¯¹åº”çš„ç±»çš„è·¯å¾„ï¼‰ï¼Œç„¶åé€šè¿‡ucpçš„getresourceæ–¹æ³•å¯»æ‰¾ç±»ï¼Œå¦‚æœä¸ä¸ºç©ºå°±è¿”å›ä¸€ä¸ªç±»ï¼Œå¦åˆ™è¿”å›null</h3><h3 id="æ­¤æ—¶resultä¸ºnullï¼Œè¿”å›ç±»æœªæ‰¾åˆ°å¼‚å¸¸"><a href="#æ­¤æ—¶resultä¸ºnullï¼Œè¿”å›ç±»æœªæ‰¾åˆ°å¼‚å¸¸" class="headerlink" title="æ­¤æ—¶resultä¸ºnullï¼Œè¿”å›ç±»æœªæ‰¾åˆ°å¼‚å¸¸"></a>æ­¤æ—¶resultä¸ºnullï¼Œè¿”å›ç±»æœªæ‰¾åˆ°å¼‚å¸¸</h3><p><img src="img_6.png" alt="img_6.png"><br><img src="img_7.png" alt="img_7.png"><br><img src="img_8.png" alt="img_8.png"><br><img src="img_9.png" alt="img_9.png"><br><img src="img_10.png" alt="img_10.png"></p><h2 id="è§£å†³ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#è§£å†³ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="è§£å†³ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶"></a>è§£å†³ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="å†…éƒ¨å£°æ˜å¯¹è±¡ä¸èƒ½ç”¨propertyç›´æ¥åˆ›å»º"><a href="#å†…éƒ¨å£°æ˜å¯¹è±¡ä¸èƒ½ç”¨propertyç›´æ¥åˆ›å»º" class="headerlink" title="å†…éƒ¨å£°æ˜å¯¹è±¡ä¸èƒ½ç”¨propertyç›´æ¥åˆ›å»º"></a>å†…éƒ¨å£°æ˜å¯¹è±¡ä¸èƒ½ç”¨propertyç›´æ¥åˆ›å»º</h3><p><img src="img_11.png" alt="img_11.png"></p><h1 id="å†…éƒ¨ç±»æœªæ·»åŠ setæ–¹æ³•è€ŒæŠ¥é”™"><a href="#å†…éƒ¨ç±»æœªæ·»åŠ setæ–¹æ³•è€ŒæŠ¥é”™" class="headerlink" title="å†…éƒ¨ç±»æœªæ·»åŠ setæ–¹æ³•è€ŒæŠ¥é”™"></a>å†…éƒ¨ç±»æœªæ·»åŠ setæ–¹æ³•è€ŒæŠ¥é”™</h1><p><img src="img_12.png" alt="img_12.png"><br><img src="img_13.png" alt="img_13.png"></p><h2 id="é…ç½®æ–‡ä»¶ä¼šè°ƒç”¨setæ–¹æ³•æ¥èµ‹å€¼"><a href="#é…ç½®æ–‡ä»¶ä¼šè°ƒç”¨setæ–¹æ³•æ¥èµ‹å€¼" class="headerlink" title="é…ç½®æ–‡ä»¶ä¼šè°ƒç”¨setæ–¹æ³•æ¥èµ‹å€¼"></a>é…ç½®æ–‡ä»¶ä¼šè°ƒç”¨setæ–¹æ³•æ¥èµ‹å€¼</h2><p><img src="img_14.png" alt="img_14.png"></p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p><img src="img_15.png" alt="img_15.png"><br><img src="img_16.png" alt="img_16.png"></p><h1 id="å¤–éƒ¨ç±»setå’Œgetæ–¹æ³•é½å…¨å¹¶åˆ›å»ºäº†å¯¹è±¡å’Œå±æ€§ï¼Œå¼•ç”¨æ–¹æœªè®¾ç½®setæ–¹æ³•"><a href="#å¤–éƒ¨ç±»setå’Œgetæ–¹æ³•é½å…¨å¹¶åˆ›å»ºäº†å¯¹è±¡å’Œå±æ€§ï¼Œå¼•ç”¨æ–¹æœªè®¾ç½®setæ–¹æ³•" class="headerlink" title="å¤–éƒ¨ç±»setå’Œgetæ–¹æ³•é½å…¨å¹¶åˆ›å»ºäº†å¯¹è±¡å’Œå±æ€§ï¼Œå¼•ç”¨æ–¹æœªè®¾ç½®setæ–¹æ³•"></a>å¤–éƒ¨ç±»setå’Œgetæ–¹æ³•é½å…¨å¹¶åˆ›å»ºäº†å¯¹è±¡å’Œå±æ€§ï¼Œå¼•ç”¨æ–¹æœªè®¾ç½®setæ–¹æ³•</h1><p><img src="img_17.png" alt="img_17.png"><br><img src="img_18.png" alt="img_18.png"></p><h2 id="åœ¨åˆ›å»ºå±æ€§æ—¶ä¼šè°ƒç”¨setæ–¹æ³•ï¼Œå¼•ç”¨ç±»æ²¡setæ–¹æ³•å°±æ— æ³•è®©å¤–éƒ¨ç±»èµ‹å€¼è¿‡æ¥"><a href="#åœ¨åˆ›å»ºå±æ€§æ—¶ä¼šè°ƒç”¨setæ–¹æ³•ï¼Œå¼•ç”¨ç±»æ²¡setæ–¹æ³•å°±æ— æ³•è®©å¤–éƒ¨ç±»èµ‹å€¼è¿‡æ¥" class="headerlink" title="åœ¨åˆ›å»ºå±æ€§æ—¶ä¼šè°ƒç”¨setæ–¹æ³•ï¼Œå¼•ç”¨ç±»æ²¡setæ–¹æ³•å°±æ— æ³•è®©å¤–éƒ¨ç±»èµ‹å€¼è¿‡æ¥"></a>åœ¨åˆ›å»ºå±æ€§æ—¶ä¼šè°ƒç”¨setæ–¹æ³•ï¼Œå¼•ç”¨ç±»æ²¡setæ–¹æ³•å°±æ— æ³•è®©å¤–éƒ¨ç±»èµ‹å€¼è¿‡æ¥</h2><h1 id="åˆ›å»ºå†…éƒ¨ç±»çš„å±æ€§æ—¶ï¼Œæ²¡è®¾ç½®getæ–¹æ³•ï¼ˆç±»å°±æ— æ³•è°ƒç”¨å†…éƒ¨ç±»çš„å±æ€§ï¼‰ï¼ŒæŠ¥é”™"><a href="#åˆ›å»ºå†…éƒ¨ç±»çš„å±æ€§æ—¶ï¼Œæ²¡è®¾ç½®getæ–¹æ³•ï¼ˆç±»å°±æ— æ³•è°ƒç”¨å†…éƒ¨ç±»çš„å±æ€§ï¼‰ï¼ŒæŠ¥é”™" class="headerlink" title="åˆ›å»ºå†…éƒ¨ç±»çš„å±æ€§æ—¶ï¼Œæ²¡è®¾ç½®getæ–¹æ³•ï¼ˆç±»å°±æ— æ³•è°ƒç”¨å†…éƒ¨ç±»çš„å±æ€§ï¼‰ï¼ŒæŠ¥é”™"></a>åˆ›å»ºå†…éƒ¨ç±»çš„å±æ€§æ—¶ï¼Œæ²¡è®¾ç½®getæ–¹æ³•ï¼ˆç±»å°±æ— æ³•è°ƒç”¨å†…éƒ¨ç±»çš„å±æ€§ï¼‰ï¼ŒæŠ¥é”™</h1><h2 id="è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªé”™è¯¯ï¼šè°ƒç”¨å†…éƒ¨ç±»å±æ€§éœ€è¦xxx-xxè¿™ç§å‘½åæ–¹å¼ï¼Œå¤–éƒ¨ç±»çš„åå­—å¿…é¡»å’Œå†…éƒ¨ç±»çš„å¤–éƒ¨ç±»å±æ€§åä¸€è‡´"><a href="#è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªé”™è¯¯ï¼šè°ƒç”¨å†…éƒ¨ç±»å±æ€§éœ€è¦xxx-xxè¿™ç§å‘½åæ–¹å¼ï¼Œå¤–éƒ¨ç±»çš„åå­—å¿…é¡»å’Œå†…éƒ¨ç±»çš„å¤–éƒ¨ç±»å±æ€§åä¸€è‡´" class="headerlink" title="è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªé”™è¯¯ï¼šè°ƒç”¨å†…éƒ¨ç±»å±æ€§éœ€è¦xxx.xxè¿™ç§å‘½åæ–¹å¼ï¼Œå¤–éƒ¨ç±»çš„åå­—å¿…é¡»å’Œå†…éƒ¨ç±»çš„å¤–éƒ¨ç±»å±æ€§åä¸€è‡´"></a>è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªé”™è¯¯ï¼šè°ƒç”¨å†…éƒ¨ç±»å±æ€§éœ€è¦xxx.xxè¿™ç§å‘½åæ–¹å¼ï¼Œå¤–éƒ¨ç±»çš„åå­—å¿…é¡»å’Œå†…éƒ¨ç±»çš„å¤–éƒ¨ç±»å±æ€§åä¸€è‡´</h2><p><img src="img_19.png" alt="img_19.png"></p><h2 id="æ”¹æ­£ï¼š"><a href="#æ”¹æ­£ï¼š" class="headerlink" title="æ”¹æ­£ï¼š"></a>æ”¹æ­£ï¼š</h2><p><img src="img_20.png" alt="img_20.png"><br><img src="img_21.png" alt="img_21.png"></p><h1 id="xmlé…ç½®é”™è¯¯"><a href="#xmlé…ç½®é”™è¯¯" class="headerlink" title="xmlé…ç½®é”™è¯¯"></a>xmlé…ç½®é”™è¯¯</h1><p><img src="img_22.png" alt="img_22.png"><br><img src="img_23.png" alt="img_23.png">   </p><h2 id="æ›´æ­£"><a href="#æ›´æ­£" class="headerlink" title="æ›´æ­£"></a>æ›´æ­£</h2><p><img src="img_24.png" alt="img_24.png"></p><h1 id="æŒ‰ç…§åç§°æ³¨å…¥æŠ¥é”™"><a href="#æŒ‰ç…§åç§°æ³¨å…¥æŠ¥é”™" class="headerlink" title="æŒ‰ç…§åç§°æ³¨å…¥æŠ¥é”™"></a>æŒ‰ç…§åç§°æ³¨å…¥æŠ¥é”™</h1><h2 id="è§£å†³ï¼Œé»˜è®¤beanåæ˜¯ç±»åä¸”é¦–å­—æ¯å°å†™"><a href="#è§£å†³ï¼Œé»˜è®¤beanåæ˜¯ç±»åä¸”é¦–å­—æ¯å°å†™" class="headerlink" title="è§£å†³ï¼Œé»˜è®¤beanåæ˜¯ç±»åä¸”é¦–å­—æ¯å°å†™"></a>è§£å†³ï¼Œé»˜è®¤beanåæ˜¯ç±»åä¸”é¦–å­—æ¯å°å†™</h2><p><img src="img_25.png" alt="img_25.png"></p><h1 id="è¿‡æ—¶çš„æ•°æ®åº“api"><a href="#è¿‡æ—¶çš„æ•°æ®åº“api" class="headerlink" title="è¿‡æ—¶çš„æ•°æ®åº“api"></a>è¿‡æ—¶çš„æ•°æ®åº“api</h1><p><img src="img_26.png" alt="img_26.png"></p><h2 id="æŠŠcom-mysql-jdbc-Driveræ”¹ä¸ºcom-mysql-cj-jdbc-Driver"><a href="#æŠŠcom-mysql-jdbc-Driveræ”¹ä¸ºcom-mysql-cj-jdbc-Driver" class="headerlink" title="æŠŠcom.mysql.jdbc.Driveræ”¹ä¸ºcom.mysql.cj.jdbc.Driver"></a>æŠŠcom.mysql.jdbc.Driveræ”¹ä¸ºcom.mysql.cj.jdbc.Driver</h2><h1 id="æ•°æ®åº“å‚æ•°ä¸åŒ¹é…"><a href="#æ•°æ®åº“å‚æ•°ä¸åŒ¹é…" class="headerlink" title="æ•°æ®åº“å‚æ•°ä¸åŒ¹é…"></a>æ•°æ®åº“å‚æ•°ä¸åŒ¹é…</h1><p><img src="img_27.png" alt="img_27.png"></p><h2 id="argså‚æ•°è¦å’Œæ•°æ®åº“å®Œå…¨åŒ¹é…ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘"><a href="#argså‚æ•°è¦å’Œæ•°æ®åº“å®Œå…¨åŒ¹é…ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘" class="headerlink" title="argså‚æ•°è¦å’Œæ•°æ®åº“å®Œå…¨åŒ¹é…ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘"></a>argså‚æ•°è¦å’Œæ•°æ®åº“å®Œå…¨åŒ¹é…ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘</h2><p><img src="img_28.png" alt="img_28.png"></p><h1 id="æœªæŒ‡å®šæ˜ å°„ç±»"><a href="#æœªæŒ‡å®šæ˜ å°„ç±»" class="headerlink" title="æœªæŒ‡å®šæ˜ å°„ç±»"></a>æœªæŒ‡å®šæ˜ å°„ç±»</h1><h2 id="ä½¿ç”¨BeanPropertyRowMapperæ—¶ï¼Œæ„é€ å™¨æœªä¼ é€’å‚æ•°"><a href="#ä½¿ç”¨BeanPropertyRowMapperæ—¶ï¼Œæ„é€ å™¨æœªä¼ é€’å‚æ•°" class="headerlink" title="ä½¿ç”¨BeanPropertyRowMapperæ—¶ï¼Œæ„é€ å™¨æœªä¼ é€’å‚æ•°"></a>ä½¿ç”¨BeanPropertyRowMapperæ—¶ï¼Œæ„é€ å™¨æœªä¼ é€’å‚æ•°</h2><h2 id="è§£å†³ï¼šåœ¨æ„é€ å™¨é‡Œä¼ é€’è¦æ˜ å°„çš„ç±»Book-class"><a href="#è§£å†³ï¼šåœ¨æ„é€ å™¨é‡Œä¼ é€’è¦æ˜ å°„çš„ç±»Book-class" class="headerlink" title="è§£å†³ï¼šåœ¨æ„é€ å™¨é‡Œä¼ é€’è¦æ˜ å°„çš„ç±»Book.class"></a>è§£å†³ï¼šåœ¨æ„é€ å™¨é‡Œä¼ é€’è¦æ˜ å°„çš„ç±»Book.class</h2><p><img src="img_29.png" alt="img_29.png"><br><img src="img_30.png" alt="img_30.png"></p>]]></content>
      
      
      <categories>
          
          <category> ssm </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> spring </tag>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> bugè®°å½• </tag>
            
            <tag> ssm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ç†è®º</title>
      <link href="/2022/10/13/fen-bu-shi-li-lun/fen-bu-shi-li-lun/"/>
      <url>/2022/10/13/fen-bu-shi-li-lun/fen-bu-shi-li-lun/</url>
      
        <content type="html"><![CDATA[<h1 id="äºŒ-åˆ†å¸ƒå¼ç†è®º"><a href="#äºŒ-åˆ†å¸ƒå¼ç†è®º" class="headerlink" title="äºŒ,åˆ†å¸ƒå¼ç†è®º"></a>äºŒ,åˆ†å¸ƒå¼ç†è®º</h1><h2 id="2-1-æ•°æ®ä¸€è‡´æ€§"><a href="#2-1-æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="2.1,æ•°æ®ä¸€è‡´æ€§"></a>2.1,æ•°æ®ä¸€è‡´æ€§</h2><h3 id="2-1-1-ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§"><a href="#2-1-1-ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="2.1.1,ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§"></a>2.1.1,ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§</h3><p>æ•°æ®åœ¨å¤šå‰¯æœ¬ä¸­ä¿å­˜,å„å‰¯æœ¬æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„</p><h3 id="2-1-2-å‰¯æœ¬ä¸€è‡´æ€§"><a href="#2-1-2-å‰¯æœ¬ä¸€è‡´æ€§" class="headerlink" title="2.1.2,å‰¯æœ¬ä¸€è‡´æ€§"></a>2.1.2,å‰¯æœ¬ä¸€è‡´æ€§</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­,æ•°æ®å¾€å¾€æœ‰å¤šä¸ªå‰¯æœ¬,åˆ™å¸¦æ¥äº†<strong>æ•°æ®åŒæ­¥</strong>çš„é—®é¢˜,å› ä¸ºå»¶è¿Ÿç­‰å› ç´ ,å‡ ä¹æ— æ³•ä¿è¯åŒæ—¶æ›´æ–°æ‰€æœ‰å‰¯æœ¬æ•°æ®,<br>åœ¨æ€§èƒ½å’Œä¸€è‡´æ€§ä¹‹é—´,éœ€è¦æƒè¡¡-&gt;åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®</p><h3 id="2-1-3-ä¸€è‡´æ€§åˆ†ç±»"><a href="#2-1-3-ä¸€è‡´æ€§åˆ†ç±»" class="headerlink" title="2.1.3,ä¸€è‡´æ€§åˆ†ç±»"></a>2.1.3,ä¸€è‡´æ€§åˆ†ç±»</h3><p>å¼ºä¸€è‡´æ€§-&gt;ç³»ç»Ÿå†™ä»€ä¹ˆ,è¯»å‡ºæ¥å°±æ˜¯ä»€ä¹ˆ,ä½†æ˜¯å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“å¤§,ä¹Ÿå¾ˆéš¾å®ç°  </p><p>å¼±ä¸€è‡´æ€§-&gt;å†™å…¥æˆåŠŸå,ä¸ä¸€å®šç«‹åˆ»ä¸”ä¸ä¸€å®šå¤šä¹…å¯ä»¥è¯»åˆ°å†™å…¥çš„å€¼,ä½†å°½å¯èƒ½åœ¨æŸä¸ªæ—¶é—´çº§åˆ«åè®©æ•°æ®è¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€</p><p>æœ€ç»ˆä¸€è‡´æ€§-&gt;<strong>ä¹Ÿæ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ç§</strong>,<strong>ä¿è¯ä¸€æ®µæ—¶é—´å,èŠ‚ç‚¹æ•°æ®è¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€</strong>,<br>åœ¨ä¸€è‡´æ€§çŠ¶æ€å‰çš„æ—¶é—´ç‰‡æ®µç§°ä¸º[ä¸ä¸€è‡´çª—å£]</p><p>æœ€ç»ˆä¸€è‡´æ€§åˆæœ‰å¤šä¸ªå˜ç§-&gt;å› æœä¸€è‡´æ€§||è¯»å·±æ‰€å†™ä¸€è‡´æ€§||ä¼šè¯ä¸€è‡´æ€§||å•è°ƒ/å†™è¯»ä¸€è‡´æ€§||</p><p><img src="img1.png" alt="ä¸€è‡´æ€§åˆ†ç±»"></p><h2 id="2-2-CAPå®šç†"><a href="#2-2-CAPå®šç†" class="headerlink" title="2.2,CAPå®šç†"></a>2.2,CAPå®šç†</h2><h3 id="2-2-1-CAPå®šç†ä»‹ç»"><a href="#2-2-1-CAPå®šç†ä»‹ç»" class="headerlink" title="2.2.1,CAPå®šç†ä»‹ç»"></a>2.2.1,CAPå®šç†ä»‹ç»</h3><p>åˆç§°å¸ƒé²å°”å®šç†,å®ƒæŒ‡å‡º,å¯¹ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿ,<strong>ä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹</strong>:</p><p><img src="img3.png" alt="CAPå®šç†"></p><h4 id="1-ä¸€è‡´æ€§"><a href="#1-ä¸€è‡´æ€§" class="headerlink" title="1.ä¸€è‡´æ€§"></a>1.ä¸€è‡´æ€§</h4><p>æŒ‡çš„æ˜¯å¼ºä¸€è‡´æ€§,ä¸€æ—¦å®¢æˆ·ç«¯å†™å…¥æ•°æ®,åˆ™å…¶ä»–èŠ‚ç‚¹è®¿é—®çš„ä»»ä½•ä¸€å°æœåŠ¡å™¨èŠ‚ç‚¹å¾—åˆ°çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®</p><h4 id="2-å¯ç”¨æ€§"><a href="#2-å¯ç”¨æ€§" class="headerlink" title="2.å¯ç”¨æ€§"></a>2.å¯ç”¨æ€§</h4><p>ç³»ç»Ÿä¸­çš„éæ•…éšœèŠ‚ç‚¹æ”¶åˆ°æ¯ä¸ªè¯·æ±‚éƒ½æœ‰å“åº”,ä¸å…è®¸æœåŠ¡å™¨å¿½ç•¥è¯·æ±‚</p><h4 id="3-åˆ†åŒºå®¹é”™æ€§"><a href="#3-åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="3.åˆ†åŒºå®¹é”™æ€§"></a>3.åˆ†åŒºå®¹é”™æ€§</h4><p>å…è®¸ç½‘ç»œä¸¢å¤±ä»»æ„èŠ‚ç‚¹é—´çš„æ¶ˆæ¯ä¸¢å¤±(ä¸åŒæ­¥)</p><h3 id="2-2-2-CAPå¦‚ä½•é€‰æ‹©"><a href="#2-2-2-CAPå¦‚ä½•é€‰æ‹©" class="headerlink" title="2.2.2,CAPå¦‚ä½•é€‰æ‹©"></a>2.2.2,CAPå¦‚ä½•é€‰æ‹©</h3><p><img src="img03.png" alt="img.png"></p><ul><li>CAç³»ç»Ÿ,å…³æ³¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§,ä¸èƒ½å®¹å¿ç½‘ç»œé—®é¢˜æˆ–èŠ‚ç‚¹é”™è¯¯,å‡ºç°è¿™ç§é”™è¯¯,å°±ä¼šæ‹’ç»å†™è¯·æ±‚,å˜æˆåªè¯»</li><li>CPç³»ç»Ÿ,å…³æ³¨ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§,ä¿è¯å¤§å¤šæ•°èŠ‚ç‚¹æ•°æ®ä¸€è‡´,å°‘æ•°èŠ‚ç‚¹ä¼šåœ¨æ²¡æœ‰åŒæ­¥çš„æ—¶å€™å¤„äºä¸å¯ç”¨çŠ¶æ€</li><li>APç³»ç»Ÿ,å…³æ³¨å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§,ç³»ç»Ÿä¸èƒ½è¾¾æˆä¸€è‡´,éœ€è¦ç»™å‡ºæ•°æ®å†²çª,ç»™å‡ºæ•°æ®å†²çªå°±éœ€è¦ç»´æŠ¤æ•°æ®ç‰ˆæœ¬</li></ul><p>äº’è”ç½‘ç”µå•†æ›´å¤šæ˜¯AP,è€Œé“¶è¡Œå¿…é¡»ä¿è¯C</p><h2 id="2-3-BASEç†è®º"><a href="#2-3-BASEç†è®º" class="headerlink" title="2.3,BASEç†è®º"></a>2.3,BASEç†è®º</h2><p>BASE-&gt;åŸºæœ¬å¯ç”¨+è½¯çŠ¶æ€+æœ€ç»ˆä¸€è‡´æ€§;æ˜¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æƒè¡¡,åŸºäºCAPå®šç†æ¼”åŒ–  </p><p>æ ¸å¿ƒæ€æƒ³: æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§,åˆ™æ ¹æ®ä¸åŒåº”ç”¨çš„ç‰¹ç‚¹é‡‡ç”¨åˆé€‚çš„æ–¹å¼è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§  </p><h3 id="2-3-1-åŸºæœ¬å¯ç”¨"><a href="#2-3-1-åŸºæœ¬å¯ç”¨" class="headerlink" title="2.3.1,åŸºæœ¬å¯ç”¨"></a>2.3.1,åŸºæœ¬å¯ç”¨</h3><p>å‡ºç°ä¸å¯é¢„çŸ¥çš„æ•…éšœ,ä½†è¿˜æ˜¯èƒ½ç”¨,ç›¸æ¯”ä¸€èˆ¬ç³»ç»Ÿ,å¯èƒ½å‡ºç°:</p><ul><li>å“åº”æ—¶é—´çš„æŸå¤±: æ­£å¸¸ç³»ç»Ÿåœ¨0.5å†…è¿”å›ç»“æœ,åŸºæœ¬å¯ç”¨åˆ™åœ¨1ç§’å†…è¿”å›</li><li>åŠŸèƒ½ä¸Šçš„æŸå¤±: æ­£å¸¸è´­ç‰©å¯ä»¥é¡ºåˆ©äº¤æ˜“,ä½†æ˜¯æ´»åŠ¨æµé‡å¤§çš„æ—¶å€™,ä¸ºäº†ä¿è¯ç¨³å®š,éƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½è¢«å¼•å¯¼åˆ°é™çº§é¡µé¢  </li></ul><h3 id="2-3-2-è½¯çŠ¶æ€"><a href="#2-3-2-è½¯çŠ¶æ€" class="headerlink" title="2.3.2,è½¯çŠ¶æ€"></a>2.3.2,è½¯çŠ¶æ€</h3><p>ç¡¬çŠ¶æ€è¦æ±‚å¤šä¸ªèŠ‚ç‚¹æ•°æ®å‰¯æœ¬ä¸€è‡´,è½¯çŠ¶æ€åˆ™å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€,å…è®¸ä¸åŒèŠ‚ç‚¹çš„å‰¯æœ¬æ•°æ®å­˜åœ¨æ•°æ®å»¶æ—¶</p><h3 id="2-3-3-æœ€ç»ˆä¸€è‡´æ€§"><a href="#2-3-3-æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="2.3.3,æœ€ç»ˆä¸€è‡´æ€§"></a>2.3.3,æœ€ç»ˆä¸€è‡´æ€§</h3><p>è½¯çŠ¶æ€åœ¨ä¸€å®šæ—¶é—´å†…è¾¾åˆ°å‰¯æœ¬æ•°æ®ä¸€è‡´</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º</title>
      <link href="/2022/10/13/fen-bu-shi-yi-zhi-xing-xie-yi/fen-bu-shi-yi-zhi-xing-xie-yi/"/>
      <url>/2022/10/13/fen-bu-shi-yi-zhi-xing-xie-yi/fen-bu-shi-yi-zhi-xing-xie-yi/</url>
      
        <content type="html"><![CDATA[<h1 id="3-1-äºŒé˜¶æ®µæäº¤åè®®-2PC"><a href="#3-1-äºŒé˜¶æ®µæäº¤åè®®-2PC" class="headerlink" title="3.1,äºŒé˜¶æ®µæäº¤åè®®(2PC)"></a>3.1,äºŒé˜¶æ®µæäº¤åè®®(2PC)</h1><h2 id="3-1-1-äºŒé˜¶æ®µæäº¤åè®®"><a href="#3-1-1-äºŒé˜¶æ®µæäº¤åè®®" class="headerlink" title="3.1.1,äºŒé˜¶æ®µæäº¤åè®®"></a>3.1.1,äºŒé˜¶æ®µæäº¤åè®®</h2><p>ç®€ç§°2PC,æ˜¯æ¯”è¾ƒå¸¸è§çš„è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„æ–¹å¼: è¦ä¹ˆæ‰€æœ‰å‚ä¸è¿›ç¨‹éƒ½æäº¤äº‹åŠ¡,è¦ä¹ˆéƒ½å–æ¶ˆäº‹åŠ¡,å³å®ç°ACIDçš„AåŸå­æ€§</p><blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡: äº‹åŠ¡æä¾›ä¸€ç§æ“ä½œæœ¬åœ°æ•°æ®åº“çš„ä¸å¯åˆ†å‰²çš„ä¸€ç³»åˆ—æ“ä½œ,â€è¦ä¹ˆä»€ä¹ˆéƒ½ä¸åš,è¦ä¹ˆåšå…¨å¥—(All or Nothing)â€çš„æœºåˆ¶,<br>è€Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯ä¸ºäº†æ“ä½œä¸åŒæ•°æ®åº“çš„ä¸å¯åˆ†å‰²çš„ä¸€ç³»åˆ—æ“ä½œçš„æœºåˆ¶</p></blockquote><p><img src="img4.png" alt="img.png"> </p><h2 id="3-1-2-æ‰§è¡Œæµç¨‹"><a href="#3-1-2-æ‰§è¡Œæµç¨‹" class="headerlink" title="3.1.2,æ‰§è¡Œæµç¨‹"></a>3.1.2,æ‰§è¡Œæµç¨‹</h2><h3 id="1-æˆåŠŸæ‰§è¡Œçš„äº‹åŠ¡æäº¤æµç¨‹"><a href="#1-æˆåŠŸæ‰§è¡Œçš„äº‹åŠ¡æäº¤æµç¨‹" class="headerlink" title="1,æˆåŠŸæ‰§è¡Œçš„äº‹åŠ¡æäº¤æµç¨‹"></a>1,æˆåŠŸæ‰§è¡Œçš„äº‹åŠ¡æäº¤æµç¨‹</h3><p><img src="img.png" alt="img.png"><br>é˜¶æ®µä¸€: </p><ul><li>äº‹åŠ¡è¯¢é—®</li><li>æ‰§è¡Œäº‹åŠ¡</li><li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº” </li></ul><p>é˜¶æ®µäºŒ: </p><ul><li>å‘é€æäº¤è¯·æ±‚</li><li>äº‹åŠ¡æäº¤</li><li>åé¦ˆäº‹åŠ¡æäº¤ç»“æœ</li><li>å®Œæˆäº‹åŠ¡</li></ul><h3 id="2-ä¸­æ–­äº‹åŠ¡æµç¨‹"><a href="#2-ä¸­æ–­äº‹åŠ¡æµç¨‹" class="headerlink" title="2,ä¸­æ–­äº‹åŠ¡æµç¨‹"></a>2,ä¸­æ–­äº‹åŠ¡æµç¨‹</h3><p>å‡å¦‚ä»»ä½•ä¸€ä¸ªå‚ä¸è€…æŒ‚äº†(è¶…æ—¶ç­‰),åè°ƒè€…æ— æ³•æ¥æ”¶åˆ°åé¦ˆ,ä¼šä¸­æ–­äº‹åŠ¡  </p><p>é˜¶æ®µä¸€: </p><ul><li>äº‹åŠ¡è¯¢é—®</li><li>æ‰§è¡Œäº‹åŠ¡</li><li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº” </li></ul><p>é˜¶æ®µäºŒ: </p><ul><li>å‘é€å›æ»šè¯·æ±‚</li><li>äº‹åŠ¡å›æ»š</li><li>åé¦ˆäº‹åŠ¡å›æ»šç»“æœ </li><li>ä¸­æ–­äº‹åŠ¡</li></ul><h2 id="3-1-3-2PCçš„ä¼˜ç¼ºç‚¹"><a href="#3-1-3-2PCçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3.1.3 2PCçš„ä¼˜ç¼ºç‚¹"></a>3.1.3 2PCçš„ä¼˜ç¼ºç‚¹</h2><h3 id="1-ä¼˜ç‚¹"><a href="#1-ä¼˜ç‚¹" class="headerlink" title="1,ä¼˜ç‚¹"></a>1,ä¼˜ç‚¹</h3><p>åŸç†ç®€å•</p><h3 id="2-ç¼ºç‚¹"><a href="#2-ç¼ºç‚¹" class="headerlink" title="2,ç¼ºç‚¹"></a>2,ç¼ºç‚¹</h3><ul><li>åŒæ­¥é˜»å¡<br>åœ¨äºŒé˜¶æ®µæäº¤çš„æ‰§è¡Œè¿‡ç¨‹ä¸­,äº‹åŠ¡å¤„äºé˜»å¡çŠ¶æ€,å¦‚æœå‚ä¸è€…å ç”¨å…¬å…±èµ„æº,åˆ™å…¶ä»–èŠ‚ç‚¹è®¿é—®ä¼šè¢«é˜»å¡</li><li>å•ç‚¹é—®é¢˜<br>åè°ƒè€…å‡ºç°é—®é¢˜,æäº¤æµç¨‹å‡ºç°é—®é¢˜,æ‰€æœ‰å‚ä¸è€…ä¸€ç›´å¤„äºäº‹åŠ¡é”å®šçŠ¶æ€</li><li>æ•°æ®ä¸ä¸€è‡´<br>åè°ƒè€…å‘é€commitè¯·æ±‚,å¦‚æœä¸€éƒ¨åˆ†å‚ä¸è€…ç½‘ç»œæ•…éšœæˆ–å®•æœº,åˆ™ä¼šå‡ºç°æ— æ³•æ¥æ”¶commitè¯·æ±‚æ¥å®Œæˆäº‹åŠ¡æ“ä½œ,å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜</li><li>æ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶<br>ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å¤±è´¥</li></ul><h1 id="3-2-ä¸‰é˜¶æ®µæäº¤åè®®-3PC"><a href="#3-2-ä¸‰é˜¶æ®µæäº¤åè®®-3PC" class="headerlink" title="3.2,ä¸‰é˜¶æ®µæäº¤åè®®(3PC)"></a>3.2,ä¸‰é˜¶æ®µæäº¤åè®®(3PC)</h1><h1 id="3-3-NWRåè®®"><a href="#3-3-NWRåè®®" class="headerlink" title="3.3,NWRåè®®"></a>3.3,NWRåè®®</h1><h1 id="3-4-Gossipåè®®"><a href="#3-4-Gossipåè®®" class="headerlink" title="3.4,Gossipåè®®"></a>3.4,Gossipåè®®</h1><h1 id="3-5-Paxosåè®®"><a href="#3-5-Paxosåè®®" class="headerlink" title="3.5,Paxosåè®®"></a>3.5,Paxosåè®®</h1><h1 id="3-6-Raftåè®®"><a href="#3-6-Raftåè®®" class="headerlink" title="3.6,Raftåè®®"></a>3.6,Raftåè®®</h1><h1 id="3-7-Leaseæœºåˆ¶"><a href="#3-7-Leaseæœºåˆ¶" class="headerlink" title="3.7,Leaseæœºåˆ¶"></a>3.7,Leaseæœºåˆ¶</h1>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º</title>
      <link href="/2022/10/05/fen-bu-shi-jia-gou-she-ji/fen-bu-shi-jia-gou-she-ji/"/>
      <url>/2022/10/05/fen-bu-shi-jia-gou-she-ji/fen-bu-shi-jia-gou-she-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€-åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º"><a href="#ä¸€-åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º" class="headerlink" title="ä¸€,åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º"></a>ä¸€,åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º</h1><h2 id="ä¸€-åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º-1"><a href="#ä¸€-åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º-1" class="headerlink" title="ä¸€,åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º"></a>ä¸€,åˆ†å¸ƒå¼æ¶æ„ä¸ç†è®º</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ" class="headerlink" title="1.1,ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ"></a>1.1,ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ç¡¬è½¯ä»¶åˆ†å¸ƒåœ¨ä¸åŒç½‘ç»œè®¡ç®—æœºä¸Š,å½¼æ­¤é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡åè°ƒçš„ç³»ç»Ÿ  </p><p>æŠŠä¸€ä¸ªå¤§çš„ä¸šåŠ¡æ‹†æˆå¤šä¸ªå¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œå®ç°åŠŸèƒ½çš„å­æ¨¡å—,åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨èŠ‚ç‚¹,å…±åŒæ„æˆçš„ç³»ç»Ÿ  </p><p><img src="img0.png" alt="åˆ†å¸ƒå¼ç³»ç»Ÿ">  </p><h3 id="1-2-åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„åŒºåˆ«"><a href="#1-2-åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„åŒºåˆ«" class="headerlink" title="1.2,åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„åŒºåˆ«"></a>1.2,åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„åŒºåˆ«</h3><p>é›†ç¾¤-&gt;å¤šä¸ªæœåŠ¡åšåŒä¸€ä»¶äº‹  </p><p>åˆ†å¸ƒå¼-&gt;å¤šä¸ªæœåŠ¡åšä¸åŒçš„äº‹  </p><h3 id="1-3-åˆ†å¸ƒå¼ç³»ç»Ÿç‰¹æ€§"><a href="#1-3-åˆ†å¸ƒå¼ç³»ç»Ÿç‰¹æ€§" class="headerlink" title="1.3,åˆ†å¸ƒå¼ç³»ç»Ÿç‰¹æ€§"></a>1.3,åˆ†å¸ƒå¼ç³»ç»Ÿç‰¹æ€§</h3><p>åˆ†å¸ƒæ€§-&gt;å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒç©ºé—´(ç‰©ç†)   </p><p>å¯¹ç­‰æ€§-&gt;è®¡ç®—æœºæœåŠ¡èŠ‚ç‚¹æ²¡æœ‰ä¸»ä»ä¹‹åˆ†  </p><p>å¹¶å‘æ€§-&gt;åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤šä¸ªèŠ‚ç‚¹,å¯èƒ½å¹¶å‘åœ°æ“ä½œèµ„æº(æ•°æ®åº“ç­‰)  </p><p>ç¼ºä¹å…¨å±€æ—¶é’Ÿ-&gt;ç”±äºå¤„äºä¸åŒæœºå™¨,è€Œä¸”æ˜¯è¿œç¨‹é€šä¿¡,äº‹ä»¶æ‰§è¡Œçš„å…ˆåé¡ºåºéš¾ä»¥ç¡®è®¤  </p><p>æ•…éšœå®¹æ˜“å‘ç”Ÿ-&gt;æœºå™¨è¶Šå¤š,è¶Šæœ‰å¯èƒ½å‘ç”Ÿå±€éƒ¨çš„æ•…éšœ  </p><p>å•ç‚¹æ•…éšœ-&gt;å¦‚æœæŸä¸ªåŠŸèƒ½/è§’è‰²åªæœ‰ä¸€å°è®¡ç®—æœºæ”¯æ’‘,åˆ™å®ƒå‡ºç°çš„æ•…éšœå°±æ˜¯å•ç‚¹æ•…éšœ</p><h3 id="1-4-åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"><a href="#1-4-åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜" class="headerlink" title="1.4,åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"></a>1.4,åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜</h3><h4 id="1-é€šä¿¡å¼‚å¸¸"><a href="#1-é€šä¿¡å¼‚å¸¸" class="headerlink" title="1,é€šä¿¡å¼‚å¸¸"></a>1,é€šä¿¡å¼‚å¸¸</h4><p>ç½‘ç»œæœ¬èº«å¯èƒ½å¼‚å¸¸,åˆ™ä¼šå‡ºç°<strong>åˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•å®Œæˆä¸€æ¬¡ç½‘ç»œé€šä¿¡</strong>çš„æƒ…å†µ,<br>è€Œä¸”,è¿œç¨‹é€šä¿¡ä¹Ÿæœ‰å»¶è¿Ÿ,ç»¼ä¸Š,åˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆå®¹æ˜“å‡ºç°<strong>æ¶ˆæ¯ä¸¢å¤±å’Œå»¶è¿Ÿ</strong></p><h4 id="2-ç½‘ç»œåˆ†åŒº"><a href="#2-ç½‘ç»œåˆ†åŒº" class="headerlink" title="2,ç½‘ç»œåˆ†åŒº"></a>2,ç½‘ç»œåˆ†åŒº</h4><p>éƒ¨åˆ†ç½‘ç»œä¸è¿é€š,ä½†æ˜¯å­ç½‘ç»œå†…éƒ¨çš„ç½‘ç»œé€šä¿¡æ­£å¸¸,å¯¼è‡´ç½‘ç»œç¯å¢ƒåˆ†æˆäº†ä¸åŒçš„åŒºåŸŸ,å‡ºç°<strong>å±€éƒ¨å°é›†ç¾¤</strong>,<br>æ­¤æ—¶éœ€è¦è¿™äº›å°é›†ç¾¤å®ŒæˆæœåŠ¡,å¯¹åˆ†å¸ƒå¼ä¸€è‡´æ€§æå‡ºå·¨å¤§æŒ‘æˆ˜</p><h4 id="3-èŠ‚ç‚¹æ•…éšœ"><a href="#3-èŠ‚ç‚¹æ•…éšœ" class="headerlink" title="3,èŠ‚ç‚¹æ•…éšœ"></a>3,èŠ‚ç‚¹æ•…éšœ</h4><p>ç»„æˆå¾®æœåŠ¡çš„æœåŠ¡å™¨èŠ‚ç‚¹å®•æœºæˆ–åƒµæ­»</p><h4 id="4-ä¸‰æ€-é‡å‘"><a href="#4-ä¸‰æ€-é‡å‘" class="headerlink" title="4,ä¸‰æ€,é‡å‘"></a>4,ä¸‰æ€,é‡å‘</h4><p>ä¸‰æ€-&gt;åˆ†å¸ƒå¼ç³»ç»Ÿæ¯æ¬¡è¯·æ±‚å“åº”éƒ½æœ‰<strong>æˆåŠŸ/å¤±è´¥/è¶…æ—¶</strong>ä¸‰ç§çŠ¶æ€  </p><p>é‡å‘-&gt;è¶…æ—¶/å¤±è´¥çš„æƒ…å†µå°±éœ€è¦é‡æ–°å‘èµ·è°ƒç”¨</p><h4 id="5-å¹‚ç­‰"><a href="#5-å¹‚ç­‰" class="headerlink" title="5,å¹‚ç­‰"></a>5,å¹‚ç­‰</h4><p>å¤šæ¬¡è¯·æ±‚æŸä¸ªèµ„æº,å¯¹èµ„æºæœ¬èº«éƒ½æ˜¯äº§ç”Ÿå’Œä¸€æ¬¡è°ƒç”¨ç›¸åŒçš„ç»“æœ </p><h1 id="å››-åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç­–ç•¥"><a href="#å››-åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç­–ç•¥" class="headerlink" title="å››,åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç­–ç•¥"></a>å››,åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç­–ç•¥</h1><h1 id="äº”-åˆ†å¸ƒå¼æ¶æ„æœåŠ¡è°ƒç”¨"><a href="#äº”-åˆ†å¸ƒå¼æ¶æ„æœåŠ¡è°ƒç”¨" class="headerlink" title="äº”,åˆ†å¸ƒå¼æ¶æ„æœåŠ¡è°ƒç”¨"></a>äº”,åˆ†å¸ƒå¼æ¶æ„æœåŠ¡è°ƒç”¨</h1><h1 id="å…­-åˆ†å¸ƒå¼æœåŠ¡æ²»ç†"><a href="#å…­-åˆ†å¸ƒå¼æœåŠ¡æ²»ç†" class="headerlink" title="å…­,åˆ†å¸ƒå¼æœåŠ¡æ²»ç†"></a>å…­,åˆ†å¸ƒå¼æœåŠ¡æ²»ç†</h1><h1 id="ä¸ƒ-æ¶æ„è®¾è®¡åŸºæœ¬åŸåˆ™"><a href="#ä¸ƒ-æ¶æ„è®¾è®¡åŸºæœ¬åŸåˆ™" class="headerlink" title="ä¸ƒ,æ¶æ„è®¾è®¡åŸºæœ¬åŸåˆ™"></a>ä¸ƒ,æ¶æ„è®¾è®¡åŸºæœ¬åŸåˆ™</h1>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€ä»£å¾®æœåŠ¡</title>
      <link href="/2022/10/05/di-yi-dai-wei-fu-wu/di-yi-dai-wei-fu-wu/"/>
      <url>/2022/10/05/di-yi-dai-wei-fu-wu/di-yi-dai-wei-fu-wu/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ‹è¯•æ–‡ç« </title>
      <link href="/2022/10/04/ce-shi-wen-zhang/ce-shi-wen-zhang/"/>
      <url>/2022/10/04/ce-shi-wen-zhang/ce-shi-wen-zhang/</url>
      
        <content type="html"><![CDATA[<p>æµ‹è¯•æ–‡ç« </p><img src="/2022/10/04/ce-shi-wen-zhang/ce-shi-wen-zhang/test.jpg" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p><img src="test.jpg" alt="å›¾ç‰‡å¼•ç”¨æ–¹æ³•äºŒ"></p><p><img src="/images/test.jpg" alt="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸‰"></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸåˆ› </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
