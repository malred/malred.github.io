<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="flutter-build-5-social-app, HTML,CSS,React,Vue,Java,Go,微服务,linux">
    <meta name="description" content="1. Introduction
3. Instagram Clone1. Demo
2. Setup &amp;amp; Theming the Appflutter create instagram_flutter
flutter devices">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>flutter-build-5-social-app | malred-blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">malred-blog</span>
                    </a>
                </div>
                

<a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">malred-blog</div>
        <div class="logo-desc">
            
            前后端学习者,存放知识笔记
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
    </ul>

    <div class="social-link">
    <a href="https://github.com/malred" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:malguy2022@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2725953379" class="tooltipped" data-tooltip="QQ联系我: 2725953379" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
</div>

            </div>
        </div>

        
    </nav>
</header>


<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/15.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        flutter-build-5-social-app
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/flutter/" target="_blank">
                                <span class="chip bg-color">flutter</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/flutter/" class="post-category" target="_blank">
                                flutter
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-05-04
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        10.4k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        62 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><p><img src="20230713115055.png"></p>
<h1 id="3-Instagram-Clone"><a href="#3-Instagram-Clone" class="headerlink" title="3. Instagram Clone"></a>3. Instagram Clone</h1><h2 id="1-Demo"><a href="#1-Demo" class="headerlink" title="1. Demo"></a>1. Demo</h2><p><img src="20230713115752.png"></p>
<h2 id="2-Setup-amp-Theming-the-App"><a href="#2-Setup-amp-Theming-the-App" class="headerlink" title="2. Setup &amp; Theming the App"></a>2. Setup &amp; Theming the App</h2><pre class=" language-shell"><code class="language-shell">flutter create instagram_flutter
flutter devices
flutter run -d <设备名>
</code></pre>
<p><img src="20230713121812.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>
      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string">'Instagram Clone'</span><span class="token punctuation">,</span>
      theme<span class="token punctuation">:</span> ThemeData<span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>scaffoldBackgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
      home<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        body<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Let's build Instagram"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// utils/colors.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mobileBackgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webBackgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mobileSearchColor <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> blueColor <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">246</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> primaryColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">;</span>
<span class="token keyword">const</span> secondaryColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">;</span>
</code></pre>
<p><img src="20230713122109.png"></p>
<h2 id="3-Building-Responsive-Layout-Widget"><a href="#3-Building-Responsive-Layout-Widget" class="headerlink" title="3. Building Responsive Layout Widget"></a>3. Building Responsive Layout Widget</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/mobile_screen_layout.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/responsive_layout_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/web_screen_layout.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>
      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string">'Instagram Clone'</span><span class="token punctuation">,</span>
      theme<span class="token punctuation">:</span> ThemeData<span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>scaffoldBackgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
      home<span class="token punctuation">:</span> <span class="token function">ResposiveLayout</span><span class="token punctuation">(</span>
        mobileScreenLayout<span class="token punctuation">:</span> <span class="token function">MobileScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        webScreenLayout<span class="token punctuation">:</span> <span class="token function">WebScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// responsive/responsive_layout_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/dimensions.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ResposiveLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> Widget webScreenLayout<span class="token punctuation">;</span>
  <span class="token keyword">final</span> Widget mobileScreenLayout<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">ResposiveLayout</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>Key<span class="token operator">?</span> key<span class="token punctuation">,</span>
      required <span class="token keyword">this</span><span class="token punctuation">.</span>webScreenLayout<span class="token punctuation">,</span>
      required <span class="token keyword">this</span><span class="token punctuation">.</span>mobileScreenLayout<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">LayoutBuilder</span><span class="token punctuation">(</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>BuildContext context<span class="token punctuation">,</span> BoxConstraints constraints<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>constraints<span class="token punctuation">.</span>maxWidth <span class="token operator">></span> webScreenSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// web screen</span>
          <span class="token keyword">return</span> webScreenLayout<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// mobile screen</span>
        <span class="token keyword">return</span> mobileScreenLayout<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// mobile_screen_layout.dart</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter/material.dart"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MobileScreenLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MobileScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'this is mobile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// web_screen_layout.dart</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter/material.dart"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WebScreenLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">WebScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'this is web'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// utils/dimensions.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webScreenSize <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="20230713123408.png"></p>
<h2 id="4-Setting-Up-Firebase"><a href="#4-Setting-Up-Firebase" class="headerlink" title="4. Setting Up Firebase"></a>4. Setting Up Firebase</h2><blockquote>
<p>拓展: ctrl+shift+p -&gt; pubspec add/update -&gt; 输入要添加的依赖名 -&gt; enter</p>
</blockquote>
<p><img src="20230713153402.png"><br><img src="20230713153614.png"></p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># pubspec.yaml</span>
<span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud_firestore</span><span class="token punctuation">:</span> ^4.8.2
  <span class="token key atrule">cupertino_icons</span><span class="token punctuation">:</span> ^1.0.2
  <span class="token key atrule">firebase_auth</span><span class="token punctuation">:</span> ^4.6.3
  <span class="token key atrule">firebase_core</span><span class="token punctuation">:</span> ^2.14.0
  <span class="token key atrule">firebase_storage</span><span class="token punctuation">:</span> ^11.2.4
  <span class="token key atrule">flutter</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter

<span class="token key atrule">dev_dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter_lints</span><span class="token punctuation">:</span> ^2.0.0
  <span class="token key atrule">flutter_test</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
</code></pre>
<p><img src="20230713154147.png"><br><img src="20230713154215.png"><br><img src="20230713154234.png"><br><img src="20230713154257.png"><br><img src="20230713154327.png"><br><img src="20230713154357.png" alt="选一个靠近自己的位置"><br><img src="20230713154428.png"><br><img src="20230713154510.png"><br><img src="20230713155018.png" alt="xcode是开发苹果系统软件的,mac系统才能下"><br><img src="20230713155142.png"><br><img src="20230713155155.png"><br><img src="20230713155218.png"><br><img src="20230713155227.png"><br><img src="20230713155704.png"><br><img src="20230713155715.png"><br><img src="20230713160617.png"><br><img src="20230713160630.png"><br><img src="20230713160712.png"><br><img src="20230713160729.png"><br><img src="20230713160747.png"><br><img src="20230713161058.png"></p>
<blockquote>
<p>这种是 buildscript 语法</p>
</blockquote>
<p><img src="20230713161528.png"><br><img src="20230713161649.png"></p>
<blockquote>
<p>谷歌商店不允许 com.example 的包</p>
</blockquote>
<p><img src="20230713161907.png"></p>
<p><img src="20230713162201.png"><br><img src="20230713162211.png"><br><img src="20230713162348.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// main.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/mobile_screen_layout.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/responsive_layout_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/web_screen_layout.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  WidgetsFlutterBinding<span class="token punctuation">.</span><span class="token function">ensureInitialized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>kIsWeb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Firebase<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span>
      options<span class="token punctuation">:</span> <span class="token function">FirebaseOptions</span><span class="token punctuation">(</span>
        apiKey<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        appId<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        messagingSenderId<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        projectId<span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
        storageBucket<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Firebase<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="5-Login-Screen-UI-Mobile"><a href="#5-Login-Screen-UI-Mobile" class="headerlink" title="5. Login Screen UI (Mobile)"></a>5. Login Screen UI (Mobile)</h2><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># ...</span>

<span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud_firestore</span><span class="token punctuation">:</span> ^4.8.2
  <span class="token key atrule">cupertino_icons</span><span class="token punctuation">:</span> ^1.0.2
  <span class="token key atrule">firebase_auth</span><span class="token punctuation">:</span> ^4.6.3
  <span class="token key atrule">firebase_core</span><span class="token punctuation">:</span> ^2.14.0
  <span class="token key atrule">firebase_storage</span><span class="token punctuation">:</span> ^11.2.4
  <span class="token key atrule">flutter</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
  <span class="token key atrule">flutter_svg</span><span class="token punctuation">:</span> ^1.1.6

<span class="token key atrule">dev_dependencies</span><span class="token punctuation">:</span>
  <span class="token comment" spellcheck="true"># ...</span>

<span class="token key atrule">flutter</span><span class="token punctuation">:</span>
  <span class="token comment" spellcheck="true"># ...</span>
  <span class="token key atrule">assets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> assets/ic_instagram.svg
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// screens/login_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LoginScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">LoginScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>LoginScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_LoginScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_LoginScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>LoginScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _emailController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _passwordController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _emailController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _passwordController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// SafeArea是一个用于处理屏幕边缘区域的小部件。</span>
      <span class="token comment" spellcheck="true">// 它的作用是确保应用的内容不会被设备的状态栏、导航栏或者设备刘海等区域所覆盖。</span>
      body<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            <span class="token comment" spellcheck="true">// 主轴（这里指的是column)居中</span>
            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// svg image</span>
              SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
                <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
                color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for email</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your email'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>emailAddress<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _emailController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for pass</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                textEditingController<span class="token punctuation">:</span> _passwordController<span class="token punctuation">,</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your password'</span><span class="token punctuation">,</span>
                isPass<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// button login</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Log in'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">ShapeDecoration</span><span class="token punctuation">(</span>
                    shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                      borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                        Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// transitioning to signing up</span>
              <span class="token function">Row</span><span class="token punctuation">(</span>
                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">Container</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Don't have an accout?"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                    onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                      child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token string">"Sign up."</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// widgets/text_field_input.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TextFieldInput</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController textEditingController<span class="token punctuation">;</span>
  <span class="token keyword">final</span> bool isPass<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String hinText<span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextInputType textInputType<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">TextFieldInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>textEditingController<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isPass <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>hinText<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>textInputType<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> inputBorder <span class="token operator">=</span> <span class="token function">OutlineInputBorder</span><span class="token punctuation">(</span>
      borderSide<span class="token punctuation">:</span> Divider<span class="token punctuation">.</span><span class="token function">createBorderSide</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
      controller<span class="token punctuation">:</span> textEditingController<span class="token punctuation">,</span>
      decoration<span class="token punctuation">:</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
        hintText<span class="token punctuation">:</span> hinText<span class="token punctuation">,</span>
        border<span class="token punctuation">:</span> inputBorder<span class="token punctuation">,</span>
        focusedBorder<span class="token punctuation">:</span> inputBorder<span class="token punctuation">,</span>
        filled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        contentPadding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      keyboardType<span class="token punctuation">:</span> textInputType<span class="token punctuation">,</span>
      obscureText<span class="token punctuation">:</span> isPass<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="6-Signup-Screen-UI-Mobile"><a href="#6-Signup-Screen-UI-Mobile" class="headerlink" title="6. Signup Screen UI (Mobile)"></a>6. Signup Screen UI (Mobile)</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// screens/signup_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SignupScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">SignupScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>SignupScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_SignupScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_SignupScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>SignupScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _emailController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _passwordController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _bioController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _usernameController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _emailController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _passwordController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _bioController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _usernameController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// SafeArea是一个用于处理屏幕边缘区域的小部件。</span>
      <span class="token comment" spellcheck="true">// 它的作用是确保应用的内容不会被设备的状态栏、导航栏或者设备刘海等区域所覆盖。</span>
      body<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            <span class="token comment" spellcheck="true">// 主轴（这里指的是column)居中</span>
            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// svg image</span>
              SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
                <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
                color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// cicular widget to accept and show our selected file</span>
              <span class="token function">Stack</span><span class="token punctuation">(</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                    radius<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
                    backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                        <span class="token string">'https://img.zcool.cn/community/019f095ca1b5d4a801208f8bf6f436.jpg@1280w_1l_2o_100sh.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">Positioned</span><span class="token punctuation">(</span>
                    bottom<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
                    left<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                      onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                      icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                        Icons<span class="token punctuation">.</span>add_a_photo<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for username</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your username'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _usernameController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for email</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your email'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>emailAddress<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _emailController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for pass</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                textEditingController<span class="token punctuation">:</span> _passwordController<span class="token punctuation">,</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your password'</span><span class="token punctuation">,</span>
                isPass<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for bio</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your bio'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _bioController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// button login</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Sign up'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">ShapeDecoration</span><span class="token punctuation">(</span>
                    shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                      borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                        Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// transitioning to signing up</span>
              <span class="token function">Row</span><span class="token punctuation">(</span>
                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">Container</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Don't have an accout?"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                    onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                      child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token string">"Sign up."</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="7-Firebase-Signup-Auth"><a href="#7-Firebase-Signup-Auth" class="headerlink" title="7. Firebase Signup Auth"></a>7. Firebase Signup Auth</h2><p><img src="20230713180534.png"><br><img src="20230713180728.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// resources/auth_methods.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseAuth _auth <span class="token operator">=</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// signup user</span>
  Future<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">signUpUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
    required String username<span class="token punctuation">,</span>
    required String bio<span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// required Uint8List file,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    String res <span class="token operator">=</span> <span class="token string">"Some error occurred"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              password<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              username<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              bio<span class="token punctuation">.</span>isNotEmpty
          <span class="token comment" spellcheck="true">// || file != null</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// register user</span>
        UserCredential cred <span class="token operator">=</span> <span class="token keyword">await</span> _auth<span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>
            email<span class="token punctuation">:</span> email<span class="token punctuation">,</span> password<span class="token punctuation">:</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// add user to our database</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
          <span class="token string">"uid"</span><span class="token punctuation">:</span> cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
          <span class="token string">'email'</span><span class="token punctuation">:</span> email<span class="token punctuation">,</span>
          <span class="token string">'bio'</span><span class="token punctuation">:</span> bio<span class="token punctuation">,</span>
          <span class="token string">'followers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">'following'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// await _firestore.collection('users').add({</span>
        <span class="token comment" spellcheck="true">//   'username': username,</span>
        <span class="token comment" spellcheck="true">//   "uid": cred.user!.uid,</span>
        <span class="token comment" spellcheck="true">//   'email': email,</span>
        <span class="token comment" spellcheck="true">//   'bio': bio,</span>
        <span class="token comment" spellcheck="true">//   'followers': [],</span>
        <span class="token comment" spellcheck="true">//   'following': []</span>
        <span class="token comment" spellcheck="true">// });</span>
        res <span class="token operator">=</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="20230713181524.png"><br><img src="20230713181432.png"></p>
<p><img src="20230713182902.png"><br><img src="20230713184932.png"></p>
<p><img src="20230713185245.png"></p>
<pre class=" language-plist"><code class="language-plist">// info.plist
        <key>NSPhotoLibraryUsageDescription</key>
        <string>Photo Library Usage</string>
        <key>NSCameraUsageDescription</key>
        <string>Camera Usage</string>
        <key>NSMicrophoneUsageDescription</key>
        <string>Microphone Usage</string>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// signup_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:image_picker/image_picker.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/auth_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SignupScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">SignupScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>SignupScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_SignupScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_SignupScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>SignupScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _emailController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _passwordController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _bioController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _usernameController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Uint8List<span class="token operator">?</span> _image<span class="token punctuation">;</span>
  bool _isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 释放资源</span>
  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _emailController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _passwordController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _bioController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _usernameController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">selectImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    Uint8List im <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">pickImage</span><span class="token punctuation">(</span>ImageSource<span class="token punctuation">.</span>gallery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _image <span class="token operator">=</span> im<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">signUpUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">AuthMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signUpUser</span><span class="token punctuation">(</span>
      email<span class="token punctuation">:</span> _emailController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
      password<span class="token punctuation">:</span> _passwordController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> _usernameController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
      bio<span class="token punctuation">:</span> _bioController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
      file<span class="token punctuation">:</span> _image<span class="token operator">!</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// SafeArea是一个用于处理屏幕边缘区域的小部件。</span>
      <span class="token comment" spellcheck="true">// 它的作用是确保应用的内容不会被设备的状态栏、导航栏或者设备刘海等区域所覆盖。</span>
      body<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            <span class="token comment" spellcheck="true">// 主轴（这里指的是column)居中</span>
            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// svg image</span>
              SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
                <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
                color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// cicular widget to accept and show our selected file</span>
              <span class="token function">Stack</span><span class="token punctuation">(</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  _image <span class="token operator">!=</span> <span class="token keyword">null</span>
                      <span class="token operator">?</span> <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                          radius<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
                          backgroundImage<span class="token punctuation">:</span> <span class="token function">MemoryImage</span><span class="token punctuation">(</span>_image<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">:</span> <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                          radius<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
                          backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                              <span class="token string">'https://th.bing.com/th/id/OIP.OesLvyzDO6AvU_hYUAT4IAHaHa?pid=ImgDet&amp;rs=1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">Positioned</span><span class="token punctuation">(</span>
                    bottom<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
                    left<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                      onPressed<span class="token punctuation">:</span> selectImage<span class="token punctuation">,</span>
                      icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                        Icons<span class="token punctuation">.</span>add_a_photo<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for username</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your username'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _usernameController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for email</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your email'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>emailAddress<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _emailController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for pass</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                textEditingController<span class="token punctuation">:</span> _passwordController<span class="token punctuation">,</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your password'</span><span class="token punctuation">,</span>
                isPass<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for bio</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your bio'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _bioController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// button login</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                onTap<span class="token punctuation">:</span> signUpUser<span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> _isLoading
                      <span class="token operator">?</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                          <span class="token comment" spellcheck="true">// 加载条</span>
                          child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Sign up'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">ShapeDecoration</span><span class="token punctuation">(</span>
                    shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                      borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                        Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// transitioning to signing up</span>
              <span class="token function">Row</span><span class="token punctuation">(</span>
                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">Container</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Don't have an accout?"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                    onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                      child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token string">"Sign up."</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// auth_methods</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:math'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseAuth _auth <span class="token operator">=</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// signup user</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">signUpUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
    required String username<span class="token punctuation">,</span>
    required String bio<span class="token punctuation">,</span>
    required Uint8List file<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    String res <span class="token operator">=</span> <span class="token string">"Some error occurred"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              password<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              username<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              bio<span class="token punctuation">.</span>isNotEmpty
          <span class="token comment" spellcheck="true">// || file != null</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// register user</span>
        UserCredential cred <span class="token operator">=</span> <span class="token keyword">await</span> _auth<span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>
            email<span class="token punctuation">:</span> email<span class="token punctuation">,</span> password<span class="token punctuation">:</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        String photoUrl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">StorageMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">uploadImageToStorage</span><span class="token punctuation">(</span><span class="token string">'profilePics'</span><span class="token punctuation">,</span> file<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// add user to our database</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
          <span class="token string">"uid"</span><span class="token punctuation">:</span> cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
          <span class="token string">'email'</span><span class="token punctuation">:</span> email<span class="token punctuation">,</span>
          <span class="token string">'bio'</span><span class="token punctuation">:</span> bio<span class="token punctuation">,</span>
          <span class="token string">'followers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">'following'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">'photoUrl'</span><span class="token punctuation">:</span> photoUrl<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// await _firestore.collection('users').add({</span>
        <span class="token comment" spellcheck="true">//   'username': username,</span>
        <span class="token comment" spellcheck="true">//   "uid": cred.user!.uid,</span>
        <span class="token comment" spellcheck="true">//   'email': email,</span>
        <span class="token comment" spellcheck="true">//   'bio': bio,</span>
        <span class="token comment" spellcheck="true">//   'followers': [],</span>
        <span class="token comment" spellcheck="true">//   'following': []</span>
        <span class="token comment" spellcheck="true">// });</span>
        res <span class="token operator">=</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// storage_methods</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_storage/firebase_storage.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">StorageMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseStorage _storage <span class="token operator">=</span> FirebaseStorage<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token keyword">final</span> FirebaseAuth _auth <span class="token operator">=</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// adding image to firebase storage</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">uploadImageToStorage</span><span class="token punctuation">(</span>
      String childName<span class="token punctuation">,</span> Uint8List file<span class="token punctuation">,</span> bool isPost<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    Reference ref <span class="token operator">=</span>
        _storage<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span>childName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span>_auth<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    UploadTask uploadTask <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">putData</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    TaskSnapshot snap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> uploadTask<span class="token punctuation">)</span> <span class="token operator">as</span> TaskSnapshot<span class="token punctuation">;</span>
    String downloadUrl <span class="token operator">=</span> <span class="token keyword">await</span> snap<span class="token punctuation">.</span>ref<span class="token punctuation">.</span><span class="token function">getDownloadURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> downloadUrl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// utils/utils.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:image_picker/image_picker.dart'</span><span class="token punctuation">;</span>

<span class="token function">pickImage</span><span class="token punctuation">(</span>ImageSource source<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> ImagePicker _imagePicker <span class="token operator">=</span> <span class="token function">ImagePicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  XFile<span class="token operator">?</span> _file <span class="token operator">=</span> <span class="token keyword">await</span> _imagePicker<span class="token punctuation">.</span><span class="token function">pickImage</span><span class="token punctuation">(</span>source<span class="token punctuation">:</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>_file <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _file<span class="token punctuation">.</span><span class="token function">readAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">showSnackBar</span><span class="token punctuation">(</span>String content<span class="token punctuation">,</span> BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ScaffoldMessenger<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showSnackBar</span><span class="token punctuation">(</span>
    <span class="token function">SnackBar</span><span class="token punctuation">(</span>
      content<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
        content<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="8-Firebase-Login-Auth"><a href="#8-Firebase-Login-Auth" class="headerlink" title="8. Firebase Login Auth"></a>8. Firebase Login Auth</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// auth_methods.dart</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:math'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseAuth _auth <span class="token operator">=</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// signup user</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">signUpUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
    required String username<span class="token punctuation">,</span>
    required String bio<span class="token punctuation">,</span>
    required Uint8List file<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">loginUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    String res <span class="token operator">=</span> <span class="token string">'Some error occurred'</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span> password<span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> _auth<span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span>
            email<span class="token punctuation">:</span> email<span class="token punctuation">,</span> password<span class="token punctuation">:</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res <span class="token operator">=</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res <span class="token operator">=</span> <span class="token string">'Please enter all the fields'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// login_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/auth_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LoginScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">LoginScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>LoginScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_LoginScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_LoginScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>LoginScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _emailController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _passwordController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bool isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _emailController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _passwordController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">loginUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">AuthMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginUser</span><span class="token punctuation">(</span>
        email<span class="token punctuation">:</span> _emailController<span class="token punctuation">.</span>text<span class="token punctuation">,</span> password<span class="token punctuation">:</span> _passwordController<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// SafeArea是一个用于处理屏幕边缘区域的小部件。</span>
      <span class="token comment" spellcheck="true">// 它的作用是确保应用的内容不会被设备的状态栏、导航栏或者设备刘海等区域所覆盖。</span>
      body<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            <span class="token comment" spellcheck="true">// 主轴（这里指的是column)居中</span>
            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// svg image</span>
              SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
                <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
                color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for email</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your email'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>emailAddress<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _emailController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for pass</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                textEditingController<span class="token punctuation">:</span> _passwordController<span class="token punctuation">,</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your password'</span><span class="token punctuation">,</span>
                isPass<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// button login</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                onTap<span class="token punctuation">:</span> loginUser<span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> isLoading
                      <span class="token operator">?</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                          child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Log in'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">ShapeDecoration</span><span class="token punctuation">(</span>
                    shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                      borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                        Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// transitioning to signing up</span>
              <span class="token function">Row</span><span class="token punctuation">(</span>
                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">Container</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Don't have an accout?"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                    onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                      child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token string">"Sign up."</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="9-Persisting-Auth-State"><a href="#9-Persisting-Auth-State" class="headerlink" title="9. Persisting Auth State"></a>9. Persisting Auth State</h2><blockquote>
<p>firebase 提供了三种方法校验用户状态</p>
</blockquote>
<p><img src="20230713205149.png"><br><img src="20230713205229.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// main.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/mobile_screen_layout.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/responsive_layout_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/responsive/web_screen_layout.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/screens/login_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/screens/signup_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>
      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string">'Instagram Clone'</span><span class="token punctuation">,</span>
      theme<span class="token punctuation">:</span> ThemeData<span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>scaffoldBackgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
      home<span class="token punctuation">:</span> <span class="token function">StreamBuilder</span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">authStateChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>connectionState <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">ResposiveLayout</span><span class="token punctuation">(</span>
                webScreenLayout<span class="token punctuation">:</span> <span class="token function">WebScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                mobileScreenLayout<span class="token punctuation">:</span> <span class="token function">MobileScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'${snapshot.error}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>connectionState <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>
              child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span>
                color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">LoginScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="20230713205657.png" alt="flutter run -d chrome --web-renderer html"><br><img src="20230713205745.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// login_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/auth_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/screens/home_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/screens/signup_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LoginScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">LoginScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>LoginScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_LoginScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_LoginScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>LoginScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _emailController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _passwordController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bool isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _emailController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _passwordController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">loginUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">AuthMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginUser</span><span class="token punctuation">(</span>
        email<span class="token punctuation">:</span> _emailController<span class="token punctuation">.</span>text<span class="token punctuation">,</span> password<span class="token punctuation">:</span> _passwordController<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pushReplacement</span><span class="token punctuation">(</span>
        <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>
          builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">ResposiveLayout</span><span class="token punctuation">(</span>
            mobileScreenLayout<span class="token punctuation">:</span> <span class="token function">MobileScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            webScreenLayout<span class="token punctuation">:</span> <span class="token function">WebScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">navigateToSignup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">SignupScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// SafeArea是一个用于处理屏幕边缘区域的小部件。</span>
      <span class="token comment" spellcheck="true">// 它的作用是确保应用的内容不会被设备的状态栏、导航栏或者设备刘海等区域所覆盖。</span>
      body<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            <span class="token comment" spellcheck="true">// 主轴（这里指的是column)居中</span>
            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// svg image</span>
              SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
                <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
                color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for email</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your email'</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>emailAddress<span class="token punctuation">,</span>
                textEditingController<span class="token punctuation">:</span> _emailController<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// text field input for pass</span>
              <span class="token function">TextFieldInput</span><span class="token punctuation">(</span>
                textEditingController<span class="token punctuation">:</span> _passwordController<span class="token punctuation">,</span>
                hinText<span class="token punctuation">:</span> <span class="token string">'Enter your password'</span><span class="token punctuation">,</span>
                isPass<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                textInputType<span class="token punctuation">:</span> TextInputType<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// button login</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                onTap<span class="token punctuation">:</span> loginUser<span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> isLoading
                      <span class="token operator">?</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                          child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Log in'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">ShapeDecoration</span><span class="token punctuation">(</span>
                    shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                      borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                        Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Flexible</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment" spellcheck="true">// transitioning to signing up</span>
              <span class="token function">Row</span><span class="token punctuation">(</span>
                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">Container</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Don't have an accout?"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                    onTap<span class="token punctuation">:</span> navigateToSignup<span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                      child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token string">"Sign up."</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="10-Modelling-User-Data"><a href="#10-Modelling-User-Data" class="headerlink" title="10. Modelling User Data"></a>10. Modelling User Data</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// auth_methods.dart</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:math'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseAuth _auth <span class="token operator">=</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// signup user</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">signUpUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
    required String username<span class="token punctuation">,</span>
    required String bio<span class="token punctuation">,</span>
    required Uint8List file<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    String res <span class="token operator">=</span> <span class="token string">"Some error occurred"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              password<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              username<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              bio<span class="token punctuation">.</span>isNotEmpty
          <span class="token comment" spellcheck="true">// || file != null</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// register user</span>
        UserCredential cred <span class="token operator">=</span> <span class="token keyword">await</span> _auth<span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>
            email<span class="token punctuation">:</span> email<span class="token punctuation">,</span> password<span class="token punctuation">:</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        String photoUrl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">StorageMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">uploadImageToStorage</span><span class="token punctuation">(</span><span class="token string">'profilePics'</span><span class="token punctuation">,</span> file<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// add user to our database</span>
        model<span class="token punctuation">.</span>User user <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">User</span><span class="token punctuation">(</span>
          username<span class="token punctuation">:</span> username<span class="token punctuation">,</span>
          uid<span class="token punctuation">:</span> cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
          email<span class="token punctuation">:</span> email<span class="token punctuation">,</span>
          bio<span class="token punctuation">:</span> bio<span class="token punctuation">,</span>
          followers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          following<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          photoUrl<span class="token punctuation">:</span> photoUrl<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> _firestore
            <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>cred<span class="token punctuation">.</span>user<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res <span class="token operator">=</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> on FirebaseAuthException <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">loginUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// models/user.dart</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> String username<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String uid<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String email<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String bio<span class="token punctuation">;</span>
  <span class="token keyword">final</span> List followers<span class="token punctuation">;</span>
  <span class="token keyword">final</span> List following<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String photoUrl<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>email<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>bio<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>followers<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>following<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>photoUrl<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
        <span class="token string">"uid"</span><span class="token punctuation">:</span> uid<span class="token punctuation">,</span>
        <span class="token string">'email'</span><span class="token punctuation">:</span> email<span class="token punctuation">,</span>
        <span class="token string">'bio'</span><span class="token punctuation">:</span> bio<span class="token punctuation">,</span>
        <span class="token string">'followers'</span><span class="token punctuation">:</span> followers<span class="token punctuation">,</span>
        <span class="token string">'following'</span><span class="token punctuation">:</span> following<span class="token punctuation">,</span>
        <span class="token string">'photoUrl'</span><span class="token punctuation">:</span> photoUrl<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="11-User-Data-State-Management"><a href="#11-User-Data-State-Management" class="headerlink" title="11. User Data State Management"></a>11. User Data State Management</h2><blockquote>
<p>状态管理</p>
</blockquote>
<p><img src="20230714055327.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// models/user.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> String username<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String uid<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String email<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String bio<span class="token punctuation">;</span>
  <span class="token keyword">final</span> List followers<span class="token punctuation">;</span>
  <span class="token keyword">final</span> List following<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String photoUrl<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token keyword">static</span> User <span class="token function">fromSnap</span><span class="token punctuation">(</span>DocumentSnapshot snap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> snapshot <span class="token operator">=</span> snap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">as</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">User</span><span class="token punctuation">(</span>
      bio<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'bio'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      uid<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      email<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      followers<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'followers'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      following<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'following'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      photoUrl<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'photoUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// user_provider.dart</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/auth_methods.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserProvider</span> <span class="token keyword">with</span> ChangeNotifier <span class="token punctuation">{</span>
  User<span class="token operator">?</span> _user<span class="token punctuation">;</span>
  <span class="token keyword">final</span> AuthMethods _authMethods <span class="token operator">=</span> <span class="token function">AuthMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  User <span class="token keyword">get</span> getUser <span class="token operator">=</span><span class="token operator">></span> _user<span class="token operator">!</span><span class="token punctuation">;</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">refreshUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    User user <span class="token operator">=</span> <span class="token keyword">await</span> _authMethods<span class="token punctuation">.</span><span class="token function">getUserDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _user <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 刷新</span>
    <span class="token function">notifyListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// auth_methods.dart</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:math'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_core/firebase_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/foundation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseAuth _auth <span class="token operator">=</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  FutureOr<span class="token operator">&lt;</span>model<span class="token punctuation">.</span>User<span class="token operator">></span> <span class="token function">getUserDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    User currentUser <span class="token operator">=</span> _auth<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">;</span>

    DocumentSnapshot snap <span class="token operator">=</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token function">fromSnap</span><span class="token punctuation">(</span>snap<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// signup user</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">signUpUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
    required String username<span class="token punctuation">,</span>
    required String bio<span class="token punctuation">,</span>
    required Uint8List file<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    String res <span class="token operator">=</span> <span class="token string">"Some error occurred"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              password<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              username<span class="token punctuation">.</span>isNotEmpty <span class="token operator">||</span>
              bio<span class="token punctuation">.</span>isNotEmpty
          <span class="token comment" spellcheck="true">// || file != null</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...</span>
        res <span class="token operator">=</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> on FirebaseAuthException <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">loginUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required String email<span class="token punctuation">,</span>
    required String password<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// mobile_screen_layout</span>
<span class="token keyword">import</span> <span class="token string">"package:cloud_firestore/cloud_firestore.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:firebase_auth/firebase_auth.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter/material.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:instagram_flutter/providers/user_provider.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:provider/provider.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MobileScreenLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MobileScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>MobileScreenLayout<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_MobileScreenLayoutState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_MobileScreenLayoutState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MobileScreenLayout<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span>User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="20230714062344.png"><br><img src="20230714062617.png"></p>
<h2 id="12-Mobile-Bottom-App-Bar"><a href="#12-Mobile-Bottom-App-Bar" class="headerlink" title="12. Mobile Bottom App Bar"></a>12. Mobile Bottom App Bar</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// mobile_screen_layout</span>
<span class="token keyword">import</span> <span class="token string">"package:cloud_firestore/cloud_firestore.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:firebase_auth/firebase_auth.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter/cupertino.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter/material.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:instagram_flutter/providers/user_provider.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:instagram_flutter/utils/colors.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:provider/provider.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MobileScreenLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MobileScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>MobileScreenLayout<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_MobileScreenLayoutState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_MobileScreenLayoutState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MobileScreenLayout<span class="token operator">></span> <span class="token punctuation">{</span>
  int _page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  late PageController pageController<span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageController <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 点击底部导航触发</span>
  <span class="token keyword">void</span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span>int page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pageController<span class="token punctuation">.</span><span class="token function">jumpToPage</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">onPageChanged</span><span class="token punctuation">(</span>int page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _page <span class="token operator">=</span> page<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// model.User user = Provider.of&lt;UserProvider>(context).getUser;</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      body<span class="token punctuation">:</span> <span class="token function">PageView</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'feed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'add post'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'notif'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'profile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// 无法通过左右滑动屏幕切换页面</span>
        physics<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">NeverScrollableScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        controller<span class="token punctuation">:</span> pageController<span class="token punctuation">,</span>
        onPageChanged<span class="token punctuation">:</span> onPageChanged<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">CupertinoTabBar</span><span class="token punctuation">(</span>
        onTap<span class="token punctuation">:</span> navigationTapped<span class="token punctuation">,</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            label<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            backgroundColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            label<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            backgroundColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>add_circle<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            label<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            backgroundColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            label<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            backgroundColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>person<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            label<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            backgroundColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="13-Add-Post-Screen-UI"><a href="#13-Add-Post-Screen-UI" class="headerlink" title="13. Add Post Screen UI"></a>13. Add Post Screen UI</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// global_variables.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/screens/add_post_screen.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webScreenSize <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> homeScreenItems <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'feed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">AddPostScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'notif'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'profile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="20230714083704.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// add_post_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AddPostScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">AddPostScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>AddPostScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_AddPostScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_AddPostScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>AddPostScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span>User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        leading<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
          icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>arrow_back<span class="token punctuation">)</span><span class="token punctuation">,</span>
          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Post to'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">TextButton</span><span class="token punctuation">(</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                <span class="token string">'Post'</span><span class="token punctuation">,</span>
                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueAccent<span class="token punctuation">,</span>
                  fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                  fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">Row</span><span class="token punctuation">(</span>
            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceAround<span class="token punctuation">,</span>
            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                width<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
                  decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
                    hintText<span class="token punctuation">:</span> <span class="token string">'Write a caption...'</span><span class="token punctuation">,</span>
                    border<span class="token punctuation">:</span> InputBorder<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  maxLines<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                width<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">AspectRatio</span><span class="token punctuation">(</span>
                  aspectRatio<span class="token punctuation">:</span> <span class="token number">487</span> <span class="token operator">/</span> <span class="token number">451</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                    decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                      image<span class="token punctuation">:</span> <span class="token function">DecorationImage</span><span class="token punctuation">(</span>
                        image<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                        alignment<span class="token punctuation">:</span> FractionalOffset<span class="token punctuation">.</span>topCenter<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="14-Selecting-Image"><a href="#14-Selecting-Image" class="headerlink" title="14. Selecting Image"></a>14. Selecting Image</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// add_post_screen</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:image_picker/image_picker.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AddPostScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">AddPostScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>AddPostScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_AddPostScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_AddPostScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>AddPostScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  Uint8List<span class="token operator">?</span> _file<span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _descriptionController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">_selectImage</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">showDialog</span><span class="token punctuation">(</span>
        context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">SimpleDialog</span><span class="token punctuation">(</span>
            title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Create a Post'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">SimpleDialogOption</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Take a photo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  Uint8List file <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">pickImage</span><span class="token punctuation">(</span>
                    ImageSource<span class="token punctuation">.</span>camera<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _file <span class="token operator">=</span> file<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">SimpleDialogOption</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Choose from gallery'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  Uint8List file <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">pickImage</span><span class="token punctuation">(</span>
                    ImageSource<span class="token punctuation">.</span>gallery<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _file <span class="token operator">=</span> file<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">SimpleDialogOption</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Cancel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> model<span class="token punctuation">.</span>User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>
    <span class="token keyword">return</span> _file <span class="token operator">==</span> <span class="token keyword">null</span>
        <span class="token operator">?</span> <span class="token function">Center</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
              icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                Icons<span class="token punctuation">.</span>upload<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_selectImage</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
              backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
              leading<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>arrow_back<span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Post to'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">TextButton</span><span class="token punctuation">(</span>
                    onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      <span class="token string">'Post'</span><span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueAccent<span class="token punctuation">,</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                        fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">Row</span><span class="token punctuation">(</span>
                  mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceAround<span class="token punctuation">,</span>
                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                      backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                      width<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
                      child<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
                        decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
                          hintText<span class="token punctuation">:</span> <span class="token string">'Write a caption...'</span><span class="token punctuation">,</span>
                          border<span class="token punctuation">:</span> InputBorder<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        maxLines<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                        controller<span class="token punctuation">:</span> _descriptionController<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                      width<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                      height<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                      child<span class="token punctuation">:</span> <span class="token function">AspectRatio</span><span class="token punctuation">(</span>
                        aspectRatio<span class="token punctuation">:</span> <span class="token number">487</span> <span class="token operator">/</span> <span class="token number">451</span><span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                          decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                            image<span class="token punctuation">:</span> <span class="token function">DecorationImage</span><span class="token punctuation">(</span>
                              image<span class="token punctuation">:</span> <span class="token function">MemoryImage</span><span class="token punctuation">(</span>_file<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                              alignment<span class="token punctuation">:</span> FractionalOffset<span class="token punctuation">.</span>topCenter<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="15-Storing-Post-Data-in-Firebase"><a href="#15-Storing-Post-Data-in-Firebase" class="headerlink" title="15. Storing Post Data in Firebase"></a>15. Storing Post Data in Firebase</h2><p><img src="20230714100624.png"><br><img src="20230714103400.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// model/post</span>
<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> String description<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String uid<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String username<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String postId<span class="token punctuation">;</span>
  <span class="token keyword">final</span> datePublished<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String postUrl<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String profImage<span class="token punctuation">;</span>
  <span class="token keyword">final</span> likes<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>description<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>postId<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>datePublished<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>postUrl<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>profImage<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>likes<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
        <span class="token string">"uid"</span><span class="token punctuation">:</span> uid<span class="token punctuation">,</span>
        <span class="token string">'description'</span><span class="token punctuation">:</span> description<span class="token punctuation">,</span>
        <span class="token string">'postId'</span><span class="token punctuation">:</span> postId<span class="token punctuation">,</span>
        <span class="token string">'datePublished'</span><span class="token punctuation">:</span> datePublished<span class="token punctuation">,</span>
        <span class="token string">'postUrl'</span><span class="token punctuation">:</span> postUrl<span class="token punctuation">,</span>
        <span class="token string">'profImage'</span><span class="token punctuation">:</span> profImage<span class="token punctuation">,</span>
        <span class="token string">'likes'</span><span class="token punctuation">:</span> likes<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> Post <span class="token function">fromSnap</span><span class="token punctuation">(</span>DocumentSnapshot snap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> snapshot <span class="token operator">=</span> snap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">as</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Post</span><span class="token punctuation">(</span>
      description<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      uid<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      postId<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      datePublished<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'datePublished'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      postUrl<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'postUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      profImage<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'profImage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      likes<span class="token punctuation">:</span> snapshot<span class="token punctuation">[</span><span class="token string">'likes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// firestore_method.dart</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/post.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:uuid/uuid.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FirestoreMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// upload post</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">uploadPost</span><span class="token punctuation">(</span>
    String description<span class="token punctuation">,</span>
    Uint8List file<span class="token punctuation">,</span>
    String uid<span class="token punctuation">,</span>
    String username<span class="token punctuation">,</span>
    String profImage<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    String res <span class="token operator">=</span> <span class="token string">"some error occurred"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      String photoUrl <span class="token operator">=</span>
          <span class="token keyword">await</span> <span class="token function">StorageMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uploadImageToStorage</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">,</span> file<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      String postId <span class="token operator">=</span> <span class="token keyword">const</span> <span class="token function">Uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">v1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      Post post <span class="token operator">=</span> <span class="token function">Post</span><span class="token punctuation">(</span>
        description<span class="token punctuation">:</span> description<span class="token punctuation">,</span>
        uid<span class="token punctuation">:</span> uid<span class="token punctuation">,</span>
        username<span class="token punctuation">:</span> username<span class="token punctuation">,</span>
        postId<span class="token punctuation">:</span> postId<span class="token punctuation">,</span>
        datePublished<span class="token punctuation">:</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        postUrl<span class="token punctuation">:</span> photoUrl<span class="token punctuation">,</span>
        profImage<span class="token punctuation">:</span> profImage<span class="token punctuation">,</span>
        likes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>postId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      res <span class="token operator">=</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// add_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:image_picker/image_picker.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/firestore_method.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span> <span class="token operator">as</span> model<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AddPostScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">AddPostScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>AddPostScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_AddPostScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_AddPostScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>AddPostScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  Uint8List<span class="token operator">?</span> _file<span class="token punctuation">;</span>
  <span class="token keyword">final</span> TextEditingController _descriptionController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bool _isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token function">_selectImage</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">showDialog</span><span class="token punctuation">(</span>
        context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">SimpleDialog</span><span class="token punctuation">(</span>
            title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Create a Post'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">SimpleDialogOption</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Take a photo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  Uint8List file <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">pickImage</span><span class="token punctuation">(</span>
                    ImageSource<span class="token punctuation">.</span>camera<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _file <span class="token operator">=</span> file<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">SimpleDialogOption</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Choose from gallery'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  Uint8List file <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">pickImage</span><span class="token punctuation">(</span>
                    ImageSource<span class="token punctuation">.</span>gallery<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _file <span class="token operator">=</span> file<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">SimpleDialogOption</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Cancel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">postImage</span><span class="token punctuation">(</span>String uid<span class="token punctuation">,</span> String username<span class="token punctuation">,</span> String profImage<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      String res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uploadPost</span><span class="token punctuation">(</span>
        _descriptionController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
        _file<span class="token operator">!</span><span class="token punctuation">,</span>
        uid<span class="token punctuation">,</span>
        username<span class="token punctuation">,</span>
        profImage<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showSnackBar</span><span class="token punctuation">(</span><span class="token string">'Posted!'</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showSnackBar</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">clearImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _file <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _descriptionController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> model<span class="token punctuation">.</span>User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>
    <span class="token keyword">return</span> _file <span class="token operator">==</span> <span class="token keyword">null</span>
        <span class="token operator">?</span> <span class="token function">Center</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
              icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                Icons<span class="token punctuation">.</span>upload<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_selectImage</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
              backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
              leading<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>arrow_back<span class="token punctuation">)</span><span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> clearImage<span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Post to'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">TextButton</span><span class="token punctuation">(</span>
                    onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
                        <span class="token function">postImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      <span class="token string">'Post'</span><span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueAccent<span class="token punctuation">,</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                        fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token comment" spellcheck="true">// 进度条</span>
                _isLoading
                    <span class="token operator">?</span> <span class="token keyword">const</span> <span class="token function">LinearProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                        padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Row</span><span class="token punctuation">(</span>
                  mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceAround<span class="token punctuation">,</span>
                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                      backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                      width<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
                      child<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
                        decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
                          hintText<span class="token punctuation">:</span> <span class="token string">'Write a caption...'</span><span class="token punctuation">,</span>
                          border<span class="token punctuation">:</span> InputBorder<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        maxLines<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                        controller<span class="token punctuation">:</span> _descriptionController<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                      width<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                      height<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                      child<span class="token punctuation">:</span> <span class="token function">AspectRatio</span><span class="token punctuation">(</span>
                        aspectRatio<span class="token punctuation">:</span> <span class="token number">487</span> <span class="token operator">/</span> <span class="token number">451</span><span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                          decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                            image<span class="token punctuation">:</span> <span class="token function">DecorationImage</span><span class="token punctuation">(</span>
                              image<span class="token punctuation">:</span> <span class="token function">MemoryImage</span><span class="token punctuation">(</span>_file<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                              alignment<span class="token punctuation">:</span> FractionalOffset<span class="token punctuation">.</span>topCenter<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                  width<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
                  height<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">AspectRatio</span><span class="token punctuation">(</span>
                    aspectRatio<span class="token punctuation">:</span> <span class="token number">487</span> <span class="token operator">/</span> <span class="token number">451</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                      decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                        image<span class="token punctuation">:</span> <span class="token function">DecorationImage</span><span class="token punctuation">(</span>
                          image<span class="token punctuation">:</span> <span class="token function">MemoryImage</span><span class="token punctuation">(</span>_file<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>contain<span class="token punctuation">,</span>
                          alignment<span class="token punctuation">:</span> FractionalOffset<span class="token punctuation">.</span>topCenter<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="16-Feed-Posts-UI"><a href="#16-Feed-Posts-UI" class="headerlink" title="16. Feed Posts UI"></a>16. Feed Posts UI</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// post_card.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostCard</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">PostCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
        vertical<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token comment" spellcheck="true">// HEADER SECTION</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">// 创建此 EdgeInsets 的副本，但替换给定字段 与新的value</span>
                <span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                  radius<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                  backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                    <span class="token string">'https://th.bing.com/th/id/R.7926965d1a9b2609d3615be20ac6b12f?rik=%2b7bgyWW1fRlwGw&amp;riu=http%3a%2f%2fwww.andrefelizardo.com.br%2fblog%2fwp-content%2fuploads%2f2016%2f10%2freact.js.png&amp;ehk=bJy%2byzfCQ2XlNdNHmGKO%2bu4SEWgCRUBWziI8scdMCVU%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0'</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 占据剩余空间</span>
                <span class="token function">Expanded</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                      <span class="token comment" spellcheck="true">// 最大限度地减少沿主轴的自由空间量，但须满足 传入的布局约束。</span>
                      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
                      crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">Text</span><span class="token punctuation">(</span>
                          <span class="token string">'username'</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 右上角的...符合，点击弹出操作</span>
                <span class="token function">IconButton</span><span class="token punctuation">(</span>
                  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">showDialog</span><span class="token punctuation">(</span>
                      context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
                      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">Dialog</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">ListView</span><span class="token punctuation">(</span>
                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
                            vertical<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token comment" spellcheck="true">// 从显式的 [List] 创建一个可滚动的、线性的小部件数组</span>
                          shrinkWrap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                            <span class="token string">'Delete'</span><span class="token punctuation">,</span>
                          <span class="token punctuation">]</span>
                              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">InkWell</span><span class="token punctuation">(</span>
                                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
                                        vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                                        horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// IMAGE SECTION</span>
          <span class="token function">SizedBox</span><span class="token punctuation">(</span>
            height<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.35</span><span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
              <span class="token string">'https://th.bing.com/th/id/R.7926965d1a9b2609d3615be20ac6b12f?rik=%2b7bgyWW1fRlwGw&amp;riu=http%3a%2f%2fwww.andrefelizardo.com.br%2fblog%2fwp-content%2fuploads%2f2016%2f10%2freact.js.png&amp;ehk=bJy%2byzfCQ2XlNdNHmGKO%2bu4SEWgCRUBWziI8scdMCVU%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0'</span><span class="token punctuation">,</span>
              fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// LIKE COMMENT SECTION</span>
          <span class="token function">Row</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>comment_outlined<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>send<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Align</span><span class="token punctuation">(</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomRight<span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                    icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                      Icons<span class="token punctuation">.</span>bookmark_border<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// DESCRIPTION AND NUMBER OF COMMENTS</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
              horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">DefaultTextStyle</span><span class="token punctuation">(</span>
                  style<span class="token punctuation">:</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>titleSmall<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'1,231 likes'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>bodyMedium<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">RichText</span><span class="token punctuation">(</span>
                    text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                      style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          text<span class="token punctuation">:</span> <span class="token string">'username'</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                            text<span class="token punctuation">:</span> <span class="token string">'Hey this some description to be replaced'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">InkWell</span><span class="token punctuation">(</span>
                  onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      <span class="token string">'View all 200 comments'</span><span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span>
                          <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> secondaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'22/12/2021'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> secondaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// feed_screen.dart</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/post_card.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FeedScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">FeedScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
          <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
          color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">IconButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>messenger_outline<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">PostCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="17-Displaying-Post-Data-from-Firebase"><a href="#17-Displaying-Post-Data-from-Firebase" class="headerlink" title="17. Displaying Post Data from Firebase"></a>17. Displaying Post Data from Firebase</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// feed_screen</span>
<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_svg/flutter_svg.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/post_card.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FeedScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">FeedScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span>  <span class="token comment" spellcheck="true">// ...</span>
      body<span class="token punctuation">:</span> <span class="token function">StreamBuilder</span><span class="token punctuation">(</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span>
            AsyncSnapshot<span class="token operator">&lt;</span>QuerySnapshot<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">>></span><span class="token operator">></span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>connectionState <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
              child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
            itemCount<span class="token punctuation">:</span> snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">PostCard</span><span class="token punctuation">(</span>
              snap<span class="token punctuation">:</span> snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        stream<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">snapshots</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="18-Like-Animation"><a href="#18-Like-Animation" class="headerlink" title="18. Like Animation"></a>18. Like Animation</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// post_card</span>
<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/like_animation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:intl/intl.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostCard</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> snap<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">PostCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>snap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>PostCard<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_PostCardState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_PostCardState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>PostCard<span class="token operator">></span> <span class="token punctuation">{</span>
  bool isLikeAnimating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
        vertical<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token comment" spellcheck="true">// HEADER SECTION</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">// 创建此 EdgeInsets 的副本，但替换给定字段 与新的value</span>
                <span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                  radius<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                  backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'profImage'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 占据剩余空间</span>
                <span class="token function">Expanded</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                      <span class="token comment" spellcheck="true">// 最大限度地减少沿主轴的自由空间量，但须满足 传入的布局约束。</span>
                      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
                      crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">Text</span><span class="token punctuation">(</span>
                          widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 右上角的...符合，点击弹出操作</span>
                <span class="token function">IconButton</span><span class="token punctuation">(</span>
                  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">showDialog</span><span class="token punctuation">(</span>
                      context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
                      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">Dialog</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">ListView</span><span class="token punctuation">(</span>
                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
                            vertical<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token comment" spellcheck="true">// 从显式的 [List] 创建一个可滚动的、线性的小部件数组</span>
                          shrinkWrap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                            <span class="token string">'Delete'</span><span class="token punctuation">,</span>
                          <span class="token punctuation">]</span>
                              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">InkWell</span><span class="token punctuation">(</span>
                                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
                                        vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                                        horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// IMAGE SECTION</span>
          <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
            onDoubleTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isLikeAnimating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span>
              alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.35</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                    widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">AnimatedOpacity</span><span class="token punctuation">(</span>
                  <span class="token comment" spellcheck="true">// 透明度</span>
                  opacity<span class="token punctuation">:</span> isLikeAnimating <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">LikeAnimation</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    isAnimating<span class="token punctuation">:</span> isLikeAnimating<span class="token punctuation">,</span>
                    duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onEnd<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        isLikeAnimating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// LIKE COMMENT SECTION</span>
          <span class="token function">Row</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">LikeAnimation</span><span class="token punctuation">(</span>
                smallLike<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                isAnimating<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'likes'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                    Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>comment_outlined<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>send<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Align</span><span class="token punctuation">(</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomRight<span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                    icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                      Icons<span class="token punctuation">.</span>bookmark_border<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// DESCRIPTION AND NUMBER OF COMMENTS</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
              horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">DefaultTextStyle</span><span class="token punctuation">(</span>
                  style<span class="token punctuation">:</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>titleSmall<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'${widget.snap['</span>likes<span class="token string">'].length} likes'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>bodyMedium<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">RichText</span><span class="token punctuation">(</span>
                    text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                      style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          text<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string">' ${widget.snap['</span>description<span class="token string">']}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">InkWell</span><span class="token punctuation">(</span>
                  onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      <span class="token string">'View all 200 comments'</span><span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span>
                          <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> secondaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    DateFormat<span class="token punctuation">.</span><span class="token function">yMMMd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'datePublished'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> secondaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// likeAnimation</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LikeAnimation</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> Widget child<span class="token punctuation">;</span>
  <span class="token keyword">final</span> bool isAnimating<span class="token punctuation">;</span>
  <span class="token keyword">final</span> Duration duration<span class="token punctuation">;</span>
  <span class="token keyword">final</span> VoidCallback<span class="token operator">?</span> onEnd<span class="token punctuation">;</span>
  <span class="token keyword">final</span> bool smallLike<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">LikeAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>isAnimating<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEnd<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>smallLike <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>LikeAnimation<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_LikeAnimationState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_LikeAnimationState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>LikeAnimation<span class="token operator">></span>
    <span class="token keyword">with</span> SingleTickerProviderStateMixin <span class="token punctuation">{</span>
  late AnimationController controller<span class="token punctuation">;</span>
  late Animation<span class="token operator">&lt;</span>double<span class="token operator">></span> scale<span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller <span class="token operator">=</span> <span class="token function">AnimationController</span><span class="token punctuation">(</span>
        vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>
          <span class="token comment" spellcheck="true">// ~/ 截断除法是小数结果的除法 通过向零舍入转换为整数。</span>
          milliseconds<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>duration<span class="token punctuation">.</span>inMilliseconds <span class="token operator">~/</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scale <span class="token operator">=</span> Tween<span class="token operator">&lt;</span>double<span class="token operator">></span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didUpdateWidget</span><span class="token punctuation">(</span>covariant LikeAnimation oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didUpdateWidget</span><span class="token punctuation">(</span>oldWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span>isAnimating <span class="token operator">!=</span> oldWidget<span class="token punctuation">.</span>isAnimating<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">startAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">startAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span>isAnimating <span class="token operator">||</span> widget<span class="token punctuation">.</span>smallLike<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> Future<span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>
        milliseconds<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span>onEnd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        widget<span class="token punctuation">.</span>onEnd<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">ScaleTransition</span><span class="token punctuation">(</span>
      scale<span class="token punctuation">:</span> scale<span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="19-Updating-Likes"><a href="#19-Updating-Likes" class="headerlink" title="19. Updating Likes"></a>19. Updating Likes</h2><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// post_card</span>
<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/firestore_method.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/like_animation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:intl/intl.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostCard</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> snap<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">PostCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>snap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>PostCard<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_PostCardState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_PostCardState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>PostCard<span class="token operator">></span> <span class="token punctuation">{</span>
  bool isLikeAnimating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
        vertical<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token comment" spellcheck="true">// HEADER SECTION</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">// 创建此 EdgeInsets 的副本，但替换给定字段 与新的value</span>
                <span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                  radius<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                  backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'profImage'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 占据剩余空间</span>
                <span class="token function">Expanded</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                      <span class="token comment" spellcheck="true">// 最大限度地减少沿主轴的自由空间量，但须满足 传入的布局约束。</span>
                      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
                      crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">Text</span><span class="token punctuation">(</span>
                          widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 右上角的...符合，点击弹出操作</span>
                <span class="token function">IconButton</span><span class="token punctuation">(</span>
                  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">showDialog</span><span class="token punctuation">(</span>
                      context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
                      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">Dialog</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">ListView</span><span class="token punctuation">(</span>
                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
                            vertical<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token comment" spellcheck="true">// 从显式的 [List] 创建一个可滚动的、线性的小部件数组</span>
                          shrinkWrap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                            <span class="token string">'Delete'</span><span class="token punctuation">,</span>
                          <span class="token punctuation">]</span>
                              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">InkWell</span><span class="token punctuation">(</span>
                                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
                                        vertical<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                                        horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// IMAGE SECTION</span>
          <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
            onDoubleTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
              <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">likePost</span><span class="token punctuation">(</span>
                widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'likes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isLikeAnimating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span>
              alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.35</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                    widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">AnimatedOpacity</span><span class="token punctuation">(</span>
                  <span class="token comment" spellcheck="true">// 透明度</span>
                  opacity<span class="token punctuation">:</span> isLikeAnimating <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">LikeAnimation</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    isAnimating<span class="token punctuation">:</span> isLikeAnimating<span class="token punctuation">,</span>
                    duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onEnd<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        isLikeAnimating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// LIKE COMMENT SECTION</span>
          <span class="token function">Row</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">LikeAnimation</span><span class="token punctuation">(</span>
                smallLike<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                isAnimating<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'likes'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">likePost</span><span class="token punctuation">(</span>
                      widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                      widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'likes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'likes'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
                      <span class="token operator">?</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                          Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                      <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                          Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>comment_outlined<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">IconButton</span><span class="token punctuation">(</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                  Icons<span class="token punctuation">.</span>send<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Align</span><span class="token punctuation">(</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomRight<span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span>
                    icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                      Icons<span class="token punctuation">.</span>bookmark_border<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// DESCRIPTION AND NUMBER OF COMMENTS</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
              horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">DefaultTextStyle</span><span class="token punctuation">(</span>
                  style<span class="token punctuation">:</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>titleSmall<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'${widget.snap['</span>likes<span class="token string">'].length} likes'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>bodyMedium<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">RichText</span><span class="token punctuation">(</span>
                    text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                      style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          text<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string">' ${widget.snap['</span>description<span class="token string">']}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">InkWell</span><span class="token punctuation">(</span>
                  onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      <span class="token string">'View all 200 comments'</span><span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span>
                          <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> secondaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    DateFormat<span class="token punctuation">.</span><span class="token function">yMMMd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'datePublished'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> secondaryColor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/post.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:uuid/uuid.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FirestoreMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// upload post</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">uploadPost</span><span class="token punctuation">(</span>
    String description<span class="token punctuation">,</span>
    Uint8List file<span class="token punctuation">,</span>
    String uid<span class="token punctuation">,</span>
    String username<span class="token punctuation">,</span>
    String profImage<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">likePost</span><span class="token punctuation">(</span>String postId<span class="token punctuation">,</span> String uid<span class="token punctuation">,</span> List likes<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>likes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>postId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'likes'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">arrayRemove</span><span class="token punctuation">(</span><span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>postId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'likes'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">arrayUnion</span><span class="token punctuation">(</span><span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="20-Comments-Screen-UI"><a href="#20-Comments-Screen-UI" class="headerlink" title="20. Comments Screen UI"></a>20. Comments Screen UI</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommentCard</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">CommentCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>CommentCard<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CommentCardState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_CommentCardState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>CommentCard<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
        vertical<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
            backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
              <span class="token string">'https://bpic.588ku.com/back_origin_min_pic/21/04/09/7f66917e0335797d885362f23825b6e0.jpg!/fw/750/quality/99/unsharp/true/compress/true'</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            radius<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Expanded</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                  <span class="token function">RichText</span><span class="token punctuation">(</span>
                    text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          text<span class="token punctuation">:</span> <span class="token string">'username'</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          text<span class="token punctuation">:</span> <span class="token string">'some description to insert'</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">Padding</span><span class="token punctuation">(</span>
                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      <span class="token string">'23/12/21'</span><span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                        fontSize<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w400<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/common_card.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommentsSreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">CommentsSreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>CommentsSreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CommentsSreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_CommentsSreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>CommentsSreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">CommentCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          height<span class="token punctuation">:</span> kToolbarHeight<span class="token punctuation">,</span>
          margin<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
            bottom<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>viewInsets<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                  <span class="token string">'https://bpic.588ku.com/back_origin_min_pic/21/04/09/7f66917e0335797d885362f23825b6e0.jpg!/fw/750/quality/99/unsharp/true/compress/true'</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                radius<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
                    decoration<span class="token punctuation">:</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
                      hintText<span class="token punctuation">:</span> <span class="token string">'Comment as username'</span><span class="token punctuation">,</span>
                      border<span class="token punctuation">:</span> InputBorder<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span>
                      <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'Post'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="21-Storing-Comments-in-Firestore"><a href="#21-Storing-Comments-in-Firestore" class="headerlink" title="21. Storing Comments in Firestore"></a>21. Storing Comments in Firestore</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/post.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:uuid/uuid.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FirestoreMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// upload post</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">uploadPost</span><span class="token punctuation">(</span>
    String description<span class="token punctuation">,</span>
    Uint8List file<span class="token punctuation">,</span>
    String uid<span class="token punctuation">,</span>
    String username<span class="token punctuation">,</span>
    String profImage<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">likePost</span><span class="token punctuation">(</span>String postId<span class="token punctuation">,</span> String uid<span class="token punctuation">,</span> List likes<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">postComment</span><span class="token punctuation">(</span>
    String postId<span class="token punctuation">,</span>
    String text<span class="token punctuation">,</span>
    String uid<span class="token punctuation">,</span>
    String name<span class="token punctuation">,</span>
    String profilePic<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String commentId <span class="token operator">=</span> <span class="token keyword">const</span> <span class="token function">Uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">v1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> _firestore
            <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>postId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>commentId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'profilePic'</span><span class="token punctuation">:</span> profilePic<span class="token punctuation">,</span>
          <span class="token string">'name'</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
          <span class="token string">'uid'</span><span class="token punctuation">:</span> uid<span class="token punctuation">,</span>
          <span class="token string">'text'</span><span class="token punctuation">:</span> text<span class="token punctuation">,</span>
          <span class="token string">'commentId'</span><span class="token punctuation">:</span> commentId<span class="token punctuation">,</span>
          <span class="token string">'datePublished'</span><span class="token punctuation">:</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Text is empty'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/firestore_method.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/common_card.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommentsSreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> snap<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">CommentsSreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>snap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>CommentsSreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CommentsSreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_CommentsSreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>CommentsSreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _commentController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _commentController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">CommentCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          height<span class="token punctuation">:</span> kToolbarHeight<span class="token punctuation">,</span>
          margin<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
            bottom<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>viewInsets<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
                radius<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
                    controller<span class="token punctuation">:</span> _commentController<span class="token punctuation">,</span>
                    decoration<span class="token punctuation">:</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
                      hintText<span class="token punctuation">:</span> <span class="token string">'Comment as ${user.username}'</span><span class="token punctuation">,</span>
                      border<span class="token punctuation">:</span> InputBorder<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                  <span class="token function">print</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">await</span> <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postComment</span><span class="token punctuation">(</span>
                    widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    _commentController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span>
                      <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'Post'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="22-Displaying-Comments"><a href="#22-Displaying-Comments" class="headerlink" title="22. Displaying Comments"></a>22. Displaying Comments</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/firestore_method.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/screens/commens_screen.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/like_animation.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:intl/intl.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostCard</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> snap<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">PostCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>snap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>PostCard<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_PostCardState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_PostCardState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>PostCard<span class="token operator">></span> <span class="token punctuation">{</span>
  bool isLikeAnimating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  int commentLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">getComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      QuerySnapshot snap <span class="token operator">=</span> <span class="token keyword">await</span> FirebaseFirestore<span class="token punctuation">.</span>instance
          <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      commentLen <span class="token operator">=</span> snap<span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>
        vertical<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span> <span class="token comment" spellcheck="true">// ...</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/providers/user_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/firestore_method.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/common_card.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/text_field_input.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:provider/provider.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommentsSreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> snap<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">CommentsSreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>snap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>CommentsSreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CommentsSreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_CommentsSreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>CommentsSreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController _commentController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _commentController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> User user <span class="token operator">=</span> Provider<span class="token punctuation">.</span>of<span class="token operator">&lt;</span>UserProvider<span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>getUser<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">StreamBuilder</span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance
            <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>
              <span class="token string">'datePublished'</span><span class="token punctuation">,</span>
              descending<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">snapshots</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>connectionState <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
              child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
            itemCount<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">CommentCard</span><span class="token punctuation">(</span>
                snap<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">SafeArea</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          height<span class="token punctuation">:</span> kToolbarHeight<span class="token punctuation">,</span>
          margin<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
            bottom<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>viewInsets<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
                radius<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>
                    controller<span class="token punctuation">:</span> _commentController<span class="token punctuation">,</span>
                    decoration<span class="token punctuation">:</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
                      hintText<span class="token punctuation">:</span> <span class="token string">'Comment as ${user.username}'</span><span class="token punctuation">,</span>
                      border<span class="token punctuation">:</span> InputBorder<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">InkWell</span><span class="token punctuation">(</span>
                onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                  <span class="token keyword">await</span> <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postComment</span><span class="token punctuation">(</span>
                    widget<span class="token punctuation">.</span>snap<span class="token punctuation">[</span><span class="token string">'postId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    _commentController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span>photoUrl<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _commentController<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span>
                      <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'Post'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> blueColor<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="23-Deleting-Post"><a href="#23-Deleting-Post" class="headerlink" title="23. Deleting Post"></a>23. Deleting Post</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/post.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:uuid/uuid.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FirestoreMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// upload post</span>
  FutureOr<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">uploadPost</span><span class="token punctuation">(</span>
    String description<span class="token punctuation">,</span>
    Uint8List file<span class="token punctuation">,</span>
    String uid<span class="token punctuation">,</span>
    String username<span class="token punctuation">,</span>
    String profImage<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">likePost</span><span class="token punctuation">(</span>String postId<span class="token punctuation">,</span> String uid<span class="token punctuation">,</span> List likes<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">postComment</span><span class="token punctuation">(</span>
    String postId<span class="token punctuation">,</span>
    String text<span class="token punctuation">,</span>
    String uid<span class="token punctuation">,</span>
    String name<span class="token punctuation">,</span>
    String profilePic<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">deletePost</span><span class="token punctuation">(</span>String postId<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>postId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="20230715052239.png"></p>
<h2 id="24-Searching-Users"><a href="#24-Searching-Users" class="headerlink" title="24. Searching Users"></a>24. Searching Users</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SearchScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">SearchScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>SearchScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_SearchScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_SearchScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>SearchScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController searchController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bool isShowUsers <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token function">TextFormField</span><span class="token punctuation">(</span>
          controller<span class="token punctuation">:</span> searchController<span class="token punctuation">,</span>
          decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
            labelText<span class="token punctuation">:</span> <span class="token string">'search for user'</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          onFieldSubmitted<span class="token punctuation">:</span> <span class="token punctuation">(</span>String _<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              isShowUsers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> isShowUsers
          <span class="token operator">?</span> <span class="token function">FutureBuilder</span><span class="token punctuation">(</span>
              builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                  itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">ListTile</span><span class="token punctuation">(</span>
                      leading<span class="token punctuation">:</span> <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                        backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                          <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'photoUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  itemCount<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              future<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance
                  <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>
                    <span class="token string">'username'</span><span class="token punctuation">,</span>
                    isGreaterThanOrEqualTo<span class="token punctuation">:</span> searchController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Posts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="25-Showing-Posts-on-Search-Screen"><a href="#25-Showing-Posts-on-Search-Screen" class="headerlink" title="25. Showing Posts on Search Screen"></a>25. Showing Posts on Search Screen</h2><p><img src="20230715062550.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_staggered_grid_view/flutter_staggered_grid_view.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SearchScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">SearchScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>SearchScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_SearchScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_SearchScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>SearchScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> TextEditingController searchController <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bool isShowUsers <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token function">TextFormField</span><span class="token punctuation">(</span>
          controller<span class="token punctuation">:</span> searchController<span class="token punctuation">,</span>
          decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">InputDecoration</span><span class="token punctuation">(</span>
            labelText<span class="token punctuation">:</span> <span class="token string">'search for user'</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          onFieldSubmitted<span class="token punctuation">:</span> <span class="token punctuation">(</span>String _<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              isShowUsers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> isShowUsers
          <span class="token operator">?</span> <span class="token function">FutureBuilder</span><span class="token punctuation">(</span>
              builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                  itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">ListTile</span><span class="token punctuation">(</span>
                      leading<span class="token punctuation">:</span> <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                        backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                          <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'photoUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  itemCount<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              future<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance
                  <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>
                    <span class="token string">'username'</span><span class="token punctuation">,</span>
                    isGreaterThanOrEqualTo<span class="token punctuation">:</span> searchController<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">:</span> <span class="token function">FutureBuilder</span><span class="token punctuation">(</span>
              future<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">return</span> StaggeredGridView<span class="token punctuation">.</span><span class="token function">countBuilder</span><span class="token punctuation">(</span>
                  crossAxisCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                  itemCount<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                  itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                      <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'postUrl'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  staggeredTileBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> StaggeredTile<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span>index <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>index <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  mainAxisSpacing<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                  crossAxisSpacing<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="26-Creating-Reusable-Profile-Screen-UI"><a href="#26-Creating-Reusable-Profile-Screen-UI" class="headerlink" title="26. Creating Reusable Profile Screen UI"></a>26. Creating Reusable Profile Screen UI</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FollowButton</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> function<span class="token punctuation">;</span>
  <span class="token keyword">final</span> Color backgroundColor<span class="token punctuation">;</span>
  <span class="token keyword">final</span> Color borderColor<span class="token punctuation">;</span>
  <span class="token keyword">final</span> Color textColor<span class="token punctuation">;</span>
  <span class="token keyword">final</span> String text<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>function<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>backgroundColor<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>borderColor<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>textColor<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">TextButton</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
            color<span class="token punctuation">:</span> backgroundColor<span class="token punctuation">,</span>
            border<span class="token punctuation">:</span> Border<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> borderColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
            text<span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> textColor<span class="token punctuation">,</span>
              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        onPressed<span class="token punctuation">:</span> function<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/follow_button.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProfileScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">ProfileScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>ProfileScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_ProfileScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_ProfileScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>ProfileScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">ListView</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">Padding</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">Row</span><span class="token punctuation">(</span>
                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                      backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                      backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>
                        <span class="token string">'https://th.bing.com/th/id/R.f4dd383a91aa149fd47da7a0cba73a95?rik=KRZB3DYDNVGq9w&amp;riu=http%3a%2f%2fpic.zsucai.com%2ffiles%2f2013%2f0716%2fpgjlg7.jpg&amp;ehk=yGkBxqtnGW%2bsIAxJA0yro%2bOLIk0fJU5jR1SsfId3PL0%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0'</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      radius<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">Expanded</span><span class="token punctuation">(</span>
                      <span class="token comment" spellcheck="true">// 创建一个扩展 [Row]、[Column] 或 [Flex] 子级的小部件 以便子组件沿着 Flex 小部件填充可用空间 主轴。</span>
                      flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                          <span class="token function">Row</span><span class="token punctuation">(</span>
                            mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
                            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
                            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                              <span class="token function">buildStatColumn</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token function">buildStatColumn</span><span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token string">'followers'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token function">buildStatColumn</span><span class="token punctuation">(</span><span class="token number">2120</span><span class="token punctuation">,</span> <span class="token string">'following'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">]</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token function">Row</span><span class="token punctuation">(</span>
                            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
                            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                              <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                text<span class="token punctuation">:</span> <span class="token string">'Edit Profile'</span><span class="token punctuation">,</span>
                                backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
                                textColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                                borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                                function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                              <span class="token punctuation">)</span>
                            <span class="token punctuation">]</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerLeft<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                    top<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'username'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerLeft<span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                    top<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Some description'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Column <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>int num<span class="token punctuation">,</span> String label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>
      mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
          num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
            fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">Container</span><span class="token punctuation">(</span>
          margin<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
            label<span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
              fontSize<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w400<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="27-Displaying-Profile-Data"><a href="#27-Displaying-Profile-Data" class="headerlink" title="27. Displaying Profile Data"></a>27. Displaying Profile Data</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/follow_button.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProfileScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> String uid<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">ProfileScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>uid<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>ProfileScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_ProfileScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_ProfileScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>ProfileScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  int postLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  int followers <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  int following <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  bool isFollowing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  bool isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> userSnap <span class="token operator">=</span> <span class="token keyword">await</span> FirebaseFirestore<span class="token punctuation">.</span>instance
          <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// get post length</span>
      <span class="token keyword">var</span> postSnap <span class="token operator">=</span> <span class="token keyword">await</span> FirebaseFirestore<span class="token punctuation">.</span>instance
          <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">,</span> isEqualTo<span class="token punctuation">:</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      postLen <span class="token operator">=</span> postSnap<span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      userData <span class="token operator">=</span> userSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
      followers <span class="token operator">=</span> userSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'followers'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      following <span class="token operator">=</span> userSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'following'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      isFollowing <span class="token operator">=</span> userSnap
          <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'followers'</span><span class="token punctuation">]</span>
          <span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> isLoading
        <span class="token operator">?</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
              backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>userData<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token function">ListView</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">Padding</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                      <span class="token function">Row</span><span class="token punctuation">(</span>
                        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                          <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                            backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                            backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>userData<span class="token punctuation">[</span><span class="token string">'photoUrl'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            radius<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token function">Expanded</span><span class="token punctuation">(</span>
                            <span class="token comment" spellcheck="true">// 创建一个扩展 [Row]、[Column] 或 [Flex] 子级的小部件 以便子组件沿着 Flex 小部件填充可用空间 主轴。</span>
                            flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                <span class="token function">Row</span><span class="token punctuation">(</span>
                                  mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
                                  mainAxisAlignment<span class="token punctuation">:</span>
                                      MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
                                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                    <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>postLen<span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>followers<span class="token punctuation">,</span> <span class="token string">'followers'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>following<span class="token punctuation">,</span> <span class="token string">'following'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token function">Row</span><span class="token punctuation">(</span>
                                  mainAxisAlignment<span class="token punctuation">:</span>
                                      MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
                                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                    FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid <span class="token operator">==</span>
                                            widget<span class="token punctuation">.</span>uid
                                        <span class="token operator">?</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                            text<span class="token punctuation">:</span> <span class="token string">'Edit Profile'</span><span class="token punctuation">,</span>
                                            backgroundColor<span class="token punctuation">:</span>
                                                mobileBackgroundColor<span class="token punctuation">,</span>
                                            textColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                                            borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                                            function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                          <span class="token punctuation">)</span>
                                        <span class="token punctuation">:</span> isFollowing
                                            <span class="token operator">?</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                                text<span class="token punctuation">:</span> <span class="token string">'Unfollow'</span><span class="token punctuation">,</span>
                                                backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                                textColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                                                borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                                                function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                              <span class="token punctuation">)</span>
                                            <span class="token punctuation">:</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                                text<span class="token punctuation">:</span> <span class="token string">'Follow'</span><span class="token punctuation">,</span>
                                                backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
                                                textColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                                borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
                                                function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                              <span class="token punctuation">)</span>
                                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token punctuation">)</span>
                              <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">Container</span><span class="token punctuation">(</span>
                        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerLeft<span class="token punctuation">,</span>
                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                          top<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                          userData<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">Container</span><span class="token punctuation">(</span>
                        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerLeft<span class="token punctuation">,</span>
                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                          top<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>userData<span class="token punctuation">[</span><span class="token string">'bio'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">FutureBuilder</span><span class="token punctuation">(</span>
                  future<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance
                      <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
                      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">,</span> isEqualTo<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
                      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>connectionState <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">return</span> GridView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                      itemCount<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                      shrinkWrap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                      gridDelegate<span class="token punctuation">:</span>
                          <span class="token keyword">const</span> <span class="token function">SliverGridDelegateWithFixedCrossAxisCount</span><span class="token punctuation">(</span>
                        crossAxisCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                        crossAxisSpacing<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                        mainAxisSpacing<span class="token punctuation">:</span> <span class="token number">1.5</span><span class="token punctuation">,</span>
                        childAspectRatio<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        DocumentSnapshot snap <span class="token operator">=</span>
                            <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

                        <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                            <span class="token punctuation">(</span>snap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'postUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Column <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>int num<span class="token punctuation">,</span> String label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>
      mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
          num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
            fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">Container</span><span class="token punctuation">(</span>
          margin<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
            label<span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
              fontSize<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w400<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="20230715095650.png"></p>
<h2 id="28-Following-Users"><a href="#28-Following-Users" class="headerlink" title="28. Following Users"></a>28. Following Users</h2><pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/models/post.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/storage_methods.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:uuid/uuid.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FirestoreMethods</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> FirebaseFirestore _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// ...</span>

  FutureOr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">followUser</span><span class="token punctuation">(</span>
    String uid<span class="token punctuation">,</span>
    String followId<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      DocumentSnapshot snap <span class="token operator">=</span>
          <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      List following <span class="token operator">=</span> <span class="token punctuation">(</span>snap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'following'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// 已关注的再点就是取关</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>following<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>followId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>followId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'followers'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">arrayRemove</span><span class="token punctuation">(</span><span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string">'following'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">arrayRemove</span><span class="token punctuation">(</span><span class="token punctuation">[</span>followId<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>followId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'followers'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">arrayUnion</span><span class="token punctuation">(</span><span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'following'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">arrayUnion</span><span class="token punctuation">(</span><span class="token punctuation">[</span>followId<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:cloud_firestore/cloud_firestore.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:firebase_auth/firebase_auth.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/resources/firestore_method.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/colors.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/utils/utils.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:instagram_flutter/widgets/follow_button.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProfileScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> String uid<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function">ProfileScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>uid<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>ProfileScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_ProfileScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_ProfileScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>ProfileScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  int postLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  int followers <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  int following <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  bool isFollowing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  bool isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> userSnap <span class="token operator">=</span> <span class="token keyword">await</span> FirebaseFirestore<span class="token punctuation">.</span>instance
          <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// get post length</span>
      <span class="token keyword">var</span> postSnap <span class="token operator">=</span> <span class="token keyword">await</span> FirebaseFirestore<span class="token punctuation">.</span>instance
          <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">,</span> isEqualTo<span class="token punctuation">:</span> FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      postLen <span class="token operator">=</span> postSnap<span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      userData <span class="token operator">=</span> userSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
      followers <span class="token operator">=</span> userSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'followers'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      following <span class="token operator">=</span> userSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'following'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      isFollowing <span class="token operator">=</span> userSnap
          <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'followers'</span><span class="token punctuation">]</span>
          <span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showSnackBar</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> isLoading
        <span class="token operator">?</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
              backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>userData<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token function">ListView</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token function">Padding</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                      <span class="token function">Row</span><span class="token punctuation">(</span>
                        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                          <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>
                            backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                            backgroundImage<span class="token punctuation">:</span> <span class="token function">NetworkImage</span><span class="token punctuation">(</span>userData<span class="token punctuation">[</span><span class="token string">'photoUrl'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            radius<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token function">Expanded</span><span class="token punctuation">(</span>
                            <span class="token comment" spellcheck="true">// 创建一个扩展 [Row]、[Column] 或 [Flex] 子级的小部件 以便子组件沿着 Flex 小部件填充可用空间 主轴。</span>
                            flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                <span class="token function">Row</span><span class="token punctuation">(</span>
                                  mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
                                  mainAxisAlignment<span class="token punctuation">:</span>
                                      MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
                                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                    <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>postLen<span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>followers<span class="token punctuation">,</span> <span class="token string">'followers'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>following<span class="token punctuation">,</span> <span class="token string">'following'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token function">Row</span><span class="token punctuation">(</span>
                                  mainAxisAlignment<span class="token punctuation">:</span>
                                      MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
                                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                    FirebaseAuth<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid <span class="token operator">==</span>
                                            widget<span class="token punctuation">.</span>uid
                                        <span class="token operator">?</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                            text<span class="token punctuation">:</span> <span class="token string">'Edit Profile'</span><span class="token punctuation">,</span>
                                            backgroundColor<span class="token punctuation">:</span>
                                                mobileBackgroundColor<span class="token punctuation">,</span>
                                            textColor<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
                                            borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                                            function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                          <span class="token punctuation">)</span>
                                        <span class="token punctuation">:</span> isFollowing
                                            <span class="token operator">?</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                                text<span class="token punctuation">:</span> <span class="token string">'Unfollow'</span><span class="token punctuation">,</span>
                                                backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                                textColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                                                borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                                                function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                                                  <span class="token keyword">await</span> <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                      <span class="token punctuation">.</span><span class="token function">followUser</span><span class="token punctuation">(</span>
                                                    FirebaseAuth<span class="token punctuation">.</span>instance
                                                        <span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                                                    userData<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                    isFollowing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                                                    followers<span class="token operator">--</span><span class="token punctuation">;</span>
                                                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                              <span class="token punctuation">)</span>
                                            <span class="token punctuation">:</span> <span class="token function">FollowButton</span><span class="token punctuation">(</span>
                                                text<span class="token punctuation">:</span> <span class="token string">'Follow'</span><span class="token punctuation">,</span>
                                                backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
                                                textColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                                borderColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
                                                function<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                                                  <span class="token keyword">await</span> <span class="token function">FirestoreMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                      <span class="token punctuation">.</span><span class="token function">followUser</span><span class="token punctuation">(</span>
                                                    FirebaseAuth<span class="token punctuation">.</span>instance
                                                        <span class="token punctuation">.</span>currentUser<span class="token operator">!</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                                                    userData<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                    isFollowing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                                                    followers<span class="token operator">++</span><span class="token punctuation">;</span>
                                                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                              <span class="token punctuation">)</span>
                                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token punctuation">)</span>
                              <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">Container</span><span class="token punctuation">(</span>
                        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerLeft<span class="token punctuation">,</span>
                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                          top<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                          userData<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">Container</span><span class="token punctuation">(</span>
                        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerLeft<span class="token punctuation">,</span>
                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                          top<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>userData<span class="token punctuation">[</span><span class="token string">'bio'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">FutureBuilder</span><span class="token punctuation">(</span>
                  future<span class="token punctuation">:</span> FirebaseFirestore<span class="token punctuation">.</span>instance
                      <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
                      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">,</span> isEqualTo<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
                      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>connectionState <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">return</span> GridView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                      itemCount<span class="token punctuation">:</span> <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                      shrinkWrap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                      gridDelegate<span class="token punctuation">:</span>
                          <span class="token keyword">const</span> <span class="token function">SliverGridDelegateWithFixedCrossAxisCount</span><span class="token punctuation">(</span>
                        crossAxisCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                        crossAxisSpacing<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                        mainAxisSpacing<span class="token punctuation">:</span> <span class="token number">1.5</span><span class="token punctuation">,</span>
                        childAspectRatio<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        DocumentSnapshot snap <span class="token operator">=</span>
                            <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">.</span>docs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

                        <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                            <span class="token punctuation">(</span>snap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span> <span class="token operator">as</span> <span class="token keyword">dynamic</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'postUrl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Column <span class="token function">buildStatColumn</span><span class="token punctuation">(</span>int num<span class="token punctuation">,</span> String label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>
      mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
          num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
            fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">Container</span><span class="token punctuation">(</span>
          margin<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
            label<span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
              fontSize<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w400<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="29-Signing-Out"><a href="#29-Signing-Out" class="headerlink" title="29. Signing Out"></a>29. Signing Out</h2><p><img src="20230715103633.png"></p>
<h2 id="30-Creating-Responsive-UI"><a href="#30-Creating-Responsive-UI" class="headerlink" title="30. Creating Responsive UI"></a>30. Creating Responsive UI</h2><p><img src="20230715104133.png"></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">"package:cloud_firestore/cloud_firestore.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:firebase_auth/firebase_auth.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter/material.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:flutter_svg/flutter_svg.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:instagram_flutter/utils/colors.dart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"package:instagram_flutter/utils/global_variables.dart"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WebScreenLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">WebScreenLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  State<span class="token operator">&lt;</span>WebScreenLayout<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_WebScreenLayoutState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_WebScreenLayoutState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>WebScreenLayout<span class="token operator">></span> <span class="token punctuation">{</span>
  int _page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  late PageController pageController<span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageController <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// 点击底部导航触发</span>
  <span class="token keyword">void</span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span>int page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pageController<span class="token punctuation">.</span><span class="token function">jumpToPage</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _page <span class="token operator">=</span> page<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">onPageChanged</span><span class="token punctuation">(</span>int page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _page <span class="token operator">=</span> page<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        centerTitle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        backgroundColor<span class="token punctuation">:</span> mobileBackgroundColor<span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> SvgPicture<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>
          <span class="token string">'assets/ic_instagram.svg'</span><span class="token punctuation">,</span>
          color<span class="token punctuation">:</span> primaryColor<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token function">IconButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">IconButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">IconButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>add_a_photo<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">IconButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>favorite<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">IconButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">navigationTapped</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
              Icons<span class="token punctuation">.</span>person<span class="token punctuation">,</span>
              color<span class="token punctuation">:</span> _page <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">?</span> primaryColor <span class="token punctuation">:</span> secondaryColor<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">PageView</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> homeScreenItems<span class="token punctuation">,</span>
        physics<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">NeverScrollableScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        controller<span class="token punctuation">:</span> pageController<span class="token punctuation">,</span>
        onPageChanged<span class="token punctuation">:</span> onPageChanged<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="20230715110931.png"><br><img src="20230715111441.png"><br><img src="20230715111457.png"><br><img src="20230715111701.png"></p>
<h1 id="4-TikTok-Clone"><a href="#4-TikTok-Clone" class="headerlink" title="4. TikTok Clone"></a>4. TikTok Clone</h1><h2 id="2-Setup"><a href="#2-Setup" class="headerlink" title="2. Setup"></a>2. Setup</h2><pre class=" language-shell"><code class="language-shell">flutter create tiktok_flutter
</code></pre>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2>
            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://malred.github.io" class="b-link-green">malred-blog</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2023/05/04/frontend/flutter/flutter-build-5-social-app/flutter-build-5-social-app/" class="b-link-green">flutter-build-5-social-app</a>
                </p>
            </div>
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '676b06df8b7379e50e35',
        clientSecret: '9159b4de0f716ba7bdab9bc02151a90e6961246b',
        repo: 'comment_repo',
        owner: 'malred',
        admin: "malred",
        id: '2023-05-04T09-30-54',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    
        <link rel="stylesheet" href="/libs/gitment/gitment-default.css">
<link rel="stylesheet" href="/css/gitment.css">

<div class="gitment-card card" data-aos="fade-up">
    <div id="gitment-content" class="card-content"></div>
</div>

<script src="/libs/gitment/gitment.js"></script>
<script>
var gitment = new Gitment({
    id: 'Thu May 04 2023 09:30:54 GMT+0800',
    owner: 'malred',
    repo: 'comment_repo',
    oauth: {
        client_id: '676b06df8b7379e50e35',
        client_secret: '9159b4de0f716ba7bdab9bc02151a90e6961246b'
    }
});

gitment.render('gitment-content');
</script>
    

    
        <div class="disqus-card card" data-aos="fade-up">
    <div id="disqus_thread" class="card-content">
        <noscript>Please enable JavaScript to view the
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
</div>

<script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'https://malred.github.io/2023/05/04/frontend/flutter/flutter-build-5-social-app/flutter-build-5-social-app/';
        this.page.identifier = '/2023/05/04/frontend/flutter/flutter-build-5-social-app/flutter-build-5-social-app/';
        this.page.title = 'flutter-build-5-social-app';
    };
    let disqus_shortname = '';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'mipjlux8dRwbE7yY1zP3v13z-gzGzoHsz',
        appKey: 'cIy0pwvRAK8cuOCZRjuoHHfy',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '留下友善的评论~'
    });
</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/05/04/backend/java/udemy-ultimate-java/p1-fundamentals/fundamentals/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="Ultimate Java Part 1 Fundamentals">
                        
                        <span class="card-title">Ultimate Java Part 1 Fundamentals</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">
1. getting start1- Setting Up the Development Environment–[koudaizy.com]
2- Anatomy of a Java Program–[koudaizy.com]
3-</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2023-05-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/udemy/" class="post-category" target="_blank">
                                    udemy
                                </a>
                            
                            <a href="/categories/udemy/java/" class="post-category" target="_blank">
                                    java
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/udemy/" target="_blank">
                        <span class="chip bg-color">udemy</span>
                    </a>
                    
                    <a href="/tags/java/" target="_blank">
                        <span class="chip bg-color">java</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/05/01/frontend/react/ytb/youtube-clone-ui/youtube-clone-ui/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="youtube-clone-ui">
                        
                        <span class="card-title">youtube-clone-ui</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">内容来源https://youtu.be/yIaXoop8gl4
Menuimport React, { useEffect, useState } from "react";
import Logo from "../img/logo.p</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2023-05-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/node/" class="post-category" target="_blank">
                                    node
                                </a>
                            
                            <a href="/categories/node/react/" class="post-category" target="_blank">
                                    react
                                </a>
                            
                            <a href="/categories/node/react/tailwind/" class="post-category" target="_blank">
                                    tailwind
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/node/" target="_blank">
                        <span class="chip bg-color">node</span>
                    </a>
                    
                    <a href="/tags/react/" target="_blank">
                        <span class="chip bg-color">react</span>
                    </a>
                    
                    <a href="/tags/tailwind/" target="_blank">
                        <span class="chip bg-color">tailwind</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://blinkfox.github.io/" target="_blank">Blinkfox</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建.

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">673k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/malred" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:malguy2022@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2725953379" class="tooltipped" data-tooltip="QQ联系我: 2725953379" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input" autofocus="">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<!--动态线条背景-->
<script type="text/javascript" color="122 103 238" opacity='0.7' zIndex="-2" count="200"
    src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
    </script>
<script src="/js/matery.js"></script>
<script src="/js/snow.js"></script>

<!-- 引用Aplayer和metingjs -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script>
<div id="my-aplayer" class="aplayer" data-id="7363940489" data-server="netease" data-type="playlist" data-fixed="true"
    // 吸底模式可以固定播放器于页面底部 data-autoplay="true" data-order="list" data-volume="0.55" data-theme="#cc543a"
    data-preload="auto"></div>  
<!-- <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script> -->
<!-- <script src="https://cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script>
    // 对所有链接跳转事件绑定pjax容器container
    $(document).pjax('a[target!=_blank]', '.container', { fragment: '.container', timeout: 8000 })
</script> -->


<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-MSEYRC5EW5"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'G-MSEYRC5EW5');
</script>



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>