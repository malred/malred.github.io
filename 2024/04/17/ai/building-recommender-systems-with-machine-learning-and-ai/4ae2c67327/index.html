<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Building Recommender Systems with Machine Learning and AI, HTML,CSS,React,Vue,Java,Go,微服务,linux">
    <meta name="description" content="01 - Getting Started004 [Activity] Install Anaconda, course materials, and create movie recommendations!005 Course Roadm">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Building Recommender Systems with Machine Learning and AI | malred-blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">malred-blog</span>
                    </a>
                </div>
                

<a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">malred-blog</div>
        <div class="logo-desc">
            
            前后端学习者,存放知识笔记
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
    </ul>

    <div class="social-link">
    <a href="https://github.com/malred" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:malguy2022@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2725953379" class="tooltipped" data-tooltip="QQ联系我: 2725953379" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
</div>

            </div>
        </div>

        
    </nav>
</header>


<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Building Recommender Systems with Machine Learning and AI
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ai/" target="_blank">
                                <span class="chip bg-color">ai</span>
                            </a>
                        
                            <a href="/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" target="_blank">
                                <span class="chip bg-color">推荐系统</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/ai/" class="post-category" target="_blank">
                                ai
                            </a>
                        
                            <a href="/categories/ai/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" class="post-category" target="_blank">
                                推荐系统
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-04-17
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        5.1k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        30 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="01-Getting-Started"><a href="#01-Getting-Started" class="headerlink" title="01 - Getting Started"></a>01 - Getting Started</h1><h2 id="004-Activity-Install-Anaconda-course-materials-and-create-movie-recommendations"><a href="#004-Activity-Install-Anaconda-course-materials-and-create-movie-recommendations" class="headerlink" title="004 [Activity] Install Anaconda, course materials, and create movie recommendations!"></a>004 [Activity] Install Anaconda, course materials, and create movie recommendations!</h2><h2 id="005-Course-Roadmap"><a href="#005-Course-Roadmap" class="headerlink" title="005 Course Roadmap"></a>005 Course Roadmap</h2><p><img src="be80f140.png"></p>
<h2 id="006-What-Is-a-Recommender-System"><a href="#006-What-Is-a-Recommender-System" class="headerlink" title="006 What Is a Recommender System"></a>006 What Is a Recommender System</h2><p><img src="c68ed5a5.png"><img src="5d6c2033.png"><img src="2cf1e6f3.png"><img src="17ea067f.png"></p>
<h2 id="007-Types-of-Recommenders"><a href="#007-Types-of-Recommenders" class="headerlink" title="007 Types of Recommenders"></a>007 Types of Recommenders</h2><p><img src="e2f2afa5.png"><img src="4aa3a45c.png"><img src="a8f6b95a.png"><img src="305b2b6f.png"><img src="3aad0826.png"></p>
<h2 id="008-Understanding-You-through-Implicit-and-Explicit-Ratings"><a href="#008-Understanding-You-through-Implicit-and-Explicit-Ratings" class="headerlink" title="008 Understanding You through Implicit and Explicit Ratings"></a>008 Understanding You through Implicit and Explicit Ratings</h2><p><img src="e19b415d.png" alt="通过用户明确反馈来收集数据, 但是这种数据一般比较稀疏, 人的评价主观因素也比较大"><br><img src="afc6e27e.png" alt="通过隐形数据来收集偏好数据, 但是点击等数据可能被虚假的封面等诱导点击;购买的商品;视频完播率"></p>
<h2 id="009-Top-N-Recommender-Architecture"><a href="#009-Top-N-Recommender-Architecture" class="headerlink" title="009 Top-N Recommender Architecture"></a>009 Top-N Recommender Architecture</h2><p><img src="20a6a1ee.png"><img src="edbfb7d4.png" alt="基于项目的协同过滤"><img src="fe6880f5.png"></p>
<h2 id="010-Quiz-Review-the-basics-of-recommender-systems"><a href="#010-Quiz-Review-the-basics-of-recommender-systems" class="headerlink" title="010 [Quiz] Review the basics of recommender systems"></a>010 [Quiz] Review the basics of recommender systems</h2><p><img src="44c736c0.png"><img src="c3f69206.png"><img src="fd4d7457.png"><img src="96546c5b.png"></p>
<h1 id="03-Evaluating-Recommender-Systems"><a href="#03-Evaluating-Recommender-Systems" class="headerlink" title="03 - Evaluating Recommender Systems"></a>03 - Evaluating Recommender Systems</h1><h2 id="001-TrainTest-and-Cross-Validation"><a href="#001-TrainTest-and-Cross-Validation" class="headerlink" title="001 TrainTest and Cross Validation"></a>001 TrainTest and Cross Validation</h2><p><img src="1fb03e92.png"><img src="bffa792b.png"></p>
<h2 id="002-Accuracy-Metrics-RMSE-MAE"><a href="#002-Accuracy-Metrics-RMSE-MAE" class="headerlink" title="002 Accuracy Metrics (RMSE, MAE)"></a>002 Accuracy Metrics (RMSE, MAE)</h2><p><img src="1cf2d203.png"><img src="872fece0.png"></p>
<h2 id="003-Top-N-Hit-Rate-Many-Ways"><a href="#003-Top-N-Hit-Rate-Many-Ways" class="headerlink" title="003 Top-N Hit Rate - Many Ways"></a>003 Top-N Hit Rate - Many Ways</h2><p><img src="ae9cefe7.png"><img src="8d0ebdba.png" alt="用户最喜欢的5个里面去掉一个作为预测目标, 来作为训练和评估的依据, 但是需要大量数据集才能有好的表现"><br><img src="2b29d570.png" alt="平均倒数命中率"><img src="617426f2.png" alt="累积命中率"><img src="5bd27c79.png"><br><img src="9acd1cee.png"></p>
<h2 id="004-Coverage-Diversity-and-Novelty"><a href="#004-Coverage-Diversity-and-Novelty" class="headerlink" title="004 Coverage, Diversity, and Novelty"></a>004 Coverage, Diversity, and Novelty</h2><p><img src="70cbbcde.png"><img src="a7e7b035.png" alt="多样性"><img src="a968c348.png" alt="新颖性"><br><img src="4bd63238.png" alt="长尾, y轴是销量或受欢迎程度, 大多数销量来源于少数的几个商品"></p>
<h2 id="005-Churn-Responsiveness-and-AB-Tests"><a href="#005-Churn-Responsiveness-and-AB-Tests" class="headerlink" title="005 Churn, Responsiveness, and AB Tests"></a>005 Churn, Responsiveness, and AB Tests</h2><p><img src="c1fdec52.png"><img src="923fd375.png" alt="响应能力"><img src="770212b6.png"></p>
<h2 id="006-Quiz-Review-ways-to-measure-your-recommender"><a href="#006-Quiz-Review-ways-to-measure-your-recommender" class="headerlink" title="006 [Quiz] Review ways to measure your recommender"></a>006 [Quiz] Review ways to measure your recommender</h2><p><img src="4aba930c.png"><img src="33d8cd17.png"><img src="c73ff007.png"><img src="b837ebfe.png"><br><img src="aed04a88.png"></p>
<h2 id="007-Activity-Walkthrough-of-RecommenderMetrics-py"><a href="#007-Activity-Walkthrough-of-RecommenderMetrics-py" class="headerlink" title="007 [Activity] Walkthrough of RecommenderMetrics.py"></a>007 [Activity] Walkthrough of RecommenderMetrics.py</h2><p><img src="35d460d3.png"><img src="d3df3c50.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> itertools

<span class="token comment" spellcheck="true"># conda install -c conda-forge scikit-surprise</span>
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> accuracy
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict


<span class="token comment" spellcheck="true"># 推荐指标类</span>
<span class="token keyword">class</span> <span class="token class-name">RecommenderMetrics</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">MAE</span><span class="token punctuation">(</span>predictions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> accuracy<span class="token punctuation">.</span>mae<span class="token punctuation">(</span>predictions<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">RMSE</span><span class="token punctuation">(</span>predictions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> accuracy<span class="token punctuation">.</span>rmse<span class="token punctuation">(</span>predictions<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">GetTopN</span><span class="token punctuation">(</span>predictions<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> minimumRating<span class="token operator">=</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        topN <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>

        <span class="token keyword">for</span> userID<span class="token punctuation">,</span> movieID<span class="token punctuation">,</span> actualRating<span class="token punctuation">,</span> estimatedRating<span class="token punctuation">,</span> _ <span class="token keyword">in</span> predictions<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># 如果系统评估的分数大于最低评分阈值, 就加入到topN</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>estimatedRating <span class="token operator">>=</span> minimumRating<span class="token punctuation">)</span><span class="token punctuation">:</span>
                topN<span class="token punctuation">[</span>int<span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">,</span> estimatedRating<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># topN: [userID: (movieID, esRating), ...]</span>
        <span class="token keyword">for</span> userID<span class="token punctuation">,</span> ratings <span class="token keyword">in</span> topN<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># 根据电影评分排序</span>
            ratings<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            topN<span class="token punctuation">[</span>int<span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ratings<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span>

        <span class="token keyword">return</span> topN

    <span class="token comment" spellcheck="true"># 留一</span>
    <span class="token keyword">def</span> <span class="token function">HitRate</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        hits <span class="token operator">=</span> <span class="token number">0</span>
        total <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">for</span> leftOut <span class="token keyword">in</span> leftOutPredictions<span class="token punctuation">:</span>
            userID <span class="token operator">=</span> leftOut<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            leftOutMovieID <span class="token operator">=</span> leftOut<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment" spellcheck="true"># 该leftout是否是topN里的</span>
            hit <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> movieID<span class="token punctuation">,</span> predictedRating <span class="token keyword">in</span> topNPredicted<span class="token punctuation">[</span>int<span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span>leftOutMovieID<span class="token punctuation">)</span> <span class="token operator">==</span> int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    hit <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token keyword">break</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span><span class="token punctuation">:</span>
                hits <span class="token operator">+=</span> <span class="token number">1</span>

            total <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment" spellcheck="true"># Compute overall precision</span>
        <span class="token keyword">return</span> hits <span class="token operator">/</span> total

    <span class="token comment" spellcheck="true"># 累积命中率</span>
    <span class="token keyword">def</span> <span class="token function">CumulativeHitRate</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">,</span> ratingCutoff<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        hits <span class="token operator">=</span> <span class="token number">0</span>
        total <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token comment" spellcheck="true"># For each Left-out rating</span>
        <span class="token keyword">for</span> userID<span class="token punctuation">,</span> leftOutMovieID<span class="token punctuation">,</span> actualRating<span class="token punctuation">,</span> estimatedRating<span class="token punctuation">,</span> _ <span class="token keyword">in</span> leftOutPredictions<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># OnLy Look at ability to recommend things the users actually liked..</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>actualRating <span class="token operator">>=</span> ratingCutoff<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment" spellcheck="true"># Is it in the predicted top 10 for this user?</span>
                hit <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> movieID<span class="token punctuation">,</span> predictedRating <span class="token keyword">in</span> topNPredicted<span class="token punctuation">[</span>int<span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span>leftOutMovieID<span class="token punctuation">)</span> <span class="token operator">==</span> int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        hit <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    hits <span class="token operator">+=</span> <span class="token number">1</span>

                total <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment" spellcheck="true"># Compute overall precision</span>
        <span class="token keyword">return</span> hits <span class="token operator">/</span> total

    <span class="token keyword">def</span> <span class="token function">RatingHitRate</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        hits <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>float<span class="token punctuation">)</span>
        total <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>float<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># For each Left-out rating</span>
        <span class="token keyword">for</span> userID<span class="token punctuation">,</span> leftOutMovieID<span class="token punctuation">,</span> actualRating<span class="token punctuation">,</span> estimatedRating<span class="token punctuation">,</span> _ <span class="token keyword">in</span> leftOutPredictions<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># Is it in the predicted top 10 for this user?</span>
            hit <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> movieID<span class="token punctuation">,</span> predictedRating <span class="token keyword">in</span> topNPredicted<span class="token punctuation">[</span>int<span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span>leftOutMovieID<span class="token punctuation">)</span> <span class="token operator">==</span> int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    hit <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token keyword">break</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span><span class="token punctuation">:</span>
                hits<span class="token punctuation">[</span>actualRating<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

            total<span class="token punctuation">[</span>actualRating<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment" spellcheck="true"># Compute overall precision</span>
        result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> rating <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>hits<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># print(rating, hits[rating] / total[rating])</span>
            result<span class="token punctuation">[</span>rating<span class="token punctuation">]</span> <span class="token operator">=</span> hits<span class="token punctuation">[</span>rating<span class="token punctuation">]</span> <span class="token operator">/</span> total<span class="token punctuation">[</span>rating<span class="token punctuation">]</span>

        <span class="token keyword">return</span> result

    <span class="token keyword">def</span> <span class="token function">AverageReciprocalHitRank</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        summation <span class="token operator">=</span> <span class="token number">0</span>
        total <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token comment" spellcheck="true"># For each left-out rating</span>
        <span class="token keyword">for</span> userID<span class="token punctuation">,</span> leftOutMovieID<span class="token punctuation">,</span> actualRating<span class="token punctuation">,</span> estimatedRating<span class="token punctuation">,</span> _ <span class="token keyword">in</span> leftOutPredictions<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># Is it in the predicted top N for this user?</span>
            hitRank <span class="token operator">=</span> <span class="token number">0</span>
            rank <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> movieID<span class="token punctuation">,</span> predictedRating <span class="token keyword">in</span> topNPredicted<span class="token punctuation">[</span>int<span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                rank <span class="token operator">=</span> rank <span class="token operator">+</span> <span class="token number">1</span>
                <span class="token comment" spellcheck="true"># 如果推荐的命中了, 就 +1 hitRank</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span>leftOutMovieID<span class="token punctuation">)</span> <span class="token operator">==</span> movieID<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    hitRank <span class="token operator">=</span> rank
                    <span class="token keyword">break</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hitRank <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                summation <span class="token operator">+=</span> <span class="token number">1.0</span> <span class="token operator">/</span> hitRank

            total <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token keyword">return</span> summation <span class="token operator">/</span> total

    <span class="token comment" spellcheck="true"># 用户覆盖率</span>
    <span class="token comment" spellcheck="true"># What percentage of users have at least one "good" recommendation</span>
    <span class="token keyword">def</span> <span class="token function">UserCoverage</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> numUsers<span class="token punctuation">,</span> ratingThreshold<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        hits <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> userID <span class="token keyword">in</span> topNPredicted<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            hit <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> movieID<span class="token punctuation">,</span> predictedRating <span class="token keyword">in</span> topNPredicted<span class="token punctuation">[</span>userID<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>predictedRating <span class="token operator">>=</span> ratingThreshold<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    hit <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token keyword">break</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span><span class="token punctuation">:</span>
                hits <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token keyword">return</span> hits <span class="token operator">/</span> numUsers

    <span class="token comment" spellcheck="true"># 多样性</span>
    <span class="token keyword">def</span> <span class="token function">Diversity</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> simsAlgo<span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token number">0</span>
        total <span class="token operator">=</span> <span class="token number">0</span>
        simsMatrix <span class="token operator">=</span> simsAlgo<span class="token punctuation">.</span>compute_similarities<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> userID <span class="token keyword">in</span> topNPredicted<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># 创建一个迭代器，返回iterable中所有长度为r的子序列，</span>
            <span class="token comment" spellcheck="true"># 返回的子序列中的项按输入iterable中的顺序排序 (不带重复).</span>
            <span class="token comment" spellcheck="true"># r 指定生成排列的元素的长度，如果不指定，则默认为可迭代对象的元素长度。</span>
            pairs <span class="token operator">=</span> itertools<span class="token punctuation">.</span>combinations<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">[</span>userID<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> pair <span class="token keyword">in</span> pairs<span class="token punctuation">:</span>
                movie1 <span class="token operator">=</span> pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                movie2 <span class="token operator">=</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                innerID1 <span class="token operator">=</span> simsAlgo<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>to_inner_iid<span class="token punctuation">(</span>str<span class="token punctuation">(</span>movie1<span class="token punctuation">)</span><span class="token punctuation">)</span>
                innerID2 <span class="token operator">=</span> simsAlgo<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>to_inner_iid<span class="token punctuation">(</span>str<span class="token punctuation">(</span>movie2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true"># 求相似度</span>
                similarity <span class="token operator">=</span> simsMatrix<span class="token punctuation">[</span>innerID1<span class="token punctuation">]</span><span class="token punctuation">[</span>innerID2<span class="token punctuation">]</span>
                total <span class="token operator">+=</span> similarity
                n <span class="token operator">+=</span> <span class="token number">1</span>

        S <span class="token operator">=</span> total <span class="token operator">/</span> n
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> S<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># 新颖性</span>
    <span class="token keyword">def</span> <span class="token function">Novelty</span><span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token number">0</span>
        total <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> userID <span class="token keyword">in</span> topNPredicted<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> rating <span class="token keyword">in</span> topNPredicted<span class="token punctuation">[</span>userID<span class="token punctuation">]</span><span class="token punctuation">:</span>
                movieID <span class="token operator">=</span> rating<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                rank <span class="token operator">=</span> rankings<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span>
                total <span class="token operator">+=</span> rank
                n <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> total <span class="token operator">/</span> n
</code></pre>
<h2 id="008-Activity-Walkthrough-of-TestMetrics-py"><a href="#008-Activity-Walkthrough-of-TestMetrics-py" class="headerlink" title="008 [Activity] Walkthrough of TestMetrics.py"></a>008 [Activity] Walkthrough of TestMetrics.py</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># MovieLens.py</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> re
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> Dataset
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> Reader
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">class</span> <span class="token class-name">MovieLens</span><span class="token punctuation">:</span>
    movieID_to_name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    name_to_movieID <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    ratingsPath <span class="token operator">=</span> <span class="token string">'../ml-latest-small/ratings.csv'</span>
    moviesPath <span class="token operator">=</span> <span class="token string">'../ml-latest-small/movies.csv'</span>

    <span class="token keyword">def</span> <span class="token function">loadMovieLensLatestSmall</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        加载电影数据, 编码为 电影名和电影ID 的对应字典
        :return:
        '''</span>
        <span class="token comment" spellcheck="true"># Look for files relative to the directory we are running from</span>
        os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        ratingsDataset <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>movieID_to_name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>name_to_movieID <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        reader <span class="token operator">=</span> Reader<span class="token punctuation">(</span>line_format<span class="token operator">=</span><span class="token string">'user item rating timestamp'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> skip_lines<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        ratingsDataset <span class="token operator">=</span> Dataset<span class="token punctuation">.</span>load_from_file<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ratingsPath<span class="token punctuation">,</span> reader<span class="token operator">=</span>reader<span class="token punctuation">)</span>

        <span class="token keyword">with</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>moviesPath<span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'ISO-8859-1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
            movieReader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
            next<span class="token punctuation">(</span>movieReader<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Skip header Line</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> movieReader<span class="token punctuation">:</span>
                movieID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                movieName <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                self<span class="token punctuation">.</span>movieID_to_name<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">=</span> movieName
                self<span class="token punctuation">.</span>name_to_movieID<span class="token punctuation">[</span>movieName<span class="token punctuation">]</span> <span class="token operator">=</span> movieID

        <span class="token keyword">return</span> ratingsDataset

    <span class="token keyword">def</span> <span class="token function">getUserRatings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
        userRatings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        hitUser <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ratingsPath<span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
            ratingReader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
            next<span class="token punctuation">(</span>ratingReader<span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> ratingReader<span class="token punctuation">:</span>
                userID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> userID<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    movieID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    rating <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    userRatings<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>movieID<span class="token punctuation">,</span> rating<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    hitUser <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hitUser <span class="token operator">and</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> userID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>

        <span class="token keyword">return</span> userRatings

    <span class="token keyword">def</span> <span class="token function">getPopularityRanks</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ratings <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>int<span class="token punctuation">)</span>
        rankings <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>int<span class="token punctuation">)</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ratingsPath<span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
            ratingReader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
            next<span class="token punctuation">(</span>ratingReader<span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> ratingReader<span class="token punctuation">:</span>
                movieID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                ratings<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        rank <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># 根据 rating[1](movie出现次数) 排序, 然后遍历, 将出现次数改为 rank(排名)</span>
        <span class="token keyword">for</span> movieID<span class="token punctuation">,</span> ratingCount <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>ratings<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            rankings<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">=</span> rank  <span class="token comment" spellcheck="true"># 设置排名</span>
            rank <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># 下一个的排名变为当前rank+1</span>
        <span class="token keyword">return</span> rankings

    <span class="token keyword">def</span> <span class="token function">getGenres</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        标签
        :return:
        '''</span>
        genres <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        genreIDs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># 标签toID的字典</span>
        maxGenreID <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment" spellcheck="true"># 当前最大的ID号</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>moviesPath<span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'ISO-8859-1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
            movieReader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
            next<span class="token punctuation">(</span>movieReader<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># skip header Line</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> movieReader<span class="token punctuation">:</span>
                movieID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                genreList <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>
                genreIDList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token comment" spellcheck="true"># 将文本形式的标签list, 转为ID数字形式</span>
                <span class="token keyword">for</span> genre <span class="token keyword">in</span> genreList<span class="token punctuation">:</span>
                    <span class="token comment" spellcheck="true"># 如果已经编码在ID里</span>
                    <span class="token keyword">if</span> genre <span class="token keyword">in</span> genreIDs<span class="token punctuation">:</span>
                        <span class="token comment" spellcheck="true"># 使用已经编码的ID</span>
                        genreID <span class="token operator">=</span> genreIDs<span class="token punctuation">[</span>genre<span class="token punctuation">]</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment" spellcheck="true"># 给标签编码</span>
                        genreID <span class="token operator">=</span> maxGenreID
                        genreIDs<span class="token punctuation">[</span>genre<span class="token punctuation">]</span> <span class="token operator">=</span> genreID
                        maxGenreID <span class="token operator">+=</span> <span class="token number">1</span>
                    genreIDList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>genreID<span class="token punctuation">)</span>
                genres<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">=</span> genreIDList
        <span class="token comment" spellcheck="true"># Convert integer-encoded genre lists to bitfields that we can treat as vectors</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>movieID<span class="token punctuation">,</span> genreIDList<span class="token punctuation">)</span> <span class="token keyword">in</span> genres<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bitfield <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> maxGenreID
            <span class="token keyword">for</span> genreID <span class="token keyword">in</span> genreIDList<span class="token punctuation">:</span>
                bitfield<span class="token punctuation">[</span>genreID<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
            genres<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">=</span> bitfield

        <span class="token keyword">return</span> genres

    <span class="token keyword">def</span> <span class="token function">getYears</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        编码 电影ID到上映年份 的字典
        :return:
        '''</span>
        p <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"(?:\((\d{4})\))?\s*$"</span><span class="token punctuation">)</span>
        years <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>int<span class="token punctuation">)</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>moviesPath<span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'ISO-8859-1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
            movieReader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
            next<span class="token punctuation">(</span>movieReader<span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> movieReader<span class="token punctuation">:</span>
                movieID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                title <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># like: Toy Story (1995)</span>
                m <span class="token operator">=</span> p<span class="token punctuation">.</span>search<span class="token punctuation">(</span>title<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 使用正则</span>
                year <span class="token operator">=</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> year<span class="token punctuation">:</span>
                    years<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">=</span> int<span class="token punctuation">(</span>year<span class="token punctuation">)</span>
        <span class="token keyword">return</span> years

    <span class="token keyword">def</span> <span class="token function">getMiseEnScene</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        读取日志
        :return:
        '''</span>
        mes <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"LLVisualFeatures13K_Log.csv"</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
            mesReader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
            next<span class="token punctuation">(</span>mesReader<span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> mesReader<span class="token punctuation">:</span>
                movieID <span class="token operator">=</span> int<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                avgShotLength <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                meanColorVariance <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                stddevColorVariance <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                meanMotion <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                stddevMotion <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                meanLightingKey <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                numShots <span class="token operator">=</span> float<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                mes<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>avgShotLength<span class="token punctuation">,</span> meanColorVariance<span class="token punctuation">,</span> stddevColorVariance<span class="token punctuation">,</span>
                                meanMotion<span class="token punctuation">,</span> stddevMotion<span class="token punctuation">,</span>
                                meanLightingKey<span class="token punctuation">,</span> numShots<span class="token punctuation">]</span>
        <span class="token keyword">return</span> mes

    <span class="token keyword">def</span> <span class="token function">getMovieName</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> movieID<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> movieID <span class="token keyword">in</span> self<span class="token punctuation">.</span>movieID_to_name<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>movieID_to_name<span class="token punctuation">[</span>movieID<span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">""</span>

    <span class="token keyword">def</span> <span class="token function">getMovieID</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> movieName<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> movieName <span class="token keyword">in</span> self<span class="token punctuation">.</span>name_to_movieID<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>name_to_movieID<span class="token punctuation">[</span>movieName<span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># TestMetrics.py</span>
<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> SVD
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> KNNBaseline
<span class="token keyword">from</span> surprise<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token punctuation">,</span> LeaveOneOut
<span class="token keyword">from</span> RecommenderMetrics <span class="token keyword">import</span> RecommenderMetrics

ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># return surprise.Dataset</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing item similarities so we can measure diversity later..."</span><span class="token punctuation">)</span>
fullTrainSet <span class="token operator">=</span> data<span class="token punctuation">.</span>build_full_trainset<span class="token punctuation">(</span><span class="token punctuation">)</span>
sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'pearson_baseline'</span><span class="token punctuation">,</span> <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span>
simsAlgo <span class="token operator">=</span> KNNBaseline<span class="token punctuation">(</span>sim_options<span class="token operator">=</span>sim_options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># KNN 用于计算相似度</span>
simsAlgo<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>fullTrainSet<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nBuilding recommendation model..."</span><span class="token punctuation">)</span>
trainSet<span class="token punctuation">,</span> testSet <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>data<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">25</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

algo <span class="token operator">=</span> SVD<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 将输入数据矩阵进行降维, 提取特征, 提高计算性能</span>
algo<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>trainSet<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing recommendations..."</span><span class="token punctuation">)</span>
predictions <span class="token operator">=</span> algo<span class="token punctuation">.</span>test<span class="token punctuation">(</span>testSet<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nEvaluating accuracy of model..."</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"RMSE:"</span><span class="token punctuation">,</span> RecommenderMetrics<span class="token punctuation">.</span>RMSE<span class="token punctuation">(</span>predictions<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MAE:"</span><span class="token punctuation">,</span> RecommenderMetrics<span class="token punctuation">.</span>MAE<span class="token punctuation">(</span>predictions<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nEvaluating top-10 recommendations..."</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Set aside one rating per user for testing</span>
LOOCV <span class="token operator">=</span> LeaveOneOut<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 交叉验证迭代器</span>

<span class="token keyword">for</span> trainSet<span class="token punctuation">,</span> testSet <span class="token keyword">in</span> LOOCV<span class="token punctuation">.</span>split<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Computing recommendations with leave-one-out..."</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Train model without Left-out ratings</span>
    algo<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>trainSet<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Predicts ratings for Left-out ratings only</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Predict ratings for left-out set..."</span><span class="token punctuation">)</span>
    leftOutPredictions <span class="token operator">=</span> algo<span class="token punctuation">.</span>test<span class="token punctuation">(</span>testSet<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Build predictions for all ratings not in the training set</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Predict all missing ratings..."</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># Return a list of ratings that can be used as a testset in the</span>
    <span class="token comment" spellcheck="true">#         :meth:`test() &lt;surprise.prediction_algorithms.algo_base.AlgoBase.test>`</span>
    <span class="token comment" spellcheck="true">#         method.</span>
    bigTestSet <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>build_anti_testset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    allPredictions <span class="token operator">=</span> algo<span class="token punctuation">.</span>test<span class="token punctuation">(</span>bigTestSet<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Compute top 10 recs for each user</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Compute top 10 recs per user..."</span><span class="token punctuation">)</span>
    topNPredicted <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>GetTopN<span class="token punctuation">(</span>allPredictions<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># See how often we recommended a movie the user actually rated</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nHit Rate:"</span><span class="token punctuation">,</span> RecommenderMetrics<span class="token punctuation">.</span>HitRate<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Break down hit rate by rating value</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nrHR (Hit Rate by Rating value):"</span><span class="token punctuation">,</span>
          RecommenderMetrics<span class="token punctuation">.</span>RatingHitRate<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># See how often we recommended a movie the user actually Liked</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ncHR (Cumulative Hit Rate,rating >= 4):"</span><span class="token punctuation">,</span>
          RecommenderMetrics<span class="token punctuation">.</span>CumulativeHitRate<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Compute ARHR</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nARHR (Average Reciprocal Hit Rank):"</span><span class="token punctuation">,</span>
          RecommenderMetrics<span class="token punctuation">.</span>AverageReciprocalHitRank<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing complete recommendations,no hold outs..."</span><span class="token punctuation">)</span>
algo<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>fullTrainSet<span class="token punctuation">)</span>
bigTestSet <span class="token operator">=</span> fullTrainSet<span class="token punctuation">.</span>build_anti_testset<span class="token punctuation">(</span><span class="token punctuation">)</span>
allPredictions <span class="token operator">=</span> algo<span class="token punctuation">.</span>test<span class="token punctuation">(</span>bigTestSet<span class="token punctuation">)</span>

topNPredicted <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>GetTopN<span class="token punctuation">(</span>allPredictions<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Print user coverage with a minimum predicted rating of 4.0:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nUser coverage:"</span><span class="token punctuation">,</span> 
      RecommenderMetrics<span class="token punctuation">.</span>UserCoverage<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> fullTrainSet<span class="token punctuation">.</span>n_users<span class="token punctuation">,</span> ratingThreshold<span class="token operator">=</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Measure diversity of recommendations:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nDiversity:"</span><span class="token punctuation">,</span> RecommenderMetrics<span class="token punctuation">.</span>Diversity<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> simsAlgo<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Measure novelty (average popularity rank of recommendations):</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nNovelty (average popularity rank):"</span><span class="token punctuation">,</span> RecommenderMetrics<span class="token punctuation">.</span>Novelty<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="009-Activity-Measure-the-Performance-of-SVD-Recommendations"><a href="#009-Activity-Measure-the-Performance-of-SVD-Recommendations" class="headerlink" title="009 [Activity] Measure the Performance of SVD Recommendations"></a>009 [Activity] Measure the Performance of SVD Recommendations</h2><p><img src="4221e2a7.png"></p>
<h1 id="04-A-Recommender-Engine-Framework"><a href="#04-A-Recommender-Engine-Framework" class="headerlink" title="04 - A Recommender Engine Framework"></a>04 - A Recommender Engine Framework</h1><h2 id="001-Our-Recommender-Engine-Architecture"><a href="#001-Our-Recommender-Engine-Architecture" class="headerlink" title="001 Our Recommender Engine Architecture"></a>001 Our Recommender Engine Architecture</h2><p><img src="00ec16dd.png"><img src="24359b79.png"><img src="c5a243d0.png"><img src="da4b0d57.png"><img src="d3531cee.png"></p>
<h2 id="002-Activity-Recommender-Engine-Walkthrough-Part-1"><a href="#002-Activity-Recommender-Engine-Walkthrough-Part-1" class="headerlink" title="002 [Activity] Recommender Engine Walkthrough, Part 1"></a>002 [Activity] Recommender Engine Walkthrough, Part 1</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Evaluator.py</span>
<span class="token keyword">from</span> EvaluationData <span class="token keyword">import</span> EvaluationData
<span class="token keyword">from</span> EvaluatedAlgorithm <span class="token keyword">import</span> EvaluatedAlgorithm


<span class="token keyword">class</span> <span class="token class-name">Evaluator</span><span class="token punctuation">:</span>
    algorithms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ed <span class="token operator">=</span> EvaluationData<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dataset <span class="token operator">=</span> ed

    <span class="token keyword">def</span> <span class="token function">AddAlgorithm</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> algorithm<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        alg <span class="token operator">=</span> EvaluatedAlgorithm<span class="token punctuation">(</span>algorithm<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>algorithms<span class="token punctuation">.</span>append<span class="token punctuation">(</span>alg<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">Evaluate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> doTopN<span class="token punctuation">)</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> algorithm <span class="token keyword">in</span> self<span class="token punctuation">.</span>algorithms<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Evaluating "</span><span class="token punctuation">,</span> algorithm<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"..."</span><span class="token punctuation">)</span>
            results<span class="token punctuation">[</span>algorithm<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dataset<span class="token punctuation">,</span> doTopN<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Print results</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>doTopN<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:&lt;10} {:&lt;10} {:&lt;10} {:&lt;10} {:&lt;10} {:&lt;10} {:&lt;10} {:&lt;10} {:&lt;10}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>
                <span class="token string">"Algorithm"</span><span class="token punctuation">,</span> <span class="token string">"RMSE"</span><span class="token punctuation">,</span> <span class="token string">"MAE"</span><span class="token punctuation">,</span> <span class="token string">"HR"</span><span class="token punctuation">,</span> <span class="token string">"CHR"</span><span class="token punctuation">,</span> <span class="token string">"ARHR"</span><span class="token punctuation">,</span> <span class="token string">"Coverage"</span><span class="token punctuation">,</span> <span class="token string">"Diversity"</span><span class="token punctuation">,</span> <span class="token string">"Novelty"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> metrics<span class="token punctuation">)</span> <span class="token keyword">in</span> results<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:&lt;10} {:&lt;10.4f} {:&lt;10.4f} {:&lt;10.4f} {:&lt;10.4f} {:&lt;10.4f} {:&lt;10.4f} {:&lt;10.4f} {:&lt;10.4f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>
                    name<span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"RMSE"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"MAE"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"HR"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"CHR"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"ARHR"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    metrics<span class="token punctuation">[</span><span class="token string">"Coverage"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"Diversity"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"Novelty"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:&lt;10} {:&lt;10} {:&lt;10}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"Algorithm"</span><span class="token punctuation">,</span> <span class="token string">"RMSE"</span><span class="token punctuation">,</span> <span class="token string">"MAE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> metrics<span class="token punctuation">)</span> <span class="token keyword">in</span> results<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:&lt;10} {:&lt;10.4f} {:&lt;10.4f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>name<span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"RMSE"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metrics<span class="token punctuation">[</span><span class="token string">"MAE"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nLegend:\n"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"RMSE:        Root Mean Squared Error.Lower values mean better accuracy."</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MAE:         Mean Absolute Error.Lower values mean better accuracy."</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>doTopN<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"HR:        Hit Rate;how often we are able to recommend a left-out rating.Higher is better."</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>
                <span class="token string">"cHR:        Cumulative Hit Rate;hit rate,confined to ratings above a certain threshold.Higher is better."</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>
                <span class="token string">"ARHR:        Average Reciprocal Hit Rank-Hit rate that takes the ranking into account.Higher is better."</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Coverage:Ratio of users for whom recommendations above a certain threshold exist.Higher is better."</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>
                <span class="token string">"Diversity:1-S,where s is the average similarity score between every possible pair of recommendations"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"              for a given user.Higher means more diverse."</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Novelty:        Average popularity rank of recommended items.Higher means more novel."</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">SampleTopNRecs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ml<span class="token punctuation">,</span> testSubject<span class="token operator">=</span><span class="token number">85</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> algo <span class="token keyword">in</span> self<span class="token punctuation">.</span>algorithms<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nUsing recommender "</span><span class="token punctuation">,</span> algo<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nBuilding recommendation model..."</span><span class="token punctuation">)</span>
            trainSet <span class="token operator">=</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>GetFullTrainSet<span class="token punctuation">(</span><span class="token punctuation">)</span>
            algo<span class="token punctuation">.</span>GetAlgorithm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>trainSet<span class="token punctuation">)</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Computing recommendations..."</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># 用户尚未评分的电影集 AntiTestSet</span>
            testSet <span class="token operator">=</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>GetAntiTestSetForUser<span class="token punctuation">(</span>testSubject<span class="token punctuation">)</span>

            <span class="token comment" spellcheck="true"># 对未看过的电影进行评分预测</span>
            predictions <span class="token operator">=</span> algo<span class="token punctuation">.</span>GetAlgorithm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>test<span class="token punctuation">(</span>testSet<span class="token punctuation">)</span>

            recommendations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nWe recommend:"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> userID<span class="token punctuation">,</span> movieID<span class="token punctuation">,</span> actualRating<span class="token punctuation">,</span> estimatedRating<span class="token punctuation">,</span> _ <span class="token keyword">in</span> predictions<span class="token punctuation">:</span>
                intMovieID <span class="token operator">=</span> int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span>
                recommendations<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>intMovieID<span class="token punctuation">,</span> estimatedRating<span class="token punctuation">)</span><span class="token punctuation">)</span>

            recommendations<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

            <span class="token keyword">for</span> ratings <span class="token keyword">in</span> recommendations<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>ml<span class="token punctuation">.</span>getMovieName<span class="token punctuation">(</span>ratings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># RecsBakeOff.py</span>
<span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> SVD
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> NormalPredictor
<span class="token keyword">from</span> Evaluator <span class="token keyword">import</span> Evaluator

<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">LoadMovieLensData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
    rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>


np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Load up common data set for the recommender algorithms</span>
<span class="token punctuation">(</span>evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span> <span class="token operator">=</span> LoadMovieLensData<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Construct an EvaLuator to,you know,evaluate them</span>
evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span>evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Throw in an SVD recommender</span>
SVDAlgorithm <span class="token operator">=</span> SVD<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>SVDAlgorithm<span class="token punctuation">,</span> <span class="token string">"SVD"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Just make random recommendations</span>
Random <span class="token operator">=</span> NormalPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>Random<span class="token punctuation">,</span> <span class="token string">"Random"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Fight!</span>
evaluator<span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="003-Activity-Recommender-Engine-Walkthrough-Part-2"><a href="#003-Activity-Recommender-Engine-Walkthrough-Part-2" class="headerlink" title="003 [Activity] Recommender Engine Walkthrough, Part 2"></a>003 [Activity] Recommender Engine Walkthrough, Part 2</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># EvaluatedAlgorithm.py</span>
<span class="token keyword">from</span> RecommenderMetrics <span class="token keyword">import</span> RecommenderMetrics
<span class="token keyword">from</span> EvaluationData <span class="token keyword">import</span> EvaluationData


<span class="token keyword">class</span> <span class="token class-name">EvaluatedAlgorithm</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> algorithm<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>algorithm <span class="token operator">=</span> algorithm
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">Evaluate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> evaluationData<span class="token punctuation">,</span> doTopN<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        metrics <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true"># Compute accuracy</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Evaluating accuracy..."</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetTrainSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        predictions <span class="token operator">=</span> self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>test<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetTestSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        metrics<span class="token punctuation">[</span><span class="token string">"RMSE"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>RMSE<span class="token punctuation">(</span>predictions<span class="token punctuation">)</span>
        metrics<span class="token punctuation">[</span><span class="token string">"MAE"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>MAE<span class="token punctuation">(</span>predictions<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>doTopN<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># Evaluate top-10 with Leave One Out testing</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Evaluating top-N with leave-one-out..."</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetLOOCVTrainSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            leftOutPredictions <span class="token operator">=</span> self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>test<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetLOOCVTestSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Build predictions for all ratings not in the training set</span>
            allPredictions <span class="token operator">=</span> self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>test<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetLOOCVAntiTestSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Compute top 10 recs for each user</span>
            topNPredicted <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>GetTopN<span class="token punctuation">(</span>allPredictions<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Computing hit-rate and rank metrics..."</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># See how often we recommended a movie the user actually rated</span>
            metrics<span class="token punctuation">[</span><span class="token string">"HR"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>HitRate<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># See how often we recommended a movie the user actually Liked</span>
            metrics<span class="token punctuation">[</span><span class="token string">"CHR"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>CumulativeHitRate<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Compute ARHR</span>
            metrics<span class="token punctuation">[</span><span class="token string">"ARHR"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>AverageReciprocalHitRank<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> leftOutPredictions<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Evaluate properties of recommendations on full training set</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Computing recommendations with full data set..."</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetFullTrainSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            allPredictions <span class="token operator">=</span> self<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>test<span class="token punctuation">(</span>evaluationData<span class="token punctuation">.</span>GetFullAntiTestSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            topNPredicted <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>GetTopN<span class="token punctuation">(</span>allPredictions<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Analyzing coverage,diversity,and novelty..."</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Print user coverage with a minimum predicted rating of 4.0:</span>
            metrics<span class="token punctuation">[</span><span class="token string">"Coverage"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>UserCoverage<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span>
                                                                  evaluationData<span class="token punctuation">.</span>GetFullTrainSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>n_users<span class="token punctuation">,</span>
                                                                  ratingThreshold<span class="token operator">=</span><span class="token number">4.0</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Measure diversity of recommendations:</span>
            metrics<span class="token punctuation">[</span><span class="token string">"Diversity"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>Diversity<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span> evaluationData<span class="token punctuation">.</span>GetSimilarities<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># Measure novelty (average popularity rank of recommendations):</span>
            metrics<span class="token punctuation">[</span><span class="token string">"Novelty"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RecommenderMetrics<span class="token punctuation">.</span>Novelty<span class="token punctuation">(</span>topNPredicted<span class="token punctuation">,</span>
                                                            evaluationData<span class="token punctuation">.</span>GetPopularityRankings<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Analysis complete."</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> metrics
        
    <span class="token keyword">def</span> <span class="token function">GetName</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name

    <span class="token keyword">def</span> <span class="token function">GetAlgorithm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>algorithm
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># EvaluationData.py</span>
<span class="token keyword">from</span> surprise<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> surprise<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> LeaveOneOut
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> KNNBaseline


<span class="token keyword">class</span> <span class="token class-name">EvaluationData</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> popularityRankings<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>rankings <span class="token operator">=</span> popularityRankings

        <span class="token comment" spellcheck="true"># Build a full training set for evaluating overall properties</span>
        self<span class="token punctuation">.</span>fullTrainSet <span class="token operator">=</span> data<span class="token punctuation">.</span>build_full_trainset<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fullAntiTestSet <span class="token operator">=</span> self<span class="token punctuation">.</span>fullTrainSet<span class="token punctuation">.</span>build_anti_testset<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Build a 75/25 train/test split for measuring accuracy</span>
        self<span class="token punctuation">.</span>trainSet<span class="token punctuation">,</span> self<span class="token punctuation">.</span>testSet <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>data<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">25</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Build a "Leave one out"train/test split for evaluating top-N recommenders</span>
        <span class="token comment" spellcheck="true"># And build an anti-test-set for building predictions</span>
        LOOCV <span class="token operator">=</span> LeaveOneOut<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> train<span class="token punctuation">,</span> test <span class="token keyword">in</span> LOOCV<span class="token punctuation">.</span>split<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>LOOCVTrain <span class="token operator">=</span> train
            self<span class="token punctuation">.</span>LOOCVTest <span class="token operator">=</span> test

        self<span class="token punctuation">.</span>LOOCVAntiTestSet <span class="token operator">=</span> self<span class="token punctuation">.</span>LOOCVTrain<span class="token punctuation">.</span>build_anti_testset<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Compute similarty matrix between items so we can measure diversity</span>
        sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'cosine'</span><span class="token punctuation">,</span> <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true"># KNN 计算相似度矩阵</span>
        self<span class="token punctuation">.</span>simsAlgo <span class="token operator">=</span> KNNBaseline<span class="token punctuation">(</span>sim_options<span class="token operator">=</span>sim_options<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>simsAlgo<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fullTrainSet<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">GetFullTrainSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>fullTrainSet

    <span class="token keyword">def</span> <span class="token function">GetFullAntiTestset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>fullAntiTestSet

    <span class="token keyword">def</span> <span class="token function">GetAntiTestSetForUser</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> testSubject<span class="token punctuation">)</span><span class="token punctuation">:</span>
        trainset <span class="token operator">=</span> self<span class="token punctuation">.</span>fullTrainSet
        fill <span class="token operator">=</span> trainset<span class="token punctuation">.</span>global_mean
        anti_testset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        u <span class="token operator">=</span> trainset<span class="token punctuation">.</span>to_inner_uid<span class="token punctuation">(</span>str<span class="token punctuation">(</span>testSubject<span class="token punctuation">)</span><span class="token punctuation">)</span>
        user_items <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">[</span>j <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">in</span> trainset<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        anti_testset <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>trainset<span class="token punctuation">.</span>to_raw_uid<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span> trainset<span class="token punctuation">.</span>to_raw_iid<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token punctuation">)</span> <span class="token keyword">for</span>
                         i <span class="token keyword">in</span> trainset<span class="token punctuation">.</span>all_items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span>
                         i <span class="token operator">not</span> <span class="token keyword">in</span> user_items<span class="token punctuation">]</span>
        <span class="token keyword">return</span> anti_testset

    <span class="token keyword">def</span> <span class="token function">GetTrainSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>trainSet

    <span class="token keyword">def</span> <span class="token function">GetTestSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>testSet

    <span class="token keyword">def</span> <span class="token function">GetLOOCVTrainSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>LOOCVTrain

    <span class="token keyword">def</span> <span class="token function">GetLOOCVTestSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>LOOCVTest
        
    <span class="token keyword">def</span> <span class="token function">GetLOOCVAntiTestSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>LOOCVAntiTestSet
        
    <span class="token keyword">def</span> <span class="token function">GetFullAntiTestSet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>fullAntiTestSet
        
    <span class="token keyword">def</span> <span class="token function">GetSimilarities</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>
        
    <span class="token keyword">def</span> <span class="token function">GetPopularityRankings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>rankings 
</code></pre>
<h2 id="004-Activity-Review-the-Results-of-our-Algorithm-Evaluation"><a href="#004-Activity-Review-the-Results-of-our-Algorithm-Evaluation" class="headerlink" title="004 [Activity] Review the Results of our Algorithm Evaluation"></a>004 [Activity] Review the Results of our Algorithm Evaluation</h2><p><img src="ba49f84c.png"></p>
<h1 id="05-Content-Based-Filtering"><a href="#05-Content-Based-Filtering" class="headerlink" title="05 - Content-Based Filtering"></a>05 - Content-Based Filtering</h1><h2 id="001-Content-Based-Recommendations-and-the-Cosine-Similarity-Metric"><a href="#001-Content-Based-Recommendations-and-the-Cosine-Similarity-Metric" class="headerlink" title="001 Content-Based Recommendations, and the Cosine Similarity Metric"></a>001 Content-Based Recommendations, and the Cosine Similarity Metric</h2><p><img src="001ab82c.png"><img src="9a23a069.png"><img src="4166523a.png" alt="余弦相似度"><img src="4daecfcd.png"><br><img src="d3b6477b.png" alt="one-hot"><img src="1d562765.png"><img src="fdbb89a8.png"></p>
<h2 id="002-K-Nearest-Neighbors-and-Content-Recs"><a href="#002-K-Nearest-Neighbors-and-Content-Recs" class="headerlink" title="002 K-Nearest-Neighbors and Content Recs"></a>002 K-Nearest-Neighbors and Content Recs</h2><p><img src="2e3cde21.png"><img src="c1eced5a.png" alt="选择exp正则化, abs(上映年份差值/10)作为相似度, 也有别的计算方法"><br><img src="c131e542.png" alt="K近邻"><img src="9752c14f.png"></p>
<h2 id="003-Activity-Producing-and-Evaluating-Content-Based-Movie-Recommendations"><a href="#003-Activity-Producing-and-Evaluating-Content-Based-Movie-Recommendations" class="headerlink" title="003 [Activity] Producing and Evaluating Content-Based Movie Recommendations"></a>003 [Activity] Producing and Evaluating Content-Based Movie Recommendations</h2><p><img src="a8f20693.png"><img src="4f9d2d34.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ContentKNNAlgorithm.py</span>
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> AlgoBase
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> PredictionImpossible
<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">import</span> math
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> heapq


<span class="token keyword">class</span> <span class="token class-name">ContentKNNAlgorithm</span><span class="token punctuation">(</span>AlgoBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> sim_options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        AlgoBase<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>k <span class="token operator">=</span> k

    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> trainset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        AlgoBase<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>self<span class="token punctuation">,</span> trainset<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Compute item similarity matrix based on content attributes</span>

        <span class="token comment" spellcheck="true"># Load up genre vectors for every movie</span>
        ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
        genres <span class="token operator">=</span> ml<span class="token punctuation">.</span>getGenres<span class="token punctuation">(</span><span class="token punctuation">)</span>
        years <span class="token operator">=</span> ml<span class="token punctuation">.</span>getYears<span class="token punctuation">(</span><span class="token punctuation">)</span>
        mes <span class="token operator">=</span> ml<span class="token punctuation">.</span>getMiseEnScene<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Computing content-based similarity matrix..."</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Compute genre distance for every movie combination as a 2x2 matrix</span>
        self<span class="token punctuation">.</span>similarities <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>n_items<span class="token punctuation">,</span> self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>n_items<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> thisRating <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>n_items<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>thisRating <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>thisRating<span class="token punctuation">,</span> <span class="token string">" of "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>n_items<span class="token punctuation">)</span>
            <span class="token keyword">for</span> otherRating <span class="token keyword">in</span> range<span class="token punctuation">(</span>thisRating <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>n_items<span class="token punctuation">)</span><span class="token punctuation">:</span>
                thisMovieID <span class="token operator">=</span> int<span class="token punctuation">(</span>self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>to_raw_iid<span class="token punctuation">(</span>thisRating<span class="token punctuation">)</span><span class="token punctuation">)</span>
                otherMovieID <span class="token operator">=</span> int<span class="token punctuation">(</span>self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>to_raw_iid<span class="token punctuation">(</span>otherRating<span class="token punctuation">)</span><span class="token punctuation">)</span>
                genreSimilarity <span class="token operator">=</span> self<span class="token punctuation">.</span>computeGenreSimilarity<span class="token punctuation">(</span>thisMovieID<span class="token punctuation">,</span> otherMovieID<span class="token punctuation">,</span> genres<span class="token punctuation">)</span>
                yearSimilarity <span class="token operator">=</span> self<span class="token punctuation">.</span>computeYearSimilarity<span class="token punctuation">(</span>thisMovieID<span class="token punctuation">,</span> otherMovieID<span class="token punctuation">,</span> years<span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true"># mesSimilarity self.computeMiseEnScenesimilarity(thisMovieID,otherMovieID,mes)</span>
                self<span class="token punctuation">.</span>similarities<span class="token punctuation">[</span>thisRating<span class="token punctuation">,</span> otherRating<span class="token punctuation">]</span> <span class="token operator">=</span> genreSimilarity <span class="token operator">*</span> yearSimilarity
                self<span class="token punctuation">.</span>similarities<span class="token punctuation">[</span>otherRating<span class="token punctuation">,</span> thisRating<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>similarities<span class="token punctuation">[</span>thisRating<span class="token punctuation">,</span> otherRating<span class="token punctuation">]</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"...done."</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token comment" spellcheck="true"># 标签相似度</span>
    <span class="token keyword">def</span> <span class="token function">computeGenreSimilarity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> moviel<span class="token punctuation">,</span> movie2<span class="token punctuation">,</span> genres<span class="token punctuation">)</span><span class="token punctuation">:</span>
        genres1 <span class="token operator">=</span> genres<span class="token punctuation">[</span>moviel<span class="token punctuation">]</span>
        genres2 <span class="token operator">=</span> genres<span class="token punctuation">[</span>movie2<span class="token punctuation">]</span>
        sumxx<span class="token punctuation">,</span> sumxy<span class="token punctuation">,</span> sumyy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>genres1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> genres1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            y <span class="token operator">=</span> genres2<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            sumxx <span class="token operator">+=</span> x <span class="token operator">*</span> x
            sumyy <span class="token operator">+=</span> y <span class="token operator">*</span> y
            sumxy <span class="token operator">+=</span> x <span class="token operator">*</span> y

        <span class="token keyword">return</span> sumxy <span class="token operator">/</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>sumxx <span class="token operator">*</span> sumyy<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># 上映年份相似度</span>
    <span class="token keyword">def</span> <span class="token function">computeYearSimilarity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> movie1<span class="token punctuation">,</span> movie2<span class="token punctuation">,</span> years<span class="token punctuation">)</span><span class="token punctuation">:</span>
        diff <span class="token operator">=</span> abs<span class="token punctuation">(</span>years<span class="token punctuation">[</span>movie1<span class="token punctuation">]</span> <span class="token operator">-</span> years<span class="token punctuation">[</span>movie2<span class="token punctuation">]</span><span class="token punctuation">)</span>
        sim <span class="token operator">=</span> math<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>diff <span class="token operator">/</span> <span class="token number">10.0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> sim

    <span class="token keyword">def</span> <span class="token function">computeMiseEnSceneSimilarity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> movie1<span class="token punctuation">,</span> movie2<span class="token punctuation">,</span> mes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mes1 <span class="token operator">=</span> mes<span class="token punctuation">[</span>movie1<span class="token punctuation">]</span>
        mes2 <span class="token operator">=</span> mes<span class="token punctuation">[</span>movie2<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mes1 <span class="token operator">and</span> mes2<span class="token punctuation">)</span><span class="token punctuation">:</span>
            shotLengthDiff <span class="token operator">=</span> math<span class="token punctuation">.</span>fabs<span class="token punctuation">(</span>mes1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> mes2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            colorVarianceDiff <span class="token operator">=</span> math<span class="token punctuation">.</span>fabs<span class="token punctuation">(</span>mes1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> mes2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            motionDiff <span class="token operator">=</span> math<span class="token punctuation">.</span>fabs<span class="token punctuation">(</span>mes1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> mes2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            lightingDiff <span class="token operator">=</span> math<span class="token punctuation">.</span>fabs<span class="token punctuation">(</span>mes1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> mes2<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            numShotsDiff <span class="token operator">=</span> math<span class="token punctuation">.</span>fabs<span class="token punctuation">(</span>mes1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">-</span> mes2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> shotLengthDiff <span class="token operator">*</span> colorVarianceDiff <span class="token operator">*</span> motionDiff <span class="token operator">*</span> lightingDiff <span class="token operator">*</span> numShotsDiff
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">estimate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> u<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>knows_user<span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">and</span> self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>knows_item<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> PredictionImpossible<span class="token punctuation">(</span><span class="token string">'User and/or item is unkown.'</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Build up similarity scores between this item and everything the user rated</span>
        neighbors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> rating <span class="token keyword">in</span> self<span class="token punctuation">.</span>trainset<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">:</span>
            genreSimilarity <span class="token operator">=</span> self<span class="token punctuation">.</span>similarities<span class="token punctuation">[</span>i<span class="token punctuation">,</span> rating<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            neighbors<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>genreSimilarity<span class="token punctuation">,</span> rating<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Extract the top-K most-sumilar ratings</span>
        <span class="token comment" spellcheck="true"># nlargest: Find the n largest elements in a dataset.</span>
        <span class="token comment" spellcheck="true">#           Equivalent to: sorted(iterable, key=key, reverse=True)[:n]</span>
        k_neighbors <span class="token operator">=</span> heapq<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">,</span> neighbors<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> t<span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Compute average sim score of K neighbors weighted by user ratings</span>
        simTotal <span class="token operator">=</span> weightedSum <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>simScore<span class="token punctuation">,</span> rating<span class="token punctuation">)</span> <span class="token keyword">in</span> k_neighbors<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>simScore <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                simTotal <span class="token operator">+=</span> simScore
                weightedSum <span class="token operator">+=</span> simScore <span class="token operator">*</span> rating

        <span class="token keyword">if</span> <span class="token punctuation">(</span>simTotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> PredictionImpossible<span class="token punctuation">(</span><span class="token string">'No neighbors'</span><span class="token punctuation">)</span>

        predictedRating <span class="token operator">=</span> weightedSum <span class="token operator">/</span> simTotal
        <span class="token keyword">return</span> predictedRating
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ContentRecs.py</span>
<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> ContentKNNAlgorithm <span class="token keyword">import</span> ContentKNNAlgorithm
<span class="token keyword">from</span> Evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> NormalPredictor

<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">LoadMovieLensData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
    rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ml<span class="token punctuation">,</span> data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>


np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Load up common data set for the recommender algorithms</span>
<span class="token punctuation">(</span>ml<span class="token punctuation">,</span> evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span> <span class="token operator">=</span> LoadMovieLensData<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Construct an Evaluator to,you know,evaluate them</span>
evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span>evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

contentKNN <span class="token operator">=</span> ContentKNNAlgorithm<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>contentKNN<span class="token punctuation">,</span> <span class="token string">"ContentKNN"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Just make random recommendations</span>
Random <span class="token operator">=</span> NormalPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>Random<span class="token punctuation">,</span> <span class="token string">"Random"</span><span class="token punctuation">)</span>

evaluator<span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>SampleTopNRecs<span class="token punctuation">(</span>ml<span class="token punctuation">)</span>
</code></pre>
<h2 id="004-A-Note-on-Using-Implicit-Ratings"><a href="#004-A-Note-on-Using-Implicit-Ratings" class="headerlink" title="004 A Note on Using Implicit Ratings"></a>004 A Note on Using Implicit Ratings</h2><p><img src="b89400ff.png" alt="点击/购物等隐形评价, 隐性评价往往更多而且更能反映信息"><img src="eeb234bd.png"><br><img src="88cbe8df.png"><img src="ab21b3f1.png"></p>
<h2 id="005-Activity-Bleeding-Edge-Alert-Mise-en-Scene-Recommendations"><a href="#005-Activity-Bleeding-Edge-Alert-Mise-en-Scene-Recommendations" class="headerlink" title="005 [Activity] Bleeding Edge Alert! Mise en Scene Recommendations"></a>005 [Activity] Bleeding Edge Alert! Mise en Scene Recommendations</h2><p><img src="9d1ebf0e.png"><img src="c266ab7a.png"><img src="6248d07d.png"><img src="d4ff61af.png"><img src="b1f67520.png"></p>
<h2 id="006-Exercise-Dive-Deeper-into-Content-Based-Recommendations"><a href="#006-Exercise-Dive-Deeper-into-Content-Based-Recommendations" class="headerlink" title="006 [Exercise] Dive Deeper into Content-Based Recommendations"></a>006 [Exercise] Dive Deeper into Content-Based Recommendations</h2><p><img src="7fc05c4b.png"><img src="8e2a0c38.png"><img src="02aa895a.png"></p>
<h1 id="06-Neighborhood-Based-Collaborative-Filtering"><a href="#06-Neighborhood-Based-Collaborative-Filtering" class="headerlink" title="06 - Neighborhood-Based Collaborative Filtering"></a>06 - Neighborhood-Based Collaborative Filtering</h1><h2 id="001-Measuring-Similarity-and-Sparsity"><a href="#001-Measuring-Similarity-and-Sparsity" class="headerlink" title="001 Measuring Similarity, and Sparsity"></a>001 Measuring Similarity, and Sparsity</h2><p>协同过滤, 基于他人的评价来推荐</p>
<p><img src="9545152c.png"><img src="7446eaa5.png"><img src="99461de1.png"><br><img src="43297fc0.png" alt="用户的评价等数据往往很稀疏, 大公司有很多用户数据所以它们的协同过滤系统依然可以有好的表现"></p>
<h2 id="002-Similarity-Metrics"><a href="#002-Similarity-Metrics" class="headerlink" title="002 Similarity Metrics"></a>002 Similarity Metrics</h2><p><img src="21f23b9d.png"><img src="9228dbee.png" alt="看用户平均的评分(l-)"><img src="e81bfb7c.png"><br><img src="90a3752e.png"><img src="b1a7e7f2.png"><img src="979710ae.png"></p>
<h2 id="003-User-based-Collaborative-Filtering"><a href="#003-User-based-Collaborative-Filtering" class="headerlink" title="003 User-based Collaborative Filtering"></a>003 User-based Collaborative Filtering</h2><p><img src="9983a411.png" alt="找到相似的用户, 然后根据他的评分进行推荐"><img src="9d59d733.png"><img src="24a6ea0b.png"><br><img src="5ec33000.png"><img src="6bab5079.png"><img src="d19c3f2b.png"><img src="79b1643b.png"><br><img src="fceaf8ad.png"><img src="bb8fef66.png"></p>
<h2 id="004-Activity-User-based-Collaborative-Filtering-Hands-On"><a href="#004-Activity-User-based-Collaborative-Filtering-Hands-On" class="headerlink" title="004 [Activity] User-based Collaborative Filtering, Hands-On"></a>004 [Activity] User-based Collaborative Filtering, Hands-On</h2><p><img src="ff22119a.png" alt="协同过滤处理速度很快"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Wed May  9 10:10:04 2018

@author: Frank
"""</span>
<span class="token comment" spellcheck="true"># SimpleUserCF.py</span>

<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> KNNBasic
<span class="token keyword">import</span> heapq
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter

testSubject <span class="token operator">=</span> <span class="token string">'85'</span>
k <span class="token operator">=</span> <span class="token number">10</span>

<span class="token comment" spellcheck="true"># Load our data set and compute the user similarity matrix</span>
ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>

trainSet <span class="token operator">=</span> data<span class="token punctuation">.</span>build_full_trainset<span class="token punctuation">(</span><span class="token punctuation">)</span>

sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'cosine'</span><span class="token punctuation">,</span>
               <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
               <span class="token punctuation">}</span>

model <span class="token operator">=</span> KNNBasic<span class="token punctuation">(</span>sim_options<span class="token operator">=</span>sim_options<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>trainSet<span class="token punctuation">)</span>
simsMatrix <span class="token operator">=</span> model<span class="token punctuation">.</span>compute_similarities<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Get top N similar users to our test subject</span>
<span class="token comment" spellcheck="true"># (Alternate approach would be to select users up to some similarity threshold - try it!)</span>
testUserInnerID <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>to_inner_uid<span class="token punctuation">(</span>testSubject<span class="token punctuation">)</span>
similarityRow <span class="token operator">=</span> simsMatrix<span class="token punctuation">[</span>testUserInnerID<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># 用户85的相似度矩阵</span>

similarUsers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># 记录相似的用户</span>
<span class="token keyword">for</span> innerID<span class="token punctuation">,</span> score <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>similarityRow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>innerID <span class="token operator">!=</span> testUserInnerID<span class="token punctuation">)</span><span class="token punctuation">:</span>
        similarUsers<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>innerID<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 找到前k个最相似的user</span>
kNeighbors <span class="token operator">=</span> heapq<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span>k<span class="token punctuation">,</span> similarUsers<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> t<span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Get the stuff they rated, and add up ratings for each item, weighted by user similarity</span>
candidates <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>float<span class="token punctuation">)</span>
<span class="token keyword">for</span> similarUser <span class="token keyword">in</span> kNeighbors<span class="token punctuation">:</span>
    innerID <span class="token operator">=</span> similarUser<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># simi user id</span>
    userSimilarityScore <span class="token operator">=</span> similarUser<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># simi user score 和85号的相似分值</span>
    theirRatings <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>innerID<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># simi user rating</span>
    <span class="token keyword">for</span> rating <span class="token keyword">in</span> theirRatings<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># movie: simi user score * rating/5</span>
        candidates<span class="token punctuation">[</span>rating<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>rating<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">5.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> userSimilarityScore

<span class="token comment" spellcheck="true"># Build a dictionary of stuff the user has already seen</span>
watched <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> itemID<span class="token punctuation">,</span> rating <span class="token keyword">in</span> trainSet<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>testUserInnerID<span class="token punctuation">]</span><span class="token punctuation">:</span>
    watched<span class="token punctuation">[</span>itemID<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment" spellcheck="true"># 记录85号已经看过的movie, 没看过的为 movieID: 0</span>

<span class="token comment" spellcheck="true"># Get top-rated items from similar users:</span>
pos <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment" spellcheck="true"># 根据 candidates候选字典的 [1](score) 排序, 然后遍历</span>
<span class="token keyword">for</span> itemID<span class="token punctuation">,</span> ratingSum <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>candidates<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 85号没看过</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> itemID <span class="token keyword">in</span> watched<span class="token punctuation">:</span>
        movieID <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>to_raw_iid<span class="token punctuation">(</span>itemID<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ml<span class="token punctuation">.</span>getMovieName<span class="token punctuation">(</span>int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratingSum<span class="token punctuation">)</span>
        pos <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
</code></pre>
<h2 id="005-Item-based-Collaborative-Filtering"><a href="#005-Item-based-Collaborative-Filtering" class="headerlink" title="005 Item-based Collaborative Filtering"></a>005 Item-based Collaborative Filtering</h2><p>基于物品的协同过滤(新用户也能很快被推荐适合的, 如果是基于用户, 则需要新用户产生消费或评价数据才能更好地推荐)</p>
<p><img src="e13fbd54.png"><img src="d09cce97.png" alt="这里余弦相似度是1或0主要是因为数据太少"><img src="a5174f41.png"></p>
<h2 id="006-Activity-Item-based-Collaborative-Filtering-Hands-On"><a href="#006-Activity-Item-based-Collaborative-Filtering-Hands-On" class="headerlink" title="006 [Activity] Item-based Collaborative Filtering, Hands-On"></a>006 [Activity] Item-based Collaborative Filtering, Hands-On</h2><p><img src="c9e63632.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Wed May  9 10:10:04 2018

@author: Frank
"""</span>
<span class="token comment" spellcheck="true"># SimpleItemCF.py 基于物品</span>

<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> KNNBasic
<span class="token keyword">import</span> heapq
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter

testSubject <span class="token operator">=</span> <span class="token string">'85'</span>
k <span class="token operator">=</span> <span class="token number">10</span>

ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>

trainSet <span class="token operator">=</span> data<span class="token punctuation">.</span>build_full_trainset<span class="token punctuation">(</span><span class="token punctuation">)</span>

sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'cosine'</span><span class="token punctuation">,</span>
               <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
               <span class="token punctuation">}</span>

model <span class="token operator">=</span> KNNBasic<span class="token punctuation">(</span>sim_options<span class="token operator">=</span>sim_options<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>trainSet<span class="token punctuation">)</span>
simsMatrix <span class="token operator">=</span> model<span class="token punctuation">.</span>compute_similarities<span class="token punctuation">(</span><span class="token punctuation">)</span>

testUserInnerID <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>to_inner_uid<span class="token punctuation">(</span>testSubject<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Get the top K items we rated</span>
testUserRatings <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>testUserInnerID<span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 得到85号的评分数据</span>
<span class="token comment" spellcheck="true"># 找到k个评分最高的</span>
kNeighbors <span class="token operator">=</span> heapq<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span>k<span class="token punctuation">,</span> testUserRatings<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> t<span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Get similar items to stuff we liked (weighted by rating)</span>
candidates <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>float<span class="token punctuation">)</span>
<span class="token keyword">for</span> itemID<span class="token punctuation">,</span> rating <span class="token keyword">in</span> kNeighbors<span class="token punctuation">:</span>
    similarityRow <span class="token operator">=</span> simsMatrix<span class="token punctuation">[</span>itemID<span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 找到和被评分物品相似的</span>
    <span class="token keyword">for</span> innerID<span class="token punctuation">,</span> score <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>similarityRow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 记录新物品的评分</span>
        candidates<span class="token punctuation">[</span>innerID<span class="token punctuation">]</span> <span class="token operator">+=</span> score <span class="token operator">*</span> <span class="token punctuation">(</span>rating <span class="token operator">/</span> <span class="token number">5.0</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Build a dictionary of stuff the user has already seen</span>
watched <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true"># 记录85号看过的</span>
<span class="token keyword">for</span> itemID<span class="token punctuation">,</span> rating <span class="token keyword">in</span> trainSet<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>testUserInnerID<span class="token punctuation">]</span><span class="token punctuation">:</span>
    watched<span class="token punctuation">[</span>itemID<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment" spellcheck="true"># Get top-rated items from similar users:</span>
pos <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> itemID<span class="token punctuation">,</span> ratingSum <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>candidates<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> itemID <span class="token keyword">in</span> watched<span class="token punctuation">:</span>
        movieID <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>to_raw_iid<span class="token punctuation">(</span>itemID<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ml<span class="token punctuation">.</span>getMovieName<span class="token punctuation">(</span>int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratingSum<span class="token punctuation">)</span>
        pos <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
</code></pre>
<h2 id="007-Exercise-Tuning-Collaborative-Filtering-Algorithms"><a href="#007-Exercise-Tuning-Collaborative-Filtering-Algorithms" class="headerlink" title="007 [Exercise] Tuning Collaborative Filtering Algorithms"></a>007 [Exercise] Tuning Collaborative Filtering Algorithms</h2><p><img src="a02dd6c8.png"><img src="554aed43.png"><img src="526920b5.png"></p>
<h2 id="008-Activity-Evaluating-Collaborative-Filtering-Systems-Offline"><a href="#008-Activity-Evaluating-Collaborative-Filtering-Systems-Offline" class="headerlink" title="008 [Activity] Evaluating Collaborative Filtering Systems Offline"></a>008 [Activity] Evaluating Collaborative Filtering Systems Offline</h2><p><img src="17258110.png"><img src="1d0852a5.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Wed May  9 10:10:04 2018

@author: Frank
"""</span>
<span class="token comment" spellcheck="true"># EvaluateUserCF.py</span>

<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> KNNBasic
<span class="token keyword">import</span> heapq
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter
<span class="token keyword">from</span> surprise<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> LeaveOneOut
<span class="token keyword">from</span> RecommenderMetrics <span class="token keyword">import</span> RecommenderMetrics
<span class="token keyword">from</span> EvaluationData <span class="token keyword">import</span> EvaluationData


<span class="token keyword">def</span> <span class="token function">LoadMovieLensData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
    rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ml<span class="token punctuation">,</span> data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>


ml<span class="token punctuation">,</span> data<span class="token punctuation">,</span> rankings <span class="token operator">=</span> LoadMovieLensData<span class="token punctuation">(</span><span class="token punctuation">)</span>

evalData <span class="token operator">=</span> EvaluationData<span class="token punctuation">(</span>data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Train on leave-One-Out train set</span>
trainSet <span class="token operator">=</span> evalData<span class="token punctuation">.</span>GetLOOCVTrainSet<span class="token punctuation">(</span><span class="token punctuation">)</span>
sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'cosine'</span><span class="token punctuation">,</span>
               <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>

model <span class="token operator">=</span> KNNBasic<span class="token punctuation">(</span>sim_options<span class="token operator">=</span>sim_options<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>trainSet<span class="token punctuation">)</span>
simsMatrix <span class="token operator">=</span> model<span class="token punctuation">.</span>compute_similarities<span class="token punctuation">(</span><span class="token punctuation">)</span>

leftOutTestSet <span class="token operator">=</span> evalData<span class="token punctuation">.</span>GetLOOCVTestSet<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Build up dict to lists of (int(movieID), predictedrating) pairs</span>
topN <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
k <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">for</span> uiid <span class="token keyword">in</span> range<span class="token punctuation">(</span>trainSet<span class="token punctuation">.</span>n_users<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Get top N similar users to this one</span>
    similarityRow <span class="token operator">=</span> simsMatrix<span class="token punctuation">[</span>uiid<span class="token punctuation">]</span>

    similarUsers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> innerID<span class="token punctuation">,</span> score <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>similarityRow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>innerID <span class="token operator">!=</span> uiid<span class="token punctuation">)</span><span class="token punctuation">:</span>
            similarUsers<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>innerID<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">)</span>

    kNeighbors <span class="token operator">=</span> heapq<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span>k<span class="token punctuation">,</span> similarUsers<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> t<span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Get the stuff they rated, and add up ratings for each item, weighted by user similarity</span>
    candidates <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>float<span class="token punctuation">)</span>
    <span class="token keyword">for</span> similarUser <span class="token keyword">in</span> kNeighbors<span class="token punctuation">:</span>
        innerID <span class="token operator">=</span> similarUser<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        userSimilarityScore <span class="token operator">=</span> similarUser<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        theirRatings <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>innerID<span class="token punctuation">]</span>
        <span class="token keyword">for</span> rating <span class="token keyword">in</span> theirRatings<span class="token punctuation">:</span>
            candidates<span class="token punctuation">[</span>rating<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>rating<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">5.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> userSimilarityScore

    <span class="token comment" spellcheck="true"># Build a dictionary of stuff the user has already seen</span>
    watched <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> itemID<span class="token punctuation">,</span> rating <span class="token keyword">in</span> trainSet<span class="token punctuation">.</span>ur<span class="token punctuation">[</span>uiid<span class="token punctuation">]</span><span class="token punctuation">:</span>
        watched<span class="token punctuation">[</span>itemID<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token comment" spellcheck="true"># Get top-rated items from similar users:</span>
    pos <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> itemID<span class="token punctuation">,</span> ratingSum <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>candidates<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> itemID <span class="token keyword">in</span> watched<span class="token punctuation">:</span>
            movieID <span class="token operator">=</span> trainSet<span class="token punctuation">.</span>to_raw_iid<span class="token punctuation">(</span>itemID<span class="token punctuation">)</span>
            topN<span class="token punctuation">[</span>int<span class="token punctuation">(</span>trainSet<span class="token punctuation">.</span>to_raw_uid<span class="token punctuation">(</span>uiid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">(</span>movieID<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            pos <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">></span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>

<span class="token comment" spellcheck="true"># Measure</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"HR"</span><span class="token punctuation">,</span> RecommenderMetrics<span class="token punctuation">.</span>HitRate<span class="token punctuation">(</span>topN<span class="token punctuation">,</span> leftOutTestSet<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="009-Exercise-Measure-the-Hit-Rate-of-Item-Based-Collaborative-Filtering"><a href="#009-Exercise-Measure-the-Hit-Rate-of-Item-Based-Collaborative-Filtering" class="headerlink" title="009 [Exercise] Measure the Hit Rate of Item-Based Collaborative Filtering"></a>009 [Exercise] Measure the Hit Rate of Item-Based Collaborative Filtering</h2><p><img src="04796290.png"><img src="e94b036f.png"></p>
<h2 id="010-KNN-Recommenders"><a href="#010-KNN-Recommenders" class="headerlink" title="010 KNN Recommenders"></a>010 KNN Recommenders</h2><p><img src="39a0c8ae.png"><img src="1b1d7429.png" alt="尝试使用k近邻预测, 而不是对k个最相似的进行评分的平均计算(topN)"><br><img src="968b6605.png"><img src="0d26b2fc.png"><img src="e2f0b797.png"></p>
<h2 id="011-Activity-Running-User-and-Item-Based-KNN-on-MovieLens"><a href="#011-Activity-Running-User-and-Item-Based-KNN-on-MovieLens" class="headerlink" title="011 [Activity] Running User and Item-Based KNN on MovieLens"></a>011 [Activity] Running User and Item-Based KNN on MovieLens</h2><p><img src="86acdbdd.png"><img src="945e661b.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Thu May  3 11:11:13 2018

@author: Frank
"""</span>
<span class="token comment" spellcheck="true"># KNNBakeOff.py</span>

<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> KNNBasic
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> NormalPredictor
<span class="token keyword">from</span> Evaluator <span class="token keyword">import</span> Evaluator

<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">LoadMovieLensData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
    rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ml<span class="token punctuation">,</span> data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Load up common data set for the recommender algorithms</span>
<span class="token punctuation">(</span>ml<span class="token punctuation">,</span> evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span> <span class="token operator">=</span> LoadMovieLensData<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Construct an Evaluator to, you know, evaluate them</span>
evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span>evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># User-based KNN</span>
UserKNN <span class="token operator">=</span> KNNBasic<span class="token punctuation">(</span>sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'cosine'</span><span class="token punctuation">,</span> <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>UserKNN<span class="token punctuation">,</span> <span class="token string">"User KNN"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Item-based KNN</span>
ItemKNN <span class="token operator">=</span> KNNBasic<span class="token punctuation">(</span>sim_options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'cosine'</span><span class="token punctuation">,</span> <span class="token string">'user_based'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>ItemKNN<span class="token punctuation">,</span> <span class="token string">"Item KNN"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Just make random recommendations</span>
Random <span class="token operator">=</span> NormalPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>Random<span class="token punctuation">,</span> <span class="token string">"Random"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Fight!</span>
evaluator<span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

evaluator<span class="token punctuation">.</span>SampleTopNRecs<span class="token punctuation">(</span>ml<span class="token punctuation">)</span>
</code></pre>
<h2 id="012-Exercise-Experiment-with-different-KNN-parameters"><a href="#012-Exercise-Experiment-with-different-KNN-parameters" class="headerlink" title="012 [Exercise] Experiment with different KNN parameters"></a>012 [Exercise] Experiment with different KNN parameters</h2><p><img src="b6daa48a.png"><img src="37334509.png"><img src="df23286e.png"><img src="791d2e28.png"><br>KNN表现通常不佳, 评级并不是连续的, 而KNN假定数据是连续的, 而且对稀疏数据敏感, KNN适合解决分类问题而不是评级预测问题</p>
<h2 id="013-Bleeding-Edge-Alert-Translation-Based-Recommendations"><a href="#013-Bleeding-Edge-Alert-Translation-Based-Recommendations" class="headerlink" title="013 Bleeding Edge Alert! Translation-Based Recommendations"></a>013 Bleeding Edge Alert! Translation-Based Recommendations</h2><p><img src="0b611605.png"><img src="f8fb7951.png"><img src="abfde3b7.png"><img src="53dc65cc.png"></p>
<h1 id="07-Matrix-Factorization-Methods-矩阵分解方法"><a href="#07-Matrix-Factorization-Methods-矩阵分解方法" class="headerlink" title="07 - Matrix Factorization Methods 矩阵分解方法"></a>07 - Matrix Factorization Methods 矩阵分解方法</h1><h2 id="001-Principal-Component-Analysis-PCA-主成分分析"><a href="#001-Principal-Component-Analysis-PCA-主成分分析" class="headerlink" title="001 Principal Component Analysis (PCA) 主成分分析"></a>001 Principal Component Analysis (PCA) 主成分分析</h2><p>协同过滤可扩展性有限, 大数据集可能要经过大量计算</p>
<p><img src="6169d3fa.png"><img src="fdee4b79.png" alt="主成分分析通常用于降维"><img src="a84f7f34.png" alt="特征向量给出了我们最需要关注的维度"><img src="567505eb.png"></p>
<h2 id="002-Singular-Value-Decomposition"><a href="#002-Singular-Value-Decomposition" class="headerlink" title="002 Singular Value Decomposition"></a>002 Singular Value Decomposition</h2><p><img src="ca5e42ca.png" alt="PCA方法提取用户的潜在特征"><img src="aa2ae2d8.png"><img src="fe1882dd.png"><br><img src="32ad072a.png" alt="PCA需要在完整的无缺失数据的矩阵上使用, 尝试使用SVD进行填充, 用随机梯度下降(SGD)学习SVD参数 ?."><br>各种方法来学习最好的缺失值填充</p>
<h2 id="003-Activity-Running-SVD-and-SVD-on-MovieLens"><a href="#003-Activity-Running-SVD-and-SVD-on-MovieLens" class="headerlink" title="003 [Activity] Running SVD and SVD++ on MovieLens"></a>003 [Activity] Running SVD and SVD++ on MovieLens</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Thu May  3 11:11:13 2018

@author: Frank
"""</span>
<span class="token comment" spellcheck="true"># SVDBakeOff.py</span>

<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> SVD<span class="token punctuation">,</span> SVDpp
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> NormalPredictor
<span class="token keyword">from</span> Evaluator <span class="token keyword">import</span> Evaluator

<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">LoadMovieLensData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
    rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ml<span class="token punctuation">,</span> data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>


np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Load up common data set for the recommender algorithms</span>
<span class="token punctuation">(</span>ml<span class="token punctuation">,</span> evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span> <span class="token operator">=</span> LoadMovieLensData<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Construct an Evaluator to, you know, evaluate them</span>
evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span>evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SVD</span>
SVD <span class="token operator">=</span> SVD<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>SVD<span class="token punctuation">,</span> <span class="token string">"SVD"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SVD++</span>
SVDPlusPlus <span class="token operator">=</span> SVDpp<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>SVDPlusPlus<span class="token punctuation">,</span> <span class="token string">"SVD++"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Just make random recommendations</span>
Random <span class="token operator">=</span> NormalPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>Random<span class="token punctuation">,</span> <span class="token string">"Random"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Fight!</span>
evaluator<span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

evaluator<span class="token punctuation">.</span>SampleTopNRecs<span class="token punctuation">(</span>ml<span class="token punctuation">)</span>
</code></pre>
<h2 id="004-Improving-on-SVD"><a href="#004-Improving-on-SVD" class="headerlink" title="004 Improving on SVD"></a>004 Improving on SVD</h2><p><img src="9abea5fc.png"><img src="6dcadecd.png" alt="调整SVD参数"></p>
<h2 id="005-Exercise-Tune-the-hyperparameters-on-SVD"><a href="#005-Exercise-Tune-the-hyperparameters-on-SVD" class="headerlink" title="005 [Exercise] Tune the hyperparameters on SVD"></a>005 [Exercise] Tune the hyperparameters on SVD</h2><p><img src="148fbdb5.png"> 网格搜索寻找最佳超参数</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Thu May  3 11:11:13 2018

@author: Frank
"""</span>
<span class="token comment" spellcheck="true"># SVDTuning.py</span>

<span class="token keyword">from</span> MovieLens <span class="token keyword">import</span> MovieLens
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> SVD
<span class="token keyword">from</span> surprise <span class="token keyword">import</span> NormalPredictor
<span class="token keyword">from</span> Evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> surprise<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV

<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">LoadMovieLensData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ml <span class="token operator">=</span> MovieLens<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading movie ratings..."</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ml<span class="token punctuation">.</span>loadMovieLensLatestSmall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nComputing movie popularity ranks so we can measure novelty later..."</span><span class="token punctuation">)</span>
    rankings <span class="token operator">=</span> ml<span class="token punctuation">.</span>getPopularityRanks<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ml<span class="token punctuation">,</span> data<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Load up common data set for the recommender algorithms</span>
<span class="token punctuation">(</span>ml<span class="token punctuation">,</span> evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span> <span class="token operator">=</span> LoadMovieLensData<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Searching for best parameters..."</span><span class="token punctuation">)</span>
param_grid <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'n_epochs'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'lr_all'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.010</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'n_factors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
gs <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>SVD<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> measures<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'rmse'</span><span class="token punctuation">,</span> <span class="token string">'mae'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

gs<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>evaluationData<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># best RMSE score</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best RMSE score attained: "</span><span class="token punctuation">,</span> gs<span class="token punctuation">.</span>best_score<span class="token punctuation">[</span><span class="token string">'rmse'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># combination of parameters that gave the best RMSE score</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gs<span class="token punctuation">.</span>best_params<span class="token punctuation">[</span><span class="token string">'rmse'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Construct an Evaluator to, you know, evaluate them</span>
evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span>evaluationData<span class="token punctuation">,</span> rankings<span class="token punctuation">)</span>

params <span class="token operator">=</span> gs<span class="token punctuation">.</span>best_params<span class="token punctuation">[</span><span class="token string">'rmse'</span><span class="token punctuation">]</span>
SVDtuned <span class="token operator">=</span> SVD<span class="token punctuation">(</span>n_epochs <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'n_epochs'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lr_all <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'lr_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_factors <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'n_factors'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>SVDtuned<span class="token punctuation">,</span> <span class="token string">"SVD - Tuned"</span><span class="token punctuation">)</span>

SVDUntuned <span class="token operator">=</span> SVD<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>SVDUntuned<span class="token punctuation">,</span> <span class="token string">"SVD - Untuned"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Just make random recommendations</span>
Random <span class="token operator">=</span> NormalPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>
evaluator<span class="token punctuation">.</span>AddAlgorithm<span class="token punctuation">(</span>Random<span class="token punctuation">,</span> <span class="token string">"Random"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Fight!</span>
evaluator<span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

evaluator<span class="token punctuation">.</span>SampleTopNRecs<span class="token punctuation">(</span>ml<span class="token punctuation">)</span>
</code></pre>
<p><img src="140e2443.png"></p>
<h2 id="006-Bleeding-Edge-Alert-Sparse-Linear-Methods-SLIM"><a href="#006-Bleeding-Edge-Alert-Sparse-Linear-Methods-SLIM" class="headerlink" title="006 Bleeding Edge Alert! Sparse Linear Methods (SLIM)"></a>006 Bleeding Edge Alert! Sparse Linear Methods (SLIM)</h2><p><img src="d04bac92.png"><img src="61f0d405.png"><img src="211837a1.png"></p>
<h1 id="09-Deep-Learning-for-Recommender-Systems"><a href="#09-Deep-Learning-for-Recommender-Systems" class="headerlink" title="09 - Deep Learning for Recommender Systems"></a>09 - Deep Learning for Recommender Systems</h1><h2 id="001-Intro-to-Deep-Learning-for-Recommenders"><a href="#001-Intro-to-Deep-Learning-for-Recommenders" class="headerlink" title="001 Intro to Deep Learning for Recommenders"></a>001 Intro to Deep Learning for Recommenders</h2><h2 id="002-Restricted-Boltzmann-Machines-RBM’s"><a href="#002-Restricted-Boltzmann-Machines-RBM’s" class="headerlink" title="002 Restricted Boltzmann Machines (RBM’s)"></a>002 Restricted Boltzmann Machines (RBM’s)</h2>
            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://malred.github.io" class="b-link-green">malred-blog</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2024/04/17/ai/building-recommender-systems-with-machine-learning-and-ai/4ae2c67327/" class="b-link-green">Building Recommender Systems with Machine Learning and AI</a>
                </p>
            </div>
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '676b06df8b7379e50e35',
        clientSecret: '9159b4de0f716ba7bdab9bc02151a90e6961246b',
        repo: 'comment_repo',
        owner: 'malred',
        admin: "malred",
        id: '2024-04-17T20-27-27',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    
        <link rel="stylesheet" href="/libs/gitment/gitment-default.css">
<link rel="stylesheet" href="/css/gitment.css">

<div class="gitment-card card" data-aos="fade-up">
    <div id="gitment-content" class="card-content"></div>
</div>

<script src="/libs/gitment/gitment.js"></script>
<script>
var gitment = new Gitment({
    id: 'Wed Apr 17 2024 20:27:27 GMT+0800',
    owner: 'malred',
    repo: 'comment_repo',
    oauth: {
        client_id: '676b06df8b7379e50e35',
        client_secret: '9159b4de0f716ba7bdab9bc02151a90e6961246b'
    }
});

gitment.render('gitment-content');
</script>
    

    
        <div class="disqus-card card" data-aos="fade-up">
    <div id="disqus_thread" class="card-content">
        <noscript>Please enable JavaScript to view the
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
</div>

<script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'https://malred.github.io/2024/04/17/ai/building-recommender-systems-with-machine-learning-and-ai/4ae2c67327/';
        this.page.identifier = '/2024/04/17/ai/building-recommender-systems-with-machine-learning-and-ai/4ae2c67327/';
        this.page.title = 'Building Recommender Systems with Machine Learning and AI';
    };
    let disqus_shortname = '';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'mipjlux8dRwbE7yY1zP3v13z-gzGzoHsz',
        appKey: 'cIy0pwvRAK8cuOCZRjuoHHfy',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '留下友善的评论~'
    });
</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-dot-circle-o"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2024/04/17/ai/building-recommender-systems-with-machine-learning-and-ai/4ae2c67327/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="Building Recommender Systems with Machine Learning and AI">
                        
                        <span class="card-title">Building Recommender Systems with Machine Learning and AI</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">01 - Getting Started004 [Activity] Install Anaconda, course materials, and create movie recommendations!005 Course Roadm</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2024-04-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/ai/" class="post-category" target="_blank">
                                    ai
                                </a>
                            
                            <a href="/categories/ai/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" class="post-category" target="_blank">
                                    推荐系统
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ai/" target="_blank">
                        <span class="chip bg-color">ai</span>
                    </a>
                    
                    <a href="/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" target="_blank">
                        <span class="chip bg-color">推荐系统</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/04/16/bigdata/pyspark/taming-big-data-with-apache-spark-and-python-hands-on/4ae2c67327/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="Taming Big Data with Apache Spark and Python - Hands On!">
                        
                        <span class="card-title">Taming Big Data with Apache Spark and Python - Hands On!</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">2. Spark Basics and the RDD Interface1. What’s new in Spark 32. Introduction to Spark
3. The Resilient Distributed Datas</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2024-04-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/python/" class="post-category" target="_blank">
                                    python
                                </a>
                            
                            <a href="/categories/python/bigdata/" class="post-category" target="_blank">
                                    bigdata
                                </a>
                            
                            <a href="/categories/python/bigdata/pyspark/" class="post-category" target="_blank">
                                    pyspark
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/bigdata/" target="_blank">
                        <span class="chip bg-color">bigdata</span>
                    </a>
                    
                    <a href="/tags/python/" target="_blank">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/pyspark/" target="_blank">
                        <span class="chip bg-color">pyspark</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://blinkfox.github.io/" target="_blank">Blinkfox</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建.

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">779.8k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/malred" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:malguy2022@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2725953379" class="tooltipped" data-tooltip="QQ联系我: 2725953379" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input" autofocus="">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<!--动态线条背景-->
<script type="text/javascript" color="122 103 238" opacity='0.7' zIndex="-2" count="200"
    src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
    </script>
<script src="/js/matery.js"></script>
<script src="/js/snow.js"></script>

<!-- 引用Aplayer和metingjs -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script>
<div id="my-aplayer" class="aplayer" data-id="7363940489" data-server="netease" data-type="playlist" data-fixed="true"
    // 吸底模式可以固定播放器于页面底部 data-autoplay="true" data-order="list" data-volume="0.55" data-theme="#cc543a"
    data-preload="auto"></div>  
<!-- <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script> -->
<!-- <script src="https://cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script>
    // 对所有链接跳转事件绑定pjax容器container
    $(document).pjax('a[target!=_blank]', '.container', { fragment: '.container', timeout: 8000 })
</script> -->


<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-MSEYRC5EW5"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'G-MSEYRC5EW5');
</script>



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>