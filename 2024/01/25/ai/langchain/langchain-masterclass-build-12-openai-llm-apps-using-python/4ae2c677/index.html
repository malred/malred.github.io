<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="LangChain MasterClass-Build 12 OpenAI LLM Apps using Python, HTML,CSS,React,Vue,Java,Go,微服务,linux">
    <meta name="description" content="1. LangChain Introduction
2. OpenAI Introduction3. Demo &amp;amp; Environment Setup1. A LangChain Example - Implementation D">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>LangChain MasterClass-Build 12 OpenAI LLM Apps using Python | malred-blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">malred-blog</span>
                    </a>
                </div>
                

<a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">malred-blog</div>
        <div class="logo-desc">
            
            前后端学习者,存放知识笔记
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
    </ul>

    <div class="social-link">
    <a href="https://github.com/malred" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:malguy2022@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2725953379" class="tooltipped" data-tooltip="QQ联系我: 2725953379" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
</div>

            </div>
        </div>

        
    </nav>
</header>


<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        LangChain MasterClass-Build 12 OpenAI LLM Apps using Python
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ai/" target="_blank">
                                <span class="chip bg-color">ai</span>
                            </a>
                        
                            <a href="/tags/langChain/" target="_blank">
                                <span class="chip bg-color">langChain</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/ai/" class="post-category" target="_blank">
                                ai
                            </a>
                        
                            <a href="/categories/ai/langChain/" class="post-category" target="_blank">
                                langChain
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-01-25
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        7.4k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        45 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="1-LangChain-Introduction"><a href="#1-LangChain-Introduction" class="headerlink" title="1. LangChain Introduction"></a>1. LangChain Introduction</h1><p><img src="5eb3ee52.png"><img src="e03fe565.png"><img src="81f809b3.png"><img src="c72a14bc.png"><img src="5347b7ac.png"><br><img src="2295b6aa.png"><img src="3ce666b9.png"><img src="f2023e49.png"></p>
<h1 id="2-OpenAI-Introduction"><a href="#2-OpenAI-Introduction" class="headerlink" title="2. OpenAI Introduction"></a>2. OpenAI Introduction</h1><h1 id="3-Demo-amp-Environment-Setup"><a href="#3-Demo-amp-Environment-Setup" class="headerlink" title="3. Demo &amp; Environment Setup"></a>3. Demo &amp; Environment Setup</h1><h2 id="1-A-LangChain-Example-Implementation-Demo"><a href="#1-A-LangChain-Example-Implementation-Demo" class="headerlink" title="1. A LangChain Example - Implementation Demo"></a>1. A LangChain Example - Implementation Demo</h2><p><img src="1b23a291.png"></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="d77da774.png" alt="2023.3好像是py10"></p>
<h1 id="4-Langchain-Models-Module-Concept"><a href="#4-Langchain-Models-Module-Concept" class="headerlink" title="4. Langchain - Models Module Concept"></a>4. Langchain - Models Module Concept</h1><h2 id="1-LangChain’s-Modules-Overview"><a href="#1-LangChain’s-Modules-Overview" class="headerlink" title="1. LangChain’s Modules Overview"></a>1. LangChain’s Modules Overview</h2><p><img src="80900c53.png"><img src="297dc01f.png"></p>
<h1 id="5-✅Beginner-level"><a href="#5-✅Beginner-level" class="headerlink" title="5. ✅Beginner level"></a>5. ✅Beginner level</h1><h1 id="6-Project-1-Simple-Question-amp-Answer-App"><a href="#6-Project-1-Simple-Question-amp-Answer-App" class="headerlink" title="6. Project #1 - Simple Question &amp; Answer App"></a>6. Project #1 - Simple Question &amp; Answer App</h1><h2 id="1-LLMs-Walkthrough"><a href="#1-LLMs-Walkthrough" class="headerlink" title="1. LLMs Walkthrough"></a>1. LLMs Walkthrough</h2><p><img src="b0bfba16.png"><img src="38be212e.png"><img src="29f060da.png"><img src="69c33a24.png" alt="huggingface上有免费的模型"></p>
<h2 id="2-LLM-Practical-Implementation-using-Python"><a href="#2-LLM-Practical-Implementation-using-Python" class="headerlink" title="2. LLM Practical Implementation using Python"></a>2. LLM Practical Implementation using Python</h2><pre class=" language-shell"><code class="language-shell">pip install openai
pip install Openai
conda install langchain -c conda-forge 
pip install langchain[all]
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span>
<span class="token comment" spellcheck="true"># coding: utf-8</span>

<span class="token comment" spellcheck="true"># Pip install is the command you use to install Python packages with the help of a tool called Pip package manager.</span>
<span class="token comment" spellcheck="true"># Installing LangChain package</span>

<span class="token comment" spellcheck="true"># In[20]:</span>


<span class="token comment" spellcheck="true"># get_ipython().system('pip install langChain')</span>


<span class="token comment" spellcheck="true"># # Let's use Proprietary LLM from-OpenAl</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Installing Openai package,which includes the classes that we can use to communicate with Openai services</span>

<span class="token comment" spellcheck="true"># In[21]:</span>


<span class="token comment" spellcheck="true"># get_ipython().system('pip install Openai')</span>


<span class="token comment" spellcheck="true"># Imports the Python built-in module called "os."</span>
<span class="token comment" spellcheck="true"># This module provides a way to interact with the operating system,such as accessing environment variables,working with files and directories,executing shell</span>
<span class="token comment" spellcheck="true"># commands,etc</span>
<span class="token comment" spellcheck="true"># The environ attribute is a dictionary-like object that contains the environment variables of the current operating system session</span>
<span class="token comment" spellcheck="true"># By accessing os.environ,you can retrieve and manipulate environment variables within your Python program.For example,you can retrieve the value of a</span>
<span class="token comment" spellcheck="true"># specific environment variable using the syntax os.environ["VARIABLE_NAME],where "VARIABLE_NAME"is the name of the environment variable you want to</span>
<span class="token comment" spellcheck="true"># access.</span>

<span class="token comment" spellcheck="true"># In[22]:</span>


<span class="token keyword">import</span> os

<span class="token keyword">import</span> httpx

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token comment" spellcheck="true"># os.environ["OPENAI_API_BASE"] = 'https://oneapi.xty.app/v1'</span>

<span class="token comment" spellcheck="true"># LangChain has built a Wrapper around OpenAl APIs,using which we can get access to all the services OpenAl provides.</span>
<span class="token comment" spellcheck="true"># The code snippet below imports a specific class called 'OpenAl'(Wrapper around OpenAl large language models)from the 'llms'module of the 'langchain'</span>
<span class="token comment" spellcheck="true"># library.</span>
<span class="token comment" spellcheck="true"># https://python.langchain.com/en/latest/modules/langchain/llms/openai.html</span>

<span class="token comment" spellcheck="true"># In[23]:</span>


<span class="token comment" spellcheck="true"># from langchain.llms import OpenAI</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI

<span class="token comment" spellcheck="true"># Here we are instantiating a language model object called OpenAl,for our natural language processing tasks.</span>
<span class="token comment" spellcheck="true"># The parameter model_name is provided with the value "text-davinci-003"which is a specific version or variant of a language model (examples-text-davinci-</span>
<span class="token comment" spellcheck="true"># 003,code-davinci-002,gpt-3.5-turbo,text-ada-001 and more).</span>

<span class="token comment" spellcheck="true"># In[24]:</span>


llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>
    temperature<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>
    base_url<span class="token operator">=</span><span class="token string">"https://oneapi.xty.app/v1"</span><span class="token punctuation">,</span>
    api_key<span class="token operator">=</span><span class="token string">"sk-Qg2sQRe2BTRDkjXCAaCa243017994a8aBf2e5bC26aE8Af99"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># model_name="text-davinci-003", # model 不存在</span>
    model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-instruct"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># OK </span>
    http_client<span class="token operator">=</span>httpx<span class="token punctuation">.</span>Client<span class="token punctuation">(</span>
        base_url<span class="token operator">=</span><span class="token string">"https://oneapi.xty.app/v1"</span><span class="token punctuation">,</span>
        follow_redirects<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Here language model is represented by the object "llm,"which is being utilized to generate a completion or response based on a specific query.</span>
<span class="token comment" spellcheck="true"># The query,stored in the "our_query"variable is bieng passed to the model through llm object.</span>
 
our_query <span class="token operator">=</span> <span class="token string">"What is the currency of India?"</span>
completion <span class="token operator">=</span> llm<span class="token punctuation">(</span>our_query<span class="token punctuation">)</span> 

<span class="token keyword">print</span><span class="token punctuation">(</span>completion<span class="token punctuation">)</span> 
</code></pre>
<p><img src="5ac3a0a9.png"></p>
<pre class=" language-shell"><code class="language-shell">pip install huggingface_hub
</code></pre>
<p><img src="08d76942.png" alt="settings"><img src="7ca73ab4.png" alt="生成令牌"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># https://huggingface.co/docs/transformers/model_doc/flan-t5</span>
<span class="token comment" spellcheck="true"># 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</span>
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'HUGGINGFACEHUB_API_TOKEN'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token comment" spellcheck="true"># from langchain.llms import HuggingFaceHub</span>
<span class="token comment" spellcheck="true"># from langchain_community.llms import HuggingFaceHub</span>

<span class="token comment" spellcheck="true"># F:\anaconda\envs\py39f\lib\site-packages\huggingface_hub\utils\_deprecation.py:131:</span>
<span class="token comment" spellcheck="true"># FutureWarning: 'InferenceApi' (from 'huggingface_hub.inference_api') is deprecated</span>
<span class="token comment" spellcheck="true"># and will be removed from version '1.0'.</span>
<span class="token comment" spellcheck="true"># `InferenceApi` client is deprecated in favor of the more feature-complete `InferenceClient`.</span>
<span class="token comment" spellcheck="true"># Check out this guide to learn how to convert your script to use it:</span>
<span class="token comment" spellcheck="true"># https://huggingface.co/docs/huggingface_hub/guides/inference#legacy-inferenceapi-client.</span>
<span class="token comment" spellcheck="true"># llm = HuggingFaceHub(repo_id="google/flan-t5-large")</span>
<span class="token comment" spellcheck="true"># model = "google/flan-t5-large"</span>
<span class="token comment" spellcheck="true"># llm = HuggingFaceHub(model=model)</span>

<span class="token comment" spellcheck="true"># The LLM takes a prompt as an input and outputs a completion</span>
<span class="token comment" spellcheck="true"># our_query = 'What is the currency of India?'</span>
<span class="token comment" spellcheck="true"># completion = llm(our_query)</span>
<span class="token comment" spellcheck="true"># print(completion)</span>

<span class="token keyword">from</span> langchain <span class="token keyword">import</span> PromptTemplate<span class="token punctuation">,</span> HuggingFaceHub<span class="token punctuation">,</span> LLMChain

template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""Question: {question}

Answer: Let's think step by step."""</span>

prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>template<span class="token operator">=</span>template<span class="token punctuation">,</span> input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"question"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
llm_chain <span class="token operator">=</span> LLMChain<span class="token punctuation">(</span>
    prompt<span class="token operator">=</span>prompt<span class="token punctuation">,</span>
    llm<span class="token operator">=</span>HuggingFaceHub<span class="token punctuation">(</span>
        repo_id<span class="token operator">=</span><span class="token string">"google/flan-t5-large"</span><span class="token punctuation">,</span>
        model_kwargs<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">"max_length"</span><span class="token punctuation">:</span> <span class="token number">64</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>

question <span class="token operator">=</span> <span class="token string">"What is the capital of France?"</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>llm_chain<span class="token punctuation">.</span>run<span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="3-Project-Environment-Setup"><a href="#3-Project-Environment-Setup" class="headerlink" title="3. Project Environment Setup"></a>3. Project Environment Setup</h2><p><img src="f87a5d2a.png"><img src="8527ac7d.png"><img src="58e0816d.png"><img src="36741c8f.png"><img src="78f1ac06.png"><br><img src="d5ea45ac.png"><img src="d46e0f00.png"><img src="67301ff4.png"><img src="25f00878.png" alt="requirements.txt"></p>
<pre class=" language-txt"><code class="language-txt">langchain
Openai
Streamlit
</code></pre>
<p><img src="9b0c811e.png"><img src="5d400313.png"><img src="59897c5d.png"></p>
<h2 id="4-Lets’-Build-Simple-Question-Answering-Application"><a href="#4-Lets’-Build-Simple-Question-Answering-Application" class="headerlink" title="4. Lets’ Build Simple Question Answering Application"></a>4. Lets’ Build Simple Question Answering Application</h2><p><img src="31f92aab.png" alt="upload"><img src="9da1af5f.png" alt="上次app.py会覆盖原本的空文件"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#Hello! It seems like you want to import the Streamlit library in Python. Streamlit is a powerful open-source framework used for building web applications with interactive data visualizations and machine learning models. To import Streamlit, you'll need to ensure that you have it installed in your Python environment.</span>
<span class="token comment" spellcheck="true">#Once you have Streamlit installed, you can import it into your Python script using the import statement,</span>

<span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st


<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI

<span class="token comment" spellcheck="true">#Function to return the response</span>
<span class="token keyword">def</span> <span class="token function">load_answer</span><span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">:</span>
    llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-instruct"</span><span class="token punctuation">,</span>temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    answer<span class="token operator">=</span>llm<span class="token punctuation">(</span>question<span class="token punctuation">)</span>
    <span class="token keyword">return</span> answer


<span class="token comment" spellcheck="true">#App UI starts here</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>page_title<span class="token operator">=</span><span class="token string">"LangChain Demo"</span><span class="token punctuation">,</span> page_icon<span class="token operator">=</span><span class="token string">":robot:"</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"LangChain Demo"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#Gets the user input</span>
<span class="token keyword">def</span> <span class="token function">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    input_text <span class="token operator">=</span> st<span class="token punctuation">.</span>text_input<span class="token punctuation">(</span><span class="token string">"You: "</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">"input"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> input_text


user_input<span class="token operator">=</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
response <span class="token operator">=</span> load_answer<span class="token punctuation">(</span>user_input<span class="token punctuation">)</span>

submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">'Generate'</span><span class="token punctuation">)</span>  

<span class="token comment" spellcheck="true">#If generate button is clicked</span>
<span class="token keyword">if</span> submit<span class="token punctuation">:</span>

    st<span class="token punctuation">.</span>subheader<span class="token punctuation">(</span><span class="token string">"Answer:"</span><span class="token punctuation">)</span>

    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
</code></pre>
<p><img src="42ec266a.png"><img src="9e914444.png" alt="settings"><img src="26e6c94b.png"></p>
<h1 id="7-Project-2-Simple-Conversational-App"><a href="#7-Project-2-Simple-Conversational-App" class="headerlink" title="7. Project #2 - Simple Conversational App"></a>7. Project #2 - Simple Conversational App</h1><h2 id="1-Chat-Model-Walkthrough"><a href="#1-Chat-Model-Walkthrough" class="headerlink" title="1. Chat Model Walkthrough"></a>1. Chat Model Walkthrough</h2><p><img src="3bbb620e.png"></p>
<h2 id="2-Chat-Model-Practical-Implementation-using-Python"><a href="#2-Chat-Model-Practical-Implementation-using-Python" class="headerlink" title="2. Chat Model Practical Implementation using Python"></a>2. Chat Model Practical Implementation using Python</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %% env</span>
<span class="token keyword">import</span> os

<span class="token comment" spellcheck="true"># os.environ["OPENAI_API_KEY"] = 'sk-Qg2sQRe2BTRDkjXCAaCa243017994a8aBf2e5bC26aE8Af99'</span>
<span class="token comment" spellcheck="true"># os.environ["OPENAI_API_BASE"] = 'https://oneapi.xty.app/v/1'</span>

<span class="token comment" spellcheck="true"># %% import model</span>
<span class="token triple-quoted-string string">'''
LangChain has built a Wrapper around OpenAl APls,using which we can get access to all the services OpenAl provides.
The code snippet below imports a specific class called 'ChatOpenAl'(Wrapper around OpenAl large language models)from the 'chat_models'module of the
langchain'library.
'''</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>chat_models <span class="token keyword">import</span> ChatOpenAI

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
The code snippet below imports HumanMessage,SystemMessage and
 AlMessage from the 'schema'module of the langchain'library.
'''</span>

<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema <span class="token keyword">import</span> HumanMessage<span class="token punctuation">,</span> SystemMessage<span class="token punctuation">,</span> AIMessage

<span class="token comment" spellcheck="true"># %% create model</span>
<span class="token triple-quoted-string string">'''
Initialize the ChatOpenAl object and
We'll set temperature=.7 to maximise randomness and make outputs creative.  temperature添加随机性
The parameter model_name is provided with the value "gpt-3.5-turbo"which is a specific version or variant of a language model for chat
'''</span>

chat <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>
    temperature<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>
    base_url<span class="token operator">=</span><span class="token string">"https://oneapi.xty.app/v1"</span><span class="token punctuation">,</span>
    api_key<span class="token operator">=</span><span class="token string">"sk-Qg2sQRe2BTRDkjXCAaCa243017994a8aBf2e5bC26aE8Af99"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 报错307 就换一个模型试试</span>
    model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># OK</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% chat with</span>
<span class="token triple-quoted-string string">'''
Chats with the Chat-GPT model 'gpt-3.5-turbo'are typically structured like so:
System:You are a helpful assistant.
User:Hi Al,how are you today?
Assistant:I'm great thank you.How can I help you?
User:I'd like to understand string theory.
Assistant:The final "Assistant:"without a response is what would prompt the model to continue the comversation.In the official
'''</span>

result <span class="token operator">=</span> chat<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        <span class="token comment" spellcheck="true"># 设定</span>
        SystemMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"You are a sarcastic AI assistant"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true"># 用户提问</span>
        HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"Please answer in 30 words:How can I learn driving a car"</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># %% more detail chat</span>
<span class="token triple-quoted-string string">'''
In the below scenario
We are asking the model to behave in a specific way
And passing our question
And also passing on more context so that it can elaborate more on that specific topic
This model gives us a better way to have conversation kind of opportunity with the model,which can be used to build chat bots.
'''</span>

ourConversation <span class="token operator">=</span> chat<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        SystemMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"You are a 3 years old girl who answers very cutely and in a funny way"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"How can I learn driving a car"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        AIMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"I can't drive yet! But I have a driver,my dad..."</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"Can you teach me driving?"</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ourConversation<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre>
<h2 id="3-Let’s-Build-Simple-Conversational-Application"><a href="#3-Let’s-Build-Simple-Conversational-Application" class="headerlink" title="3. Let’s Build Simple Conversational Application"></a>3. Let’s Build Simple Conversational Application</h2><blockquote>
<p>和刚才一样, space里创建</p>
</blockquote>
<p><img src="b6a016a8.png"><img src="9aa72313.png" alt="upload file"><img src="92ac4f19.png"></p>
<pre class=" language-python"><code class="language-python">
<span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st


<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>chat_models <span class="token keyword">import</span> ChatOpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema <span class="token keyword">import</span> <span class="token punctuation">(</span>
    AIMessage<span class="token punctuation">,</span>
    HumanMessage<span class="token punctuation">,</span>
    SystemMessage
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># From here down is all the StreamLit UI.</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>page_title<span class="token operator">=</span><span class="token string">"LangChain Demo"</span><span class="token punctuation">,</span> page_icon<span class="token operator">=</span><span class="token string">":robot:"</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"Hey, I'm your Chat GPT"</span><span class="token punctuation">)</span>



<span class="token keyword">if</span> <span class="token string">"sessionMessages"</span> <span class="token operator">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
     st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>sessionMessages <span class="token operator">=</span> <span class="token punctuation">[</span>
        SystemMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"You are a helpful assistant."</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>



<span class="token keyword">def</span> <span class="token function">load_answer</span><span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">:</span>

    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>sessionMessages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span>question<span class="token punctuation">)</span><span class="token punctuation">)</span>

    assistant_answer  <span class="token operator">=</span> chat<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>sessionMessages <span class="token punctuation">)</span>

    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>sessionMessages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>AIMessage<span class="token punctuation">(</span>content<span class="token operator">=</span>assistant_answer<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> assistant_answer<span class="token punctuation">.</span>content


<span class="token keyword">def</span> <span class="token function">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    input_text <span class="token operator">=</span> st<span class="token punctuation">.</span>text_input<span class="token punctuation">(</span><span class="token string">"You: "</span><span class="token punctuation">,</span> key<span class="token operator">=</span> input<span class="token punctuation">)</span>
    <span class="token keyword">return</span> input_text


chat <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>
    temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> 
    api_key<span class="token operator">=</span><span class="token string">"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"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 报错307 就换一个模型试试</span>
    model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># OK</span>
<span class="token punctuation">)</span>




user_input<span class="token operator">=</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">'Generate'</span><span class="token punctuation">)</span>  

<span class="token keyword">if</span> submit<span class="token punctuation">:</span>
    
    response <span class="token operator">=</span> load_answer<span class="token punctuation">(</span>user_input<span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>subheader<span class="token punctuation">(</span><span class="token string">"Answer:"</span><span class="token punctuation">)</span>

    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">,</span>key<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="8-Project-3-Find-Similar-Things-App-For-Kids"><a href="#8-Project-3-Find-Similar-Things-App-For-Kids" class="headerlink" title="8. Project #3 - Find Similar Things App For Kids"></a>8. Project #3 - Find Similar Things App For Kids</h1><h2 id="1-Text-Embedding-Walkthrough"><a href="#1-Text-Embedding-Walkthrough" class="headerlink" title="1. Text Embedding Walkthrough"></a>1. Text Embedding Walkthrough</h2><p><img src="58bab423.png"><img src="d01fd9db.png"><img src="82786bea.png"></p>
<h2 id="2-Text-Embeddings-Practical-Implementation-using-Python"><a href="#2-Text-Embeddings-Practical-Implementation-using-Python" class="headerlink" title="2. Text Embeddings Practical Implementation using Python"></a>2. Text Embeddings Practical Implementation using Python</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %% env</span>
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token comment" spellcheck="true"># %% import embeddings</span>
<span class="token comment" spellcheck="true"># ImportError: Could not import tiktoken python package.</span>
<span class="token comment" spellcheck="true"># This is needed in order to for OpenAIEmbeddings. Please install it with `pip install tiktoken`.</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>embeddings <span class="token keyword">import</span> OpenAIEmbeddings

<span class="token comment" spellcheck="true"># %% Initialize the OpenAlEmbeddings object</span>
embeddings <span class="token operator">=</span> OpenAIEmbeddings<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
our_txt <span class="token operator">=</span> <span class="token string">'hey buddy'</span>
txt_embedding <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>embed_query<span class="token punctuation">(</span>our_txt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Our embedding is length {txt_embedding}'</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="8d893929.png"></p>
<h2 id="3-Embeddings-Example-using-Python"><a href="#3-Embeddings-Example-using-Python" class="headerlink" title="3. Embeddings Example using Python"></a>3. Embeddings Example using Python</h2><p><img src="7b10dbe7.png" alt="data.xlsx"><a href="data.xlsx">data.xlsx</a><img src="8f473056.png"><img src="3fa44a7c.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %% env</span>
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token comment" spellcheck="true"># %% import embeddings</span>
<span class="token comment" spellcheck="true"># ImportError: Could not import tiktoken python package.</span>
<span class="token comment" spellcheck="true"># This is needed in order to for OpenAIEmbeddings. Please install it with `pip install tiktoken`.</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>embeddings <span class="token keyword">import</span> OpenAIEmbeddings

<span class="token comment" spellcheck="true"># %% Initialize the OpenAlEmbeddings object</span>
embeddings <span class="token operator">=</span> OpenAIEmbeddings<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% data</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment" spellcheck="true"># ImportError: Missing optional dependency 'openpyxl'.  Use pip or conda to install openpyxl.</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data.xlsx'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
We can use "apply"to apply the get_embedding function to each row in the dataframe because our words are stored in a pandas dataframe.In order to save
time and to save the calculated word embeddings in a new csv file called "word_embeddings.csv"rather than calling OpenAl once more to carry out these
computations.
'''</span>
<span class="token comment" spellcheck="true"># 需要等很长时间 ...</span>
df<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Words'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> embeddings<span class="token punctuation">.</span>embed_query<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'word_embeddings.csv'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
Let's load the existing file,which contains the embeddings,
so that we can save chargers by not hitting the APl repeatedly
'''</span>
new_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'word_embeddings.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_df<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% Let's get the embeddings for our text</span>
our_txt <span class="token operator">=</span> <span class="token string">'Mango'</span>
txt_embedding <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>embed_query<span class="token punctuation">(</span>our_txt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Our embedding is {txt_embedding}'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
We can determine how similar a word is to other words in our dataframe after we have a vector representing that word.
By computing the cosine similarity of the word vector for our search term to each word embedding in our dataframe.
'''</span>
<span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI

client <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_embedding</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">"text-embedding-ada-002"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> client<span class="token punctuation">.</span>embeddings<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        input<span class="token operator">=</span><span class="token punctuation">[</span>text<span class="token punctuation">]</span><span class="token punctuation">,</span>
        model<span class="token operator">=</span>model
    <span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>embedding


<span class="token comment" spellcheck="true"># df['ada_embedding'] = df.combined.apply(lambda x: get_embedding(x, model='text-embedding-ada-002'))</span>
<span class="token comment" spellcheck="true"># %% utils</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">calculate_cosine_similarity</span><span class="token punctuation">(</span>vector_a<span class="token punctuation">,</span> vector_b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Compute the dot product of the two vectors</span>
    dot_product <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>vector_a<span class="token punctuation">,</span> vector_b<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Compute the L2 norms (magnitudes) of each vector</span>
    norm_a <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>vector_a<span class="token punctuation">)</span>
    norm_b <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>vector_b<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Compute the cosine similarity</span>
    <span class="token comment" spellcheck="true"># Note: We add a small epsilon value to the denominator for numerical stability</span>
    epsilon <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">10</span>
    cosine_similarity <span class="token operator">=</span> dot_product <span class="token operator">/</span> <span class="token punctuation">(</span>norm_a <span class="token operator">*</span> norm_b <span class="token operator">+</span> epsilon<span class="token punctuation">)</span>

    <span class="token keyword">return</span> cosine_similarity


<span class="token comment" spellcheck="true"># def cosine_similarity(asingle, bsingle) -> np.double:</span>
<span class="token comment" spellcheck="true">#     </span><span class="token triple-quoted-string string">"""return normalized dot product of two arrays"""</span>
<span class="token comment" spellcheck="true">#     a = asingle.astype(np.double)</span>
<span class="token comment" spellcheck="true">#     b = bsingle.astype(np.double)</span>
<span class="token comment" spellcheck="true">#     return np.dot(a, b) / (np.linalg.norm(a) * np.linalg.norm(b))</span>


<span class="token comment" spellcheck="true"># %% similarity</span>
<span class="token comment" spellcheck="true"># old version &lt; 1.0</span>
<span class="token comment" spellcheck="true"># from openai.embeddings_utils import cosine_similarity</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>pairwise <span class="token keyword">import</span> cosine_similarity

<span class="token comment" spellcheck="true"># df['similarity score'] = df['embedding'].apply(lambda x: cosine_similarity(x, txt_embedding))</span>
df<span class="token punctuation">[</span><span class="token string">'similarity score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> cosine_similarity<span class="token punctuation">(</span>x<span class="token punctuation">,</span> txt_embedding<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
Sorting by similarity values in dataframe reveals Banana,Orange,and Apple are closest to searched term,such as Mango.
'''</span>

res <span class="token operator">=</span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'similarity score'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre>
<h2 id="4-Let’s-build-Similar-Words-Finder-Application"><a href="#4-Let’s-build-Similar-Words-Finder-Application" class="headerlink" title="4. Let’s build Similar Words Finder Application"></a>4. Let’s build Similar Words Finder Application</h2><p><img src="5847bbce.png"><img src="09684d7c.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#Allows you to use Streamlit, a framework for building interactive web applications.</span>
<span class="token comment" spellcheck="true">#It provides functions for creating UIs, displaying data, and handling user inputs.</span>
<span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st


<span class="token comment" spellcheck="true">#This module provides a way to interact with the operating system, such as accessing environment variables, working with files</span>
<span class="token comment" spellcheck="true">#and directories, executing shell commands, etc</span>
<span class="token keyword">import</span> os

<span class="token comment" spellcheck="true">#Helps us generate embeddings</span>
<span class="token comment" spellcheck="true">#An embedding is a vector (list) of floating point numbers. The distance between two vectors measures their relatedness. </span>
<span class="token comment" spellcheck="true">#Small distances suggest high relatedness and large distances suggest low relatedness.</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>embeddings <span class="token keyword">import</span> OpenAIEmbeddings


<span class="token comment" spellcheck="true">#FAISS is an open-source library developed by Facebook AI Research for efficient similarity search and clustering of large-scale datasets, particularly with high-dimensional vectors. </span>
<span class="token comment" spellcheck="true">#It provides optimized indexing structures and algorithms for tasks like nearest neighbor search and recommendation systems.</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>vectorstores <span class="token keyword">import</span> FAISS


<span class="token comment" spellcheck="true">#load_dotenv() is a function that loads variables from a .env file into environment variables in a Python script. </span>
<span class="token comment" spellcheck="true">#It allows you to store sensitive information or configuration settings separate from your code</span>
<span class="token comment" spellcheck="true">#and access them within your application.</span>

<span class="token comment" spellcheck="true"># pip3 install python-dotenv</span>
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv


load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">#By using st.set_page_config(), you can customize the appearance of your Streamlit application's web page</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>page_title<span class="token operator">=</span><span class="token string">"Educate Kids"</span><span class="token punctuation">,</span> page_icon<span class="token operator">=</span><span class="token string">":robot:"</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"Hey, Ask me something &amp; I will give out similar things"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#Initialize the OpenAIEmbeddings object</span>
embeddings <span class="token operator">=</span> OpenAIEmbeddings<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#The below snippet helps us to import CSV file data for our tasks</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>document_loaders<span class="token punctuation">.</span>csv_loader <span class="token keyword">import</span> CSVLoader
loader <span class="token operator">=</span> CSVLoader<span class="token punctuation">(</span>file_path<span class="token operator">=</span><span class="token string">'myData.csv'</span><span class="token punctuation">,</span> csv_args<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'delimiter'</span><span class="token punctuation">:</span> <span class="token string">','</span><span class="token punctuation">,</span>
    <span class="token string">'quotechar'</span><span class="token punctuation">:</span> <span class="token string">'"'</span><span class="token punctuation">,</span>
    <span class="token string">'fieldnames'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Words'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#Assigning the data inside the csv to our variable here</span>
data <span class="token operator">=</span> loader<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#Display the data</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

db <span class="token operator">=</span> FAISS<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>data<span class="token punctuation">,</span> embeddings<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#Function to receive input from user and store it in a variable</span>
<span class="token keyword">def</span> <span class="token function">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    input_text <span class="token operator">=</span> st<span class="token punctuation">.</span>text_input<span class="token punctuation">(</span><span class="token string">"You: "</span><span class="token punctuation">,</span> key<span class="token operator">=</span> input<span class="token punctuation">)</span>
    <span class="token keyword">return</span> input_text


user_input<span class="token operator">=</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">'Find similar Things'</span><span class="token punctuation">)</span>  

<span class="token keyword">if</span> submit<span class="token punctuation">:</span>
    
    <span class="token comment" spellcheck="true">#If the button is clicked, the below snippet will fetch us the similar text</span>
    docs <span class="token operator">=</span> db<span class="token punctuation">.</span>similarity_search<span class="token punctuation">(</span>user_input<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>subheader<span class="token punctuation">(</span><span class="token string">"Top Matches:"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>text<span class="token punctuation">(</span>docs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>text<span class="token punctuation">(</span>docs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>page_content<span class="token punctuation">)</span>
</code></pre>
<pre class=" language-shell"><code class="language-shell">streamlit run 文件名.py --server.port 8888
</code></pre>
<h1 id="9-Langchain-Prompt-Module-Concept-amp-Implementation-Using-Python"><a href="#9-Langchain-Prompt-Module-Concept-amp-Implementation-Using-Python" class="headerlink" title="9. Langchain - Prompt Module Concept &amp; Implementation Using Python"></a>9. Langchain - Prompt Module Concept &amp; Implementation Using Python</h1><h2 id="1-Prompts-Module-Introduction"><a href="#1-Prompts-Module-Introduction" class="headerlink" title="1. Prompts Module Introduction"></a>1. Prompts Module Introduction</h2><p><img src="0a74dbde.png"><img src="0d78b7ec.png"></p>
<h2 id="2-Prompt-Template-Walkthrough"><a href="#2-Prompt-Template-Walkthrough" class="headerlink" title="2. Prompt Template Walkthrough"></a>2. Prompt Template Walkthrough</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %%</span>
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'OPENAI_API_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token comment" spellcheck="true"># %%</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-instruct"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
our_prompt <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
I love trips,and I have been to 6 countries.
I plan to visit few more soon.

Can you create a post for tweet in 10 words for the above?
"""</span>  <span class="token comment" spellcheck="true"># 10 words -> 这个10 我们希望能动态指定</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>our_prompt<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># %%</span>
res <span class="token operator">=</span> llm<span class="token punctuation">(</span>our_prompt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% Prompt Template</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain <span class="token keyword">import</span> PromptTemplate

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-instruct"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% Using F-String</span>
<span class="token triple-quoted-string string">'''
F-String is a Python feature that allows easy string formatting by placing variables inside curly braces within a string,making code more readable and efficient.
__Code:__
name = "Alice"
age = 25
message f"My name is {name} and I am {age} years old."
print(message)

__Output:__
My name is Allce and I am 25 years old.
'''</span>

wordsCount <span class="token operator">=</span> <span class="token number">5</span>
our_txt <span class="token operator">=</span> <span class="token string">"I love trips,and I have been to 6 countries. I plan to visit few more soon."</span>
our_prompt <span class="token operator">=</span> f<span class="token triple-quoted-string string">"""
{our_txt}

Can you create a post for tweet in {wordsCount} words for the above?
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>our_prompt<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>our_prompt<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% Using Prompt Template</span>
<span class="token comment" spellcheck="true"># Prompt templates helps us in keeping our code neat and clean when we are bullding more complex</span>

template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
{our_txt}

Can you create a post for tweet in {wordsCount} words for the above?
"""</span>

<span class="token comment" spellcheck="true"># %%</span>
prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'wordsCount'</span><span class="token punctuation">,</span> <span class="token string">'our_txt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token operator">=</span>template
<span class="token punctuation">)</span>

final_prompt <span class="token operator">=</span> prompt<span class="token punctuation">.</span>format<span class="token punctuation">(</span>
    wordsCount<span class="token operator">=</span><span class="token string">'3'</span><span class="token punctuation">,</span>
    our_txt<span class="token operator">=</span>our_txt
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>final_prompt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>final_prompt<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="3-Example-Selectors-Walkthrough"><a href="#3-Example-Selectors-Walkthrough" class="headerlink" title="3. Example Selectors Walkthrough"></a>3. Example Selectors Walkthrough</h2><p><img src="f0927611.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %%</span>
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'OPENAI_API_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token comment" spellcheck="true"># %% Few Shot Templates</span>
<span class="token triple-quoted-string string">"""
Few-shot learning is a way to teach computers to make predictions using only a small amount of information.Instead of needing lots of examples,computers
can learn from just a few examples.
They find patterns in the examples and use those pattemns to understand and recognize new things.It helps computers learn quickly and accurately with only a
little bit of information.
"""</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
A prompt in NLP (Natural Language Processing) is a text
or instruction given to a language model to generate a response.
'''</span>

our_prompt <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
You are a 5 year old gril, who is very funny, mischievous and sweet:

Question: What is house?
Response: 
"""</span>

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> model_name<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-instruct"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>our_prompt<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
We observe that though we have instructed the model to act as a little girl,
it's unable to do so as it very generic by nature
So we will try to proved some extemal knowledge to get the perfect answers from it
'''</span>

our_prompt <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a s year old girl,who is very funny, mischievous and sweet:
Here are some examples:
Question: What is a mobile?
Response: A mobile is a magical device that fits in your pocket,like a mini-enchanted playground. It has games, videos, and talking pictures,but be careful,it can turn grown-ups into

Question: What are your dreams?
Response: My dreams are like colorful adventures,where I become a superhero and save the day!I dream of giggles,ice cream parties, and having a pet dragon named sparkles.

Question: What is a house?
Response: 
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>our_prompt<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
The FewShotPromptTemplate feature offered by LangChain allows for few-shot leaming using prompts.

In the context of large language models(LLMs),the primary sources of knowledge are parametric knowledge (learned during model training)and source
knowledge(provided within model input at inference time).

The FewShotPromptTemplate enables the inclusion of a few examples within prompts,which the model can read and use to apply to user input,enhancing the
model's ability to handle specific tasks or scenarios.
'''</span>

<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token keyword">from</span> langchain <span class="token keyword">import</span> FewShotPromptTemplate  <span class="token comment" spellcheck="true"># 简短提示模板</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token comment" spellcheck="true"># Let's create a list of examples, that can be passed to the model later for our task</span>
<span class="token comment" spellcheck="true"># examples 的json的变量名对应 example_template 的 {变量名}</span>
examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">'What is a mobile?'</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'A mobile is a magical device that fits in your pocket,like a mini-enchanted playground. It has games, videos, and talking pictures,but be careful,it can turn grown-ups into'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">'What are your dreams?'</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'My dreams are like colorful adventures,where I become a superhero and save the day!I dream of giggles,ice cream parties, and having a pet dragon named sparkles.'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># %% Let's create a example template</span>
example_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {query}
Response: {answer}
"""</span>

<span class="token comment" spellcheck="true"># %% Let's create a prompt example from above created example template</span>
<span class="token comment" spellcheck="true"># example_template -> 定义 example_prompt 模板</span>
example_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'query'</span><span class="token punctuation">,</span> <span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token operator">=</span>example_template
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
The previous original prompt can be divided into a prefix and suffix.
The prefix consists of the instructions or context given to the model,while the suffix includes the user input and output indicator.
'''</span>
prefix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a s year old girl,who is very funny, mischievous and sweet:
Here are some examples:
"""</span>

suffix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {userInput}
Response: """</span>

<span class="token comment" spellcheck="true"># %% Let's create a few shot prompt template,by using the above details</span>

few_shot_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    <span class="token comment" spellcheck="true"># 将 example_prompt 和 examples 关联</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 将 prefix 和 input_variables 关联</span>
    prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
    suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'userInput'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    example_separator<span class="token operator">=</span><span class="token string">"\n\n"</span>
<span class="token punctuation">)</span>

query <span class="token operator">=</span> <span class="token string">'What is a house?'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>few_shot_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>few_shot_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="4-Adding-More-Examples-To-Input-Prompt"><a href="#4-Adding-More-Examples-To-Input-Prompt" class="headerlink" title="4. Adding More Examples To Input Prompt"></a>4. Adding More Examples To Input Prompt</h2><p><img src="4c16bfb1.png" alt="传递example有很多时, 可能遇到超过上下文限制的情况"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %%</span>
examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">'What is a mobile?'</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'A mobile is a magical device that fits in your pocket,like a mini-enchanted playground. It has games, videos, and talking pictures,but be careful,it can turn grown-ups into'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">'What are your dreams?'</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'My dreams are like colorful adventures,where I become a superhero and save the day!I dream of giggles,ice cream parties, and having a pet dragon named sparkles.'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">'What are your ambitions?'</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian,spreading laughter everywhere I go!I also want to be a master cooki"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">"what happens when you get sick?"</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"when I get sick,it's like a sneaky monster visits.I feel tired,sniffly,and need lots of cuddles.But"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"oh,I love my dad to the moon and back,with sprinkles and unicorns on top!He's my superhero,my partner "</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow!We laugh,play,and have magical parties together.They always list"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">"what math means to you?"</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"Math i like a puzzle game,full of numbers and shapes.It helps me count my toys,build towers,and shar"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string">"what is your fear?"</span><span class="token punctuation">,</span>
        <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed.But with my teddy bear by my side and lo"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
In the above explanation,be have been using 'FewShotPromptTemplate'and 'examples'dictionary as it is more robust approach compared to using a single f-string.

It offers features such as the ability to include or exclude examples based on the length of the query.
This is important because there is a maximum context window limitation for prompt and generation output length.

The goal is to provide as many examples as possible for few-shot learning without exceeding the context window or increasing processing times excessively.
The dynamic inclusion/exclusion of examples means that we choose which examples to use based on certain rules.This helps us use the model's abilities in
the best way possible.

It allows us to be efficient and make the most out of the few-shot learning process.
'''</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>example_selector <span class="token keyword">import</span> LengthBasedExampleSelector

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
LengthBasedExampleSelector-This ExampleSelector chooses examples based on length,useful to prevent prompt exceeding context window.
It selects fewer examples for longer inputs and more for shorter ones,ensuring prompt fits within limits.

The maximum length of the formatted examples is set to 'n'characters.
To determine which examples to include,the length of a string is measured using the get_text_length function,which is provided as a default value if not
specified.
'''</span>
example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    max_length<span class="token operator">=</span><span class="token number">50</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
<span class="token triple-quoted-string string">'''
Creating a new dynamic few shot prompt template
And we are passing example_selector instead of examples as earlier
'''</span>
new_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    example_selector<span class="token operator">=</span>example_selector<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># use example_selector instead of examples</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 将 prefix 和 input_variables 关联</span>
    prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
    suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'userInput'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    example_separator<span class="token operator">=</span><span class="token string">"\n\n"</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %%</span>
query <span class="token operator">=</span> <span class="token string">'What is a house?'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% We can also add an extra example to an example selector we already have.</span>
new_example <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What's your favorite work?"</span><span class="token punctuation">,</span> <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"sleep"</span><span class="token punctuation">}</span>
new_prompt_template<span class="token punctuation">.</span>example_selector<span class="token punctuation">.</span>add_example<span class="token punctuation">(</span>new_example<span class="token punctuation">)</span>

example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>new_example<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    max_length<span class="token operator">=</span><span class="token number">1000</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="5-Output-Parsers-Walkthrough"><a href="#5-Output-Parsers-Walkthrough" class="headerlink" title="5. Output Parsers Walkthrough"></a>5. Output Parsers Walkthrough</h2><p><img src="f2a835f4.png"><img src="42225607.png" alt="CommaSeparatedListOutputParser"><br><img src="b83380b4.png" alt="CommaSeparatedListOutputParser"><img src="bbc1001c.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %%</span>
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'OPENAI_API_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'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'</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI
<span class="token comment" spellcheck="true"># %% Comma Separated List</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>output_parsers <span class="token keyword">import</span> CommaSeparatedListOutputParser

<span class="token comment" spellcheck="true"># Creating an object of CommaSeparatedListOutputParser</span>
<span class="token comment" spellcheck="true"># 指定模型输出 逗号分割的列表: 1. xxx \n2. xxx\n</span>
<span class="token comment" spellcheck="true"># #%% JSON format</span>
<span class="token comment" spellcheck="true"># ...</span>
output_parser <span class="token operator">=</span> CommaSeparatedListOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
format_instructions <span class="token operator">=</span> output_parser<span class="token punctuation">.</span>get_format_instructions<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Your response should be a list of comma separated values, eg: `foo, bar, baz`</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>format_instructions<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># %%</span>
prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    template<span class="token operator">=</span><span class="token string">"Provide 5 examples of {query}.\n{format_instructions}"</span><span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    partial_variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'format_instructions'</span><span class="token punctuation">:</span> format_instructions<span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># llm = OpenAI(temperature=0.9, model="gpt-3.5-turbo-instruct")</span>
llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span>

prompt <span class="token operator">=</span> prompt<span class="token punctuation">.</span>format<span class="token punctuation">(</span>query<span class="token operator">=</span><span class="token string">"Currencies"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Currencies: 货币实例</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>

output <span class="token operator">=</span> llm<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% JSON format</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>output_parsers <span class="token keyword">import</span> StructuredOutputParser<span class="token punctuation">,</span> ResponseSchema

<span class="token comment" spellcheck="true"># 指定返回什么</span>
<span class="token triple-quoted-string string">'''json
{
    'currency': '',
    'abbrevation': ''
}
'''</span>
response_schema <span class="token operator">=</span> <span class="token punctuation">[</span>
    ResponseSchema<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'currency'</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"answer to the user's question"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># abbrevation: 缩写</span>
    ResponseSchema<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'abbrevation'</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"What's the abbrevation of that currency"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

output_parser <span class="token operator">=</span> StructuredOutputParser<span class="token punctuation">.</span>from_response_schemas<span class="token punctuation">(</span>response_schema<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output_parser<span class="token punctuation">)</span>

format_instructions <span class="token operator">=</span> output_parser<span class="token punctuation">.</span>get_format_instructions<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>format_instructions<span class="token punctuation">)</span>

prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    template<span class="token operator">=</span><span class="token string">"answer the users question as best as possible.\n{format_instructions}\n{query}"</span><span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 用户输入</span>
    partial_variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'format_instructions'</span><span class="token punctuation">:</span> format_instructions<span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># 指定格式的输入语句</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>

prompt <span class="token operator">=</span> prompt<span class="token punctuation">.</span>format<span class="token punctuation">(</span>query<span class="token operator">=</span><span class="token string">'what is the currency of india?'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
json
{
    "currency": "Indian rupee",
    "abbrevation": "INR"
}
'''</span>
</code></pre>
<h1 id="10-Project-4-Marketing-Campaign-App"><a href="#10-Project-4-Marketing-Campaign-App" class="headerlink" title="10. Project #4 - Marketing Campaign App"></a>10. Project #4 - Marketing Campaign App</h1><h2 id="1-Convert-Jupyter-Notebook-to-Python-Script"><a href="#1-Convert-Jupyter-Notebook-to-Python-Script" class="headerlink" title="1. Convert Jupyter Notebook to Python Script"></a>1. Convert Jupyter Notebook to Python Script</h2><pre class=" language-shell"><code class="language-shell">pip install -r requirements.txt
</code></pre>
<p><img src="ae304e5f.png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># %%</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token keyword">from</span> langchain <span class="token keyword">import</span> FewShotPromptTemplate
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>example_selector <span class="token keyword">import</span> LengthBasedExampleSelector

<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"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"</span>

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">9</span><span class="token punctuation">)</span>

examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

example_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {query}
Response: {answer}
"""</span>

example_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token operator">=</span>example_template
<span class="token punctuation">)</span>

prefix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a 5 year old girl, who is very funny,mischievous and sweet: 
Here are some examples: 
"""</span>

suffix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {userInput}
Response: """</span>

example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    max_length<span class="token operator">=</span><span class="token number">200</span>
<span class="token punctuation">)</span>

new_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    example_selector<span class="token operator">=</span>example_selector<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># use example_selector instead of examples</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
    suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"userInput"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    example_separator<span class="token operator">=</span><span class="token string">"\n"</span>
<span class="token punctuation">)</span>

query <span class="token operator">=</span> <span class="token string">"What is a house?"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="2-Building-the-App’s-frontend"><a href="#2-Building-the-App’s-frontend" class="headerlink" title="2. Building the App’s frontend"></a>2. Building the App’s frontend</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token keyword">from</span> langchain <span class="token keyword">import</span> FewShotPromptTemplate
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>example_selector <span class="token keyword">import</span> LengthBasedExampleSelector
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">9</span><span class="token punctuation">)</span>

examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

example_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {query}
Response: {answer}
"""</span>

example_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token operator">=</span>example_template
<span class="token punctuation">)</span>

prefix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a 5 year old girl, who is very funny,mischievous and sweet: 
Here are some examples: 
"""</span>

suffix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {userInput}
Response: """</span>

example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    max_length<span class="token operator">=</span><span class="token number">200</span>
<span class="token punctuation">)</span>

new_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    example_selector<span class="token operator">=</span>example_selector<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># use example_selector instead of examples</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
    suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"userInput"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    example_separator<span class="token operator">=</span><span class="token string">"\n"</span>
<span class="token punctuation">)</span>

query <span class="token operator">=</span> <span class="token string">"What is a house?"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>userInput<span class="token operator">=</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># print(llm(new_prompt_template.format(userInput=query)))</span>

<span class="token comment" spellcheck="true"># %% UI</span>
<span class="token comment" spellcheck="true"># %% 页面基本配置</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
    page_title<span class="token operator">=</span><span class="token string">'Marketing Tool'</span><span class="token punctuation">,</span>
    page_icon<span class="token operator">=</span><span class="token string">'✔'</span><span class="token punctuation">,</span>
    layout<span class="token operator">=</span><span class="token string">'centered'</span><span class="token punctuation">,</span>
    initial_sidebar_state<span class="token operator">=</span><span class="token string">'collapsed'</span>
<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 页面头部显示内容</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"Hey, How can I help you?"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建 text area</span>
form_input <span class="token operator">=</span> st<span class="token punctuation">.</span>text_area<span class="token punctuation">(</span><span class="token string">'Enter text'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">275</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
tasktype_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'Please select the action to be performed?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Write a sales copy'</span><span class="token punctuation">,</span> <span class="token string">'Create a tweet'</span><span class="token punctuation">,</span> <span class="token string">'Write a product description'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
age_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'For which age group?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Kid'</span><span class="token punctuation">,</span> <span class="token string">'Adult'</span><span class="token punctuation">,</span> <span class="token string">'senior Citizen'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建滑动条, 取值范围1~200, 初始值25</span>
numberOfWords <span class="token operator">=</span> st<span class="token punctuation">.</span>slider<span class="token punctuation">(</span><span class="token string">'Words limit'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建按钮</span>
submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Generate"</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-shell"><code class="language-shell">streamlit run app.py --server.port 8888
</code></pre>
<p><img src="84b43eac.png"></p>
<h2 id="3-Integration-of-Frontend-amp-Backend"><a href="#3-Integration-of-Frontend-amp-Backend" class="headerlink" title="3. Integration of Frontend &amp; Backend"></a>3. Integration of Frontend &amp; Backend</h2><pre class=" language-dotenv"><code class="language-dotenv"># OPENAI_API_KEY="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"
OPENAI_API_KEY="sk-Qg2sQRe2BTRDkjXCAaCa243017994a8aBf2e5bC26aE8Af99"
OPENAI_API_BASE="https://oneapi.xty.app/v1"
</code></pre>
<p>what is a laptop?</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token comment" spellcheck="true"># from langchain_community.llms import OpenAI</span>
<span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token comment" spellcheck="true"># from langchain import FewShotPromptTemplate</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> FewShotPromptTemplate
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>example_selector <span class="token keyword">import</span> LengthBasedExampleSelector
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">9</span><span class="token punctuation">)</span>

examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># %% UI</span>
<span class="token comment" spellcheck="true"># %% 页面基本配置</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
    page_title<span class="token operator">=</span><span class="token string">'Marketing Tool'</span><span class="token punctuation">,</span>
    page_icon<span class="token operator">=</span><span class="token string">':robot:'</span><span class="token punctuation">,</span>
    layout<span class="token operator">=</span><span class="token string">'centered'</span><span class="token punctuation">,</span>
    initial_sidebar_state<span class="token operator">=</span><span class="token string">'collapsed'</span>
<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 页面头部显示内容</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"Hey, How can I help you?"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建 text area</span>
form_input <span class="token operator">=</span> st<span class="token punctuation">.</span>text_area<span class="token punctuation">(</span><span class="token string">'Enter text'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">275</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
tasktype_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'Please select the action to be performed?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Write a sales copy'</span><span class="token punctuation">,</span> <span class="token string">'Create a tweet'</span><span class="token punctuation">,</span> <span class="token string">'Write a product description'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
age_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'For which age group?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Kid'</span><span class="token punctuation">,</span> <span class="token string">'Adult'</span><span class="token punctuation">,</span> <span class="token string">'senior Citizen'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建滑动条, 取值范围1~200, 初始值25</span>
numberOfWords <span class="token operator">=</span> st<span class="token punctuation">.</span>slider<span class="token punctuation">(</span><span class="token string">'Words limit'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建按钮</span>
submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Generate"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% backend</span>
example_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {query}
Response: {answer}
"""</span>

example_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token operator">=</span>example_template
<span class="token punctuation">)</span>

prefix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a {template_age_option}, and {template_tasktype_option}: 
Here are some examples: 
"""</span>

suffix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Question: {template_userInput}
Response: """</span>

example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    max_length<span class="token operator">=</span><span class="token number">200</span>
<span class="token punctuation">)</span>

new_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    example_selector<span class="token operator">=</span>example_selector<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># use example_selector instead of examples</span>
    example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
    prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
    suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"template_userInput"</span><span class="token punctuation">,</span> <span class="token string">'template_age_option'</span><span class="token punctuation">,</span> <span class="token string">'template_tasktype_option'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    example_separator<span class="token operator">=</span><span class="token string">"\n"</span>
<span class="token punctuation">)</span>

query <span class="token operator">=</span> form_input

<span class="token comment" spellcheck="true"># print(new_prompt_template.format(</span>
<span class="token comment" spellcheck="true">#     template_userInput=query,</span>
<span class="token comment" spellcheck="true">#     template_age_option=age_option,</span>
<span class="token comment" spellcheck="true">#     template_tasktype_option=tasktype_option</span>
<span class="token comment" spellcheck="true"># ))</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>
    template_userInput<span class="token operator">=</span>query<span class="token punctuation">,</span>
    template_age_option<span class="token operator">=</span>age_option<span class="token punctuation">,</span>
    template_tasktype_option<span class="token operator">=</span>tasktype_option
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="4-Modularization-of-Code"><a href="#4-Modularization-of-Code" class="headerlink" title="4. Modularization of Code"></a>4. Modularization of Code</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token comment" spellcheck="true"># from langchain_community.llms import OpenAI</span>
<span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token comment" spellcheck="true"># from langchain import FewShotPromptTemplate</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> FewShotPromptTemplate
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>example_selector <span class="token keyword">import</span> LengthBasedExampleSelector
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% UI</span>
<span class="token comment" spellcheck="true"># %% 页面基本配置</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
    page_title<span class="token operator">=</span><span class="token string">'Marketing Tool'</span><span class="token punctuation">,</span>
    page_icon<span class="token operator">=</span><span class="token string">':robot:'</span><span class="token punctuation">,</span>
    layout<span class="token operator">=</span><span class="token string">'centered'</span><span class="token punctuation">,</span>
    initial_sidebar_state<span class="token operator">=</span><span class="token string">'collapsed'</span>
<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 页面头部显示内容</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"Hey, How can I help you?"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建 text area</span>
form_input <span class="token operator">=</span> st<span class="token punctuation">.</span>text_area<span class="token punctuation">(</span><span class="token string">'Enter text'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">275</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
tasktype_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'Please select the action to be performed?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Write a sales copy'</span><span class="token punctuation">,</span> <span class="token string">'Create a tweet'</span><span class="token punctuation">,</span> <span class="token string">'Write a product description'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
age_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'For which age group?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Kid'</span><span class="token punctuation">,</span> <span class="token string">'Adult'</span><span class="token punctuation">,</span> <span class="token string">'senior Citizen'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建滑动条, 取值范围1~200, 初始值25</span>
numberOfWords <span class="token operator">=</span> st<span class="token punctuation">.</span>slider<span class="token punctuation">(</span><span class="token string">'Words limit'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建按钮</span>
submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Generate"</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># %% backend</span>
<span class="token keyword">def</span> <span class="token function">getLLMResponse</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> age_option<span class="token punctuation">,</span> tasktype_option<span class="token punctuation">)</span><span class="token punctuation">:</span>
    llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">9</span><span class="token punctuation">)</span>

    examples <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
            <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>

    example_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    Question: {query}
    Response: {answer}
    """</span>

    example_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
        input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        template<span class="token operator">=</span>example_template
    <span class="token punctuation">)</span>

    prefix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a {template_age_option}, and {template_tasktype_option}: 
    Here are some examples: 
    """</span>

    suffix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    Question: {template_userInput}
    Response: """</span>

    example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
        examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
        example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
        max_length<span class="token operator">=</span><span class="token number">200</span>
    <span class="token punctuation">)</span>

    new_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
        example_selector<span class="token operator">=</span>example_selector<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># use example_selector instead of examples</span>
        example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
        prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
        suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
        input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"template_userInput"</span><span class="token punctuation">,</span> <span class="token string">'template_age_option'</span><span class="token punctuation">,</span> <span class="token string">'template_tasktype_option'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        example_separator<span class="token operator">=</span><span class="token string">"\n"</span>
    <span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># print(new_prompt_template.format(</span>
    <span class="token comment" spellcheck="true">#     template_userInput=query,</span>
    <span class="token comment" spellcheck="true">#     template_age_option=age_option,</span>
    <span class="token comment" spellcheck="true">#     template_tasktype_option=tasktype_option</span>
    <span class="token comment" spellcheck="true"># ))</span>

    res <span class="token operator">=</span> llm<span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>
        template_userInput<span class="token operator">=</span>query<span class="token punctuation">,</span>
        template_age_option<span class="token operator">=</span>age_option<span class="token punctuation">,</span>
        template_tasktype_option<span class="token operator">=</span>tasktype_option
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token keyword">return</span> res


<span class="token comment" spellcheck="true"># 如果点击了按钮</span>
<span class="token keyword">if</span> submit<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 显示到页面</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>getLLMResponse<span class="token punctuation">(</span>form_input<span class="token punctuation">,</span> age_option<span class="token punctuation">,</span> tasktype_option<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="5-Adding-Examples-Kids-Adult-amp-Senior-Citizen"><a href="#5-Adding-Examples-Kids-Adult-amp-Senior-Citizen" class="headerlink" title="5. Adding Examples - Kids, Adult &amp; Senior Citizen"></a>5. Adding Examples - Kids, Adult &amp; Senior Citizen</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token comment" spellcheck="true"># from langchain_community.llms import OpenAI</span>
<span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate
<span class="token comment" spellcheck="true"># from langchain import FewShotPromptTemplate</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> FewShotPromptTemplate
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>example_selector <span class="token keyword">import</span> LengthBasedExampleSelector
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># %% UI</span>
<span class="token comment" spellcheck="true"># %% 页面基本配置</span>
st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
    page_title<span class="token operator">=</span><span class="token string">'Marketing Tool'</span><span class="token punctuation">,</span>
    page_icon<span class="token operator">=</span><span class="token string">':robot:'</span><span class="token punctuation">,</span>
    layout<span class="token operator">=</span><span class="token string">'centered'</span><span class="token punctuation">,</span>
    initial_sidebar_state<span class="token operator">=</span><span class="token string">'collapsed'</span>
<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 页面头部显示内容</span>
st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"Hey, How can I help you?"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建 text area</span>
form_input <span class="token operator">=</span> st<span class="token punctuation">.</span>text_area<span class="token punctuation">(</span><span class="token string">'Enter text'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">275</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
tasktype_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'Please select the action to be performed?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Write a sales copy'</span><span class="token punctuation">,</span> <span class="token string">'Create a tweet'</span><span class="token punctuation">,</span> <span class="token string">'Write a product description'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建单选框</span>
age_option <span class="token operator">=</span> st<span class="token punctuation">.</span>selectbox<span class="token punctuation">(</span>
    <span class="token string">'For which age group?'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># 选项</span>
    <span class="token punctuation">(</span><span class="token string">'Kid'</span><span class="token punctuation">,</span> <span class="token string">'Adult'</span><span class="token punctuation">,</span> <span class="token string">'Senior Citizen'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建滑动条, 取值范围1~200, 初始值25</span>
numberOfWords <span class="token operator">=</span> st<span class="token punctuation">.</span>slider<span class="token punctuation">(</span><span class="token string">'Words limit'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建按钮</span>
submit <span class="token operator">=</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Generate"</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># %% backend</span>
<span class="token keyword">def</span> <span class="token function">getLLMResponse</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> age_option<span class="token punctuation">,</span> tasktype_option<span class="token punctuation">)</span><span class="token punctuation">:</span>
    llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token punctuation">.</span><span class="token number">9</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> age_option <span class="token operator">==</span> <span class="token string">"Kid"</span><span class="token punctuation">:</span>

        examples <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>

    <span class="token keyword">elif</span> age_option <span class="token operator">==</span> <span class="token string">"Adult"</span><span class="token punctuation">:</span>
        examples <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>

    <span class="token keyword">elif</span> age_option <span class="token operator">==</span> <span class="token string">"Senior Citizen"</span><span class="token punctuation">:</span>
        examples <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is a mobile?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"A mobile is a magical device that fits in your pocket, like a mini-enchanted playground. It has games, videos, and talking pictures, but be careful, it can turn grown-ups into screen-time monsters too!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What are your dreams?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My dreams are like colorful adventures, where I become a superhero and save the day! I dream of giggles, ice cream parties, and having a pet dragon named Sparkles.."</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">" What are your ambitions?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"I want to be a super funny comedian, spreading laughter everywhere I go! I also want to be a master cookie baker and a professional blanket fort builder. Being mischievous and sweet is just my bonus superpower!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What happens when you get sick?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"When I get sick, it's like a sneaky monster visits. I feel tired, sniffly, and need lots of cuddles. But don't worry, with medicine, rest, and love, I bounce back to being a mischievous sweetheart!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"WHow much do you love your dad?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Oh, I love my dad to the moon and back, with sprinkles and unicorns on top! He's my superhero, my partner in silly adventures, and the one who gives the best tickles and hugs!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Tell me about your friend?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"My friend is like a sunshine rainbow! We laugh, play, and have magical parties together. They always listen, share their toys, and make me feel special. Friendship is the best adventure!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What math means to you?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Math is like a puzzle game, full of numbers and shapes. It helps me count my toys, build towers, and share treats equally. It's fun and makes my brain sparkle!"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"What is your fear?"</span><span class="token punctuation">,</span>
                <span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string">"Sometimes I'm scared of thunderstorms and monsters under my bed. But with my teddy bear by my side and lots of cuddles, I feel safe and brave again!"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>

    example_template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    Question: {query}
    Response: {answer}
    """</span>

    example_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
        input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        template<span class="token operator">=</span>example_template
    <span class="token punctuation">)</span>

    prefix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""You are a {template_age_option}, and {template_tasktype_option}: 
    Here are some examples: 
    """</span>

    suffix <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    Question: {template_userInput}
    Response: """</span>

    example_selector <span class="token operator">=</span> LengthBasedExampleSelector<span class="token punctuation">(</span>
        examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
        example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
        max_length<span class="token operator">=</span><span class="token number">200</span>
    <span class="token punctuation">)</span>

    new_prompt_template <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
        example_selector<span class="token operator">=</span>example_selector<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># use example_selector instead of examples</span>
        example_prompt<span class="token operator">=</span>example_prompt<span class="token punctuation">,</span>
        prefix<span class="token operator">=</span>prefix<span class="token punctuation">,</span>
        suffix<span class="token operator">=</span>suffix<span class="token punctuation">,</span>
        input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"template_userInput"</span><span class="token punctuation">,</span> <span class="token string">'template_age_option'</span><span class="token punctuation">,</span> <span class="token string">'template_tasktype_option'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        example_separator<span class="token operator">=</span><span class="token string">"\n"</span>
    <span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># print(new_prompt_template.format(</span>
    <span class="token comment" spellcheck="true">#     template_userInput=query,</span>
    <span class="token comment" spellcheck="true">#     template_age_option=age_option,</span>
    <span class="token comment" spellcheck="true">#     template_tasktype_option=tasktype_option</span>
    <span class="token comment" spellcheck="true"># ))</span>

    res <span class="token operator">=</span> llm<span class="token punctuation">(</span>new_prompt_template<span class="token punctuation">.</span>format<span class="token punctuation">(</span>
        template_userInput<span class="token operator">=</span>query<span class="token punctuation">,</span>
        template_age_option<span class="token operator">=</span>age_option<span class="token punctuation">,</span>
        template_tasktype_option<span class="token operator">=</span>tasktype_option
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token keyword">return</span> res


<span class="token comment" spellcheck="true"># 如果点击了按钮</span>
<span class="token keyword">if</span> submit<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 显示到页面</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>getLLMResponse<span class="token punctuation">(</span>form_input<span class="token punctuation">,</span> age_option<span class="token punctuation">,</span> tasktype_option<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="11-Langchain-Memory-Module-Concept"><a href="#11-Langchain-Memory-Module-Concept" class="headerlink" title="11. Langchain - Memory Module Concept"></a>11. Langchain - Memory Module Concept</h1>
            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://malred.github.io" class="b-link-green">malred-blog</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2024/01/25/ai/langchain/langchain-masterclass-build-12-openai-llm-apps-using-python/4ae2c677/" class="b-link-green">LangChain MasterClass-Build 12 OpenAI LLM Apps using Python</a>
                </p>
            </div>
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '676b06df8b7379e50e35',
        clientSecret: '9159b4de0f716ba7bdab9bc02151a90e6961246b',
        repo: 'comment_repo',
        owner: 'malred',
        admin: "malred",
        id: '2024-01-25T18-48-38',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    
        <link rel="stylesheet" href="/libs/gitment/gitment-default.css">
<link rel="stylesheet" href="/css/gitment.css">

<div class="gitment-card card" data-aos="fade-up">
    <div id="gitment-content" class="card-content"></div>
</div>

<script src="/libs/gitment/gitment.js"></script>
<script>
var gitment = new Gitment({
    id: 'Thu Jan 25 2024 18:48:38 GMT+0800',
    owner: 'malred',
    repo: 'comment_repo',
    oauth: {
        client_id: '676b06df8b7379e50e35',
        client_secret: '9159b4de0f716ba7bdab9bc02151a90e6961246b'
    }
});

gitment.render('gitment-content');
</script>
    

    
        <div class="disqus-card card" data-aos="fade-up">
    <div id="disqus_thread" class="card-content">
        <noscript>Please enable JavaScript to view the
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
</div>

<script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'https://malred.github.io/2024/01/25/ai/langchain/langchain-masterclass-build-12-openai-llm-apps-using-python/4ae2c677/';
        this.page.identifier = '/2024/01/25/ai/langchain/langchain-masterclass-build-12-openai-llm-apps-using-python/4ae2c677/';
        this.page.title = 'LangChain MasterClass-Build 12 OpenAI LLM Apps using Python';
    };
    let disqus_shortname = '';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'mipjlux8dRwbE7yY1zP3v13z-gzGzoHsz',
        appKey: 'cIy0pwvRAK8cuOCZRjuoHHfy',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '留下友善的评论~'
    });
</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/01/25/ai/langchain/langchain-legends-build-legendary-ai-apps-with-javascript/4ae2c677/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Langchain Legends Build legendary AI apps with Javascript">
                        
                        <span class="card-title">Langchain Legends Build legendary AI apps with Javascript</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary"></div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2024-01-25
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/ai/" class="post-category" target="_blank">
                                    ai
                                </a>
                            
                            <a href="/categories/ai/langChain/" class="post-category" target="_blank">
                                    langChain
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ai/" target="_blank">
                        <span class="chip bg-color">ai</span>
                    </a>
                    
                    <a href="/tags/langChain/" target="_blank">
                        <span class="chip bg-color">langChain</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/01/24/backend/scala/scala-functional-programming-essentials-rock-the-jvm/4ae2c677/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="Scala & Functional Programming Essentials  Rock the JVM">
                        
                        <span class="card-title">Scala & Functional Programming Essentials  Rock the JVM</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">1. Getting Started!
//src/playground/javaPlayground.java
package org.malred.playground;

public class javaPlayground {
 </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2024-01-24
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/scala/" class="post-category" target="_blank">
                                    scala
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/scala/" target="_blank">
                        <span class="chip bg-color">scala</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://blinkfox.github.io/" target="_blank">Blinkfox</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建.

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">733.9k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/malred" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:malguy2022@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2725953379" class="tooltipped" data-tooltip="QQ联系我: 2725953379" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input" autofocus="">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<!--动态线条背景-->
<script type="text/javascript" color="122 103 238" opacity='0.7' zIndex="-2" count="200"
    src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
    </script>
<script src="/js/matery.js"></script>
<script src="/js/snow.js"></script>

<!-- 引用Aplayer和metingjs -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script>
<div id="my-aplayer" class="aplayer" data-id="7363940489" data-server="netease" data-type="playlist" data-fixed="true"
    // 吸底模式可以固定播放器于页面底部 data-autoplay="true" data-order="list" data-volume="0.55" data-theme="#cc543a"
    data-preload="auto"></div>  
<!-- <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script> -->
<!-- <script src="https://cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script>
    // 对所有链接跳转事件绑定pjax容器container
    $(document).pjax('a[target!=_blank]', '.container', { fragment: '.container', timeout: 8000 })
</script> -->


<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-MSEYRC5EW5"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'G-MSEYRC5EW5');
</script>



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>